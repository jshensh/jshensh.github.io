<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 10 页 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/about.html">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2015/02/09/PHP 利用 redis 做统计缓存mysql的压力/"><span>PHP 利用 redis 做统计缓存mysql的压力</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/02/09/PHP 利用 redis 做统计缓存mysql的压力/" rel="bookmark">
        <time class="entry-date published" datetime="2015-02-09T07:41:09.000Z">
          2015-02-09
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    header(<span class="string">"Content-Type:text/html;charset=utf-8"</span>);</span><br><span class="line">    <span class="keyword">include</span> <span class="string">'lib/mysql.class.php'</span>;</span><br><span class="line">    $mysql_obj = mysql::getConn();</span><br><span class="line">    <span class="comment">//redis </span></span><br><span class="line">    $redis = <span class="keyword">new</span> Redis();</span><br><span class="line">    $redis-&gt;pconnect(<span class="string">'127.0.0.1'</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_REFERER'</span>]))&#123;</span><br><span class="line">        $url_md5 = md5($_SERVER[<span class="string">'HTTP_REFERER'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    $adve_key = <span class="string">'adve'</span>; </span><br><span class="line">    $adve_key_exists = <span class="string">'adve_exists'</span>;</span><br><span class="line">    <span class="keyword">if</span>(!$redis-&gt;exists($adve_key_exists))&#123;</span><br><span class="line">        $list = $mysql_obj-&gt;fetch_array(<span class="string">"select * from user_online_adve"</span>);</span><br><span class="line">        <span class="keyword">if</span>($list)&#123;</span><br><span class="line">            <span class="keyword">foreach</span> ($list <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">                $url_hash = md5($value[<span class="string">'adve_url'</span>]);</span><br><span class="line">                $adve_hash_key = $adve_key.<span class="string">":"</span>.$url_hash;</span><br><span class="line">                $id = $value[<span class="string">'id'</span>];</span><br><span class="line">                $redis-&gt;set($adve_hash_key,$id);</span><br><span class="line">                $redis-&gt;set($adve_key_exists,<span class="keyword">true</span>);</span><br><span class="line">                <span class="comment">//$redis-&gt;hmset($adve_hash_key, array('id' =&gt;$id));</span></span><br><span class="line">                <span class="comment">//print_r($redis-&gt;get($adve_hash_key));</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $adve_new_key = $adve_key.<span class="string">':'</span>.$url_md5;</span><br><span class="line">    <span class="keyword">if</span>($redis-&gt;exists($adve_new_key))&#123;</span><br><span class="line">            $adve_plus = $adve_new_key.<span class="string">":plus"</span> ;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(!$redis-&gt;exists($adve_plus))&#123;</span><br><span class="line">                $redis-&gt;set($adve_plus,<span class="number">1</span>);  </span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                $redis-&gt;incr($adve_plus);</span><br><span class="line">                $num = $redis-&gt;get($adve_plus);</span><br><span class="line">                <span class="keyword">if</span>($num &gt;<span class="number">10</span>)&#123;</span><br><span class="line">                    $id = $redis-&gt;get($adve_new_key);</span><br><span class="line">                    <span class="comment">// insert to sql;</span></span><br><span class="line">                    $mysql_obj-&gt;query(<span class="string">"update user_online_adve set adve_num=adve_num+$num where id=$id"</span>);</span><br><span class="line">                    $redis-&gt;set($adve_plus,<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    header(<span class="string">'HTTP/1.0 301 Moved Permanently'</span>);</span><br><span class="line">    header(<span class="string">'Location: https://itunes.apple.com/cn/app/san-guo-zhi15-ba-wangno-da-lu/id694974270?mt=8'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    if()&#123;</span></span><br><span class="line"><span class="comment">            $adve_plus = $adve_key.":plus" ;</span></span><br><span class="line"><span class="comment">            if($redis-&gt;exists($adve_plus))&#123;</span></span><br><span class="line"><span class="comment">                $redis-&gt;incr($adve_plus);</span></span><br><span class="line"><span class="comment">            &#125;else&#123;</span></span><br><span class="line"><span class="comment">                $redis-&gt;set($adve_plus,1);  </span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            echo $redis-&gt;get($adve_plus);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    foreach ($list as $key =&gt; $value) &#123;</span></span><br><span class="line"><span class="comment">            $url_hash = md5($value['adve_url']);</span></span><br><span class="line"><span class="comment">            $id = $value['id'];</span></span><br><span class="line"><span class="comment">            $adve_num = $value['adve_num'];</span></span><br><span class="line"><span class="comment">            $adve_plus = $adve_key.":plus" ;</span></span><br><span class="line"><span class="comment">            if($redis-&gt;exists($adve_plus))&#123;</span></span><br><span class="line"><span class="comment">                $redis-&gt;incr($adve_plus);</span></span><br><span class="line"><span class="comment">            &#125;else&#123;</span></span><br><span class="line"><span class="comment">                $redis-&gt;set($adve_plus,1);  </span></span><br><span class="line"><span class="comment">            &#125;</span></span><br><span class="line"><span class="comment">            echo $redis-&gt;get($adve_plus);</span></span><br><span class="line"><span class="comment">            //if($redis-&gt;)</span></span><br><span class="line"><span class="comment">            //$redis-&gt;hmset($adve_key, array('id' =&gt;$id, 'adve_num'=&gt;$adve_num));</span></span><br><span class="line"><span class="comment">            //print_r($redis-&gt;hmget("adve:$url_hash", array('adve_num')));</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        print_r($list);</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>转载自 <a href="http://www.cnblogs.com/jackluo/p/3401999.html" target="_blank" rel="noopener">http://www.cnblogs.com/jackluo/p/3401999.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/02/09/PHP 利用 redis 做统计缓存mysql的压力/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/02/08/php class中public,private,protected,static的区别，以及实例/"><span>php class中public,private,protected,static的区别，以及实例</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/02/08/php class中public,private,protected,static的区别，以及实例/" rel="bookmark">
        <time class="entry-date published" datetime="2015-02-08T08:16:35.000Z">
          2015-02-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>一，public,private,protected的区别</strong><br>public:权限是最大的，可以内部调用，实例调用等。<br>protected: 受保护类型，用于本类和继承类调用。<br>private: 私有类型，只有在本类中使用。</p>
<p><strong>二，实例</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> $public;</span><br><span class="line"> <span class="keyword">private</span> $private;</span><br><span class="line"> <span class="keyword">protected</span> $protected;</span><br><span class="line"> <span class="keyword">static</span> $instance;</span><br><span class="line"> <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;public    = <span class="string">'public     &lt;br&gt;'</span>;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;private   = <span class="string">'private    &lt;br&gt;'</span>;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;protected = <span class="string">'protected  &lt;br&gt;'</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">tank</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">self</span>::$instance[get_class()]))</span><br><span class="line"> &#123;</span><br><span class="line"> $c = get_class();</span><br><span class="line"> <span class="keyword">self</span>::$instance = <span class="keyword">new</span> $c;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">self</span>::$instance;</span><br><span class="line"> &#125;    </span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pub_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request public function&lt;br&gt;"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;public;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;private;        <span class="comment">//private,内部可以调用</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;protected;      <span class="comment">//protected,内部可以调用</span></span><br><span class="line"> <span class="keyword">$this</span>-&gt;pri_function();      <span class="comment">//private方法，内部可以调用</span></span><br><span class="line"> <span class="keyword">$this</span>-&gt;pro_function();      <span class="comment">//protected方法，内部可以调用</span></span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">protected</span>  <span class="function"><span class="keyword">function</span> <span class="title">pro_function</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request protected function&lt;br&gt;"</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">pri_function</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request private function&lt;br&gt;"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$test = test::tank();</span><br><span class="line"><span class="keyword">echo</span> $test-&gt;public;</span><br><span class="line"><span class="keyword">echo</span> $test-&gt;private;    <span class="comment">//Fatal error: Cannot access private property test::$private</span></span><br><span class="line"><span class="keyword">echo</span> $test-&gt;protected;  <span class="comment">//Fatal error: Cannot access protected property test::$protected</span></span><br><span class="line">$test-&gt;pub_function();</span><br><span class="line">$test-&gt;pro_function();  <span class="comment">//Fatal error: Call to protected method test::pro_function() from context</span></span><br><span class="line">$test-&gt;pri_function();  <span class="comment">//Fatal error: Call to private method test::pri_function() from context</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>从上面的例子中，我们可以看出，<br>public:    可以class内部调用，可以实例化调用。<br>private:   可以class内部调用，实例化调用报错。<br>protected：  可以class内部调用，实例化调用报错。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> $public;</span><br><span class="line"> <span class="keyword">private</span> $private;</span><br><span class="line"> <span class="keyword">protected</span> $protected;</span><br><span class="line"> <span class="keyword">static</span> $instance;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;public    = <span class="string">'public     &lt;br&gt;'</span>;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;private   = <span class="string">'private    &lt;br&gt;'</span>;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;protected = <span class="string">'protected  &lt;br&gt;'</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">tank</span><span class="params">()</span></span>&#123;                          <span class="comment">//私有方法不能继承，换成public,protected</span></span><br><span class="line"> <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="keyword">self</span>::$instance[get_class()]))</span><br><span class="line"> &#123;</span><br><span class="line"> $c = get_class();</span><br><span class="line"> <span class="keyword">self</span>::$instance = <span class="keyword">new</span> $c;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">self</span>::$instance;</span><br><span class="line"> &#125;    </span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pub_function</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request public function&lt;br&gt;"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;public;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">protected</span>  <span class="function"><span class="keyword">function</span> <span class="title">pro_function</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request protected function&lt;br&gt;"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;protected;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">pri_function</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request private function&lt;br&gt;"</span>;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;private;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">test1</span> <span class="keyword">extends</span> <span class="title">test</span></span>&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">parent</span>::tank();</span><br><span class="line"> <span class="keyword">parent</span>::__construct();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tank</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;public;</span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;private;       <span class="comment">//Notice: Undefined property: test1::$private</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;protected;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;pub_function();</span><br><span class="line"> <span class="keyword">$this</span>-&gt;pro_function();</span><br><span class="line"> <span class="keyword">$this</span>-&gt;pri_function();    <span class="comment">//Fatal error: Call to private method test::pri_function() from context 'test1'</span></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span>  <span class="function"><span class="keyword">function</span> <span class="title">pro_extends_function</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request extends_protected function&lt;br&gt;"</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pri_extends_function</span><span class="params">()</span></span>&#123;</span><br><span class="line"> <span class="keyword">echo</span> <span class="string">"you request extends_private function&lt;br&gt;"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line">$test = <span class="keyword">new</span> test1();</span><br><span class="line">$test -&gt; tank();       <span class="comment">//子类和父类有相同名字的属性和方法，实例化子类时，子类的中的属性和方法会盖掉父类的。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>从上面的例子中，我们可以看出，<br>public:    test中的public可以被继承。<br>private:   test中的private不可以被继承。<br>protected：  test中的protected可以被继承。<br>static：        test中的static可以被继承。</p>
<p>转载自 <a href="http://blog.163.com/wz_pk007/blog/static/170627050201143104938560/" target="_blank" rel="noopener">http://blog.163.com/wz_pk007/blog/static/170627050201143104938560/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/02/08/php class中public,private,protected,static的区别，以及实例/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/02/01/MySQL的if，case语句使用总结/"><span>MySQL的if，case语句使用总结</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/02/01/MySQL的if，case语句使用总结/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-31T21:17:49.000Z">
          2015-02-01
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Mysql的if既可以作为表达式用，也可在存储过程中作为流程控制语句使用，如下是做为表达式使用：</p>
<p><strong>IF表达式</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(expr1,expr2,expr3)</span><br></pre></td></tr></table></figure></p>
<p>如果 expr1 是TRUE (expr1 &lt;&gt; 0 and expr1 &lt;&gt; NULL)，则 IF()的返回值为expr2; 否则返回值则为 expr3。IF() 的返回值为数字值或字符串值，具体情况视其所在语境而定。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *,<span class="keyword">if</span>(sva=<span class="number">1</span>,<span class="string">"男"</span>,<span class="string">"女"</span>) <span class="keyword">as</span> ssva <span class="keyword">from</span> taname <span class="keyword">where</span> sva != <span class="string">""</span></span><br></pre></td></tr></table></figure></p>
<p><strong>作为表达式的if也可以用CASE when来实现：</strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">CASE</span> sva <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">'男'</span> <span class="keyword">ELSE</span> <span class="string">'女'</span> <span class="keyword">END</span> <span class="keyword">as</span> ssva <span class="keyword">from</span> taname <span class="keyword">where</span> sva != <span class="string">''</span></span><br></pre></td></tr></table></figure></p>
<p>在第一个方案的返回结果中， value=compare-value。而第二个方案的返回结果是第一种情况的真实结果。如果没有匹配的结果值，则返回结果为ELSE后的结果，如果没有ELSE 部分，则返回值为 NULL。<br>例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span> <span class="number">1</span> <span class="keyword">WHEN</span> <span class="number">1</span> <span class="keyword">THEN</span> <span class="string">'one'</span></span><br><span class="line">  <span class="keyword">WHEN</span> <span class="number">2</span> <span class="keyword">THEN</span> <span class="string">'two'</span> </span><br><span class="line">   <span class="keyword">ELSE</span> <span class="string">'more'</span> <span class="keyword">END</span></span><br><span class="line"><span class="keyword">as</span> testCol</span><br></pre></td></tr></table></figure></p>
<p>将输出one</p>
<p><strong>IFNULL(expr1,expr2)</strong><br>假如expr1 不为 NULL，则 IFNULL() 的返回值为 expr1; 否则其返回值为 expr2。IFNULL()的返回值是数字或是字符串，具体情况取决于其所使用的语境。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT IFNULL(1,0);</span><br><span class="line">        -&gt; 1</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT IFNULL(NULL,10);</span><br><span class="line">        -&gt; 10</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT IFNULL(1/0,10);</span><br><span class="line">        -&gt; 10</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT IFNULL(1/0,'yes');</span><br><span class="line">        -&gt; 'yes'</span><br></pre></td></tr></table></figure></p>
<p>IFNULL(expr1,expr2) 的默认结果值为两个表达式中更加“通用”的一个，顺序为STRING、 REAL或 INTEGER。</p>
<p><strong>IF ELSE 做为流程控制语句使用</strong><br>if实现条件判断，满足不同条件执行不同的操作，这个我们只要学编程的都知道if的作用了，下面我们来看看mysql 存储过程中的if是如何使用的吧。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF search_condition THEN </span><br><span class="line">    statement_list  </span><br><span class="line">[ELSEIF search_condition THEN]  </span><br><span class="line">    statement_list ...  </span><br><span class="line">[ELSE </span><br><span class="line">    statement_list]  </span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span></span><br></pre></td></tr></table></figure></p>
<p>与PHP中的IF语句类似，当IF中条件search_condition成立时，执行THEN后的statement_list语句，否则判断ELSEIF中的条件，成立则执行其后的statement_list语句，否则继续判断其他分支。当所有分支的条件均不成立时，执行ELSE分支。search_condition是一个条件表达式，可以由“=、&lt;、&lt;=、&gt;、&gt;=、!=”等条件运算符组成，并且可以使用AND、OR、NOT对多个表达式进行组合。<br>例如，建立一个存储过程，该存储过程通过学生学号（student_no）和课程编号（course_no）查询其成绩（grade），返回成绩和成绩的等级，成绩大于90分的为A级，小于90分大于等于80分的为B级，小于80分大于等于70分的为C级，依次到E级。那么，创建存储过程的代码如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> dbname.proc_getGrade  </span><br><span class="line">(stu_no <span class="built_in">varchar</span>(<span class="number">20</span>),cour_no <span class="built_in">varchar</span>(<span class="number">10</span>))  </span><br><span class="line"><span class="keyword">BEGIN</span> </span><br><span class="line"><span class="keyword">declare</span> stu_grade <span class="built_in">float</span>;  </span><br><span class="line"><span class="keyword">select</span> grade <span class="keyword">into</span> stu_grade <span class="keyword">from</span> grade <span class="keyword">where</span> student_no=stu_no <span class="keyword">and</span> course_no=cour_no;  </span><br><span class="line">if stu_grade&gt;=90 then </span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">'A'</span>;  </span><br><span class="line">elseif stu_grade&lt;90 and stu_grade&gt;=80 then </span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">'B'</span>;  </span><br><span class="line">elseif stu_grade&lt;80 and stu_grade&gt;=70 then </span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">'C'</span>;  </span><br><span class="line">elseif stu_grade70 and stu_grade&gt;=60 then </span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">'D'</span>;  </span><br><span class="line">else </span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">'E'</span>;  </span><br><span class="line"><span class="keyword">end</span> <span class="keyword">if</span>;  </span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure></p>
<p>注意：IF作为一条语句，在END IF后需要加上分号“;”以表示语句结束，其他语句如CASE、LOOP等也是相同的。</p>
<p>转载自 <a href="http://outofmemory.cn/code-snippet/1149/MySQL-if-case-statement-usage-summary" target="_blank" rel="noopener">http://outofmemory.cn/code-snippet/1149/MySQL-if-case-statement-usage-summary</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/02/01/MySQL的if，case语句使用总结/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/31/请别在朋友圈侮辱我的智商/"><span>请别在朋友圈侮辱我的智商</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/31/请别在朋友圈侮辱我的智商/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-31T08:58:23.000Z">
          2015-01-31
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><img src="/uploads/2015/02/2014-10-24_11-43-17.jpg" alt="我改相信谁"><br>我读书少，我流量不多。每当我手机上网被你们逼着看看你们转的这些脑残无语乱七八糟的秘籍攻略心灵鸡汤什么的就无比心痛感觉被你们强奸了一百遍啊一百遍！深深的感受到有些人的智商真是无下限，家长老师把你们拉扯到这么大不容易你们自己却连独立思考的精神也没有，我很无奈，我很想哭。<br><img src="/uploads/2015/02/2014-10-24_11-43-18.jpg" alt="有东西"><br>1、蓝翔就是搭了谣言丑闻的顺风车，他家的挖机水平和别家也差不多；<br>2、苹果 6 里的自带地图里钓鱼岛是中国的，高速公路上日本车还是可以加油的；<br>3、羚羊才不会接力跳悬崖，金鱼的记忆才不止七秒；<br><img src="/uploads/2015/02/2014-10-24_11-43-23.jpg" alt="记忆"><br>4、腾讯才不管你一条信息转发多少次，腾讯老总的女儿也好儿子也好私生子也好不会为你冲Q币；<br>5、你大概得吃三百斤虾和十几瓶维生素C才能发生轻微砷中毒，少女被割肾的故事起源于美国远播海外；<br>6、在 ATM 上倒着输入密码只会被告知密码错误，你倒是可以试试倒输三次，当然，你密码正输倒输都一样的不在此列；<br><img src="/uploads/2015/02/2014-10-24_11-43-24.jpg" alt="比例"><br>7、喝一辈子汽水只会超重不会得白血病，吃再多米线只会因明胶而发育不良不会长所谓的细菌虫；<br>8、人乳放置几十年变的血红是因为密封不当而混进了红曲菌你们就不要用这个来赞美你妈了；<br>9、把大蒜扔进油锅里怎么炸都不会变红更别提鉴别地沟油了；<br><img src="/uploads/2015/02/2014-10-24_11-43-25.jpg" alt="地沟油"><br>10、由于头皮和头骨的阻隔，手机对大脑的辐射微乎其微请不要把手机说得有核辐射似的；<br>11、上网之后洗脸只能洗掉你脸上的灰毕竟电磁辐射是电磁波而不是什么颗粒，在电脑桌旁摆一盆仙人掌也不能吸收均匀发散的辐射，把电脑屏幕调成绿色该近视还得近视，空军从未流传过治疗近视的方法否则你让眼镜商怎么活。<br>12、你的任何手机输入什么数字都不会为你启动备用电池，毕竟你手机根本就不存在什么备用电池；<br>13、金陵十三钗根本未在日本上映还谈什么票房，南京大屠杀纪念日是 12 月 13 日而不是 9 月 12 日也不是 5 月 12 日你妹的你的近代史是怎么学的；<br><img src="/uploads/2015/02/2014-10-24_11-43-26.jpg" alt="牙膏"><br>14、牙膏管底部有个绿色色块的是纯天然牙膏黑色的就是全化学物质的，拜托那个色块只是生产线上的标记爱整啥颜色就是啥颜色，要不厂家给你整支从头到脚从里到外全是绿色的牙膏连牙齿都可以给你刷绿的好不好；<br>15、那些说你手机或者电脑收到一张带有“女人必看”、“男人必看”、“不男不女必看”之类的图片或者工资料整方案什么文件的，在任何环境下一旦打开你的手机就会爆炸电脑就会冒黑烟你的隐私艳照就会满天飞第二天你就红过冠希哥的，病毒真正侵入的是你的榆木脑袋而不是你的手机电脑，另外，冠希哥无人可以超越你尽可放心；<br>16、中国 10 大名老中医的各类偏方最近疯转，有人转的是徐文兵有人转的是叫于彤，内容一样年纪一样都是 98 岁，第一条就是香蕉皮 30 克晒干煎水可以降血压看到这第一条我就笑了。大家就不会自己去百度一下徐文兵吗？他 1966 年出生我的数学老师死的早 66 年出生的人今年多大我不会算，但肯定不是 TM 的 98 岁，干脆你说太上老君说我倒真心信了神仙说的谁敢不信是不是，我只说一句话得了病你还是去医院比较靠谱除非你想早点去见马克思。<br><img src="/uploads/2015/02/2014-10-24_11-43-261.jpg" alt="马克思"><br>17、最近电影亲爱的让大家爱心爆棚，什么加油站一辆卖天津大麻花的货车正在加油最后发现堆放麻花扳子下传来了 9 个孩子的哭叫声，原来卖天津大麻花的还兼职卖人卖器官真是吓得你一脸的狗血，我就想问问你妹的你看过卖天津大麻花的标准制式车辆没有 9 个 10 岁的孩子你给我塞进去看看，我真想把这个谣言一个字一个字的塞进你巨大的菊花里，真 9 个孩子被关着一个个器官切着卖那不成了中国第一大案了你也太小看警察蜀黎的能力了。<br>18、那些被人喷了一口烟点了一下穴瞪了一小眼就迷迷糊糊被人骗走钱财骗走身体骗走一切的人，大都是贪财爱占小便宜结果鸡飞蛋打上当了也哒屁无法和老公老婆家人孩子交代了，急中生智把自己被猪油蒙了心的行为都怪到这些武侠穿越修仙小说中才会出现的事情上去，你要信了你的智力大概也是-250。<br>实在是有太多谣言，八妹加上脚趾头都数不过来了，还是自己看图吧！<br>1、微波炉辐射会致癌<br><img src="/uploads/2015/02/2014-10-24_11-43-28.jpg" alt="致癌"><br>2、柿子和蟹、虾和水果、豆浆和鸡蛋等混吃会中毒<br><img src="/uploads/2015/02/2014-10-24_11-43-29.jpg" alt="食物"><br>3、酸性体质能致病<br><img src="/uploads/2015/02/2014-10-24_11-43-31.jpg" alt="致病"><br>4、指甲月牙越多越健康<br><img src="/uploads/2015/02/2014-10-24_11-43-311.jpg" alt="指甲"><br>5、宿便是健康杀手<br><img src="/uploads/2015/02/2014-10-24_11-43-32.jpg" alt="宿便"><br>6、孕妇必须穿防辐射服<br><img src="/uploads/2015/02/2014-10-24_11-43-35.jpg" alt="孕妇"><br>7、可乐杀精<br><img src="/uploads/2015/02/2014-10-24_11-43-41.jpg" alt="精子"><br>8、购物小票会致癌<br><img src="/uploads/2015/02/2014-10-24_11-43-42.jpg" alt="购物票"><br>9、柠檬水能减肥抗癌<br><img src="/uploads/2015/02/2014-10-24_11-43-44.jpg" alt="柠檬水"><br>这还没完呢~赶紧上个厕所咱继续！<br>手机 7 大谣言大起底！你被忽悠了吗？<br>一、55 秒通话等于 1 分钟？<br><img src="/uploads/2015/02/2014-10-24_11-43-45.jpg" alt="时钟"><br>【传言】不要赶着凑够 1 分钟通话。很多人打电话时候常会为正好赶在 1 分钟前结束而庆幸，其实，在你通话到 55 秒的时候就已经算 1 分钟了，所以 55 秒-1 分钟的通话其实是算你两分钟的钱。<br>【求证】国内统一执行打满 1 分钟时计下 1 分钟的费用。但不排除有个例的情况出现，就像有些加油站部分工作人员，通过不当手段短斤少两。但从技术上来说，在这个方面偷费，也很难做到。<br>【结论】这条流传已久的“经验”，原来是假的。<br>二、手机都有“隐形电池”？<br><img src="/uploads/2015/02/2014-10-24_11-43-46.jpg" alt="yinxing.webp"><br>【传言】你的手机电量不足了，为了让它能够继续使用，按<em>3370#键，手机会重新启动，启动完毕后，你就会发现电量增加了 50%。<br>【实验】在一部电量不足三星手机上，依次输入</em>3370#键，手机无任何反应，然后点送发射键，手机显示“UsSd 代码运行中”。这几个字还未仔细看清，又直接跳转为“连接问题或无效 MMI 代码*确定”，再按下确定键，手机复原为初始状态。换用多部其他各型号手机，均是如此。<br>【求证】网络辟谣称，在我们生活的这个三次元世界里，隐形电池是不存在的。拆开一部手机，你会发现内部没有任何“隐形电池”存在的踪影，而且手机厂家也完全没有理由去设置这样一项功能。<br>【结论】这一条也是假的！<br>三、没卡也能打“110”？<br><img src="/uploads/2015/02/2014-10-24_11-43-47.jpg" alt="110"><br>【传言】全世界的手机都可以拨打的共同紧急救援号码是 112，假如你发现自己所在地区无信号覆盖，同时你又遇到了紧急状况，用你的手机拨打 112 准没错，因为这时候你的手机会自动搜索所有可用的网络并建立起紧急呼叫。<br>【实验】拿掉手机卡，小e尝试拨打了 110、119 等紧急电话，结果表明，拨打这些号码时，会有语音提示，但并未接通。也就是说，在无卡状态下，手机并不能实现电话报警。<br>【求证】网络答案称，国内呼叫 112 并无实际作用，它会自动转接一个语音提示，“匪警请拨 110，火警请拨 119……”而呼叫 110、119、120 等中国紧急号码还是需要手机接入 SIM 卡提供商的网络，与普通通话一样。<br>尽管这种做法符合 GSM 的规范，但是为了更好的实施紧急救援，还有待国内服务商完善。<br>【结论】这一条其实不完全算是“谣言”，但在国内没有实际用处，若在国外遇险，可尝试使用这种方法求救。<br>四、手机一格电，辐射大千倍？<br><img src="/uploads/2015/02/2014-10-24_11-43-48.jpg" alt="辐射"><br>【传言】手机剩一格时不要使用：收讯满格与只剩一格时相比，发射强度竟然相差 1000 倍以上。<br>【求证】通常人们说的手机辐射强度是指手机的发信功率，也就是手机发射出来承载着语音和数据信号的电磁波的功率。这个强度与手机的剩余电量没有任何关系，但和手机信号的强度有一定的关系。<br>手机信号的强弱，与基站远近有关，也受高山阻挡或其他信号干扰的影响，这与电量关系不大。这个传言的始作俑者应该是混淆了手机“一格电”和“一格信号”这两种情况。<br>【结论】完全不靠谱。<br>五、手机连线远程开车锁？<br><img src="/uploads/2015/02/2014-10-24_11-43-49.jpg" alt="车锁"><br>【传言】车用遥控器落在车里，通过手机通话远程遥控开锁。<br>【求证】对此，网络辟谣称：汽车遥控器发射的电波频率大多集中在 315Mhz 和 433Mhz 左右，而无论 2G 还是 3G 手机，使用的电波频率都高于这个数值，两者“语言不同”。<br>【结论】简单讲，这条传言是假的！<br>六、边充电边接电话危险？<br><img src="/uploads/2015/02/2014-10-24_11-43-55.jpg" alt="充电"><br>【传言】当手机正在充电时，请勿接电话！原因是手机在充电时，接听会有潜在危险。<br>【求证】经过安全测试的手机不会发生此类情况，充电时接听也是安全的。但不排除没有使用原装设备充电导致手机发热、爆炸等极端情况发生。<br>【结论】直接用交流电充电时，最好拔下电源再接听。<br>七、关机也会泄露行踪？<br>【传言】手机即使在关机状态，只要有电池，远程的程序就能激活它，暴露你的坐标。万全的办法就是将手机的电池取出，彻底断绝电源。<br>【求证】这条流言的产生估计是受了许多高科技谍战电影的影响。窃听技术的发展历史悠久且被各国情报部门所青睐，最新的技术对大多数人来说都不可能了解到，也让这条流言难以证伪。但至少我们普通人无需担心，因为普通的手机是不具备这种功能的。<br>【结论】通常情况下，无需担心。</p>
<p>转载自 <a href="http://www.sum16.com/please-dont-insult-my-intelligence-in-the-circle-of-friends.html" target="_blank" rel="noopener">http://www.sum16.com/please-dont-insult-my-intelligence-in-the-circle-of-friends.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/杂七杂八/">杂七杂八</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/31/请别在朋友圈侮辱我的智商/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/30/解决json_encode中文UNICODE转码问题/"><span>解决json_encode中文UNICODE转码问题</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/30/解决json_encode中文UNICODE转码问题/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-30T00:32:22.000Z">
          2015-01-30
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>前段时间做东西时用到了 json，php 自带的 json_encode 会将 unicode 字符转码，以 \uxxxx 的形式输出，这样不方便调试，并且，不方便插入数据库（mysql 会自动去掉反斜杠，变成 uxxxx）。于是在网上找到了如下两种解决方案：</p>
<ol>
<li><p>JSON_UNESCAPED_UNICODE：<br>该方法只适用于 php 5.4 及以上版本，使用方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> json_encode(<span class="string">"中文"</span>, JSON_UNESCAPED_UNICODE);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自己写 function 处理：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ch_json_encode</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">ch_urlencode</span><span class="params">($data)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (is_array($data) || is_object($data)) &#123;</span><br><span class="line">           <span class="keyword">foreach</span> ($data <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">               <span class="keyword">if</span> (is_scalar($v)) &#123;</span><br><span class="line">                   <span class="keyword">if</span> (is_array($data)) &#123;</span><br><span class="line">                       $data[$k] = urlencode($v);</span><br><span class="line">                   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (is_object($data)) &#123;</span><br><span class="line">                       $data-&gt;$k = urlencode($v);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">else</span> <span class="keyword">if</span> (is_array($data)) &#123;</span><br><span class="line">                   $data[$k] = ch_urlencode($v); <span class="comment">//递归调用该函数</span></span><br><span class="line">               &#125; <span class="keyword">else</span> <span class="keyword">if</span> (is_object($data)) &#123;</span><br><span class="line">                   $data-&gt;$k = ch_urlencode($v);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> $data;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   $ret = ch_urlencode($data);</span><br><span class="line">   $ret = json_encode($ret);</span><br><span class="line">   <span class="keyword">return</span> urldecode($ret);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>个人觉得第二种方法有 bug，以前有过输出 \’ 的经历。</p>
<p>参考 <a href="http://blog.csdn.net/lanqiao825/article/details/26700809" target="_blank" rel="noopener">http://blog.csdn.net/lanqiao825/article/details/26700809</a>、<a href="http://blog.sina.com.cn/s/blog_6ad6243801016zqo.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_6ad6243801016zqo.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/30/解决json_encode中文UNICODE转码问题/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/28/mysql中You can't specify target table for update in FROM clause错误/"><span>mysql中You can&#39;t specify target table for update in FROM clause错误</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/28/mysql中You can't specify target table for update in FROM clause错误/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-27T22:24:07.000Z">
          2015-01-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>mysql中You can’t specify target table  for update in FROM clause错误的意思是说，不能先select出同一表中的某些值，再update这个表(在同一语句中)。 例如下面这个sql：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tbl <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> </span><br><span class="line">(</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">from</span> tbl a <span class="keyword">where</span> <span class="keyword">EXISTS</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> tbl b <span class="keyword">where</span> a.tac=b.tac <span class="keyword">group</span> <span class="keyword">by</span> tac <span class="keyword">HAVING</span> <span class="keyword">count</span>(<span class="number">1</span>)&gt;<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> tac</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>改写成下面就行了：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tbl <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">select</span> a.id <span class="keyword">from</span> </span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">select</span> <span class="keyword">max</span>(<span class="keyword">id</span>) <span class="keyword">id</span> <span class="keyword">from</span> tbl a <span class="keyword">where</span> <span class="keyword">EXISTS</span></span><br><span class="line">        (</span><br><span class="line">            <span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> tbl b <span class="keyword">where</span> a.tac=b.tac <span class="keyword">group</span> <span class="keyword">by</span> tac <span class="keyword">HAVING</span> <span class="keyword">count</span>(<span class="number">1</span>)&gt;<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">group</span> <span class="keyword">by</span> tac</span><br><span class="line">    ) a</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>也就是说将select出的结果再通过中间表select一遍，这样就规避了错误。注意，这个问题只出现于mysql，mssql和oracle不会出现此问题。</p>
<p>转载自：<a href="http://blog.csdn.net/priestmoon/article/details/8016121" target="_blank" rel="noopener">http://blog.csdn.net/priestmoon/article/details/8016121</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/28/mysql中You can't specify target table for update in FROM clause错误/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/21/使用 php 连接 websocket 服务器/"><span>使用 php 连接 websocket 服务器</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/21/使用 php 连接 websocket 服务器/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-21T00:03:00.000Z">
          2015-01-21
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　最近在写一个问卷调查（也可以投票用）系统，因为有一个大屏幕需要实时显示结果，于是用了 websocket。考虑到投票用户用的浏览器可能不支持 websocket，于是就只写了一个普通的表单，向 websocket 传消息的任务就交给了 php。百度了下，找到了个现成的客户端（<a href="http://download.csdn.net/download/byjlwaa/5389173" target="_blank" rel="noopener">PHP Websocket 客户端 - 下载频道 - CSDN.NET</a>），但是下载下来以后试了下发现无法正常使用，于是调整了它的 header，server 端则打印出通讯的 log，结果发现，连接是可以正常建立的，发送数据却失败。查了下资料（<a href="http://www.cnblogs.com/yjf512/archive/2013/03/11/2953483.html" target="_blank" rel="noopener">关于websocket - 轩脉刃 - 博客园</a>），发现源码中的 senddata 的 function 是错误的，它没有对数据进行处理就直接发送了。发现问题后，我根据通讯协议对源码做了如下修改：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sendData</span><span class="params">($data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// send actual data:</span></span><br><span class="line">	fwrite(<span class="keyword">$this</span>-&gt;_Socket, <span class="keyword">$this</span>-&gt;encode($data)) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'Error:'</span> . $errno . <span class="string">':'</span> . $errstr);</span><br><span class="line">	$wsData = fread(<span class="keyword">$this</span>-&gt;_Socket, <span class="number">2000</span>);</span><br><span class="line">	$retData = trim($wsData,chr(<span class="number">0</span>).chr(<span class="number">255</span>));        </span><br><span class="line">	<span class="keyword">return</span> $retData;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">( $data )</span> </span>&#123;</span><br><span class="line">       $data = is_array( $data ) || is_object( $data ) ? json_encode( $data ) : (string) $data;</span><br><span class="line">       $len = strlen( $data );</span><br><span class="line">       $mask=<span class="keyword">array</span>();</span><br><span class="line">       <span class="keyword">for</span> ($j=<span class="number">0</span>;$j&lt;<span class="number">4</span>;$j++) &#123;</span><br><span class="line">           $mask[]=mt_rand(<span class="number">1</span>,<span class="number">255</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       $head[<span class="number">0</span>] = <span class="number">129</span>;</span><br><span class="line">       <span class="keyword">if</span> ( $len &lt;= <span class="number">125</span> ) &#123;</span><br><span class="line">           $head[<span class="number">1</span>] = $len;</span><br><span class="line">       &#125; <span class="keyword">elseif</span> ( $len &lt;= <span class="number">65535</span> ) &#123;</span><br><span class="line">           $split = str_split( sprintf(<span class="string">'%016b'</span>, $len ), <span class="number">8</span> );</span><br><span class="line">           $head[<span class="number">1</span>] = <span class="number">126</span>;</span><br><span class="line">           $head[<span class="number">2</span>] = bindec( $split[<span class="number">0</span>] );</span><br><span class="line">           $head[<span class="number">3</span>] = bindec( $split[<span class="number">1</span>] );</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           $split = str_split( sprintf(<span class="string">'%064b'</span>, $len ), <span class="number">8</span> );</span><br><span class="line">           $head[<span class="number">1</span>] = <span class="number">127</span>;</span><br><span class="line">           <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; <span class="number">8</span>; $i++ ) &#123;</span><br><span class="line">               $head[$i+<span class="number">2</span>] = bindec( $split[$i] );</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> ( $head[<span class="number">2</span>] &gt; <span class="number">127</span> ) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       $head[<span class="number">1</span>]+=<span class="number">128</span>;</span><br><span class="line">       $head=array_merge($head,$mask);</span><br><span class="line">       <span class="keyword">foreach</span>( $head <span class="keyword">as</span> $k =&gt; $v ) &#123;</span><br><span class="line">           $head[$k] = chr( $v );</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       $mask_data=<span class="string">''</span>;</span><br><span class="line">       <span class="keyword">for</span> ($j=<span class="number">0</span>;$j&lt;$len;$j++) &#123;</span><br><span class="line">           $mask_data.=chr(ord($data[$j]) ^ $mask[$j % <span class="number">4</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> implode(<span class="string">''</span>, $head ) . $mask_data;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_connect</span><span class="params">($host, $port)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	$key1 = <span class="keyword">$this</span>-&gt;_generateRandomString(<span class="number">32</span>);</span><br><span class="line">	$key2 = <span class="keyword">$this</span>-&gt;_generateRandomString(<span class="number">32</span>);</span><br><span class="line">	$key3 = <span class="keyword">$this</span>-&gt;_generateRandomString(<span class="number">8</span>, <span class="keyword">false</span>, <span class="keyword">true</span>);		</span><br><span class="line"></span><br><span class="line">               $header = <span class="string">"GET ws://"</span>.$host.<span class="string">":"</span>.$port.<span class="string">"/ HTTP/1.1\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Host: "</span>.$host.<span class="string">":"</span>.$port.<span class="string">"\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Connection: Upgrade\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Pragma: no-cache\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Cache-Control: no-cache\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Upgrade: websocket\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Sec-WebSocket-Version: 13\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Accept-Encoding: gzip, deflate, sdch\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Accept-Language: zh-CN,zh;q=0.8\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Sec-WebSocket-Key: "</span> . $key1 . <span class="string">"\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits\r\n"</span>;</span><br><span class="line">               $header.= <span class="string">"\r\n"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">$this</span>-&gt;_Socket = fsockopen($host, $port, $errno, $errstr, <span class="number">2</span>); </span><br><span class="line">	fwrite(<span class="keyword">$this</span>-&gt;_Socket, $header) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'Error: '</span> . $errno . <span class="string">':'</span> . $errstr); </span><br><span class="line">	$response = fread(<span class="keyword">$this</span>-&gt;_Socket, <span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@todo</span>: check response here. Currently not implemented cause "2 key handshake" is already deprecated.</span></span><br><span class="line"><span class="comment">	 * See: http://en.wikipedia.org/wiki/WebSocket#WebSocket_Protocol_Handshake</span></span><br><span class="line"><span class="comment">	 */</span>		</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>　　替换源码中的 sendData 与 _connect 并添加 encode function 即可，因为修改之前的源码是别人发布的，所以下载见文章开头的 csdn 链接。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/21/使用 php 连接 websocket 服务器/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/17/使用Raspberry Pi作为无线路由器/"><span>使用Raspberry Pi作为无线路由器</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/17/使用Raspberry Pi作为无线路由器/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-16T20:14:47.000Z">
          2015-01-17
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>鉴于之前的教程过于麻烦。。自己也从头试了一下，发现有点问题，于是本人决定全部推倒重写一遍（注：本文采用的无线网卡为 TP-LINK WN823N，RTL8192CU 芯片）</p>
<p>另外，文章中用了 vi 编辑器，树莓派自带 vim-tiny，有点反人类，apt-get install vim 解决问题</p>
<p>参考了以下两篇文章（如果只按照其中的一篇来都不会成功，所以整理了一下）：</p>
<ul>
<li><a href="http://wangye.org/blog/archives/845/" target="_blank" rel="noopener">http://wangye.org/blog/archives/845/</a></li>
</ul>
<ul>
<li><a href="http://shumeipai.nxez.com/2014/04/01/raspberry-pi-wireless-router.html" target="_blank" rel="noopener">http://shumeipai.nxez.com/2014/04/01/raspberry-pi-wireless-router.html</a></li>
</ul>
<p><strong>一、安装dhcp服务和ap热点服务</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install isc-dhcp-server hostapd</span><br></pre></td></tr></table></figure></p>
<p><strong>二、配置无线网络</strong><br><strong>本文搭建的无线网络使用了 192.168.51 网段，如有需要，请自行修改，后文同</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/network/interfaces</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line"></span><br><span class="line">iface lo inet loopback</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line"></span><br><span class="line">allow-hotplug wlan0</span><br><span class="line">iface wlan0 inet static</span><br><span class="line">    address 192.168.51.1</span><br><span class="line">    netmask 255.255.255.0</span><br><span class="line"></span><br><span class="line">iface default inet dhcp</span><br></pre></td></tr></table></figure>
<p><strong>三、修改 DHCP Server 设置</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/dhcp/dhcpd.conf</span><br></pre></td></tr></table></figure></p>
<p>在最后添加，注意是在最后：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">subnet 192.168.51.0 netmask 255.255.255.0 &#123;</span><br><span class="line">    range 192.168.51.100 192.168.51.254;</span><br><span class="line">    option subnet-mask 255.255.255.0;</span><br><span class="line">    option broadcast-address 192.168.51.255;</span><br><span class="line">    option routers 192.168.51.1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>四、打开内核的网卡转发能力</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysctl.conf</span><br></pre></td></tr></table></figure></p>
<p>将 net.ipv4.ip_forward=1 的注释去掉</p>
<p><strong>五、重新编译 hostapd 使其支持 RTL8192CU 芯片的无线网卡</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget http://futa.ooo/uploads/2015/01/RTL8188-hostapd-master.zip</span><br><span class="line">unzip RTL8188-hostapd-master.zip</span><br><span class="line">cd RTL8188-hostapd-master/hostapd</span><br><span class="line">make;make install</span><br></pre></td></tr></table></figure></p>
<p><strong>六、修改 iptables 的 nat 规则并保存</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</span><br><span class="line">iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT</span><br><span class="line">iptables-save &gt; /etc/iptables.ipv4.nat</span><br></pre></td></tr></table></figure></p>
<p>开机自动加载 iptables 规则：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local</span><br></pre></td></tr></table></figure></p>
<p>在 exit 0; 前面添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables-restore&lt;/etc/iptables.ipv4.nat</span><br></pre></td></tr></table></figure></p>
<p><strong>七、修改无线网络的设置</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hostapd/hostapd.conf</span><br></pre></td></tr></table></figure></p>
<p>只需要改两行：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># Basic configuration</span><br><span class="line"></span><br><span class="line">interface=wlan0</span><br><span class="line">ssid=sxbxjhwm_raspberry # SSID，修改</span><br><span class="line">channel=1</span><br><span class="line">#bridge=br0</span><br><span class="line"></span><br><span class="line"># WPA and WPA2 configuration</span><br><span class="line"></span><br><span class="line">macaddr_acl=0</span><br><span class="line">auth_algs=1</span><br><span class="line">ignore_broadcast_ssid=0</span><br><span class="line">wpa=3</span><br><span class="line">wpa_passphrase=87654321 # 密码，修改</span><br><span class="line">wpa_key_mgmt=WPA-PSK</span><br><span class="line">wpa_pairwise=TKIP</span><br><span class="line">rsn_pairwise=CCMP</span><br><span class="line"></span><br><span class="line"># Hardware configuration</span><br><span class="line"></span><br><span class="line">driver=rtl871xdrv</span><br><span class="line">ieee80211n=1</span><br><span class="line">hw_mode=g</span><br><span class="line">device_name=RTL8192CU</span><br><span class="line">manufacturer=Realtek</span><br></pre></td></tr></table></figure></p>
<p><strong>P.S. 如果 DHCP 获取不到 IP，需要添加自启动：</strong><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local</span><br></pre></td></tr></table></figure></p>
<p>在 exit 0 之前添加以下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ifdown wlan0</span><br><span class="line">ifup wlan0</span><br><span class="line">ifconfig wlan0 192.168.51.1 netmask 255.255.255.0</span><br><span class="line">service isc-dhcp-server restart</span><br><span class="line">service hostapd restart</span><br></pre></td></tr></table></figure></p>
<hr>
<p>实验成功，效果图：<br><a href="/uploads/2015/01/QQ截图20150116205540.jpg"><img src="/uploads/2015/01/QQ截图20150116205540-300x154.jpg" alt="QQ截图20150116205540"></a><br><a href="/uploads/2015/01/QQ图片20150116205445-e1421413729569.jpg"><img src="/uploads/2015/01/QQ图片20150116205445-e1421413729569-169x300.jpg" alt="QQ图片20150116205445"></a><br><a href="/uploads/2015/01/QQ图片20150116205452.png"><img src="/uploads/2015/01/QQ图片20150116205452-169x300.png" alt="QQ图片20150116205452"></a><br><a href="/uploads/2015/01/QQ图片20150116205458.png"><img src="/uploads/2015/01/QQ图片20150116205458-169x300.png" alt="QQ图片20150116205458"></a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/树莓派/">树莓派</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/17/使用Raspberry Pi作为无线路由器/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/16/Linux umount 报 device is busy 的处理方法/"><span>Linux umount 报 device is busy 的处理方法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/16/Linux umount 报 device is busy 的处理方法/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-16T03:07:40.000Z">
          2015-01-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>今天在IDC 辐射了半天，又弄了套DG。 在Linux 挂盘这块也小学了两招。</p>
<p><strong>一. umout 移动硬盘</strong><br>开始用sftp 将安装文件copy到服务器的时候，速度太慢了，500k/s。几个G的东西，copy 这些就要半个多小时，扛不住，拿移动硬盘来copy了。 结果移动硬盘的格式不对。 是NTFS 格式，Linux 识别不了。 只能格式化成FAT32的。 而GG 的win7 系统又不具备格式化成FAT32的功能。 有点小变态。让同事在XP 下帮我格式化了。</p>
<p>安装文件copy到服务器后，同事直接将移动硬盘从服务器上拔下来了。 导致的结果是，用df 命令查看，挂载的移动硬盘还存在。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@qs-wg-db1 ~]# df -lh</span><br><span class="line">Filesystem Size Used Avail Use% Mounted on</span><br><span class="line">/dev/sdb3 125G 3.3G 115G 3% /</span><br><span class="line">/dev/sdb1 99M 12M 82M 13% /boot</span><br><span class="line">tmpfs 3.9G 0 3.9G 0% /dev/shm</span><br><span class="line">/dev/sda1 275G 72G 189G 28% /u01</span><br><span class="line">/dev/sdc1 10G 2.0G 8.1G 20% /datatmp</span><br></pre></td></tr></table></figure>
<p>就是这个/dev/sdc1。</p>
<p>这时使用umount 命令，会提示设备忙，无法挂载。</p>
<p>处理方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@qs-wg-db1 ~]# fuser -km /datatmp</span><br><span class="line">[root@qs-wg-db1 ~]# df -lh</span><br><span class="line">Filesystem Size Used Avail Use% Mounted on</span><br><span class="line">/dev/sdb3 125G 3.3G 115G 3% /</span><br><span class="line">/dev/sdb1 99M 12M 82M 13% /boot</span><br><span class="line">tmpfs 3.9G 0 3.9G 0% /dev/shm</span><br><span class="line">/dev/sda1 275G 72G 189G 28% /u01</span><br><span class="line">/dev/sdc1 10G 2.0G 8.1G 20% /datatmp</span><br><span class="line">[root@qs-wg-db1 ~]# umount /datatmp</span><br><span class="line">[root@qs-wg-db1 ~]# df -lh</span><br><span class="line">Filesystem Size Used Avail Use% Mounted on</span><br><span class="line">/dev/sdb3 125G 3.3G 115G 3% /</span><br><span class="line">/dev/sdb1 99M 12M 82M 13% /boot</span><br><span class="line">tmpfs 3.9G 0 3.9G 0% /dev/shm</span><br><span class="line">/dev/sda1 275G 72G 189G 28% /u01</span><br></pre></td></tr></table></figure></p>
<p>成功umount了。</p>
<p><strong>二. umount 光驱</strong><br>安装DB 之前，检查了一下相关包，少了3个。 从系统安装盘上找了包，安装了一下。 当时是直接将/dev/cdrom mount 到了/mnt目录。 也是图个方便。 结果收工时去拿盘，光驱弹不出来。 同事让我把cdrom umout掉。 同样的提示，设备忙。</p>
<p>处理方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@qs-wg-db1 ~]#fuser –km /dev/cdrom</span><br><span class="line">[root@qs-wg-db1 ~]#eject -- 弹出光驱</span><br></pre></td></tr></table></figure></p>
<p>在网上搜了一下，正确挂载CD-ROM的方法应该如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># mkdir cdrom</span><br><span class="line"># mount /dev/cdrom /mnt/cdrom</span><br><span class="line">或者</span><br><span class="line"># mount /dev/cdrom /media/cdrom</span><br></pre></td></tr></table></figure>
<p>直接挂载在/mnt,/media等系统目录下，在umount时会出现出错信息“umount: /mnt/cdrom: device is busy”的情况。</p>
<p>如果一个文件系统处于“busy”状态的时候，不能卸载该文件系统。如下情况将导致文件系统处于“busy”状态：<br>1) 文件系统上面有打开的文件<br>2) 某个进程的工作目录在此文件系统上<br>3) 文件系统上面的缓存文件正在被使用</p>
<p><strong>三. fuser 命令</strong><br>前面2个umout 都使用了这个fuser 命令。 man了一下这个命令。 内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@qs-wg-db1 ~]# man fuser</span><br><span class="line">FUSER(1) User Commands FUSER(1)</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">fuser - identify processes using files or sockets</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">fuser [-a|-s|-c] [-4|-6] [-n space ] [-k [-i] [-signal ] ] [-muvf] name</span><br><span class="line">fuser -l</span><br><span class="line">fuser -V</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">fuser displays the PIDs of processes using the specified files or file systems. In the default display mode, each file name is followed by a letter denoting the type</span><br><span class="line">of access:</span><br><span class="line">c current directory.</span><br><span class="line">e executable being run.</span><br><span class="line">f open file. f is omitted in default display mode.</span><br><span class="line">F open file for writing. F is omitted in default display mode.</span><br><span class="line">r root directory.</span><br><span class="line">m mmap&apos;ed file or shared library.</span><br><span class="line"></span><br><span class="line">fuser returns a non-zero return code if none of the specified files is accessed or in case of a fatal error. If at least one access has been found, fuser returns zero.</span><br><span class="line">In order to look up processes using TCP and UDP sockets, the corresponding name space has to be selected with the -n option. By default fuser will look in both IPv6 and IPv4 sockets. To change the default, behavior, use the -4 and -6 options. The socket(s) can be specified by the local and remote port, and the remote address. All fields are optional, but commas in front of missing fields must be present:</span><br><span class="line">[lcl_port][,[rmt_host][,[rmt_port]]]</span><br><span class="line">Either symbolic or numeric values can be used for IP addresses and port numbers.</span><br><span class="line"></span><br><span class="line">fuser outputs only the PIDs to stdout, everything else is sent to stderr.</span><br><span class="line"></span><br><span class="line">OPTIONS</span><br><span class="line">-a Show all files specified on the command line. By default, only files that are accessed by at least one process are shown.</span><br><span class="line">-c Same as -m option, used for POSIX compatibility.</span><br><span class="line">-f Silently ignored, used for POSIX compatibility.</span><br><span class="line">-k Kill processes accessing the file. Unless changed with -signal, SIGKILL is sent. An fuser process never kills itself, but may kill other fuser processes. The effective user ID of the process executing fuser is set to its real user ID before attempting to kill.</span><br><span class="line">-i Ask the user for confirmation before killing a process. This option is silently ignored if -k is not present too.</span><br><span class="line">-l List all known signal names.</span><br><span class="line">-m name specifies a file on a mounted file system or a block device that is mounted. All processes accessing files on that file system are listed. If adirectory file is specified, it is automatically changed to name/. to use any file system that might be mounted on that directory.</span><br><span class="line"></span><br><span class="line">-n space Select a different name space. The name spaces file (file names, the default), udp (local UDP ports), and tcp (local TCP ports) are supported. For ports, either the port number or the symbolic name can be specified. If there is no ambiguity, the shortcut notation name/Ispace (e.g. 80/tcp ) can be used.</span><br><span class="line">-s Silent operation. -u and -v are ignored in this mode. -a must not be used with -s.</span><br><span class="line">-signal Use the specified signal instead of SIGKILL when killing processes. Signals can be specified either by name (e.g. -HUP) or by number (e.g. -1). This option is silently ignored if the -k option is not used.</span><br><span class="line">-u Append the user name of the process owner to each PID.</span><br><span class="line">-v Verbose mode. Processes are shown in a ps-like style. The fields PID, USER and COMMAND are similar to ps. ACCESS shows how the process accesses the file. If the access is by the kernel (e.g. in the case of a mount point, awap file, etc.), kernel is shown instead of the PID.</span><br><span class="line">-V Display version information.</span><br><span class="line">-4 Search only for IPv4 sockets. This option must not be used with the -6 option and only has an effect with the tcp and udp namespaces.</span><br><span class="line">-6 Search only for IPv6 sockets. This option must not be used with the -4 option and only has an effect with the tcp and udp namespaces.</span><br><span class="line">- Reset all options and set the signal back to SIGKILL.</span><br><span class="line">FILES</span><br><span class="line">/proc location of the proc file system</span><br></pre></td></tr></table></figure>
<p>fuser 命令显示访问某个文件的进程的PID. 其中-k 和 -m 参数上面红色部分有说明。-k 是kill 访问这个文件的进程。 没有进程访问，就可以成功umount了.</p>
<p>转载自 <a href="http://blog.csdn.net/tianlesoftware/article/details/6194295" target="_blank" rel="noopener">http://blog.csdn.net/tianlesoftware/article/details/6194295</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/16/Linux umount 报 device is busy 的处理方法/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/01/11/移动端重构系列10——侧边栏导航/"><span>移动端重构系列10——侧边栏导航</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/01/11/移动端重构系列10——侧边栏导航/" rel="bookmark">
        <time class="entry-date published" datetime="2015-01-10T22:46:48.000Z">
          2015-01-11
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>本系列文章，如果没有特别说明，兼容安卓4.0.4+</p>
<p>panel一般用来做侧边栏导航，铺满整屏高度，有两种展现形式：第一种直接盖在整块内容栏（包括header和footer部分）上面，如图一；第二种把整块内容栏推开panel的宽度，如图二<br><a href="/uploads/2015/01/panel1.jpg"><img src="/uploads/2015/01/panel1.jpg" alt="panel1"></a><br><a href="/uploads/2015/01/panel2.jpg"><img src="/uploads/2015/01/panel2.jpg" alt="panel2"></a></p>
<p>设计结构如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap-page"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"page"</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"panel"</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>第一种实现方案：</strong><br><a href="http://jsbin.com/sapip/1" target="_blank" rel="noopener">demo 1</a><br>先将panel通过translate偏移负的本身宽度，离开可视区域，然后通过切换active这个class来实现无偏移。当然除此之外，top和bottom的0实现了100%高度，z-index要保证大于header和footer的层级。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$panelWidth:      120px !default;</span><br><span class="line"><span class="selector-class">.panel</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">980</span>;</span><br><span class="line">    <span class="attribute">width</span>: $panelWidth;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">    @include translate3d(-$panelWidth, 0, 0);</span><br><span class="line">    @<span class="keyword">extend</span> %transition-transform;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.panel</span><span class="selector-class">.active</span>&#123;</span><br><span class="line">    @include translate3d(0, 0, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同样我们也可以通过给body添加删除class如panel-active来控制panel的位置。</p>
<p><strong>第二种实现方案</strong><br><a href="http://jsbin.com/sapip/2" target="_blank" rel="noopener">demo 2</a>，在demo1的基础上根据第二种方案顺便处理下了当panel出现时，内容禁止滚动<br>因为需要实现整块内容栏（包括header和footer部分）偏移panel的宽度，所以第一反应是应该有个div把整块内容栏包裹下，如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap-container"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"header"</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"wrap-page"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"page"</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">        ...</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"footer"</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"panel"</span>&gt;</span><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>多了一层结构，看起来有点不爽，不过使用起来还是很爽的。首先panel偏移负的本身宽度，接下来通过控制wrap-container的class来实现内容栏偏移panel的宽度<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.panel</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: $zIndexOverlay;</span><br><span class="line">    <span class="attribute">width</span>: $panelWidth;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">    @include translate3d(-$panelWidth, 0, 0);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrap-container</span>&#123;</span><br><span class="line">    @extend %transition-transform;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.wrap-container</span><span class="selector-class">.panel-active</span>&#123;</span><br><span class="line">    @include translate3d($panelWidth, 0, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>既然这里需要一个父元素来实现一个偏移，为什么body不可以呢？所以果断干掉wrap-container，恢复最初的结构<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.panel</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: $zIndexOverlay;</span><br><span class="line">    <span class="attribute">width</span>: $panelWidth;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="number">#333</span>;</span><br><span class="line">    @include translate3d(-$panelWidth, 0, 0);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span><span class="selector-class">.has-panel</span>&#123;</span><br><span class="line">    @extend %transition-transform;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span><span class="selector-class">.panel-active</span>&#123;</span><br><span class="line">    @include translate3d($panelWidth, 0, 0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>总结</strong><br>一般来说使用比较多的还是第二种方案，因为第一种直接把左边的那个点击图标遮盖住了。而panel实际使用的时候还是挺不太好办的，因为左边的第一个icon一般都是放首页，返回什么的，当然适用不适用还是根据各自业务需要走</p>
<p>转载自：<a href="http://www.w3cplus.com/mobile/mobile-terminal-refactoring-sidebar-menu.html" target="_blank" rel="noopener">http://www.w3cplus.com/mobile/mobile-terminal-refactoring-sidebar-menu.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/01/11/移动端重构系列10——侧边栏导航/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/9/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/11/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 403 Forbidden
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>