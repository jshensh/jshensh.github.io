<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 6 页 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/20/黄金&白银实时报价实现方法/"><span>黄金&amp;白银实时报价实现方法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/20/黄金&白银实时报价实现方法/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-20T05:41:12.000Z">
          2015-10-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　先声明，数据依旧来自 jin10.com。<br>　　之前写了篇文章《<a href="http://futa.ooo/2330.html">加上了“财经消息”小工具。。。但我感觉应该没人会看</a>》，是写的“财经消息”小工具里的资讯的推送，那个比较简单，因为金十的部分服务器没有验证 origin，拿来就能用。但报价的话就不行了，必须靠一台尽量快的服务器来中转数据（报价对实时性的要求极高），于是我还是选择了 Daocloud（关于 Docker 的使用：《<a href="http://futa.ooo/2304.html">初识 Docker – 使用 tenxcloud.com 搭建自己的应用</a>》）来做中转。ok 废话少说，接下来就来看下源码，其实只有一个文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">var app = require(&apos;express&apos;)();</span><br><span class="line">var http = require(&apos;http&apos;).Server(app);</span><br><span class="line">var io = require(&apos;socket.io&apos;)(http);</span><br><span class="line">var Pio=require(&quot;socket.io-client&quot;);</span><br><span class="line">var Psocket=Pio.connect(&quot;http://121.40.214.64:8080&quot;);</span><br><span class="line">var Nsocket=Pio.connect(&quot;http://c3.jin10.com:8081&quot;);</span><br><span class="line">var request = require(&apos;request&apos;);</span><br><span class="line"></span><br><span class="line">var his = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">Psocket.on(&apos;connect&apos; , function() &#123;</span><br><span class="line">    Psocket.emit(&apos;delAllSubscription&apos; , []);</span><br><span class="line">    Psocket.emit(&apos;addSubscription&apos; , [&apos;XAUUSD&apos; , &apos;XAGUSD&apos; , &apos;UKOIL&apos; , &apos;USOIL&apos; , &apos;DXY&apos; , &apos;EURUSD&apos; , &apos;GC&apos; , &apos;GBPUSD&apos;, &apos;USDJPY&apos;, &apos;AUDUSD&apos;, &apos;USDCHF&apos;, &apos;EURGBP&apos;, &apos;EURJPY&apos;, &apos;XPDUSD&apos; , &apos;DOWI&apos; ,&apos;NASX&apos; ,&apos;SPX500&apos; ,&apos;JPN225&apos; ,&apos;SZZZ&apos; ,&apos;SZCZ&apos; ,&apos;XPTUSD&apos;]);</span><br><span class="line">    Psocket.emit(&apos;reqvote&apos;, &quot;ok&quot;);</span><br><span class="line">&#125;);</span><br><span class="line">Nsocket.on(&apos;connect&apos; , function() &#123;</span><br><span class="line">    Nsocket.emit(&apos;reg&apos;, &quot;ok&quot;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.get(&apos;/&apos;, function(req, res)&#123;</span><br><span class="line">    request(&apos;http://www.jin10.com/jin10.com.html&apos;, function (error, response, body) &#123;</span><br><span class="line">        if (!error &amp;&amp; response.statusCode == 200) &#123;</span><br><span class="line">            res.header(&quot;Access-Control-Allow-Origin&quot;, &quot;*&quot;);</span><br><span class="line">            res.send(body.replace(/\n|\s&#123;3,&#125;/g,&quot;&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">io.on(&apos;connection&apos;, function(socket) &#123;</span><br><span class="line">    for (var i in his) &#123;</span><br><span class="line">        io.emit(&apos;price list&apos;, his[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">Psocket.on(&apos;price list&apos;, function(msg) &#123;</span><br><span class="line">    his[msg[&apos;name&apos;]]=msg;</span><br><span class="line">    io.emit(&apos;price list&apos;, msg);</span><br><span class="line">    console.log(msg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Nsocket.on(&apos;user message&apos;, function(msg) &#123;</span><br><span class="line">    io.emit(&apos;user message&apos;, msg);</span><br><span class="line">    console.log(msg);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(3000, function()&#123;</span><br><span class="line">    console.log(&apos;listening on *:3000&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>没错就是那么简单 = =</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/12/openwrt安装php,mysql,Lighttpd建站/"><span>openwrt安装php,mysql,Lighttpd建站</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/12/openwrt安装php,mysql,Lighttpd建站/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-12T06:55:40.000Z">
          2015-10-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>一、安装</strong><br>1、输入如下命令更新软件列表：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br></pre></td></tr></table></figure></p>
<p>2、输入如下命令安装php,mysql,Lighttpd及其组件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg install php5 php5-mod-gd php5-mod-session php5-mod-pdo php5-mod-pdo-mysql php5-mod-mysql php5-mod-mcrypt php5-mod-mbstring php5-fastcgi php5-cgi php5-mod-xml php5-mod-ctype php5-mod-curl php5-mod-exif php5-mod-ftp php5-mod-iconv php5-mod-json php5-mod-sockets php5-mod-sqlite3 php5-mod-tokenizer php5-mod-zip php5-mod-mysqli zoneinfo-core zoneinfo-asia</span><br><span class="line">opkg install mysql-server libncursesw libncurses libreadline terminfo uclibcxx zlib libmysqlclient libmcrypt libltdl libmcrypt</span><br><span class="line">opkg install lighttpd lighttpd-mod-fastcgi lighttpd-mod-access lighttpd-mod-alias lighttpd-mod-rewrite lighttpd-mod-redirect libncurses</span><br></pre></td></tr></table></figure></p>
<p><strong>二、配置Lighttpd：</strong><br>编辑/etc/lighttpd/lighttpd.conf文件</p>
<ol>
<li>找到【server.document-root =”/www”】将【/www】改为你自己网站存放的路径（比如我的是/web）</li>
<li><p>在 static-file.exclude-extensions = ( “.php”, “.pl”, “.fcgi” ) 下插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fastcgi.server = (</span><br><span class="line">        &quot;.php&quot; =&gt; (</span><br><span class="line">                &quot;localhost&quot; =&gt; (</span><br><span class="line">                        &quot;socket&quot; =&gt; &quot;/tmp/php-fastcgi.socket&quot;,</span><br><span class="line">                        &quot;bin-path&quot; =&gt; &quot;/usr/bin/php-fcgi&quot;</span><br><span class="line">                )</span><br><span class="line">        )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
</li>
<li><p>找到【#server.port = 81】去掉#，将81更改为你想要的端口号</p>
</li>
</ol>
<p><strong>三、配置php</strong><br>打开/etc/php.ini</p>
<ol>
<li>查找;short_open_tag = off改为short_open_tag = on</li>
<li>查找doc_root = “/www”改为doc_root = “/web”（改为你自己网站存放的路径和Lighttpd的保持一样）</li>
<li>分别找到以下内容:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extension=ctype.so</span><br><span class="line">extension=curl.so</span><br><span class="line">extension=gd.so</span><br><span class="line">extension=iconv.so</span><br><span class="line">extension=json.so</span><br><span class="line">extension=mbstring.so</span><br><span class="line">extension=mcrypt.so</span><br><span class="line">extension=mysql.so</span><br><span class="line">extension=pdo.so</span><br><span class="line">extension=pdo-mysql.so</span><br><span class="line">extension=session.so</span><br><span class="line">extension=sockets.so</span><br><span class="line">extension=tokenizer.so</span><br><span class="line">extension=xml.so</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>分别将前面的“;”去掉</p>
<ol start="4">
<li>找到date.timezone =在后面加上 prc也就是date.timezone = prc</li>
<li>查找mysql.default_socket =改为mysql.default_socket = /var/run/mysqld.sock</li>
</ol>
<p><strong>四、配置mysql</strong></p>
<ol>
<li><p>输入如下命令创建数据库文件夹：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/data /mnt/data/mysql /mnt/data/tmp</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入如下命令创建默认的数据库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysql_install_db --force</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入如下命令启动mysql：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysqld start</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入如下命令创建mysql的密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqladmin -u root password 123456</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>ok到此配置完毕</p>
<ol start="5">
<li>输入如下命令启动Lighttpd：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/lighttpd start</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>转载自 <a href="http://www.right.com.cn/forum/thread-121342-1-1.html" target="_blank" rel="noopener">http://www.right.com.cn/forum/thread-121342-1-1.html</a>，有删改</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/openwrt/">openwrt</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/08/树莓派忘记登录密码怎么办/"><span>树莓派忘记登录密码怎么办</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/08/树莓派忘记登录密码怎么办/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-08T08:07:31.000Z">
          2015-10-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>借给同学之后自己把密码忘了……雅蠛蝶……可惜没把显示屏带回来，查了一圈之后灵机一动(*￣▽￣)y</p>
<p><strong>如果你有显示屏+USB键盘</strong></p>
<ul>
<li>将SD卡插入电脑（windows下只挂载boot分区）</li>
</ul>
<ul>
<li>打开boot分区，编辑command.txt(注意不要用记事本，可能会换行符坑爹）</li>
</ul>
<ul>
<li>在第一行末尾加上init=/bin/sh，完成后大概是这样<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">... root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait init=/bin/sh</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>插卡，重启，连接键盘显示器</li>
</ul>
<ul>
<li>出现shell后用passwd更改密码</li>
</ul>
<p><strong>没有的话呢？</strong></p>
<ul>
<li>想办法让电脑和树莓派连通，可以用路由器，或者电脑装个dhcpd等</li>
</ul>
<ul>
<li>生成一对密钥对，注意必须是openssh兼容格式而不是putty等密钥格式</li>
</ul>
<ul>
<li>使用一个流行的linux发行版，将SD卡插入电脑；如果是老旧的版本，你可能需要手动挂载SD卡里的ext4分区</li>
</ul>
<ul>
<li>进入/分区，在/root下建立一个.ssh文件夹（如果没有的话），并chmod 700</li>
</ul>
<ul>
<li>在/root/.ssh/下建立一个文件authorized_keys，并chmod 600</li>
</ul>
<ul>
<li>将公钥内容写入新创建的文件中</li>
</ul>
<ul>
<li>sync，umount</li>
</ul>
<ul>
<li>插卡，重启，ssh使用root账户连接，并指定刚才的私钥</li>
</ul>
<ul>
<li>passwd修改密码</li>
</ul>
<p>转载自 <a href="http://yooooo.us/2015/recover-raspi-password?variant=zh-hans" target="_blank" rel="noopener">http://yooooo.us/2015/recover-raspi-password?variant=zh-hans</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/树莓派/">树莓派</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/08/Linux下MySQL的root密码忘记解决方法/"><span>Linux下MySQL的root密码忘记解决方法</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/08/Linux下MySQL的root密码忘记解决方法/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-08T08:03:05.000Z">
          2015-10-08
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>验证环境：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qa | grep mysql</span><br><span class="line">mysql-5.1.71-1.el6.i686</span><br><span class="line">mysql-server-5.1.71-1.el6.i686</span><br><span class="line">mysql-libs-5.1.71-1.el6.i686</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# lsb_release -a</span><br><span class="line">LSB Version:    :core-4.0-ia32:core-4.0-noarch:graphics-4.0-ia32:graphics-4.0-noarch:printing-4.0-ia32:printing-4.0-noarch</span><br><span class="line">Distributor ID: CentOS</span><br><span class="line">Description:    CentOS Linux release 6.0 (Final)</span><br><span class="line">Release:        6.0</span><br><span class="line">Codename:      Final</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# uname -r</span><br><span class="line">2.6.32-71.el6.i686</span><br></pre></td></tr></table></figure></p>
<p>1．首先确认服务器出于安全的状态，也就是没有人能够任意地连接MySQL数据库。<br>因为在重新设置MySQL的root密码的期间，MySQL数据库完全出于没有密码保护的状态下，其他的用户也可以任意地登录和修改MySQL的信息。可以采用将MySQL对外的端口封闭，并且停止Apache以及所有的用户进程的方法实现服务器的准安全状态。最安全的状态是到服务器的Console上面操作，并且拔掉网线。</p>
<p>2．修改MySQL的登录设置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br></pre></td></tr></table></figure></p>
<p>在[mysqld]的段中加上一句：skip-grant-tables<br>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[mysqld] </span><br><span class="line">datadir=/var/lib/mysql </span><br><span class="line">socket=/var/lib/mysql/mysql.sock </span><br><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure></p>
<p>保存并且退出vi。</p>
<p>3．重新启动mysqld<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/mysqld restart </span><br><span class="line">Stopping MySQL: [ OK ] </span><br><span class="line">Starting MySQL: [ OK ]</span><br></pre></td></tr></table></figure></p>
<p>4．登录并修改MySQL的root密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mysql</span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \\g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.1.71 Source distribution</span><br><span class="line">Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line">Type &apos;help;&apos; or &apos;\\h&apos; for help. Type &apos;\\c&apos; to clear the current input statement.</span><br><span class="line">mysql&gt;UPDATE mysql.user SET Password = password (&quot;new-password&quot;) WHERE User = &apos;root&apos;;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 0</span><br><span class="line">mysql&gt; exit</span><br><span class="line">Bye</span><br></pre></td></tr></table></figure></p>
<p>5．将MySQL的登录设置修改回来<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br></pre></td></tr></table></figure></p>
<p>将刚才在[mysqld]的段中加上的skip-grant-tables删除,保存并且退出vi；</p>
<p>6．再次重新启动mysqld<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/mysqld restart </span><br><span class="line">Stopping MySQL: [ OK ] </span><br><span class="line">Starting MySQL: [ OK ]</span><br></pre></td></tr></table></figure></p>
<p>7、使用新的密码登录，正常登录，搞定！</p>
<p>转载自 <a href="http://www.linuxidc.com/Linux/2013-07/87069.htm" target="_blank" rel="noopener">http://www.linuxidc.com/Linux/2013-07/87069.htm</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/07/重写了下博客的播放器/"><span>重写了下博客的播放器</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/07/重写了下博客的播放器/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-07T02:03:16.000Z">
          2015-10-07
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>国庆无聊，对博客的播放器做了比较大幅度的修改，总结一下现有以下改进:</p>
<ol>
<li>添加了”自动播放”复选框，可以由用户自主决定是否需要播放背景音乐(其实歌都不错的。。)</li>
</ol>
<ol start="2">
<li>使用 node.js 重写了多标签的背景音乐控制器，主要是为了避免产生当用户打开多个标签后背景音乐同时播放的问题</li>
</ol>
<p>抱着开源共享的想法，现在这里共享一下控制器源码。播放器的就不特地写了，都是前端的东西，右键”查看源代码”即可。如果有什么 bug，希望各位提出，谢谢各位。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">var app = require(&apos;express&apos;)();</span><br><span class="line">var http = require(&apos;http&apos;).Server(app);</span><br><span class="line">var io = require(&apos;socket.io&apos;)(http);</span><br><span class="line"></span><br><span class="line">app.get(&apos;/&apos;, function(req, res)&#123;</span><br><span class="line">	res.send(&apos;&lt;h1&gt;Welcome Realtime Server&lt;/h1&gt;&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">function count(o)&#123;</span><br><span class="line">    var t = typeof o;</span><br><span class="line">    if (t == &apos;string&apos;) &#123;</span><br><span class="line">        return o.length;</span><br><span class="line">    &#125; else if (t == &apos;object&apos;) &#123;</span><br><span class="line">        var n = 0;</span><br><span class="line">        for (var i in o) &#123;</span><br><span class="line">                n++;</span><br><span class="line">        &#125;</span><br><span class="line">        return n;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">Date.prototype.Format = function (fmt) &#123;</span><br><span class="line">    var o = &#123;</span><br><span class="line">        &quot;M+&quot;: this.getMonth() + 1,</span><br><span class="line">        &quot;d+&quot;: this.getDate(),</span><br><span class="line">        &quot;h+&quot;: this.getHours(),</span><br><span class="line">        &quot;m+&quot;: this.getMinutes(),</span><br><span class="line">        &quot;s+&quot;: this.getSeconds(),</span><br><span class="line">        &quot;q+&quot;: Math.floor((this.getMonth() + 3) / 3),</span><br><span class="line">        &quot;S&quot;: this.getMilliseconds()</span><br><span class="line">    &#125;;</span><br><span class="line">    if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + &quot;&quot;).substr(4 - RegExp.$1.length));</span><br><span class="line">    for (var k in o)</span><br><span class="line">    if (new RegExp(&quot;(&quot; + k + &quot;)&quot;).test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((&quot;00&quot; + o[k]).substr((&quot;&quot; + o[k]).length)));</span><br><span class="line">    return fmt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var dump_log=function(msg) &#123;</span><br><span class="line">	//console.log(&quot;\033[40;33m&quot;+new Date().Format(&quot;yyyy-MM-dd hh:mm:ss&quot;)+&quot;\033[0m\n&quot;+msg+&quot;\nNow &quot;+count(clients)+&quot; user(s) online.&quot;);</span><br><span class="line">	console.log(new Date().Format(&quot;yyyy-MM-dd hh:mm:ss&quot;)+&quot;\n&quot;+msg+&quot;\nNow &quot;+count(clients)+&quot; user(s) online.&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">var onlineCount = 0;</span><br><span class="line">var index=0;</span><br><span class="line">global[&apos;clients&apos;]=&#123;&#125;;</span><br><span class="line"></span><br><span class="line">io.on(&apos;connection&apos;, function(socket)&#123;</span><br><span class="line"></span><br><span class="line">	socket.on(&apos;bindkey&apos;, function(str)&#123;</span><br><span class="line">		if (!str.match(/^[a-z0-9]&#123;64&#125;$/)) &#123;</span><br><span class="line">			dump_log(&quot;data: &quot;+str+&quot;\nip: &quot;+socket.handshake.address);</span><br><span class="line">			return false;</span><br><span class="line">		&#125;</span><br><span class="line">		socket.bindkey = str;</span><br><span class="line">		socket.index = index;</span><br><span class="line">		if (typeof global[&apos;clients&apos;][str]==&quot;undefined&quot;) &#123;</span><br><span class="line">			global[&apos;clients&apos;][str]=&#123;&#125;;</span><br><span class="line">			onlineCount++;</span><br><span class="line">		&#125;</span><br><span class="line">		global[&apos;clients&apos;][str][index]=&#123;&apos;playing&apos;:(count(global[&apos;clients&apos;][str])==0?1:0),&apos;socket&apos;:socket,&apos;ip&apos;:socket.handshake.address,&apos;index&apos;:index&#125;;</span><br><span class="line">		socket.emit(&quot;message&quot;,[0,index,global[&apos;clients&apos;][str][index][&apos;playing&apos;]]);</span><br><span class="line">		dump_log(&quot;bindkey: &quot;+str+&quot;, index: &quot;+index+&quot;, ip: &quot;+socket.handshake.address);</span><br><span class="line">		index++;</span><br><span class="line">	&#125;);</span><br><span class="line"></span><br><span class="line">	socket.on(&apos;disconnect&apos;, function()&#123;</span><br><span class="line">		delete global[&apos;clients&apos;][socket.bindkey][socket.index];</span><br><span class="line">		if (count(global[&apos;clients&apos;][socket.bindkey])!==0) &#123;</span><br><span class="line">			for (var ckey in global[&apos;clients&apos;][socket.bindkey]) &#123;</span><br><span class="line">				var ready_play=global[&apos;clients&apos;][socket.bindkey][ckey];</span><br><span class="line">				break;</span><br><span class="line">			&#125;</span><br><span class="line">			ready_play[&apos;playing&apos;]=1;</span><br><span class="line">			ready_play.socket.emit(&quot;message&quot;,[1,ready_play.socket.index,1]);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			delete global[&apos;clients&apos;][socket.bindkey];</span><br><span class="line">			onlineCount--;</span><br><span class="line">		&#125;</span><br><span class="line">		dump_log(&quot;bindkey: &quot;+socket.bindkey+&quot;, index: &quot;+socket.index+&quot;, ip: &quot;+socket.handshake.address+&quot; offline.&quot;);</span><br><span class="line">	&#125;);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">http.listen(3000, function()&#123;</span><br><span class="line">	console.log(&apos;listening on *:3000&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Docker 项目地址: <a href="https://github.com/jshensh/audioController" target="_blank" rel="noopener">https://github.com/jshensh/audioController</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/04/NodeJS中 package.json 解析/"><span>NodeJS中 package.json 解析</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/04/NodeJS中 package.json 解析/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-04T08:44:33.000Z">
          2015-10-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>package.json 中包含各种所需模块以及项目的配置信息（名称、版本、许可证等）meta 信息。<br><strong>包含可配置项</strong></p>
<ul>
<li>name 名称</li>
</ul>
<ul>
<li>应用描述 description</li>
</ul>
<ul>
<li>版本号 version</li>
</ul>
<ul>
<li>应用的配置项 config</li>
</ul>
<ul>
<li>作者 author</li>
</ul>
<ul>
<li>资源仓库地址 respository</li>
</ul>
<ul>
<li>授权方式 licenses</li>
</ul>
<ul>
<li>目录 directories</li>
</ul>
<ul>
<li>应用入口文件 main</li>
</ul>
<ul>
<li>命令行文件 bin</li>
</ul>
<ul>
<li>项目应用运行依赖模块 dependencies</li>
</ul>
<ul>
<li>项目应用开发环境依赖 devDependencies</li>
</ul>
<ul>
<li>运行引擎 engines</li>
</ul>
<ul>
<li>脚本 script</li>
</ul>
<h1 id="简单模式"><a href="#简单模式" class="headerlink" title="简单模式"></a>简单模式</h1><p>[json]{</p>
<p>name: “myApp”,</p>
<p>version :”0.0.1”<br>}[/json]</p>
<h1 id="完整模式"><a href="#完整模式" class="headerlink" title="完整模式"></a>完整模式</h1><p>[json]{</p>
<p>“name”: “myApp”,<br>“version”: “0.0.0”,<br>“author” : “simple”,<br>“description” : “Nodejs Package json介绍”,<br>“keywords” : “javascript, nodejs”,<br>“respository” : {<br>“type” :”git”,<br>“url” :”<a href="http://path/to/url&quot;" target="_blank" rel="noopener">http://path/to/url&quot;</a><br>},</p>
<p>“bugs” : {<br>“url” : “<a href="http://path/to/bug&quot;" target="_blank" rel="noopener">http://path/to/bug&quot;</a>,<br>“email” : “<a href="mailto:bug@example.com" target="_blank" rel="noopener">bug@example.com</a>“<br>},<br>“contributors” : [</p>
<p>{“name” : “zhangsan”, “email” : “<a href="mailto:zhangsan@example.com" target="_blank" rel="noopener">zhangsan@example.com</a>“</p>
<p>]</p>
<p>“license” : “MIT”,<br>“engines” : { “node” : “0.10.x”},<br>“script” : {<br>“start” : “node index.js”<br>},<br>“private”: true,<br>“scripts”: {<br>“start”: “node ./bin/www”<br>},</p>
<p>“dependencies”: {<br>“express”: “~4.9.0”,<br>“body-parser”: “~1.8.1”,<br>“cookie-parser”: “~1.3.3”,<br>“morgan”: “~1.3.0”,<br>“serve-favicon”: “~2.1.3”,<br>“debug”: “~2.0.0”,<br>“jade”: “~1.6.0”<br>},</p>
<p>“devDependencies”: {<br>“bower” : “~1.2.8”,<br>“grunt” : “~0.4.1”,<br>“grunt-contrib-concat” : “~0.3.0”,<br>“grunt-contrib-jshint” : “~0.7.2”,<br>“grunt-contrib-uglify” : “~0.2.7”,<br>“grunt-contrib-clean” : “~0.5.0”,<br>“browserify” : “2.36.1”,<br>“grunt-browserify” : “~1.3.0”<br>}<br>}[/json]</p>
<p><strong>1.scripts</strong><br>运行指定脚本命令。</p>
<p><strong>2.</strong><br><strong>npm install express –save</strong><br><strong>npm install express –save-dev</strong><br><strong>上面代码表示单独安装express模块，</strong><br>–save参数表示将该模块写入dependencies属性，<br>–save-dev表示将该模块写入devDependencies属性。</p>
<p><strong>3.关于指定版本号</strong><br>_（1）波浪号~（tilde）+指定版本：比如~1.2.2，表示安装1.2.x的最新版本（不低于1.2.2），但是不安装1.3.x，也就是说安装时不改变大版本号和次要版本号。 _</p>
<p>转载自 <a href="http://www.cnphp6.com/archives/57964?utm_source=tuicool" target="_blank" rel="noopener">http://www.cnphp6.com/archives/57964?utm_source=tuicool</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/10/02/加上了“财经消息”小工具。。。但我感觉应该没人会看/"><span>加上了“财经消息”小工具。。。但我感觉应该没人会看</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/02/加上了“财经消息”小工具。。。但我感觉应该没人会看/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-01T19:02:32.000Z">
          2015-10-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>纯用来提升逼格。。。数据来源 <a href="http://www.jin10.com/" target="_blank" rel="noopener">http://www.jin10.com/</a><br>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/09/29/使用Node.js+Socket.IO搭建WebSocket实时应用/"><span>使用Node.js+Socket.IO搭建WebSocket实时应用</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/09/29/使用Node.js+Socket.IO搭建WebSocket实时应用/" rel="bookmark">
        <time class="entry-date published" datetime="2015-09-29T08:02:31.000Z">
          2015-09-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Web领域的实时推送技术，也被称作Realtime技术。这种技术要达到的目的是让用户不需要刷新浏览器就可以获得实时更新。它有着广泛的应用场景，比如在线聊天室、在线客服系统、评论系统、WebIM等。<br><a href="http://futa.ooo/uploads/2015/09/20140611173333_407.jpg"><img src="http://futa.ooo/uploads/2015/09/20140611173333_407.jpg" alt="20140611173333_407"></a></p>
<p><strong>WebSocket简介</strong><br>谈到Web实时推送，就不得不说WebSocket。在WebSocket出现之前，很多网站为了实现实时推送技术，通常采用的方案是轮询 (Polling)和Comet技术，Comet又可细分为两种实现方式，一种是长轮询机制，一种称为流技术，这两种方式实际上是对轮询技术的改进，这些 方案带来很明显的缺点，需要由浏览器对服务器发出HTTP request，大量消耗服务器带宽和资源。面对这种状况，HTML5定义了WebSocket协议，能更好的节省服务器资源和带宽并实现真正意义上的实 时推送。<br>WebSocket协议本质上是一个基于TCP的协议，它由通信协议和编程API组成，WebSocket能够在浏览器和服务器之间建立双向连接， 以基于事件的方式，赋予浏览器实时通信能力。既然是双向通信，就意味着服务器端和客户端可以同时发送并响应请求，而不再像HTTP的请求和响应。<br>为了建立一个WebSocket连接，客户端浏览器首先要向服务器发起一个HTTP请求，这个请求和通常的HTTP请求不同，包含了一些附加头信 息，其中附加头信息”Upgrade: WebSocket”表明这是一个申请协议升级的HTTP请求，服务器端解析这些附加的头信息然后产生应答信息返回给客户端，客户端和服务器端的 WebSocket连接就建立起来了，双方就可以通过这个连接通道自由的传递信息，并且这个连接会持续存在直到客户端或者服务器端的某一方主动的关闭连接。<br>一个典型WebSocket客户端请求头：<br><a href="http://futa.ooo/uploads/2015/09/20140611173334_763.jpg"><img src="http://futa.ooo/uploads/2015/09/20140611173334_763.jpg" alt="20140611173334_763"></a><br>前面讲到WebSocket是HTML5中新增的一种通信协议，这意味着一部分老版本浏览器（主要是IE10以下版本）并不具备这个功能，<a href="http://tongji.baidu.com/data/browser" target="_blank" rel="noopener">通过百度统计的公开数据显示</a>，IE8 目前仍以33%的市场份额占据榜首，好在chrome浏览器市场份额逐年上升，现在以超过26%的市场份额位居第二，同时微软前不久宣布停止对IE6的技 术支持并提示用户更新到新版本浏览器，这个曾经让无数前端工程师为之头疼的浏览器有望退出历史舞台，再加上几乎所有的智能手机浏览器都支持HTML5，所 以使得WebSocket的实战意义大增，但是无论如何，我们实际的项目中，仍然要考虑低版本浏览器的兼容方案：在支持WebSocket的浏览器中采用 新技术，而在不支持WebSocket的浏览器里启用Comet来接收发送消息。</p>
<p><strong>WebSocket实战</strong><br>本文将以多人在线聊天应用作为实例场景，我们先来确定这个聊天应用的基本需求。</p>
<p><strong>需求分析</strong><br>1、兼容不支持WebSocket的低版本浏览器。<br>2、允许客户端有相同的用户名。<br>3、进入聊天室后可以看到当前在线的用户和在线人数。<br>4、用户上线或退出，所有在线的客户端应该实时更新。<br>5、用户发送消息，所有客户端实时收取。<br>在实际的开发过程中，为了使用WebSocket接口构建Web应用，我们首先需要构建一个实现了 WebSocket规范的服务端，服务端的实现不受平台和开发语言的限制，只需要遵从WebSocket规范即可，目前已经出现了一些比较成熟的 WebSocket服务端实现，比如本文使用的Node.js+Socket.IO。为什么选用这个方案呢？先来简单介绍下他们两。</p>
<p><strong>Node.js</strong><br>Node.js采用C++语言编写而成，它不是Javascript应用，而是一个Javascript的运行环境，据Node.js创始人 Ryan Dahl回忆，他最初希望采用Ruby来写Node.js，但是后来发现Ruby虚拟机的性能不能满足他的要求，后来他尝试采用V8引擎，所以选择了 C++语言。<br>Node.js支持的系统包括*nux、Windows，这意味着程序员可以编写系统级或者服务器端的Javascript代码，交给 Node.js来解释执行。Node.js的Web开发框架Express，可以帮助程序员快速建立web站点，从2009年诞生至今，Node.js的 成长的速度有目共睹，其发展前景获得了技术社区的充分肯定。</p>
<p><strong>Socket.IO</strong><br>Socket.IO是一个开源的WebSocket库，它通过Node.js实现WebSocket服务端，同时也提供客户端JS库。Socket.IO支持以事件为基础的实时双向通讯，它可以工作在任何平台、浏览器或移动设备。<br>Socket.IO支持4种协议：WebSocket、htmlfile、xhr-polling、jsonp-polling，它会自动根据浏览 器选择适合的通讯方式，从而让开发者可以聚焦到功能的实现而不是平台的兼容性，同时Socket.IO具有不错的稳定性和性能。</p>
<p><strong>编码实现</strong><br>本文一开始的的插图就是效果演示图：可以<a href="http://demo.plhwin.com/chat/" target="_blank" rel="noopener">点击这里</a>查看在线演示，整个开发过程非常简单，下面简单记录了开发步骤：</p>
<p><strong>安装Node.js</strong><br>根据自己的操作系统，去Node.js官网下载安装即可。如果成功安装。在命令行输入node -v和npm -v应该能看到相应的版本号。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">node -v </span><br><span class="line">v0.10.26 </span><br><span class="line">npm -v </span><br><span class="line">1.4.6</span><br></pre></td></tr></table></figure></p>
<p><strong>搭建WebSocket服务端</strong><br>这个环节我们尽可能的考虑真实生产环境，把WebSocket后端服务搭建成一个线上可以用域名访问的服务，如果你是在本地开发环境，可以换成本地ip地址，或者使用一个虚拟域名指向本地ip。<br>先进入到你的工作目录，比如 /workspace/wwwroot/plhwin/realtime.plhwin.com，新建一个名为 package.json的文件，内容如下：<br>[json]{<br>  “name”: “realtime-server”,<br>  “version”: “0.0.1”,<br>  “description”: “my first realtime server”,<br>  “dependencies”: {}<br>}[/json]<br>接下来使用npm命令安装express和socket.io<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install --save express</span><br><span class="line">npm install --save socket.io</span><br></pre></td></tr></table></figure></p>
<p>安装成功后，应该可以看到工作目录下生成了一个名为node_modules的文件夹，里面分别是express和socket.io，接下来可以开始编写服务端的代码了，新建一个文件：index.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var app = require(&apos;express&apos;)();</span><br><span class="line">var http = require(&apos;http&apos;).Server(app);</span><br><span class="line">var io = require(&apos;socket.io&apos;)(http);</span><br><span class="line"> </span><br><span class="line">app.get(&apos;/&apos;, function(req, res)&#123;</span><br><span class="line">    res.send(&apos;&lt;h1&gt;Welcome Realtime Server&lt;/h1&gt;&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">http.listen(3000, function()&#123;</span><br><span class="line">    console.log(&apos;listening on *:3000&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>命令行运行node index.js，如果一切顺利，你应该会看到返回的listening on *:3000字样，这说明服务已经成功搭建了。此时浏览器中打开<a href="http://localhost:3000应该可以看到正常的欢迎页面。" target="_blank" rel="noopener">http://localhost:3000应该可以看到正常的欢迎页面。</a><br>如果你想要让服务运行在线上服务器，并且可以通过域名访问的话，可以使用Nginx做代理，在nginx.conf中添加如下配置，然后将域名（比如：realtime.plhwin.com）解析到服务器IP即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line"> &#123;</span><br><span class="line">   listen       80;</span><br><span class="line">   server_name  realtime.plhwin.com;</span><br><span class="line">   location / &#123;</span><br><span class="line">     proxy_pass http://127.0.0.1:3000;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>完成以上步骤，<a href="http://realtime.plhwin.com:3000的后端服务就正常搭建了。" target="_blank" rel="noopener">http://realtime.plhwin.com:3000的后端服务就正常搭建了。</a><br><a href="http://futa.ooo/uploads/2015/09/20140611173334_655.jpg"><img src="http://futa.ooo/uploads/2015/09/20140611173334_655.jpg" alt="20140611173334_655"></a></p>
<p><strong>服务端代码实现</strong><br>前面讲到的index.js运行在服务端，之前的代码只是一个简单的WebServer欢迎内容，让我们把WebSocket服务端完整的实现代码加入进去，整个服务端就可以处理客户端的请求了。完整的index.js代码如下：<br>[html]&lt;!DOCTYPE html&gt;</p>
<p><html><br>    <head><br>        <meta charset="utf-8"><br>        <meta name="format-detection" content="telephone=no"><br>        <meta name="format-detection" content="email=no"></head></html></p>
<p><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" name="viewport"><br>        <title>多人聊天室</title><br>        <link rel="stylesheet" type="text/css" href="./style.css"><br>        <!--[if lt IE 8]><script src="./json3.min.js"></script><![endif]--><br>        <script src="http://realtime.plhwin.com:3000/socket.io/socket.io.js"></script><br>    <br>    <body><br>        <div id="loginbox"><br>            <div style="width:260px;margin:200px auto;"><br>                请先输入你在聊天室的昵称<br>                <br><br>                <br><br>                <input type="text" style="width:180px;" placeholder="请输入用户名" id="username" name="username"><br>                <input type="button" style="width:50px;" value="提交" onclick="CHAT.usernameSubmit();"><br>            </div><br>        </div><br>        <div id="chatbox" style="display:none;"><br>            <div style="background:#3d3d3d;height: 28px; width: 100%;font-size:12px;"><br>                <div style="line-height: 28px;color:#fff;"><br>                    <span style="text-align:left;margin-left:10px;">Websocket多人聊天室</span><br>                    <span style="float:right; margin-right:10px;"><span id="showusername"></span> |<br>                    <a href="javascript:;" onclick="CHAT.logout()" style="color:#fff;" target="_blank" rel="noopener">退出</a></span><br>                </div><br>            </div><br>            <div id="doc"><br>                <div id="chat"><br>                    <div id="message" class="message"></div></div></div></div></body></p>
<p><div id="onlinecount" style="background:#EFEFF4; font-size:12px; margin-top:10px; margin-left:10px; color:#666;"><br></div><br>                    <br>                    <div class="input-box"><br>                        <div class="input"></div></div></p>
<p><input type="text" maxlength="140" placeholder="请输入聊天内容，按Ctrl提交" id="content" name="content"><br>                        <br>                        <div class="action"><br>                            <button type="button" id="mjr_send" onclick="CHAT.submit();">提交</button><br>                        </div><br>                    <br>                <br>            <br>        <br>        <script type="text/javascript" src="./client.js"></script><br>    <br>[/html]<br>上面的html内容本身没有什么好说的，我们主要看看里面的4个文件请求：<br>1、realtime.plhwin.com:3000/socket.io/socket.io.js<br>2、style.css<br>3、json3.min.js<br>4、client.js</p>
<p>第1个JS是Socket.IO提供的客户端JS文件，在前面安装服务端的步骤中，当npm安装完socket.io并搭建起WebServer后，这个JS文件就可以正常访问了。<br>第2个style.css文件没什么好说的，就是样式文件而已。<br>第3个JS只在IE8以下版本的IE浏览器中加载，目的是让这些低版本的IE浏览器也能处理json，这是一个开源的JS，详见：<a href="http://bestiejs.github.io/json3/" target="_blank" rel="noopener">http://bestiejs.github.io/json3/</a><br>第4个client.js是完整的客户端的业务逻辑实现代码，它的内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">(function () &#123;</span><br><span class="line">    var d = document,</span><br><span class="line">    w = window,</span><br><span class="line">    p = parseInt,</span><br><span class="line">    dd = d.documentElement,</span><br><span class="line">    db = d.body,</span><br><span class="line">    dc = d.compatMode == &apos;CSS1Compat&apos;,</span><br><span class="line">    dx = dc ? dd: db,</span><br><span class="line">    ec = encodeURIComponent;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    w.CHAT = &#123;</span><br><span class="line">        msgObj:d.getElementById(&quot;message&quot;),</span><br><span class="line">        screenheight:w.innerHeight ? w.innerHeight : dx.clientHeight,</span><br><span class="line">        username:null,</span><br><span class="line">        userid:null,</span><br><span class="line">        socket:null,</span><br><span class="line">        //让浏览器滚动条保持在最低部</span><br><span class="line">        scrollToBottom:function()&#123;</span><br><span class="line">            w.scrollTo(0, this.msgObj.clientHeight);</span><br><span class="line">        &#125;,</span><br><span class="line">        //退出，本例只是一个简单的刷新</span><br><span class="line">        logout:function()&#123;</span><br><span class="line">            //this.socket.disconnect();</span><br><span class="line">            location.reload();</span><br><span class="line">        &#125;,</span><br><span class="line">        //提交聊天消息内容</span><br><span class="line">        submit:function()&#123;</span><br><span class="line">            var content = d.getElementById(&quot;content&quot;).value;</span><br><span class="line">            if(content != &apos;&apos;)&#123;</span><br><span class="line">                var obj = &#123;</span><br><span class="line">                    userid: this.userid,</span><br><span class="line">                    username: this.username,</span><br><span class="line">                    content: content</span><br><span class="line">                &#125;;</span><br><span class="line">                this.socket.emit(&apos;message&apos;, obj);</span><br><span class="line">                d.getElementById(&quot;content&quot;).value = &apos;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;,</span><br><span class="line">        genUid:function()&#123;</span><br><span class="line">            return new Date().getTime()+&quot;&quot;+Math.floor(Math.random()*899+100);</span><br><span class="line">        &#125;,</span><br><span class="line">        //更新系统消息，本例中在用户加入、退出的时候调用</span><br><span class="line">        updateSysMsg:function(o, action)&#123;</span><br><span class="line">            //当前在线用户列表</span><br><span class="line">            var onlineUsers = o.onlineUsers;</span><br><span class="line">            //当前在线人数</span><br><span class="line">            var onlineCount = o.onlineCount;</span><br><span class="line">            //新加入用户的信息</span><br><span class="line">            var user = o.user;</span><br><span class="line">                 </span><br><span class="line">            //更新在线人数</span><br><span class="line">            var userhtml = &apos;&apos;;</span><br><span class="line">            var separator = &apos;&apos;;</span><br><span class="line">            for(key in onlineUsers) &#123;</span><br><span class="line">                if(onlineUsers.hasOwnProperty(key))&#123;</span><br><span class="line">                    userhtml += separator+onlineUsers[key];</span><br><span class="line">                    separator = &apos;、&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            d.getElementById(&quot;onlinecount&quot;).innerHTML = &apos;当前共有 &apos;+onlineCount+&apos; 人在线，在线列表：&apos;+userhtml;</span><br><span class="line">             </span><br><span class="line">            //添加系统消息</span><br><span class="line">            var html = &apos;&apos;;</span><br><span class="line">            html += &apos;&lt;div class=&quot;msg-system&quot;&gt;&apos;;</span><br><span class="line">            html += user.username;</span><br><span class="line">            html += (action == &apos;login&apos;) ? &apos; 加入了聊天室&apos; : &apos; 退出了聊天室&apos;;</span><br><span class="line">            html += &apos;&lt;/div&gt;&apos;;</span><br><span class="line">            var section = d.createElement(&apos;section&apos;);</span><br><span class="line">            section.className = &apos;system J-mjrlinkWrap J-cutMsg&apos;;</span><br><span class="line">            section.innerHTML = html;</span><br><span class="line">            this.msgObj.appendChild(section);  </span><br><span class="line">            this.scrollToBottom();</span><br><span class="line">        &#125;,</span><br><span class="line">        //第一个界面用户提交用户名</span><br><span class="line">        usernameSubmit:function()&#123;</span><br><span class="line">            var username = d.getElementById(&quot;username&quot;).value;</span><br><span class="line">            if(username != &quot;&quot;)&#123;</span><br><span class="line">                d.getElementById(&quot;username&quot;).value = &apos;&apos;;</span><br><span class="line">                d.getElementById(&quot;loginbox&quot;).style.display = &apos;none&apos;;</span><br><span class="line">                d.getElementById(&quot;chatbox&quot;).style.display = &apos;block&apos;;</span><br><span class="line">                this.init(username);</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;,</span><br><span class="line">        init:function(username)&#123;</span><br><span class="line">            /*</span><br><span class="line">            客户端根据时间和随机数生成uid,这样使得聊天室用户名称可以重复。</span><br><span class="line">            实际项目中，如果是需要用户登录，那么直接采用用户的uid来做标识就可以</span><br><span class="line">            */</span><br><span class="line">            this.userid = this.genUid();</span><br><span class="line">            this.username = username;</span><br><span class="line">             </span><br><span class="line">            d.getElementById(&quot;showusername&quot;).innerHTML = this.username;</span><br><span class="line">            this.msgObj.style.minHeight = (this.screenheight - db.clientHeight + this.msgObj.clientHeight) + &quot;px&quot;;</span><br><span class="line">            this.scrollToBottom();</span><br><span class="line">             </span><br><span class="line">            //连接websocket后端服务器</span><br><span class="line">            this.socket = io.connect(&apos;ws://realtime.plhwin.com:3000&apos;);</span><br><span class="line">             </span><br><span class="line">            //告诉服务器端有用户登录</span><br><span class="line">            this.socket.emit(&apos;login&apos;, &#123;userid:this.userid, username:this.username&#125;);</span><br><span class="line">             </span><br><span class="line">            //监听新用户登录</span><br><span class="line">            this.socket.on(&apos;login&apos;, function(o)&#123;</span><br><span class="line">                CHAT.updateSysMsg(o, &apos;login&apos;); </span><br><span class="line">            &#125;);</span><br><span class="line">             </span><br><span class="line">            //监听用户退出</span><br><span class="line">            this.socket.on(&apos;logout&apos;, function(o)&#123;</span><br><span class="line">                CHAT.updateSysMsg(o, &apos;logout&apos;);</span><br><span class="line">            &#125;);</span><br><span class="line">             </span><br><span class="line">            //监听消息发送</span><br><span class="line">            this.socket.on(&apos;message&apos;, function(obj)&#123;</span><br><span class="line">                var isme = (obj.userid == CHAT.userid) ? true : false;</span><br><span class="line">                var contentDiv = &apos;&lt;div&gt;&apos;+obj.content+&apos;&lt;/div&gt;&apos;;</span><br><span class="line">                var usernameDiv = &apos;&lt;span&gt;&apos;+obj.username+&apos;&lt;/span&gt;&apos;;</span><br><span class="line">                 </span><br><span class="line">                var section = d.createElement(&apos;section&apos;);</span><br><span class="line">                if(isme)&#123;</span><br><span class="line">                    section.className = &apos;user&apos;;</span><br><span class="line">                    section.innerHTML = contentDiv + usernameDiv;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    section.className = &apos;service&apos;;</span><br><span class="line">                    section.innerHTML = usernameDiv + contentDiv;</span><br><span class="line">                &#125;</span><br><span class="line">                CHAT.msgObj.appendChild(section);</span><br><span class="line">                CHAT.scrollToBottom(); </span><br><span class="line">            &#125;);</span><br><span class="line"> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    //通过“回车”提交用户名</span><br><span class="line">    d.getElementById(&quot;username&quot;).onkeydown = function(e) &#123;</span><br><span class="line">        e = e || event;</span><br><span class="line">        if (e.keyCode === 13) &#123;</span><br><span class="line">            CHAT.usernameSubmit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    //通过“回车”提交信息</span><br><span class="line">    d.getElementById(&quot;content&quot;).onkeydown = function(e) &#123;</span><br><span class="line">        e = e || event;</span><br><span class="line">        if (e.keyCode === 13) &#123;</span><br><span class="line">            CHAT.submit();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>至此所有的编码开发工作全部完成了，在浏览器中打开<a href="http://demo.plhwin.com/chat/" target="_blank" rel="noopener">http://demo.plhwin.com/chat/</a>就可以看到效果了。<br>上面所有的客户端和服务端的代码可以从Github上获得，地址：<a href="https://github.com/plhwin/nodejs-socketio-chat" target="_blank" rel="noopener">https://github.com/plhwin/nodejs-socketio-chat</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/plhwin/nodejs-socketio-chat.git</span><br></pre></td></tr></table></figure></p>
<p>下载本地后有两个文件夹 client 和 server，client文件夹是客户端源码，可以放在Nginx/Apache的WebServer中，也可以放在Node.js的WebServer中。后面的server文件夹里的代码是websocket服务端代码，放在Node.js环境中，使用npm安装完 express 和 socket.io 后，node index.js 启动后端服务就可以了。</p>
<p>本例只是一个简单的Demo，留下2个有关项目扩展的思考：<br>1、假设是一个在线客服系统，里面有许多的公司使用你的服务，每个公司自己的用户可以通过一个专属URL地址进入该公司的聊天室，聊天是一对一的，每个公司可以新建多个客服人员，每个客服人员可以同时和客户端的多个用户聊天。<br>2、又假设是一个在线WebIM系统，实现类似微信，qq的功能，客户端可以看到好友在线状态，在线列表，添加好友，删除好友，新建群组等，消息的发送除了支持基本的文字外，还能支持表情、图片和文件。</p>
<p>转载自：<a href="http://www.plhwin.com/2014/05/28/nodejs-socketio/" target="_blank" rel="noopener">http://www.plhwin.com/2014/05/28/nodejs-socketio/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/09/29/初识 Docker - 使用 tenxcloud.com 搭建自己的应用/"><span>初识 Docker - 使用 tenxcloud.com 搭建自己的应用</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/09/29/初识 Docker - 使用 tenxcloud.com 搭建自己的应用/" rel="bookmark">
        <time class="entry-date published" datetime="2015-09-28T23:01:19.000Z">
          2015-09-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>2015-09-30 更新:<br>daocloud 提供的配额更慷慨，各位有兴趣的话可以走我的邀请链接: <a href="https://account.daocloud.io/signup?invite_code=r7vcv0n2nenytal22llp" target="_blank" rel="noopener">https://account.daocloud.io/signup?invite_code=r7vcv0n2nenytal22llp</a>，绑定微信的话送一个容器配额，一共三个。</p>
<p>需要搭 WordPress 的，请直接移步 <a href="http://www.freehao123.com/tenxcloud/" target="_blank" rel="noopener">http://www.freehao123.com/tenxcloud/</a></p>
<p>不知道什么是 Docker 的，请移步 <a href="http://baike.baidu.com/view/11854949.htm" target="_blank" rel="noopener">http://baike.baidu.com/view/11854949.htm</a>。我认为这和以前的 PaaS 类云平台(比如 appfog)差不多，都是布置完即成型，所有修改不保存的东西。<br>来看看探针: <a href="http://musics-johnshen.tenxcloud.net/" target="_blank" rel="noopener">http://musics-johnshen.tenxcloud.net/</a> (5M 共享带宽，28 块一个月的，所以要是探针失效了别来找我，多半是我觉得不划算了)<br>好，接下来进入正题，如何在时速云上部署你的 PHP 应用。(其实官方有个 PHP 的 Hello world 的，但哔了狗的不能用)</p>
<p>首先，<a href="http://futa.ooo/uploads/2015/09/Yahei.zip">下载代码包</a>并使用 git 上传到你喜欢的平台。然后打开时速云，选择构建，点击添加源代码，并登录你的 github 账号(当然你要是想只放个探针可以选快速构建，而不是添加源代码，然后在下一步中照我的填):<br><a href="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-31-26.png"><img src="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-31-26.png" alt="Screenshot_2015-09-29-14-31-26"></a><br>选择你要构建的项目之后，你可以修改你的镜像名称，然后点击创建:<br><a href="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-31-52.png"><img src="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-31-52.png" alt="Screenshot_2015-09-29-14-31-52"></a><br>创建完成之后:<br><a href="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-32-07.png"><img src="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-32-07.png" alt="Screenshot_2015-09-29-14-32-07"></a><br>可点击你的项目的名称进入以下界面并快速部署你的应用:<br><a href="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-32-29.png"><img src="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-32-29.png" alt="Screenshot_2015-09-29-14-32-29"></a><br>填上服务名称，创建即可:<br><a href="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-32-48.png"><img src="http://futa.ooo/uploads/2015/09/Screenshot_2015-09-29-14-32-48.png" alt="Screenshot_2015-09-29-14-32-48"></a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/09/24/将树莓派系统迁移至 U 盘上/"><span>将树莓派系统迁移至 U 盘上</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/09/24/将树莓派系统迁移至 U 盘上/" rel="bookmark">
        <time class="entry-date published" datetime="2015-09-24T04:32:16.000Z">
          2015-09-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　新入手了个 pi 2B，先上张全家福（好吧图有点大）<br><a href="http://futa.ooo/uploads/2015/09/20150924_195814.jpg"><img src="http://futa.ooo/uploads/2015/09/20150924_195814-300x169.jpg" alt="20150924_195814"></a><br>　　那啥，把系统移动到 u 盘里的好处应该不用我说了吧，相信各位也应该百度过了。但是！百度下来的各种教程却是各种麻烦，有用 U-Boot 的，有用 BerryBoot 的，反正就是各种奇奇葩葩的第三方。其实，事情并没有那么复杂：</p>
<p>为确保不会发生错误，本文所有语句均在 root 用户下执行**</p>
<p><strong>第一步：给 U 盘分区</strong><br>　　因为 U 盘比较大，所以不想全部用在树莓派上，当然各位要是土豪可以跳过这一步。<br>　　在这里需要注意的是，常用文件分区（FAT32/NTFS/exFAT）一定要分在第一个区，树莓派的 ext3 要分在第二个区，不然傻乎乎的 Windows 会不认识。如图：<br><a href="http://futa.ooo/uploads/2015/09/QQ图片20150924201713.png"><img src="http://futa.ooo/uploads/2015/09/QQ图片20150924201713.png" alt="QQ图片20150924201713"></a><br>　　分区时可以不用管树莓派分区的文件系统，因为后续操作会覆盖掉。</p>
<p><strong>第二步：将 sd 卡中的系统迁移至 U 盘</strong><br>　　很简单，用 dd 就行了。在这里我的 U 盘是 sda，第二个分区：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd if=/dev/mmcblk0p2 of=/dev/sda2 bs=4M</span><br></pre></td></tr></table></figure></p>
<p>　　写完以后，修复 U 盘分区：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e2fsck -f /dev/sda2</span><br><span class="line">resize2fs /dev/sda2</span><br></pre></td></tr></table></figure></p>
<p><a href="http://futa.ooo/uploads/2015/09/QQ截图20150924202346.png"><img src="http://futa.ooo/uploads/2015/09/QQ截图20150924202346.png" alt="QQ截图20150924202346"></a></p>
<p><strong>第三步：重新配置启动设备   重要！！！</strong><br>　　挂载刚刚写完的分区上系统：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir sda2</span><br><span class="line">mount /dev/sda2 sda2</span><br></pre></td></tr></table></figure></p>
<p>　　修改以下两个文件，内容如图：</p>
<ul>
<li>/boot/cmdline.txt</li>
</ul>
<ul>
<li>./sda2/etc/fstab</li>
</ul>
<p><a href="http://futa.ooo/uploads/2015/09/2015-09-24-120659_480x320_scrot.png"><img src="http://futa.ooo/uploads/2015/09/2015-09-24-120659_480x320_scrot.png" alt="2015-09-24-120659_480x320_scrot"></a><br>　　注意因为这是迁移完截的图，所以 fstab 的路径有点区别。</p>
<p>　　然后 reboot 一下就大功告成啦。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Linux-Desktop/">Linux Desktop</a>, <a href="/categories/Linux-Desktop/树莓派/">树莓派</a>
    </span>
    

    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/5/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/7/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>