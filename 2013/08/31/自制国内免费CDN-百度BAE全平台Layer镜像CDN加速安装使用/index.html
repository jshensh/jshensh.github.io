<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>自制国内免费CDN-百度BAE全平台Layer镜像CDN加速安装使用 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="现在美国主机和VPS都差不多是白菜价格了，而国内的虚拟主机同等配置的价格基本是美国主机的几倍以上，但是就是这样的高价，还是有人愿意花钱将自己的空间放在国内，唯一的目的就是因为国内的空间对国内用户来说访问速度快。因为各种原因而用上了美国主机的朋友，为了让自己的网站能够被访问得更快更稳定，使用CDN加速">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="自制国内免费CDN-百度BAE全平台Layer镜像CDN加速安装使用"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/about.html">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>自制国内免费CDN-百度BAE全平台Layer镜像CDN加速安装使用</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2013/08/31/自制国内免费CDN-百度BAE全平台Layer镜像CDN加速安装使用/" rel="bookmark">
        <time class="entry-date published" datetime="2013-08-30T20:29:36.000Z">
          2013-08-31
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><a href="/uploads/201308/bae-cdn_00.gif"><img src="/uploads/201308/bae-cdn_00.gif" alt="bae-cdn_00"></a><br>现在美国主机和VPS都差不多是白菜价格了，而国内的虚拟主机同等配置的价格基本是美国主机的几倍以上，但是就是这样的高价，还是有人愿意花钱将自己的空间放在国内，唯一的目的就是因为国内的空间对国内用户来说访问速度快。<br>因为各种原因而用上了美国主机的朋友，为了让自己的网站能够被访问得更快更稳定，使用CDN加速服务就是一个好办法，尤其是一些有日本、香港或者新加坡等亚太CDN服务器节点的，对加快美国主机的访问速度有很大帮助。<br>国内也有不少的CDN服务，部分CDN商还提供了免费CDN服务，但是前提是域名已经Bei案。这个条件实际非常矛盾，如果域名已经Bei案那肯定是首选用国内主机，用上了国内主机再用某些免费CDN，由于免费的服务限制太多，加速的效果反而会没有。<br>所以，求人还不求已，部落之前已经分享用新浪SAE空间搭建一个国内的免费CDN服务：<a href="http://www.freehao123.com/cdn-saelayercdn/" target="_blank" rel="noopener">自制国内免费CDN加快网页加载速度:SaeLayerCDN</a>，利用新浪SAE空间来给美国主机的网站加速效果是相当不错，尤其是图片加载这一块，可以大大减少网页加载时间。<br>本篇文章是SaeLayerCDN升级强化版本：Layer，出自<a href="http://best33.com/" target="_blank" rel="noopener">best33.com</a>博主之手，本来是期望博主自己写个图文教程给大家介绍一下，一直到现在看博主都没有写，部落就自己写了这篇如何用Layer在BAE空间搭建免费CDN。<br>Layer实际上支持的平台有：SAE（新浪）、BAE（百度）、GCS（盛大）、标准PHP（本地读写），大家如果想要将Layer应用到SAE或者自己的PHP主机上，请参考本篇文章介绍的将Layer应用在BAE空间的方法。<br>从部落的使用体验来看，Layer完全可以帮助打造下一个BAE或者SAE版本的“七牛”，Layer可以自动给网站博客在BAE上生成一个镜像，图片、JS、CSS等都可以实现CDN加速，支持防盗链保护，可手动URL刷新缓存，现在还支持Memcached内存缓存加速。</p>
<p><strong>一、在百度BAE空间上安装Layer免费CDN程序 </strong><br>1、Layer程序包下载：<a href="https://github.com/oott123/Layer" target="_blank" rel="noopener">https://github.com/oott123/Layer</a></p>
<p>2、在文章开始前，你需要先熟悉BAE空间的基本操作，<a href="http://www.freehao123.com/2013-baidu-bae/" target="_blank" rel="noopener">百度BAE安装WordPress</a>、<a href="http://www.freehao123.com/bae-discuz-x2-5/" target="_blank" rel="noopener">BAE空间成功安装运行Discuz! X2.5</a></p>
<p>3、先在百度BAE空间上创建一个应用。<br><a href="/uploads/201308/bae-cdn_01.gif"><img src="/uploads/201308/bae-cdn_01.gif" alt="百度BAE创建一个应用"></a></p>
<p>4、然后设置好应用域名和应用名称、PHP环境等。<br><a href="/uploads/201308/bae-cdn_02.gif"><img src="/uploads/201308/bae-cdn_02.gif" alt="百度BAE设置好环境"></a></p>
<p>5、最后到百度BAE中新建一个Bucket。<br><a href="/uploads/201308/bae-cdn_03.gif"><img src="/uploads/201308/bae-cdn_03.gif" alt="百度BAE新建一个Bucket"></a></p>
<p>6、属性设置为公开读就可以了。<br><a href="/uploads/201308/bae-cdn_04.gif"><img src="/uploads/201308/bae-cdn_04.gif" alt="百度BAE属性为公开读"></a></p>
<p>7、上传Layer程序包到BAE空间上，可以用在线上传代码包的形式，也可以用SVN、Git等方式。<br><a href="/uploads/201308/bae-cdn_05.gif"><img src="/uploads/201308/bae-cdn_05.gif" alt="百度BAE上传代码包"></a></p>
<p><strong>二、开启Layer CDN加速的设置方法 </strong><br>1、BAE空间上可以在线编辑代码，或者你可以在本地编辑代码后再上传到BAE空间上。<br><a href="/uploads/201308/bae-cdn_06.gif"><img src="/uploads/201308/bae-cdn_06.gif" alt="百度BAE在线编辑代码"></a></p>
<p>2、Layer的设置都在config.sample.inc.php文件中，打开该文件，可以看到Layer的基本设定。说明如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**********基本设定**********/</span></span><br><span class="line">	define(<span class="string">'STATIC_URL'</span>,<span class="string">'http://www.freehao123.com/'</span>);	<span class="comment">//源站URL</span></span><br><span class="line">	define(<span class="string">'DOMAIN'</span>,<span class="string">'freecdnbae'</span>);	<span class="comment">//使用云存储时，填写存储空间的名字；使用本地存储时，填写存储的相对路径。</span></span><br><span class="line">	define(<span class="string">'WELCOME_DOC'</span>,<span class="keyword">TRUE</span>);	<span class="comment">//空请求时是否显示欢迎界面</span></span><br></pre></td></tr></table></figure></p>
<p>3、这里我用了我的Godaddy空间的域名来作演示，这是我修改的。<br><a href="/uploads/201308/bae-cdn_07.gif"><img src="/uploads/201308/bae-cdn_07.gif" alt="Layer镜像CDN基本设置"></a></p>
<p>4、完成后，记得将你的BAE应用上线。<br><a href="/uploads/201308/bae-cdn_08.gif"><img src="/uploads/201308/bae-cdn_08.gif" alt="Layer镜像CDN应用上线"></a></p>
<p><strong>三、Layer镜像CDN加速效果测试</strong><br>1、Layer和七牛镜像CDN有着类似的原理，图片在第一次被访问时会被自动同步到CDN服务器端，以后访问该图片时就是直接从CDN服务器中加载了。</p>
<p>2、测试你的Layer镜像CDN加速有没有生效，一个直接的办法就是替换掉图片的URL的域名，如果能打开，说明图片已经被Layer同步到了BAE或者SAE空间上了。<br><a href="/uploads/201308/bae-cdn_09.gif"><img src="/uploads/201308/bae-cdn_09.gif" alt="Layer镜像CDN测试生效"></a></p>
<p>3、上面说了用Layer可以打造一个BAE版的“七牛”，原因是Layer可以将你的图片的路径完整地镜像出来，这一点有点像又拍云存储。<br><a href="/uploads/201308/bae-cdn_10.gif"><img src="/uploads/201308/bae-cdn_10.gif" alt="Layer镜像CDN路径缓存"></a></p>
<p>4、除了图片，JS、CSS等静态文件也可以被Layer镜像。<br><a href="/uploads/201308/bae-cdn_11.gif"><img src="/uploads/201308/bae-cdn_11.gif" alt="Layer镜像CDN缓存CSS"></a></p>
<p>5、被镜像的CDN路径完整被保留。<br><a href="/uploads/201308/bae-cdn_12.gif"><img src="/uploads/201308/bae-cdn_12.gif" alt="Layer镜像CDN完成保留"></a></p>
<p>6、如果你用的是Wordpress，可以直接安装WP Super Cache插件，在CDN选项中开启，填写你的BAE镜像CDN域名地址即可。<br><a href="/uploads/201308/bae-cdn_13.gif"><img src="/uploads/201308/bae-cdn_13.gif" alt="Layer镜像CDN在Wordpress中开启"></a></p>
<p>7、Layer镜像CDN加速效果可以看到我的Godaddy主机网站：s0su.com</p>
<p><strong>四、Layer镜像CDN加速防盗链,手动更新缓存,Memcached内存缓存</strong><br>1、同样是打开config.sample.inc.php文件，如果想要开启防盗链设置，请把“//”给删除，然后设置好你的文件外链的白名单。<br><a href="/uploads/201308/bae-cdn_15.gif"><img src="/uploads/201308/bae-cdn_15.gif" alt="Layer镜像CDN防盗链"></a></p>
<p>2、define(‘PURGE_KEY’,’purge’);这句是用来手动刷新缓存文件的，purge可以自己指定一个，要刷新某一个文件在服务器的缓存时，用域名URL+purge+文件路径刷新。</p>
<p>3、例如部落的<a href="http://freecdnbae.duapp.com/purge/uploads/2013/08/freehao123.jpg，用浏览器打开它就是刷新该图片在BAE空间上的缓存了。" target="_blank" rel="noopener">http://freecdnbae.duapp.com/purge/uploads/2013/08/freehao123.jpg，用浏览器打开它就是刷新该图片在BAE空间上的缓存了。</a><br><a href="/uploads/201308/bae-cdn_16.gif"><img src="/uploads/201308/bae-cdn_16.gif" alt="Layer镜像CDN更新缓存"></a></p>
<p>4、这是刷新缓存成功的提示。<br><a href="/uploads/201308/bae-cdn_17.gif"><img src="/uploads/201308/bae-cdn_17.gif" alt="Layer镜像CDN成功提示"></a></p>
<p>5、Layer镜像CDN加速支持Memcached内存缓存，你只需要到BAE空间中开启Memcached内存缓存即可。<br><a href="/uploads/201308/bae-cdn_21.gif"><img src="/uploads/201308/bae-cdn_21.gif" alt="Layer镜像CDN开启内存缓存"></a></p>
<p><strong>五、Layer镜像CDN加速设置自己的域名作CDN的域名</strong><br>1、前几天，部落分享了七牛云存储，可惜没有Bei案的网站只能使用七牛的二级域名，有朋友就因为这个不想用七牛。本次介绍的Layer镜像CDN可以完全解决此问题。</p>
<p>2、我们都知道BAE空间支持未Bei案的域名绑定空间，利用此特点，我们的Layer镜像CDN就可以使用自己的域名作为CDN的域名URL了，而且还照样是国内CDN，这点还强于七牛。</p>
<p>3、到BAE空间上添加新的域名绑定。<br><a href="/uploads/201308/bae-cdn_18.gif"><img src="/uploads/201308/bae-cdn_18.gif" alt="Layer镜像CDN域名绑定"></a></p>
<p>4、域名绑定前需要先做CNAME解析到BAE给出的URL地址，等DNS解析生效后，你就可以成功在BAE空间上添加自己的域名了。<br><a href="/uploads/201308/bae-cdn_19.gif"><img src="/uploads/201308/bae-cdn_19.gif" alt="Layer镜像CDN完成解析"></a></p>
<p>5、一旦域名绑定到了BAE空间上，你就可以使用马上在Layer镜像CDN中使用自己的域名了，文件加速效果如下：<br><a href="/uploads/201308/bae-cdn_20.gif"><img src="/uploads/201308/bae-cdn_20.gif" alt="Layer镜像CDN使用自己的域名URL"></a></p>
<p><strong>六、Layer镜像CDN加速一些问题和小结</strong></p>
<p>1、经过部落测试发现，如果网页图片过多的话首次访问会比较感觉到慢，这是因为Layer需要将图片从美国主机上下载保存到百度BAE空间上，期间会消耗一定的时间。</p>
<p>2、Layer可以完全镜像图片、JS、CSS等文件，如果你使用了Layer出现了CSS加载不正常的情况，请直接在Wordpress的WP Super Cache插件中排除对CSS的CDN缓存。<br><a href="/uploads/201308/bae-cdn_14.gif"><img src="/uploads/201308/bae-cdn_14.gif" alt="Layer镜像CDN排除特定缓存"></a></p>
<p>3、Layer镜像CDN支持自定义HTTP Host、自定义缓存后缀，极端特殊情况也能轻松使用，方便进行全站CDN。又因为Layer可直接用在PHP环境中，这意味着你可以在任意一台PHP主机上搭建一个免费CDN服务出来。</p>
<p>转载自 <a href="http://www.freehao123.com/cdn-layer/" target="_blank" rel="noopener">http://www.freehao123.com/cdn-layer/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/建站相关/">建站相关</a>
    </span>
    

    

    </div>

    
  </div>
</article>

  

	<section id="comment" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'futa-ooo';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>




    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>