<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>解决dnsmasq安装好之后主机不能解析其他域名的问题 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="概述事情是这样的，我想在阿里云上搭建一个dns服务器，没错就是吃空了，在阿里云上搭建一个本地的dns服务器，安装好之后发现不能ping域名了，难道是dns服务器的问题，换成114的dns也没有用，后来终于找到解决的方法了
操作首先看下我的配置文件1234resolv-file=/etc/resolv">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="解决dnsmasq安装好之后主机不能解析其他域名的问题"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/about.html">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>解决dnsmasq安装好之后主机不能解析其他域名的问题</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/10/10/解决dnsmasq安装好之后主机不能解析其他域名的问题/" rel="bookmark">
        <time class="entry-date published" datetime="2018-10-10T06:49:43.000Z">
          2018-10-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>事情是这样的，我想在阿里云上搭建一个dns服务器，没错就是吃空了，在阿里云上搭建一个本地的dns服务器，安装好之后发现不能ping域名了，难道是dns服务器的问题，换成114的dns也没有用，后来终于找到解决的方法了</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>首先看下我的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resolv-file=/etc/resolv.conf</span><br><span class="line">strict-order</span><br><span class="line">listen-address=47.100.210.53</span><br><span class="line">address=/hello.bboysoul.com/198.13.55.44</span><br></pre></td></tr></table></figure></p>
<p>没错我加了这个 <code>resolv-file=/etc/resolv.conf</code><br>也就是说的我的上游dns服务器地址应该是存在这个文件里面的，之后查看这个文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span><br><span class="line">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span><br><span class="line">nameserver 127.0.0.1</span><br><span class="line">options timeout:2 attempts:3 rotate single-request-reopen</span><br></pre></td></tr></table></figure></p>
<p>这就是问题所在了，之后我们修改我们本机的dns服务器地址<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolvconf/resolv.conf.d/head</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver 47.100.210.53</span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure>
<p>有人说ubuntu16.04是修改下面这个文件才可以修改dns服务器地址的，反正我是没有成功过，你们看着办<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolvconf/resolv.conf.d/base</span><br></pre></td></tr></table></figure></p>
<p>但是绝对不能编辑下面这个文件，因为一旦重启网络，这个文件会被重写<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>之后我们重启网络<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart networking</span><br></pre></td></tr></table></figure></p>
<p>重启dnsmasq<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart dnsmasq</span><br></pre></td></tr></table></figure></p>
<p>其实貌似直接重启dnsmasq就可以，因为重启这个貌似会直接重启网络的<br>如果你碰到同样ping不通主机的问题，但是我的方法没有帮助到你，那么也许下面是你的问题所在</p>
<h2 id="第二种情况"><a href="#第二种情况" class="headerlink" title="第二种情况"></a>第二种情况</h2><p>首先看下这个进程是怎么启动的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">╭─root@bboysoul-aliyun ~  </span><br><span class="line">╰─➤  ps -ef |grep dnsmasq</span><br><span class="line">dnsmasq  19842     1  0 17:02 ?        00:00:00 /usr/sbin/dnsmasq -x /var/run/dnsmasq/dnsmasq.pid -u dnsmasq -r /var/run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service --trust-anchor=.,19036,8,2,49aac11d7b6f6446702e54a1607371607a1a41855200fd2ce1cdde32f24e8fb5 --trust-anchor=.,20326,8,2,e06d44b80b8f1d39a95c0b0d7c65d08458e880409bbc683457104237c7f8ec8d</span><br><span class="line">root     20371 20335  0 21:03 pts/1    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn dnsmasq</span><br></pre></td></tr></table></figure></p>
<p>你可以看到上面这么一段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r /var/run/dnsmasq/resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>看下上面这个文件的路径和内容，如果不行那么修改下面这个文件，忽略掉上面这个文件之后重启dnsmasq<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/dnsmasq</span><br></pre></td></tr></table></figure></p>
<p>取消下面这行注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IGNORE_RESOLVCONF=yes</span><br></pre></td></tr></table></figure></p>
<p>之后手动指定上游dns服务器也就是dnsmasq的配置文件vim /etc/dnsmasq.conf加上下面这行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resolv-file=/etc/resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>之后就是重复我上面第一种情况的操作了</p>
<p>转载自 <a href="https://www.jianshu.com/p/81c0221de34c" target="_blank" rel="noopener">!https://www.jianshu.com/p/81c0221de34c</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
  </div>
</article>

  

	<section id="comment" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'futa-ooo';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>




    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>