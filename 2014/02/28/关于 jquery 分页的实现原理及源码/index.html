<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>关于 jquery 分页的实现原理及源码 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="最近做了个用来查课本词汇表的站 http://lab.233.imjs.work/cihui/ ，为了增强用户体验，于是用了 jquery 的 ajax 实现分页功能。随后在某个 web 技术交流群中和别人交流了下，有位童鞋认为这个功能不错，并希望我能提供下源码。正好有段时间没发自己原创的文章了，我">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="关于 jquery 分页的实现原理及源码"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>关于 jquery 分页的实现原理及源码</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2014/02/28/关于 jquery 分页的实现原理及源码/" rel="bookmark">
        <time class="entry-date published" datetime="2014-02-27T21:36:29.000Z">
          2014-02-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近做了个用来查课本词汇表的站 <a href="http://lab.233.imjs.work/cihui/" target="_blank" rel="noopener">http://lab.233.imjs.work/cihui/</a> ，为了增强用户体验，于是用了 jquery 的 ajax 实现分页功能。随后在某个 web 技术交流群中和别人交流了下，有位童鞋认为这个功能不错，并希望我能提供下源码。正好有段时间没发自己原创的文章了，我就发在这里并摘部分的源码吧解释一下吧。现在数据库有点不完整，缺了三十几页的数据，希望各位如果有这书的童鞋能把数据库补充完整，在此先感谢一下。</p>
<p>不想看解释的直接拉到最后下载吧。</p>
<p>为了数据传输方便使用了 json，但由于默认的 json_encode 函数会将中文重新编码，为了调试方便，我写了一个函数用来将中文先用 urlencode 编码，输出之后再解码，给出递归处理准备输出的数据的 function:<br>`    function url_encode_array($val) {<br>        if (is_array($val)) { //判断传入的数据是否为数组<br>            foreach ($val as $k=&gt;$v) { //如果是数组就循环处理获取值<br>                $val[$k]=url_encode_array($v); //调用自身继续处理<br>            }<br>            return $val; //返回编码好的数组<br>        } else {<br>            return urlencode($val); //如果传入值不是数组则直接返回经 urlencode 编码后的字符串<br>        }<br>    }<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">输出时就用 `exit(urldecode(json_encode(url_encode_array($result_array)))); //先使用自定义的 url_encode 函数对传入值进行 urlencode 编码，之后用 json_encode 对值进行 json 编码，再然后用 urldecode 解码，最后用 exit 断绝之后可能的任何输出</span><br></pre></td></tr></table></figure></p>
<p> 输出</p>
<p>数据库部分就不讲了，和分页没什么关系。</p>
<p>现在我们已经有了查询接口了，接下来自然就要用 $.ajax 去请求数据啦，不熟悉 $.ajax 的可以去 <a href="http://w3school.com.cn/jquery/ajax_ajax.asp" target="_blank" rel="noopener">http://w3school.com.cn/jquery/ajax_ajax.asp</a> 看下，这部分就不详解了。接下来说说分页功能(./js/functions.js line 18-77):<br>`            success: function(re) { //ajax 请求成功之后将得到的 json 对象 re 传入当前 function<br>                if (re[‘status’]==”error”) { //如果返回的 status 为 error<br>                    $(“#search_result”).html(‘<div class="alert alert-info">‘+re[‘message’]+’</div>‘); //输出返回的错误信息<br>                } else {<br>                    var ta=’<table class="table table-hover"><tr><th>#</th><th>单词</th><th>词性</th><th>释义</th></tr>‘; //创建 ta 变量，值为将要输出表格的表头<br>                    var tmpword; //创建 tmpword 变量，判断本行的单词是否与上行相同，即判断是否为一词多义<br>                    var iii=1; //计数器<br>                    $.each(re[‘result_data’], function(i,v) { //类似 php 的 foreach 函数，i 为键值，v 为值<br>                        if (tmpword==v[‘word’]) { //如果是一词多义<br>                            v[‘word’]=’&nbsp;’; //将输出值替换为空，但为了与部分浏览器兼容，将值改为 &nbsp;<br>                            tiii=’&nbsp;’; //同上<br>                        } else {<br>                            tmpword=v[‘word’]; //如果不是一词多义，将当前单词赋值给该变量<br>                            tiii=iii; //之后的表格输出序号<br>                            iii++;<br>                        }<br>                        ta=ta+’<tr><td>‘+tiii+’</td><td>‘+v[‘word’]+’</td><td>‘+v[‘speech’]+’</td><td>‘+v[‘trans’]+’</td></tr>‘; //输出的表格添加一行<br>                    });<br>                    ta=ta+’</table></p><p style="text-align: center">‘; //表格结尾<br>                    var pgs=5; //显示页数选择的链接，要求为奇数，大于等于 3<br>                    if (re[‘max_length’]&gt;pgs) { //如果返回的总页数大于要求显示的链接数<br>                        if (page&gt;=((pgs+1)/2+1)) { //如果当前页大于 (pgs+1)/2+1，例如当前页码为 3，pgs 为 3，将进行以下操作<br>                            if (re[‘max_length’]-page&lt;((pgs-1)/2)) { //如果返回的 总页数-当前页 小于 (pgs-1)/2，则执行以下操作<br>                                var ti=re[‘max_length’]-(pgs-1); //定义循环输出初始变量<br>                            } else {<br>                                var ti=page-(pgs-1)/2; //定义循环输出初始变量，当前页-(pgs-1)/2<br>                            }<br>                            var tmpi=ti+(pgs-1); //定义循环输出结束变量<br>                        } else {<br>                            var ti=1;<br>                            var tmpi=pgs;<br>                        }<br>                    } else {<br>                        var ti=1;<br>                        var tmpi=re[‘max_length’];<br>                    }<br>                    if (page!==1) {<br>                        ta=ta+’<a href="####" id="page_'+(page-1)+'">上一页</a>&nbsp;&nbsp;’; //如果当前页不是第一页，就输出第一页的字样<br>                    }<br>                    if (ti!==1) {<br>                        ta=ta+’<a href="####" id="page_1">1</a>&nbsp;&nbsp;…&nbsp;&nbsp;’; //如果循环初始值不是 1 则输出第一页链接<br>                    }<br>                    for (var i=ti;i&lt;=tmpi;i++) {<br>                        if (i==page) { //如果循环到了当前页<br>                            ta=ta+i+’&nbsp;&nbsp;’; //不输出链接，直接输出页码<br>                        } else {<br>                            ta=ta+’<a href="####" id="page_'+i+'">‘+i+’</a>&nbsp;&nbsp;’; //输出链接<br>                        }<br>                    }<br>                    if (tmpi!=re[‘max_length’]) {<br>                        ta=ta+’…&nbsp;&nbsp;<a href="####" id="page_'+re['max_length']+'">‘+re[‘max_length’]+’</a>&nbsp;&nbsp;’; //如果循环结束的页码不等于总页码将显示最后一页的页码<br>                    }<br>                    if (page!=re[‘max_length’]) {<br>                        ta=ta+’<a href="####" id="page_'+(page+1)+'">下一页</a>‘; //如果当前页不是最后一页则显示下一页的链接<br>                    }<br>                    ta=ta+’</p><p style="text-align: right">每页显示<select name="limit" id="limit"><option value="10">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option></select>个</p>‘; //输出选择显示数量的 select<br>                    $(“#search_result”).html(ta); //最终的输出<br>                    $(“#limit”).val(limit); //赋值给 select，确保当前页显示数量与 select 的值相等<br>                }<br>            }<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">另外还有一段，为了防止用户使用 enter 提交的:</span><br><span class="line">`    $(&apos;#search_input&apos;).keypress(function(e)&#123;</span><br><span class="line">        var keyCode = e.keyCode ? e.keyCode : e.which ? e.which : e.charCode;</span><br><span class="line">        if(keyCode === 13)&#123;</span><br><span class="line">            submit_search($(&quot;#search_input&quot;).val());</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><p></p>
<p>但 UC 浏览器上无效，只能再加一段对 get 值的判断:<br><code>getr=GetQueryString(&quot;search_input&quot;);
    if (getr!==null) {
        $(&quot;#search_input&quot;).val(getr);
            submit_search(getr);
    }
``</code></p>
<p>如果还有别的什么问题欢迎评论本文，源码下载(需要修改 ./php/config.php): <a href="http://futa.ooo/wp-content/uploads/2014/02/cihui.zip">cihui</a><br>相应的数据库下载(需要解压然后导入数据): <a href="http://futa.ooo/wp-content/uploads/2014/02/vocabulary.sql_.zip">vocabulary.sql_.zip</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/程序发布/">程序发布</a>
    </span>
    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>