<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>无聊给博客加了个背景音乐 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="如题。。顺手写了个管理中心。。这是我第一个用到 json 的玩意儿。。不过别说 json 还是挺方便的。。附源码及安装说明。。
2014-01-31 重要更新，因在编写前一个版本时不熟悉 php 的 cookies 机制，导致 随机播放时避免重复播放 的功能未实现，后准备使用 jquery 将播放列">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="无聊给博客加了个背景音乐"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>无聊给博客加了个背景音乐</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2014/01/29/无聊给博客加了个背景音乐/" rel="bookmark">
        <time class="entry-date published" datetime="2014-01-29T03:08:17.000Z">
          2014-01-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>如题。。顺手写了个管理中心。。这是我第一个用到 json 的玩意儿。。不过别说 json 还是挺方便的。。附源码及安装说明。。</p>
<p><strong>2014-01-31 重要更新，因在编写前一个版本时不熟悉 php 的 cookies 机制，导致 随机播放时避免重复播放 的功能未实现，后准备使用 jquery 将播放列表存到本地 cookies 然后随机调用，又发现 cookies 有大小限制。之后只能放弃了这个功能，现在只使用 cookies 记录当前播放的曲目以及服务器传回的播放列表中总计的曲目数量，以便进行顺序播放。</strong></p>
<p>一、先创建数据表<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">`music_list`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">text</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">""</span>,</span><br><span class="line"><span class="string">`url`</span> <span class="built_in">text</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">""</span>,</span><br><span class="line"><span class="string">`singer`</span> <span class="built_in">text</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">""</span>,</span><br><span class="line"><span class="string">`lrc`</span> <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="number">0</span>,</span><br><span class="line"><span class="string">`lrc_data`</span> <span class="built_in">text</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="string">""</span>,</span><br><span class="line">primary <span class="keyword">key</span>(<span class="string">`id`</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>表示偷了个小懒全用的 text</p>
<p>二、上传文件至根目录，命名无所谓，必须 .php 结尾，本站的是 music_list.php<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line">    header(<span class="string">"Content-type:text/html;charset=utf-8"</span>);</span><br><span class="line">    date_default_timezone_set(<span class="string">'Asia/Shanghai'</span>);</span><br><span class="line">    $pass=<span class="string">'经 md5 加密后的密码'</span>;</span><br><span class="line">    $link = @mysql_connect(<span class="string">"数据库服务器"</span>,<span class="string">'数据库用户名'</span>,<span class="string">'数据库密码'</span>,<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">if</span>(!$link) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Connect Server Failed: "</span> . mysql_error());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!mysql_select_db(<span class="string">'数据库名'</span>,$link)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Select Database Failed: "</span> . mysql_error($link));</span><br><span class="line">    &#125;</span><br><span class="line">    mysql_query(<span class="string">'set names utf8'</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_music</span><span class="params">($id=null)</span> </span>&#123;</span><br><span class="line">        $return_value=<span class="keyword">array</span>();</span><br><span class="line">        $select_query=mysql_query(<span class="string">'select * from `music_list`'</span>);</span><br><span class="line">        <span class="keyword">while</span> (($value=mysql_fetch_array($select_query))!==<span class="keyword">false</span>) &#123;</span><br><span class="line">            $return_tmp=<span class="keyword">array</span>();</span><br><span class="line">            $return_tmp[<span class="string">'name'</span>]=$value[<span class="string">'name'</span>];</span><br><span class="line">            $return_tmp[<span class="string">'url'</span>]=$value[<span class="string">'url'</span>];</span><br><span class="line">            $return_tmp[<span class="string">'singer'</span>]=$value[<span class="string">'singer'</span>];</span><br><span class="line">            $return_tmp[<span class="string">'id'</span>]=$value[<span class="string">'id'</span>];</span><br><span class="line">            $return_tmp[<span class="string">'lrc'</span>]=htmlspecialchars($value[<span class="string">'lrc'</span>]);</span><br><span class="line">            $return_tmp[<span class="string">'lrc_data'</span>]=str_replace(<span class="keyword">array</span>(<span class="string">"\r"</span>,<span class="string">"\n"</span>),<span class="keyword">array</span>(<span class="string">""</span>,<span class="string">"&lt;br /&gt;"</span>),$value[<span class="string">'lrc_data'</span>]);</span><br><span class="line">            $return_value[]=$return_tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ($id==<span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $return_value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $return_values=$return_value[$id];</span><br><span class="line">            $return_values[<span class="string">'length'</span>]=count($return_value);</span><br><span class="line">            <span class="keyword">return</span> $return_values;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">chkid</span><span class="params">($id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>($id) &amp;&amp; is_numeric($id)) &#123;</span><br><span class="line">            $select_query=mysql_query(<span class="string">'select * from `music_list` where `id`=\''</span>.$id.<span class="string">'\''</span>);</span><br><span class="line">            <span class="keyword">if</span> (mysql_num_rows($select_query)==<span class="number">0</span>) &#123;</span><br><span class="line">                msg(<span class="string">'找不到数据'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        msg(<span class="string">'找不到数据'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get_post_data</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!get_magic_quotes_gpc()) &#123;</span><br><span class="line">            $return_value=<span class="keyword">array</span>();</span><br><span class="line">            <span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $key=&gt;$value) &#123;</span><br><span class="line">                $return_value[$key]=addslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $return_value=$_POST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $return_value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">msg</span><span class="params">($msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;'</span>.$msg.<span class="string">'&lt;/p&gt;&lt;p&gt;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'"&gt;返回首页&lt;/a&gt;&lt;/p&gt;'</span>;</span><br><span class="line">        echo_footer();</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_header</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;html&gt;&lt;head&gt;&lt;meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0"/&gt;&lt;title&gt;博客背景音乐管理中心&lt;/title&gt;&lt;/head&gt;&lt;body&gt;'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo_footer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'get_music'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($_GET[<span class="string">'id'</span>]!==<span class="string">''</span> &amp;&amp; is_numeric($_GET[<span class="string">'id'</span>])) &#123;</span><br><span class="line">            $output=get_music($_GET[<span class="string">'id'</span>]);</span><br><span class="line">            preg_match_all(<span class="string">"/^(http:\/\/.*\/)(.*?)$/"</span>,$output[<span class="string">'url'</span>],$outputtmp);</span><br><span class="line">            $output[<span class="string">'url'</span>]=$outputtmp[<span class="number">1</span>][<span class="number">0</span>].rawurlencode($outputtmp[<span class="number">2</span>][<span class="number">0</span>]);</span><br><span class="line">            <span class="keyword">foreach</span> ($output <span class="keyword">as</span> $k=&gt;$v) &#123;</span><br><span class="line">                $output[$k]=urlencode($v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> urldecode(json_encode($output));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'get_music_list'</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> json_encode(get_music());</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'login'</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ($_SESSION[<span class="string">'admin'</span>]==<span class="string">'admin'</span>) &#123;</span><br><span class="line">            header(<span class="string">'Location: '</span>.$_SERVER[<span class="string">'PHP_SELF'</span>]);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        echo_header();</span><br><span class="line">        <span class="keyword">if</span> ($_POST) &#123;</span><br><span class="line">            <span class="keyword">if</span> (md5($_POST[<span class="string">'password'</span>])==$pass) &#123;</span><br><span class="line">                $_SESSION[<span class="string">'admin'</span>]=<span class="string">'admin'</span>;</span><br><span class="line">                header(<span class="string">'Location: '</span>.$_SERVER[<span class="string">'PHP_SELF'</span>]);</span><br><span class="line">                <span class="keyword">exit</span>();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;p&gt;密码错误&lt;/p&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;&lt;p&gt;&lt;label&gt;请输入密码:&lt;input type="password" name="password" /&gt;&lt;/label&gt;&lt;/p&gt;&lt;p&gt;&lt;input type="submit" name="submit" value="提交" /&gt;&lt;/p&gt;&lt;/form&gt;'</span>;</span><br><span class="line">        echo_footer();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ($_SESSION[<span class="string">'admin'</span>]!==<span class="string">'admin'</span>) &#123;</span><br><span class="line">            header(<span class="string">'Location: '</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'?action=login'</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        echo_header();</span><br><span class="line">        <span class="keyword">if</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'del'</span>) &#123;</span><br><span class="line">            chkid($_GET[<span class="string">'id'</span>]);</span><br><span class="line">            <span class="keyword">if</span> ($_POST) &#123;</span><br><span class="line">                $del_query=mysql_query(<span class="string">'delete from `music_list` where `id`=\''</span>.$_GET[<span class="string">'id'</span>].<span class="string">'\''</span>);</span><br><span class="line">                <span class="keyword">if</span> ($del_query) &#123;</span><br><span class="line">                    msg(<span class="string">'删除成功'</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    msg(<span class="string">'删除失败'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $select_query=mysql_fetch_array(mysql_query(<span class="string">'select * from `music_list` where `id`=\''</span>.$_GET[<span class="string">'id'</span>].<span class="string">'\''</span>));</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;&lt;p&gt;您确定要删除 '</span>.$select_query[<span class="string">'name'</span>].<span class="string">' - '</span>.$select_query[<span class="string">'singer'</span>].<span class="string">'么？&lt;/p&gt;&lt;p&gt;&lt;input type="submit" name="submit" value="确定" /&gt;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'"&gt;取消&lt;/a&gt;&lt;/p&gt;&lt;/form&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'edit'</span>) &#123;</span><br><span class="line">            chkid($_GET[<span class="string">'id'</span>]);</span><br><span class="line">            <span class="keyword">if</span> ($_POST) &#123;</span><br><span class="line">                $post_data=get_post_data();</span><br><span class="line">                $update_query=mysql_query(<span class="string">'update `music_list` set `name`=\''</span>.$post_data[<span class="string">'name'</span>].<span class="string">'\', `url`=\''</span>.$post_data[<span class="string">'url'</span>].<span class="string">'\', `singer`=\''</span>.$post_data[<span class="string">'singer'</span>].<span class="string">'\', `lrc`=\''</span>.$post_data[<span class="string">'lrc'</span>].<span class="string">'\', `lrc_data`=\''</span>.$post_data[<span class="string">'lrc_data'</span>].<span class="string">'\' where `id`=\''</span>.$_GET[<span class="string">'id'</span>].<span class="string">'\''</span>);</span><br><span class="line">                <span class="keyword">if</span> ($update_query) &#123;</span><br><span class="line">                    msg(<span class="string">'数据插入成功'</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    msg(<span class="string">'数据插入失败'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $select_query=mysql_fetch_array(mysql_query(<span class="string">'select * from `music_list` where `id`=\''</span>.$_GET[<span class="string">'id'</span>].<span class="string">'\''</span>));</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;&lt;p&gt;&lt;label&gt;歌名:&lt;input type="text" name="name" value="'</span>.$select_query[<span class="string">'name'</span>].<span class="string">'" /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;歌手:&lt;input type="text" name="singer" value="'</span>.$select_query[<span class="string">'singer'</span>].<span class="string">'" /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;下载地址:&lt;input type="text" name="url" value="'</span>.$select_query[<span class="string">'url'</span>].<span class="string">'" /&gt;&lt;/p&gt;&lt;p&gt;显示 lrc 歌词: &lt;label&gt;&lt;input type="radio" name="lrc" value="1" '</span>.($select_query[<span class="string">'lrc'</span>]?<span class="string">'checked="checked" '</span>:<span class="string">''</span>).<span class="string">'/&gt;是&lt;/label&gt;&amp;nbsp;&amp;nbsp;&lt;label&gt;&lt;input type="radio" name="lrc" value="0" '</span>.(!$select_query[<span class="string">'lrc'</span>]?<span class="string">'checked="checked" '</span>:<span class="string">''</span>).<span class="string">'/&gt;否&lt;/label&gt;&lt;/p&gt;&lt;p&gt;lrc 歌词(可选):&lt;br /&gt;&lt;textarea name="lrc_data"&gt;'</span>.htmlspecialchars($select_query[<span class="string">'lrc_data'</span>]).<span class="string">'&lt;/textarea&gt;&lt;/p&gt;&lt;p&gt;&lt;input type="submit" name="submit" value="确定" /&gt;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'"&gt;取消&lt;/a&gt;&lt;/p&gt;&lt;/form&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'search'</span>) &#123;</span><br><span class="line">            $post_data=get_post_data();</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;form action="?action=search" method="post"&gt;&lt;p&gt;&lt;input name="search" type="text" value="'</span>.$post_data[<span class="string">'search'</span>].<span class="string">'"/&gt;&lt;/p&gt;&lt;p&gt;&lt;input type="submit" value="搜索" /&gt;&lt;/p&gt;&lt;/form&gt;'</span>;</span><br><span class="line">            <span class="keyword">if</span> ($_POST) &#123;</span><br><span class="line">                $search_query=mysql_query(<span class="string">'select * from `music_list` where `name` like \'%'</span>.$post_data[<span class="string">'search'</span>].<span class="string">'%\' or `singer` like \'%'</span>.$post_data[<span class="string">'search'</span>].<span class="string">'%\' or `url` like \'%'</span>.$post_data[<span class="string">'search'</span>].<span class="string">'%\''</span>);</span><br><span class="line">                <span class="keyword">if</span> (mysql_num_rows($search_query)&gt;<span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;ol&gt;'</span>;</span><br><span class="line">                    <span class="keyword">while</span> (($value=mysql_fetch_array($search_query))!==<span class="keyword">false</span>) &#123;</span><br><span class="line">                        <span class="keyword">echo</span> <span class="string">'&lt;li&gt;'</span>.$value[<span class="string">'name'</span>].<span class="string">' - '</span>.$value[<span class="string">'singer'</span>].<span class="string">'&amp;nbsp;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'?action=edit&amp;id='</span>.$value[<span class="string">'id'</span>].<span class="string">'"&gt;编辑&lt;/a&gt;&amp;nbsp;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'?action=del&amp;id='</span>.$value[<span class="string">'id'</span>].<span class="string">'"&gt;删除&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;/ol&gt;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'"&gt;返回首页&lt;/a&gt;'</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">'&lt;p&gt;无搜索结果&lt;/p&gt;'</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">elseif</span> ($_GET[<span class="string">'action'</span>]==<span class="string">'add'</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ($_POST) &#123;</span><br><span class="line">                $post_data=get_post_data();</span><br><span class="line">                $insert_query=mysql_query(<span class="string">'insert into `music_list`(`name`,`url`,`singer`,`lrc`,`lrc_data`) values(\''</span>.$post_data[<span class="string">'name'</span>].<span class="string">'\',\''</span>.$post_data[<span class="string">'url'</span>].<span class="string">'\',\''</span>.$post_data[<span class="string">'singer'</span>].<span class="string">'\',\''</span>.$post_data[<span class="string">'lrc'</span>].<span class="string">'\',\''</span>.$post_data[<span class="string">'lrc_data'</span>].<span class="string">'\')'</span>);</span><br><span class="line">                <span class="keyword">if</span> ($insert_query) &#123;</span><br><span class="line">                    msg(<span class="string">'数据插入成功'</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    msg(<span class="string">'数据插入失败'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">'&lt;form action="" method="post"&gt;&lt;p&gt;&lt;label&gt;歌名:&lt;input type="text" name="name" /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;歌手:&lt;input type="text" name="singer" /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;下载地址:&lt;input type="text" name="url" value="http://" /&gt;&lt;/p&gt;&lt;p&gt;显示 lrc 歌词: &lt;label&gt;&lt;input type="radio" name="lrc" value="1" /&gt;是&lt;/label&gt;&amp;nbsp;&amp;nbsp;&lt;label&gt;&lt;input type="radio" name="lrc" value="0" checked="checked" /&gt;否&lt;/label&gt;&lt;/p&gt;&lt;p&gt;lrc 歌词(可选):&lt;br /&gt;&lt;textarea name="lrc_data"&gt;'</span>.htmlspecialchars($select_query[<span class="string">'lrc_data'</span>]).<span class="string">'&lt;/textarea&gt;&lt;/p&gt;&lt;p&gt;&lt;input type="submit" name="submit" value="确定" /&gt;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'"&gt;取消&lt;/a&gt;&lt;/p&gt;&lt;/form&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             <span class="keyword">echo</span> <span class="string">'&lt;form action="?action=search" method="post"&gt;&lt;p&gt;&lt;input name="search" type="text" /&gt;&lt;/p&gt;&lt;p&gt;&lt;input type="submit" value="搜索" /&gt;&lt;/p&gt;&lt;/form&gt;'</span>;</span><br><span class="line">             $all_list=get_music();</span><br><span class="line">             <span class="keyword">echo</span> <span class="string">'&lt;ol&gt;'</span>;</span><br><span class="line">             <span class="keyword">foreach</span> ($all_list <span class="keyword">as</span> $value) &#123;</span><br><span class="line">                 <span class="keyword">echo</span> <span class="string">'&lt;li&gt;'</span>.$value[<span class="string">'name'</span>].<span class="string">' - '</span>.$value[<span class="string">'singer'</span>].<span class="string">'&amp;nbsp;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'?action=edit&amp;id='</span>.$value[<span class="string">'id'</span>].<span class="string">'"&gt;编辑&lt;/a&gt;&amp;nbsp;&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'?action=del&amp;id='</span>.$value[<span class="string">'id'</span>].<span class="string">'"&gt;删除&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">echo</span> <span class="string">'&lt;/ol&gt;'</span>;</span><br><span class="line">             <span class="keyword">echo</span> <span class="string">'&lt;a href="'</span>.$_SERVER[<span class="string">'PHP_SELF'</span>].<span class="string">'?action=add"&gt;添加新曲目&lt;/a&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        echo_footer();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>注意不要忘记修改数据库信息和登录密码</p>
<p>三、前台创建小工具<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/json2.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"/jquery.cookie.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">            /*</span></span><br><span class="line"><span class="undefined">             * Lyric support by kookxiang(http://ikk.me)</span></span><br><span class="line"><span class="undefined">             */</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_player</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">max-height</span>: <span class="number">40px</span>; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc</span> &#123; <span class="attribute">height</span>: <span class="number">125px</span>; <span class="attribute">overflow</span>: auto; <span class="attribute">padding</span>: <span class="number">0</span>; <span class="attribute">margin</span>: <span class="number">0</span>; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc</span> <span class="selector-tag">li</span> &#123; <span class="attribute">display</span>: block; <span class="attribute">text-align</span>: center; <span class="attribute">color</span>: gray; <span class="attribute">line-height</span>: <span class="number">20px</span>; <span class="attribute">margin</span>: <span class="number">2px</span> <span class="number">0</span> <span class="number">3px</span> <span class="number">0</span> <span class="meta">!important</span>; <span class="attribute">min-height</span>: <span class="number">20px</span>; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc</span> <span class="selector-class">.current</span> &#123; <span class="attribute">color</span>: black; <span class="attribute">font-weight</span>: bold; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc</span>, <span class="selector-class">.kk_lrc</span> * &#123; <span class="attribute">-webkit-transition-duration</span>: <span class="number">1s</span>; <span class="attribute">-moz-transition-duration</span>: <span class="number">1s</span>; <span class="attribute">transition-duration</span>: <span class="number">1s</span>; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc</span> <span class="selector-pseudo">::selection</span> &#123; <span class="attribute">background</span>: transparent; <span class="attribute">background</span>: <span class="built_in">rgba</span>(127, 127, 127, 0.1); &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc_box</span> &#123; <span class="attribute">position</span>: relative; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc_box</span><span class="selector-pseudo">:before</span> &#123; <span class="attribute">content</span>: <span class="string">'.'</span>; <span class="attribute">overflow</span>: hidden; <span class="attribute">text-indent</span>: -<span class="number">9999px</span>; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">30px</span>; <span class="attribute">z-index</span>: <span class="number">1</span>; <span class="attribute">display</span>: block; <span class="attribute">position</span>: absolute; <span class="attribute">background</span>: <span class="built_in">url</span>(http://lab.imjs.work/getlrc/cover.png) repeat-x <span class="number">0</span> <span class="number">0</span>; <span class="attribute">top</span>: <span class="number">0</span>; <span class="attribute">pointer-events</span>: none; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-class">.kk_lrc_box</span><span class="selector-pseudo">:after</span> &#123; <span class="attribute">content</span>: <span class="string">'.'</span>; <span class="attribute">overflow</span>: hidden; <span class="attribute">text-indent</span>: -<span class="number">9999px</span>; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">30px</span>; <span class="attribute">z-index</span>: <span class="number">1</span>; <span class="attribute">display</span>: block; <span class="attribute">position</span>: absolute; <span class="attribute">background</span>: <span class="built_in">url</span>(http://lab.imjs.work/getlrc/cover.png) repeat-x <span class="number">0</span> <span class="number">100%</span>; <span class="attribute">bottom</span>: <span class="number">0</span>; <span class="attribute">pointer-events</span>: none; &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">            <span class="selector-pseudo">::-webkit-scrollbar</span> &#123; <span class="attribute">width</span>: <span class="number">8px</span>; <span class="attribute">height</span>: <span class="number">8px</span>;&#125;</span></span><br><span class="line"><span class="css">            <span class="selector-pseudo">::-webkit-scrollbar-track</span> &#123; <span class="attribute">-webkit-border-radius</span>: <span class="number">10px</span>; <span class="attribute">border-radius</span>: <span class="number">10px</span>; &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-pseudo">::-webkit-scrollbar-thumb</span> &#123; <span class="attribute">-webkit-border-radius</span>: <span class="number">10px</span>; <span class="attribute">border-radius</span>: <span class="number">10px</span>; <span class="attribute">background</span>: <span class="built_in">rgba</span>(96, 96, 96, 0.8); <span class="attribute">-webkit-box-shadow</span>: inset <span class="number">0</span> <span class="number">0</span> <span class="number">6px</span> <span class="built_in">rgba</span>(0, 0, 0, 0.5); &#125;</span></span><br><span class="line"><span class="css">            <span class="selector-pseudo">::-webkit-scrollbar-thumb</span><span class="selector-pseudo">:window-inactive</span> &#123; <span class="attribute">background</span>: <span class="built_in">rgba</span>(96, 96, 96, 0.4); &#125;</span></span><br><span class="line"><span class="undefined">        </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> ael=<span class="literal">false</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> tmp_interval=[<span class="number">0</span>,<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">get_lrc</span>(<span class="params">name,singer</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>);  </span></span><br><span class="line"><span class="javascript">    script.setAttribute(<span class="string">'src'</span>, <span class="string">"http://lab.liujiantao.me/lrc/?name="</span>+<span class="built_in">encodeURIComponent</span>(name)+<span class="string">"&amp;singer="</span>+<span class="built_in">encodeURIComponent</span>(singer)+<span class="string">"&amp;callback=con_lrc"</span>);  </span></span><br><span class="line"><span class="javascript">    <span class="comment">//load javascript  </span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">'head'</span>)[<span class="number">0</span>].appendChild(script);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">con_lrc</span>(<span class="params">lrc_data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> err_msg=&#123;<span class="string">"-1"</span>:<span class="string">"服务器没有接收到完整数据"</span>,<span class="string">"-2"</span>:<span class="string">"无法正常获取 xml 文件"</span>,<span class="string">"-3"</span>:<span class="string">"找不到该曲目"</span>,<span class="string">"-4"</span>:<span class="string">"未收录 lrc 歌词"</span>,<span class="string">"-5"</span>:<span class="string">"无法正常获取 lrc 歌词"</span>&#125;;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (lrc_data.status==<span class="string">"error"</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.error(err_msg[lrc_data.errcode]);</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#kk_lrc_box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="xml">    $("#player_lrc").html("<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span>");</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> kk_lrc = load_kk_lrc();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (j=<span class="number">0</span>;j&lt;lrc_data.result.length;j++) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> lrcArray=lrc_data.result[j].split(<span class="string">"&lt;br /&gt;"</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> timeKey=<span class="keyword">new</span> <span class="built_in">Object</span>();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> strArray=<span class="keyword">new</span> <span class="built_in">Array</span>();</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> _offset=lrc_data.result[j].match(<span class="regexp">/\[offset.*?(\d*?)\]/</span>);</span></span><br><span class="line"><span class="javascript">        _offset=(<span class="keyword">typeof</span> _offset==<span class="string">"undefined"</span> || _offset===<span class="literal">null</span>)?<span class="number">0</span>:_offset[<span class="number">1</span>]/<span class="number">1000</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>,l = lrcArray.length;i &lt; l;i++) &#123;</span></span><br><span class="line"><span class="javascript">            clause = <span class="built_in">decodeURIComponent</span>(lrcArray[i]).replace(<span class="regexp">/\[\d*?:\d*?([\.:]\d*?)?\]/g</span>,<span class="string">''</span>);</span></span><br><span class="line"><span class="javascript">            timeRegExpArr = <span class="built_in">decodeURIComponent</span>(lrcArray[i]).match(<span class="regexp">/\[(\d*?):(\d*?)([\.:](\d*?))?\]/g</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (timeRegExpArr!=<span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">for</span> (<span class="keyword">var</span> k = <span class="number">0</span>,h = timeRegExpArr.length;k &lt; h;k++) &#123; <span class="comment">//第一遍循环，JSON存储歌词，数组存储时间</span></span></span><br><span class="line"><span class="javascript">                    _timeRegExpArr = timeRegExpArr[k].match(<span class="regexp">/^\[(\d*?):(\d*?)([\.:](\d*?))?\]$/</span>);</span></span><br><span class="line"><span class="javascript">                    min = <span class="built_in">parseFloat</span>(_timeRegExpArr[<span class="number">1</span>]);</span></span><br><span class="line"><span class="javascript">                    sec = <span class="built_in">parseFloat</span>(_timeRegExpArr[<span class="number">2</span>]);</span></span><br><span class="line"><span class="javascript">                    msec = <span class="built_in">parseFloat</span>(<span class="keyword">typeof</span> _timeRegExpArr[<span class="number">4</span>]==<span class="string">"undefined"</span>?<span class="number">0</span>:_timeRegExpArr[<span class="number">4</span>]);</span></span><br><span class="line"><span class="undefined">                    time=min * 60 + sec + msec/100 - _offset;</span></span><br><span class="line"><span class="undefined">                    time=(time&lt;0)?0:time;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (!timeKey[time]) &#123;</span></span><br><span class="line"><span class="undefined">                        strArray.push(time);</span></span><br><span class="line"><span class="javascript">                        timeKey[time] = clause + <span class="string">'&lt;br /&gt;'</span>;</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        timeKey[time] += clause + <span class="string">'&lt;br /&gt;'</span>;</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        strArray.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> a - b;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>,l = strArray.length;i &lt; l;i++) &#123; <span class="comment">//第二遍循环，JSON存储时间，数组存储歌词</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> tempIndex = strArray[i],</span></span><br><span class="line"><span class="undefined">            tempClause = timeKey[tempIndex];</span></span><br><span class="line"><span class="undefined">            kk_lrc.add_lrc(tempIndex,tempClause);</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined">    kk_lrc.init();</span></span><br><span class="line"><span class="javascript">    ael=<span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">add_lrc</span>(<span class="params">lrc_data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    con_lrc(&#123;<span class="string">'status'</span>:<span class="string">'success'</span>,<span class="string">'errcode'</span>:<span class="string">'0'</span>,<span class="string">'result'</span>:[lrc_data.replace(<span class="string">"\n"</span>,<span class="string">"&lt;br /&gt;"</span>)]&#125;);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">/*</span></span><br><span class="line"><span class="javascript"> * Lyric support by kookxiang(http:<span class="comment">//ikk.me)</span></span></span><br><span class="line"><span class="undefined"> */</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">load_kk_lrc</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> kk_lrc = <span class="keyword">new</span> <span class="built_in">Object</span>();</span></span><br><span class="line"><span class="undefined">    kk_lrc.extra_top = 1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.current = -1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.current_obj;</span></span><br><span class="line"><span class="undefined">    kk_lrc.offset = 0;</span></span><br><span class="line"><span class="undefined">    kk_lrc.current_start = -1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.next_update_time = -1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.showtime = -1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.lrc_offset = -1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.lrc_height = -1;</span></span><br><span class="line"><span class="undefined">    kk_lrc.lrc = [];</span></span><br><span class="line"><span class="javascript">    kk_lrc.lrcobj = <span class="literal">null</span>;</span></span><br><span class="line"><span class="undefined">    kk_lrc.target = 0;</span></span><br><span class="line"><span class="undefined">    kk_lrc._target = 0;</span></span><br><span class="line"><span class="javascript">    kk_lrc.player_obj = <span class="built_in">document</span>.getElementById(<span class="string">'player_player'</span>);</span></span><br><span class="line"><span class="javascript">    kk_lrc.lrc_obj = <span class="built_in">document</span>.getElementById(<span class="string">'player_lrc'</span>);</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    kk_lrc.scroll_lrc = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(<span class="keyword">typeof</span> kk_lrc.lrc[kk_lrc.current+<span class="number">2</span>] != <span class="string">"undefined"</span>)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">for</span>(id <span class="keyword">in</span> kk_lrc.lrcobj) kk_lrc.lrcobj[id].className = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript">            kk_lrc.lrcobj[kk_lrc.current+<span class="number">3</span>].className = <span class="string">'current'</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        kk_lrc.current_start = kk_lrc.lrc[kk_lrc.current];</span></span><br><span class="line"><span class="undefined">        kk_lrc.current++;</span></span><br><span class="line"><span class="undefined">        kk_lrc.current_obj = kk_lrc.lrcobj[kk_lrc.current+2];</span></span><br><span class="line"><span class="undefined">        kk_lrc.next_update_time = kk_lrc.lrc[kk_lrc.current];</span></span><br><span class="line"><span class="undefined">        kk_lrc.showtime = kk_lrc.next_update_time - kk_lrc.current_start;</span></span><br><span class="line"><span class="undefined">        kk_lrc.lrc_offset = kk_lrc.current_obj.offsetTop;</span></span><br><span class="line"><span class="undefined">        kk_lrc.lrc_height = kk_lrc.current_obj.offsetHeight;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    kk_lrc.check_lrc_update = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> curTime = kk_lrc.player_obj.currentTime;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(curTime &gt;= kk_lrc.next_update_time - <span class="number">0.2</span>)&#123;</span></span><br><span class="line"><span class="undefined">            kk_lrc.scroll_lrc();</span></span><br><span class="line"><span class="undefined">            kk_lrc.check_lrc_update();</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(<span class="keyword">typeof</span> kk_lrc.lrc[kk_lrc.current<span class="number">-1</span>] != <span class="string">"undefined"</span>)&#123;</span></span><br><span class="line"><span class="undefined">            kk_lrc.extra_top = (kk_lrc.next_update_time - curTime) / kk_lrc.showtime;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        kk_lrc.target = <span class="built_in">Math</span>.round(kk_lrc.lrc_offset - (<span class="number">125</span> - kk_lrc.lrc_height) / <span class="number">2</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(kk_lrc.target &lt; <span class="number">0</span>) kk_lrc.target = <span class="number">0</span>;</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    kk_lrc.init = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        kk_lrc.add_lrc(<span class="string">'999999'</span>, <span class="string">''</span>);</span></span><br><span class="line"><span class="javascript">        kk_lrc.add_lrc(<span class="string">'999999'</span>, <span class="string">''</span>);</span></span><br><span class="line"><span class="javascript">        kk_lrc.add_lrc(<span class="string">'999999'</span>, <span class="string">''</span>);</span></span><br><span class="line"><span class="undefined">        kk_lrc.current = -1;</span></span><br><span class="line"><span class="javascript">        kk_lrc.lrcobj = kk_lrc.lrc_obj.getElementsByTagName(<span class="string">'li'</span>);</span></span><br><span class="line"><span class="undefined">        kk_lrc.current_obj = kk_lrc.lrcobj[0];</span></span><br><span class="line"><span class="undefined">        kk_lrc.scroll_lrc();</span></span><br><span class="line"><span class="undefined">        kk_lrc.check_lrc_update();</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (ael==<span class="literal">false</span>) &#123;</span></span><br><span class="line"><span class="javascript">        kk_lrc.player_obj.addEventListener(<span class="string">"seeked"</span> ,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">            kk_lrc.current = -1;</span></span><br><span class="line"><span class="undefined">            kk_lrc.scroll_lrc();</span></span><br><span class="line"><span class="undefined">            kk_lrc.check_lrc_update();</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="javascript">        kk_lrc.player_obj.addEventListener(<span class="string">"durationchange"</span> ,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="undefined">            kk_lrc.current = -1;</span></span><br><span class="line"><span class="undefined">            kk_lrc.scroll_lrc();</span></span><br><span class="line"><span class="undefined">            kk_lrc.check_lrc_update();</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="undefined">                    clearInterval(tmp_interval[0]);</span></span><br><span class="line"><span class="undefined">                    clearInterval(tmp_interval[1]);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">        tmp_interval[<span class="number">0</span>]=setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(kk_lrc.player_obj.paused) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(kk_lrc.current_start &gt; kk_lrc.player_obj.currentTime)&#123;</span></span><br><span class="line"><span class="undefined">                    kk_lrc.current = -1;</span></span><br><span class="line"><span class="undefined">                    kk_lrc.scroll_lrc();</span></span><br><span class="line"><span class="undefined">                    kk_lrc.check_lrc_update();</span></span><br><span class="line"><span class="javascript">                &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="undefined">                    kk_lrc.check_lrc_update();</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;, 100);</span></span><br><span class="line"><span class="javascript">            tmp_interval[<span class="number">1</span>]=setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(kk_lrc._target == kk_lrc.target) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(<span class="built_in">Math</span>.abs(kk_lrc.lrc_obj.scrollTop - kk_lrc._target) &gt; kk_lrc.lrc_height)&#123;</span></span><br><span class="line"><span class="undefined">                    kk_lrc._target = kk_lrc.lrc_obj.scrollTop;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span>(kk_lrc.player_obj.paused)&#123;</span></span><br><span class="line"><span class="undefined">                    kk_lrc._target = kk_lrc.fixFloat(kk_lrc._target * 0.8 + kk_lrc.target * 0.2);</span></span><br><span class="line"><span class="javascript">                &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="undefined">                    kk_lrc._target = kk_lrc.fixFloat(kk_lrc._target * 0.98 + kk_lrc.target * 0.02);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">                kk_lrc.lrc_obj.scrollTop = kk_lrc._target;</span></span><br><span class="line"><span class="undefined">            &#125;, 5);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    kk_lrc.add_lrc = <span class="function"><span class="keyword">function</span> (<span class="params">time, lrc</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        kk_lrc.lrc.push(<span class="built_in">parseFloat</span>(time) + kk_lrc.offset);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> lrc_line = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span></span><br><span class="line"><span class="undefined">        lrc_line.innerHTML = lrc;</span></span><br><span class="line"><span class="undefined">        kk_lrc.lrc_obj.appendChild(lrc_line);</span></span><br><span class="line"><span class="undefined">    &#125;;</span></span><br><span class="line"><span class="javascript">    kk_lrc.get_lrc = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span>(<span class="keyword">typeof</span> kk_lrc.lrc[num] != <span class="string">"undefined"</span>)&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> kk_lrc.lrc[num][<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">        &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">''</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    kk_lrc.setoffset = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        kk_lrc.offset = num / 1000;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    kk_lrc.fixFloat = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="built_in">Math</span>.ceil(num * <span class="number">10</span>) / <span class="number">10</span>;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> kk_lrc;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">get_music</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#audio_player"</span>).html(<span class="string">'&lt;p&gt;正在加载播放器，请稍候&lt;/p&gt;'</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (<span class="string">"undefined"</span>==<span class="keyword">typeof</span> $.cookie(<span class="string">"music_list"</span>) || $.cookie(<span class="string">"music_list"</span>)==<span class="literal">null</span>) &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> music_id=<span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> cookie_music=<span class="built_in">JSON</span>.parse($.cookie(<span class="string">"music_list"</span>));</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> ((cookie_music[<span class="string">'id'</span>]+<span class="number">1</span>)==cookie_music[<span class="string">'length'</span>]) &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> music_id=<span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> music_id=cookie_music[<span class="string">'id'</span>]+<span class="number">1</span>;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> music_id=(<span class="string">"undefined"</span>!==<span class="keyword">typeof</span> <span class="built_in">arguments</span>[<span class="number">0</span>])?<span class="built_in">arguments</span>[<span class="number">0</span>]:music_id;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            type: <span class="string">'get'</span>,</span></span><br><span class="line"><span class="javascript">            url: <span class="string">'/music_list.php'</span>,</span></span><br><span class="line"><span class="javascript">            dataType: <span class="string">'json'</span>,</span></span><br><span class="line"><span class="undefined">            timeout: 3000,</span></span><br><span class="line"><span class="javascript">            data: &#123;<span class="string">"action"</span>:<span class="string">"get_music"</span>,<span class="string">"id"</span>:music_id&#125;,</span></span><br><span class="line"><span class="javascript">            success: <span class="function"><span class="keyword">function</span>(<span class="params">music</span>) </span>&#123;</span></span><br><span class="line"><span class="xml">                $("#audio_player").html('<span class="tag">&lt;<span class="name">p</span>&gt;</span>当前<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"audio_player_status"</span>&gt;</span>正在缓冲准备播放<span class="tag">&lt;/<span class="name">span</span>&gt;</span>的是:<span class="tag">&lt;<span class="name">br</span> /&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"music_name"</span>&gt;</span>' +  music['name'] + ' - ' + music['singer'] + '<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&amp;nbsp;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"####"</span> <span class="attr">id</span>=<span class="string">"reload_audio_player"</span>&gt;</span>换一首<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>');</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="keyword">typeof</span> $(<span class="string">"#audio_list"</span>).html()!==<span class="string">'undefined'</span>) $(<span class="string">"#audio_list"</span>).html($(<span class="string">"#audio_list"</span>).html().replace(<span class="regexp">/&lt;\/?span.*?&gt;/g</span>,<span class="string">''</span>).replace($(<span class="string">"#music_name"</span>).html(),<span class="string">'&lt;span style="font-weight: bold; color: red"&gt;'</span>+$(<span class="string">"#music_name"</span>).html()+<span class="string">'&lt;/span&gt;'</span>));</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> ($(<span class="built_in">document</span>).width()&gt;=<span class="number">768</span> &amp;&amp; (<span class="keyword">new</span> <span class="built_in">Date</span>().getHours()&gt;=<span class="number">8</span> &amp;&amp; <span class="keyword">new</span> <span class="built_in">Date</span>().getHours()&lt;<span class="number">23</span>)) &#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">"#player_player"</span>).attr(<span class="string">"autoplay"</span>,<span class="string">"autoplay"</span>);</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#player_player"</span>).attr(<span class="string">"src"</span>,music[<span class="string">'url'</span>]);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (music[<span class="string">'lrc'</span>]==<span class="string">"0"</span>) &#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">"#kk_lrc_box"</span>).css(<span class="string">"display"</span>,<span class="string">"none"</span>);</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">"#kk_lrc_box"</span>).css(<span class="string">"display"</span>,<span class="string">"block"</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (music[<span class="string">'lrc_data'</span>]!==<span class="string">""</span>) &#123;</span></span><br><span class="line"><span class="javascript">                        add_lrc(music[<span class="string">'lrc_data'</span>]);</span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                        get_lrc(music[<span class="string">'name'</span>],music[<span class="string">'singer'</span>]);</span></span><br><span class="line"><span class="undefined">                    &#125;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">"#audio_player2"</span>).html(<span class="string">'&lt;!-- id='</span> + music_id + <span class="string">' mysql_id='</span> + music[<span class="string">'id'</span>] + <span class="string">' --&gt;'</span> + (($(<span class="built_in">document</span>).width()&lt;<span class="number">768</span> || <span class="keyword">new</span> <span class="built_in">Date</span>().getHours()&lt;<span class="number">8</span> || <span class="keyword">new</span> <span class="built_in">Date</span>().getHours()&gt;=<span class="number">23</span>)?<span class="string">"&lt;p&gt;&lt;small&gt;已为您关闭了自动播放&lt;/small&gt;&lt;/p&gt;"</span>:<span class="string">""</span>));</span></span><br><span class="line"><span class="javascript">                $.cookie(<span class="string">"music_list"</span>,<span class="string">'&#123;"id":'</span>+ music_id + <span class="string">',"length":'</span> + music[<span class="string">'length'</span>] + <span class="string">'&#125;'</span>,&#123;<span class="attr">expires</span>: <span class="number">7</span>, <span class="attr">path</span>: <span class="string">'/'</span>&#125;);</span></span><br><span class="line"><span class="undefined">            &#125;,</span></span><br><span class="line"><span class="javascript">            error: <span class="function"><span class="keyword">function</span>(<span class="params">XMLHttpRequest,status</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (status == <span class="string">'timeout'</span>) &#123;</span></span><br><span class="line"><span class="xml">                    $("#audio_player").html('<span class="tag">&lt;<span class="name">p</span>&gt;</span>请求超时，<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"####"</span> <span class="attr">id</span>=<span class="string">"reload_audio_player"</span>&gt;</span>重新加载<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span>');</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">"#audio_player"</span>).html(<span class="string">'&lt;p&gt;无法请求播放数据&lt;/p&gt;'</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line"><span class="undefined">                &#125;</span></span><br><span class="line"><span class="undefined">            &#125;</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">change_audio_player_status</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#audio_player_status"</span>).html(<span class="string">"正在播放"</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">        get_music();</span></span><br><span class="line"><span class="javascript">        $(<span class="string">"#audio_player"</span>).on(<span class="string">'click'</span>, <span class="string">"#reload_audio_player"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">            get_music();</span></span><br><span class="line"><span class="undefined">        &#125;);</span></span><br><span class="line"><span class="undefined">    &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"audio_player"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">controls</span>=<span class="string">"controls"</span> <span class="attr">onended</span>=<span class="string">"get_music()"</span> <span class="attr">onplaying</span>=<span class="string">"change_audio_player_status()"</span> <span class="attr">style</span>=<span class="string">"width: 100%"</span> <span class="attr">id</span>=<span class="string">"player_player"</span>&gt;</span>您的浏览器不支持 HTML5<span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">"audio_player2"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"kk_lrc_box"</span> <span class="attr">id</span>=<span class="string">"kk_lrc_box"</span>&gt;</span><span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">"player_lrc"</span> <span class="attr">class</span>=<span class="string">"kk_lrc"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>四、将下面这个文件解压上传至根目录，里面分别是 jQuery 的 JSON 插件和 Cookies 插件<br><a href="/uploads/2014/01/jq.zip">jq.zip</a></p>
<p>效果如本页所示。有段时间没写 php 了，如果有什么 bug 或者建议请评论，谢谢</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/程序发布/">程序发布</a>
    </span>
    

    

    </div>

    
  </div>
</article>

  

	<section id="comment" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'futa-ooo';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>




    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>