<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>无聊给博客加了个背景音乐 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="如题。。顺手写了个管理中心。。这是我第一个用到 json 的玩意儿。。不过别说 json 还是挺方便的。。附源码及安装说明。。
2014-01-31 重要更新，因在编写前一个版本时不熟悉 php 的 cookies 机制，导致 随机播放时避免重复播放 的功能未实现，后准备使用 jquery 将播放列">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="无聊给博客加了个背景音乐"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>无聊给博客加了个背景音乐</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2014/01/29/无聊给博客加了个背景音乐/" rel="bookmark">
        <time class="entry-date published" datetime="2014-01-29T03:08:17.000Z">
          2014-01-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>如题。。顺手写了个管理中心。。这是我第一个用到 json 的玩意儿。。不过别说 json 还是挺方便的。。附源码及安装说明。。</p>
<p><strong>2014-01-31 重要更新，因在编写前一个版本时不熟悉 php 的 cookies 机制，导致 随机播放时避免重复播放 的功能未实现，后准备使用 jquery 将播放列表存到本地 cookies 然后随机调用，又发现 cookies 有大小限制。之后只能放弃了这个功能，现在只使用 cookies 记录当前播放的曲目以及服务器传回的播放列表中总计的曲目数量，以便进行顺序播放。</strong></p>
<p>一、先创建数据表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table `music_list` (</span><br><span class="line">`id` int not null auto_increment,</span><br><span class="line">`name` text not null default &quot;&quot;,</span><br><span class="line">`url` text not null default &quot;&quot;,</span><br><span class="line">`singer` text not null default &quot;&quot;,</span><br><span class="line">`lrc` int not null default 0,</span><br><span class="line">`lrc_data` text not null default &quot;&quot;,</span><br><span class="line">primary key(`id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>表示偷了个小懒全用的 text</p>
<p>二、上传文件至根目录，命名无所谓，必须 .php 结尾，本站的是 music_list.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    session_start();</span><br><span class="line">    header(&quot;Content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">    date_default_timezone_set(&apos;Asia/Shanghai&apos;);</span><br><span class="line">    $pass=&apos;经 md5 加密后的密码&apos;;</span><br><span class="line">    $link = @mysql_connect(&quot;数据库服务器&quot;,&apos;数据库用户名&apos;,&apos;数据库密码&apos;,true);</span><br><span class="line">    if(!$link) &#123;</span><br><span class="line">        die(&quot;Connect Server Failed: &quot; . mysql_error());</span><br><span class="line">    &#125;</span><br><span class="line">    if(!mysql_select_db(&apos;数据库名&apos;,$link)) &#123;</span><br><span class="line">        die(&quot;Select Database Failed: &quot; . mysql_error($link));</span><br><span class="line">    &#125;</span><br><span class="line">    mysql_query(&apos;set names utf8&apos;);</span><br><span class="line">    </span><br><span class="line">    function get_music($id=null) &#123;</span><br><span class="line">        $return_value=array();</span><br><span class="line">        $select_query=mysql_query(&apos;select * from `music_list`&apos;);</span><br><span class="line">        while (($value=mysql_fetch_array($select_query))!==false) &#123;</span><br><span class="line">            $return_tmp=array();</span><br><span class="line">            $return_tmp[&apos;name&apos;]=$value[&apos;name&apos;];</span><br><span class="line">            $return_tmp[&apos;url&apos;]=$value[&apos;url&apos;];</span><br><span class="line">            $return_tmp[&apos;singer&apos;]=$value[&apos;singer&apos;];</span><br><span class="line">            $return_tmp[&apos;id&apos;]=$value[&apos;id&apos;];</span><br><span class="line">            $return_tmp[&apos;lrc&apos;]=htmlspecialchars($value[&apos;lrc&apos;]);</span><br><span class="line">            $return_tmp[&apos;lrc_data&apos;]=str_replace(array(&quot;\r&quot;,&quot;\n&quot;),array(&quot;&quot;,&quot;&lt;br /&gt;&quot;),$value[&apos;lrc_data&apos;]);</span><br><span class="line">            $return_value[]=$return_tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        if ($id==null) &#123;</span><br><span class="line">            return $return_value;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $return_values=$return_value[$id];</span><br><span class="line">            $return_values[&apos;length&apos;]=count($return_value);</span><br><span class="line">            return $return_values;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    function chkid($id) &#123;</span><br><span class="line">        if (!empty($id) &amp;&amp; is_numeric($id)) &#123;</span><br><span class="line">            $select_query=mysql_query(&apos;select * from `music_list` where `id`=\&apos;&apos;.$id.&apos;\&apos;&apos;);</span><br><span class="line">            if (mysql_num_rows($select_query)==0) &#123;</span><br><span class="line">                msg(&apos;找不到数据&apos;);</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        msg(&apos;找不到数据&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    function get_post_data() &#123;</span><br><span class="line">        if (!get_magic_quotes_gpc()) &#123;</span><br><span class="line">            $return_value=array();</span><br><span class="line">            foreach ($_POST as $key=&gt;$value) &#123;</span><br><span class="line">                $return_value[$key]=addslashes($value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $return_value=$_POST;</span><br><span class="line">        &#125;</span><br><span class="line">        return $return_value;</span><br><span class="line">    &#125;</span><br><span class="line">    function msg($msg) &#123;</span><br><span class="line">        echo &apos;&lt;p&gt;&apos;.$msg.&apos;&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;&quot;&gt;返回首页&lt;/a&gt;&lt;/p&gt;&apos;;</span><br><span class="line">        echo_footer();</span><br><span class="line">        exit();</span><br><span class="line">    &#125;</span><br><span class="line">    function echo_header() &#123;</span><br><span class="line">        echo &apos;&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,minimum-scale=1.0,maximum-scale=1.0&quot;/&gt;&lt;title&gt;博客背景音乐管理中心&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&apos;;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    function echo_footer() &#123;</span><br><span class="line">        echo &apos;&lt;/body&gt;&lt;/html&gt;&apos;;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    if ($_GET[&apos;action&apos;]==&apos;get_music&apos;) &#123;</span><br><span class="line">        if ($_GET[&apos;id&apos;]!==&apos;&apos; &amp;&amp; is_numeric($_GET[&apos;id&apos;])) &#123;</span><br><span class="line">            $output=get_music($_GET[&apos;id&apos;]);</span><br><span class="line">            preg_match_all(&quot;/^(http:\/\/.*\/)(.*?)$/&quot;,$output[&apos;url&apos;],$outputtmp);</span><br><span class="line">            $output[&apos;url&apos;]=$outputtmp[1][0].rawurlencode($outputtmp[2][0]);</span><br><span class="line">            foreach ($output as $k=&gt;$v) &#123;</span><br><span class="line">                $output[$k]=urlencode($v);</span><br><span class="line">            &#125;</span><br><span class="line">            echo urldecode(json_encode($output));</span><br><span class="line">        &#125;</span><br><span class="line">        exit();</span><br><span class="line">    &#125; elseif ($_GET[&apos;action&apos;]==&apos;get_music_list&apos;) &#123;</span><br><span class="line">        echo json_encode(get_music());</span><br><span class="line">        exit();</span><br><span class="line">    &#125; elseif ($_GET[&apos;action&apos;]==&apos;login&apos;) &#123;</span><br><span class="line">        if ($_SESSION[&apos;admin&apos;]==&apos;admin&apos;) &#123;</span><br><span class="line">            header(&apos;Location: &apos;.$_SERVER[&apos;PHP_SELF&apos;]);</span><br><span class="line">            exit();</span><br><span class="line">        &#125;</span><br><span class="line">        echo_header();</span><br><span class="line">        if ($_POST) &#123;</span><br><span class="line">            if (md5($_POST[&apos;password&apos;])==$pass) &#123;</span><br><span class="line">                $_SESSION[&apos;admin&apos;]=&apos;admin&apos;;</span><br><span class="line">                header(&apos;Location: &apos;.$_SERVER[&apos;PHP_SELF&apos;]);</span><br><span class="line">                exit();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                echo &apos;&lt;p&gt;密码错误&lt;/p&gt;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        echo &apos;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;p&gt;&lt;label&gt;请输入密码:&lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt;&lt;/label&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;提交&quot; /&gt;&lt;/p&gt;&lt;/form&gt;&apos;;</span><br><span class="line">        echo_footer();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if ($_SESSION[&apos;admin&apos;]!==&apos;admin&apos;) &#123;</span><br><span class="line">            header(&apos;Location: &apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;?action=login&apos;);</span><br><span class="line">            exit();</span><br><span class="line">        &#125;</span><br><span class="line">        echo_header();</span><br><span class="line">        if ($_GET[&apos;action&apos;]==&apos;del&apos;) &#123;</span><br><span class="line">            chkid($_GET[&apos;id&apos;]);</span><br><span class="line">            if ($_POST) &#123;</span><br><span class="line">                $del_query=mysql_query(&apos;delete from `music_list` where `id`=\&apos;&apos;.$_GET[&apos;id&apos;].&apos;\&apos;&apos;);</span><br><span class="line">                if ($del_query) &#123;</span><br><span class="line">                    msg(&apos;删除成功&apos;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    msg(&apos;删除失败&apos;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $select_query=mysql_fetch_array(mysql_query(&apos;select * from `music_list` where `id`=\&apos;&apos;.$_GET[&apos;id&apos;].&apos;\&apos;&apos;));</span><br><span class="line">                echo &apos;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;p&gt;您确定要删除 &apos;.$select_query[&apos;name&apos;].&apos; - &apos;.$select_query[&apos;singer&apos;].&apos;么？&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;确定&quot; /&gt;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;&quot;&gt;取消&lt;/a&gt;&lt;/p&gt;&lt;/form&gt;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; elseif ($_GET[&apos;action&apos;]==&apos;edit&apos;) &#123;</span><br><span class="line">            chkid($_GET[&apos;id&apos;]);</span><br><span class="line">            if ($_POST) &#123;</span><br><span class="line">                $post_data=get_post_data();</span><br><span class="line">                $update_query=mysql_query(&apos;update `music_list` set `name`=\&apos;&apos;.$post_data[&apos;name&apos;].&apos;\&apos;, `url`=\&apos;&apos;.$post_data[&apos;url&apos;].&apos;\&apos;, `singer`=\&apos;&apos;.$post_data[&apos;singer&apos;].&apos;\&apos;, `lrc`=\&apos;&apos;.$post_data[&apos;lrc&apos;].&apos;\&apos;, `lrc_data`=\&apos;&apos;.$post_data[&apos;lrc_data&apos;].&apos;\&apos; where `id`=\&apos;&apos;.$_GET[&apos;id&apos;].&apos;\&apos;&apos;);</span><br><span class="line">                if ($update_query) &#123;</span><br><span class="line">                    msg(&apos;数据插入成功&apos;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    msg(&apos;数据插入失败&apos;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $select_query=mysql_fetch_array(mysql_query(&apos;select * from `music_list` where `id`=\&apos;&apos;.$_GET[&apos;id&apos;].&apos;\&apos;&apos;));</span><br><span class="line">                echo &apos;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;p&gt;&lt;label&gt;歌名:&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&apos;.$select_query[&apos;name&apos;].&apos;&quot; /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;歌手:&lt;input type=&quot;text&quot; name=&quot;singer&quot; value=&quot;&apos;.$select_query[&apos;singer&apos;].&apos;&quot; /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;下载地址:&lt;input type=&quot;text&quot; name=&quot;url&quot; value=&quot;&apos;.$select_query[&apos;url&apos;].&apos;&quot; /&gt;&lt;/p&gt;&lt;p&gt;显示 lrc 歌词: &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;lrc&quot; value=&quot;1&quot; &apos;.($select_query[&apos;lrc&apos;]?&apos;checked=&quot;checked&quot; &apos;:&apos;&apos;).&apos;/&gt;是&lt;/label&gt;&amp;nbsp;&amp;nbsp;&lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;lrc&quot; value=&quot;0&quot; &apos;.(!$select_query[&apos;lrc&apos;]?&apos;checked=&quot;checked&quot; &apos;:&apos;&apos;).&apos;/&gt;否&lt;/label&gt;&lt;/p&gt;&lt;p&gt;lrc 歌词(可选):&lt;br /&gt;&lt;textarea name=&quot;lrc_data&quot;&gt;&apos;.htmlspecialchars($select_query[&apos;lrc_data&apos;]).&apos;&lt;/textarea&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;确定&quot; /&gt;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;&quot;&gt;取消&lt;/a&gt;&lt;/p&gt;&lt;/form&gt;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; elseif ($_GET[&apos;action&apos;]==&apos;search&apos;) &#123;</span><br><span class="line">            $post_data=get_post_data();</span><br><span class="line">            echo &apos;&lt;form action=&quot;?action=search&quot; method=&quot;post&quot;&gt;&lt;p&gt;&lt;input name=&quot;search&quot; type=&quot;text&quot; value=&quot;&apos;.$post_data[&apos;search&apos;].&apos;&quot;/&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;搜索&quot; /&gt;&lt;/p&gt;&lt;/form&gt;&apos;;</span><br><span class="line">            if ($_POST) &#123;</span><br><span class="line">                $search_query=mysql_query(&apos;select * from `music_list` where `name` like \&apos;%&apos;.$post_data[&apos;search&apos;].&apos;%\&apos; or `singer` like \&apos;%&apos;.$post_data[&apos;search&apos;].&apos;%\&apos; or `url` like \&apos;%&apos;.$post_data[&apos;search&apos;].&apos;%\&apos;&apos;);</span><br><span class="line">                if (mysql_num_rows($search_query)&gt;0) &#123;</span><br><span class="line">                    echo &apos;&lt;ol&gt;&apos;;</span><br><span class="line">                    while (($value=mysql_fetch_array($search_query))!==false) &#123;</span><br><span class="line">                        echo &apos;&lt;li&gt;&apos;.$value[&apos;name&apos;].&apos; - &apos;.$value[&apos;singer&apos;].&apos;&amp;nbsp;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;?action=edit&amp;id=&apos;.$value[&apos;id&apos;].&apos;&quot;&gt;编辑&lt;/a&gt;&amp;nbsp;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;?action=del&amp;id=&apos;.$value[&apos;id&apos;].&apos;&quot;&gt;删除&lt;/a&gt;&lt;/li&gt;&apos;;</span><br><span class="line">                    &#125;</span><br><span class="line">                    echo &apos;&lt;/ol&gt;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;&quot;&gt;返回首页&lt;/a&gt;&apos;;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    echo &apos;&lt;p&gt;无搜索结果&lt;/p&gt;&apos;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; elseif ($_GET[&apos;action&apos;]==&apos;add&apos;) &#123;</span><br><span class="line">            if ($_POST) &#123;</span><br><span class="line">                $post_data=get_post_data();</span><br><span class="line">                $insert_query=mysql_query(&apos;insert into `music_list`(`name`,`url`,`singer`,`lrc`,`lrc_data`) values(\&apos;&apos;.$post_data[&apos;name&apos;].&apos;\&apos;,\&apos;&apos;.$post_data[&apos;url&apos;].&apos;\&apos;,\&apos;&apos;.$post_data[&apos;singer&apos;].&apos;\&apos;,\&apos;&apos;.$post_data[&apos;lrc&apos;].&apos;\&apos;,\&apos;&apos;.$post_data[&apos;lrc_data&apos;].&apos;\&apos;)&apos;);</span><br><span class="line">                if ($insert_query) &#123;</span><br><span class="line">                    msg(&apos;数据插入成功&apos;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    msg(&apos;数据插入失败&apos;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                echo &apos;&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;&lt;p&gt;&lt;label&gt;歌名:&lt;input type=&quot;text&quot; name=&quot;name&quot; /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;歌手:&lt;input type=&quot;text&quot; name=&quot;singer&quot; /&gt;&lt;/p&gt;&lt;p&gt;&lt;label&gt;下载地址:&lt;input type=&quot;text&quot; name=&quot;url&quot; value=&quot;http://&quot; /&gt;&lt;/p&gt;&lt;p&gt;显示 lrc 歌词: &lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;lrc&quot; value=&quot;1&quot; /&gt;是&lt;/label&gt;&amp;nbsp;&amp;nbsp;&lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;lrc&quot; value=&quot;0&quot; checked=&quot;checked&quot; /&gt;否&lt;/label&gt;&lt;/p&gt;&lt;p&gt;lrc 歌词(可选):&lt;br /&gt;&lt;textarea name=&quot;lrc_data&quot;&gt;&apos;.htmlspecialchars($select_query[&apos;lrc_data&apos;]).&apos;&lt;/textarea&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; name=&quot;submit&quot; value=&quot;确定&quot; /&gt;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;&quot;&gt;取消&lt;/a&gt;&lt;/p&gt;&lt;/form&gt;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">             echo &apos;&lt;form action=&quot;?action=search&quot; method=&quot;post&quot;&gt;&lt;p&gt;&lt;input name=&quot;search&quot; type=&quot;text&quot; /&gt;&lt;/p&gt;&lt;p&gt;&lt;input type=&quot;submit&quot; value=&quot;搜索&quot; /&gt;&lt;/p&gt;&lt;/form&gt;&apos;;</span><br><span class="line">             $all_list=get_music();</span><br><span class="line">             echo &apos;&lt;ol&gt;&apos;;</span><br><span class="line">             foreach ($all_list as $value) &#123;</span><br><span class="line">                 echo &apos;&lt;li&gt;&apos;.$value[&apos;name&apos;].&apos; - &apos;.$value[&apos;singer&apos;].&apos;&amp;nbsp;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;?action=edit&amp;id=&apos;.$value[&apos;id&apos;].&apos;&quot;&gt;编辑&lt;/a&gt;&amp;nbsp;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;?action=del&amp;id=&apos;.$value[&apos;id&apos;].&apos;&quot;&gt;删除&lt;/a&gt;&lt;/li&gt;&apos;;</span><br><span class="line">             &#125;</span><br><span class="line">             echo &apos;&lt;/ol&gt;&apos;;</span><br><span class="line">             echo &apos;&lt;a href=&quot;&apos;.$_SERVER[&apos;PHP_SELF&apos;].&apos;?action=add&quot;&gt;添加新曲目&lt;/a&gt;&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">        echo_footer();</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>注意不要忘记修改数据库信息和登录密码</p>
<p>三、前台创建小工具<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/json2.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot; src=&quot;/jquery.cookie.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">        &lt;style&gt;</span><br><span class="line">            /*</span><br><span class="line">             * Lyric support by kookxiang(http://ikk.me)</span><br><span class="line">             */</span><br><span class="line">            .kk_player &#123; width: 100%; max-height: 40px; &#125;</span><br><span class="line">            .kk_lrc &#123; height: 125px; overflow: auto; padding: 0; margin: 0; &#125;</span><br><span class="line">            .kk_lrc li &#123; display: block; text-align: center; color: gray; line-height: 20px; margin: 2px 0 3px 0 !important; min-height: 20px; &#125;</span><br><span class="line">            .kk_lrc .current &#123; color: black; font-weight: bold; &#125;</span><br><span class="line">            .kk_lrc, .kk_lrc * &#123; -webkit-transition-duration: 1s; -moz-transition-duration: 1s; transition-duration: 1s; &#125;</span><br><span class="line">            .kk_lrc ::selection &#123; background: transparent; background: rgba(127, 127, 127, 0.1); &#125;</span><br><span class="line">            .kk_lrc_box &#123; position: relative; &#125;</span><br><span class="line">            .kk_lrc_box:before &#123; content: &apos;.&apos;; overflow: hidden; text-indent: -9999px; width: 100%; height: 30px; z-index: 1; display: block; position: absolute; background: url(http://lab.233.imjs.work/getlrc/cover.png) repeat-x 0 0; top: 0; pointer-events: none; &#125;</span><br><span class="line">            .kk_lrc_box:after &#123; content: &apos;.&apos;; overflow: hidden; text-indent: -9999px; width: 100%; height: 30px; z-index: 1; display: block; position: absolute; background: url(http://lab.233.imjs.work/getlrc/cover.png) repeat-x 0 100%; bottom: 0; pointer-events: none; &#125;</span><br><span class="line"></span><br><span class="line">            ::-webkit-scrollbar &#123; width: 8px; height: 8px;&#125;</span><br><span class="line">            ::-webkit-scrollbar-track &#123; -webkit-border-radius: 10px; border-radius: 10px; &#125;</span><br><span class="line">            ::-webkit-scrollbar-thumb &#123; -webkit-border-radius: 10px; border-radius: 10px; background: rgba(96, 96, 96, 0.8); -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.5); &#125;</span><br><span class="line">            ::-webkit-scrollbar-thumb:window-inactive &#123; background: rgba(96, 96, 96, 0.4); &#125;</span><br><span class="line">        &lt;/style&gt;</span><br><span class="line">        &lt;script&gt;</span><br><span class="line">var ael=false;</span><br><span class="line">var tmp_interval=[0,0];</span><br><span class="line">function get_lrc(name,singer) &#123;</span><br><span class="line">    var script = document.createElement(&apos;script&apos;);  </span><br><span class="line">    script.setAttribute(&apos;src&apos;, &quot;http://lab.liujiantao.me/lrc/?name=&quot;+encodeURIComponent(name)+&quot;&amp;singer=&quot;+encodeURIComponent(singer)+&quot;&amp;callback=con_lrc&quot;);  </span><br><span class="line">    //load javascript  </span><br><span class="line">    document.getElementsByTagName(&apos;head&apos;)[0].appendChild(script);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function con_lrc(lrc_data) &#123;</span><br><span class="line">    var err_msg=&#123;&quot;-1&quot;:&quot;服务器没有接收到完整数据&quot;,&quot;-2&quot;:&quot;无法正常获取 xml 文件&quot;,&quot;-3&quot;:&quot;找不到该曲目&quot;,&quot;-4&quot;:&quot;未收录 lrc 歌词&quot;,&quot;-5&quot;:&quot;无法正常获取 lrc 歌词&quot;&#125;;</span><br><span class="line">    if (lrc_data.status==&quot;error&quot;) &#123;</span><br><span class="line">        console.error(err_msg[lrc_data.errcode]);</span><br><span class="line">        $(&quot;#kk_lrc_box&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    $(&quot;#player_lrc&quot;).html(&quot;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&lt;li&gt;&lt;/li&gt;&quot;);</span><br><span class="line">    var kk_lrc = load_kk_lrc();</span><br><span class="line">    for (j=0;j&lt;lrc_data.result.length;j++) &#123;</span><br><span class="line">        var lrcArray=lrc_data.result[j].split(&quot;&lt;br /&gt;&quot;);</span><br><span class="line">        var timeKey=new Object();</span><br><span class="line">        var strArray=new Array();</span><br><span class="line">        var _offset=lrc_data.result[j].match(/\[offset.*?(\d*?)\]/);</span><br><span class="line">        _offset=(typeof _offset==&quot;undefined&quot; || _offset===null)?0:_offset[1]/1000;</span><br><span class="line">        for (var i = 0,l = lrcArray.length;i &lt; l;i++) &#123;</span><br><span class="line">            clause = decodeURIComponent(lrcArray[i]).replace(/\[\d*?:\d*?([\.:]\d*?)?\]/g,&apos;&apos;);</span><br><span class="line">            timeRegExpArr = decodeURIComponent(lrcArray[i]).match(/\[(\d*?):(\d*?)([\.:](\d*?))?\]/g);</span><br><span class="line">            if (timeRegExpArr!=null) &#123;</span><br><span class="line">                for (var k = 0,h = timeRegExpArr.length;k &lt; h;k++) &#123; //第一遍循环，JSON存储歌词，数组存储时间</span><br><span class="line">                    _timeRegExpArr = timeRegExpArr[k].match(/^\[(\d*?):(\d*?)([\.:](\d*?))?\]$/);</span><br><span class="line">                    min = parseFloat(_timeRegExpArr[1]);</span><br><span class="line">                    sec = parseFloat(_timeRegExpArr[2]);</span><br><span class="line">                    msec = parseFloat(typeof _timeRegExpArr[4]==&quot;undefined&quot;?0:_timeRegExpArr[4]);</span><br><span class="line">                    time=min * 60 + sec + msec/100 - _offset;</span><br><span class="line">                    time=(time&lt;0)?0:time;</span><br><span class="line">                    if (!timeKey[time]) &#123;</span><br><span class="line">                        strArray.push(time);</span><br><span class="line">                        timeKey[time] = clause + &apos;&lt;br /&gt;&apos;;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        timeKey[time] += clause + &apos;&lt;br /&gt;&apos;;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        strArray.sort(function(a,b) &#123;</span><br><span class="line">            return a - b;</span><br><span class="line">        &#125;);</span><br><span class="line">        for (var i = 0,l = strArray.length;i &lt; l;i++) &#123; //第二遍循环，JSON存储时间，数组存储歌词</span><br><span class="line">            var tempIndex = strArray[i],</span><br><span class="line">            tempClause = timeKey[tempIndex];</span><br><span class="line">            kk_lrc.add_lrc(tempIndex,tempClause);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    kk_lrc.init();</span><br><span class="line">    ael=true;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function add_lrc(lrc_data) &#123;</span><br><span class="line">    con_lrc(&#123;&apos;status&apos;:&apos;success&apos;,&apos;errcode&apos;:&apos;0&apos;,&apos;result&apos;:[lrc_data.replace(&quot;\n&quot;,&quot;&lt;br /&gt;&quot;)]&#125;);</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Lyric support by kookxiang(http://ikk.me)</span><br><span class="line"> */</span><br><span class="line">function load_kk_lrc()&#123;</span><br><span class="line">    var kk_lrc = new Object();</span><br><span class="line">    kk_lrc.extra_top = 1;</span><br><span class="line">    kk_lrc.current = -1;</span><br><span class="line">    kk_lrc.current_obj;</span><br><span class="line">    kk_lrc.offset = 0;</span><br><span class="line">    kk_lrc.current_start = -1;</span><br><span class="line">    kk_lrc.next_update_time = -1;</span><br><span class="line">    kk_lrc.showtime = -1;</span><br><span class="line">    kk_lrc.lrc_offset = -1;</span><br><span class="line">    kk_lrc.lrc_height = -1;</span><br><span class="line">    kk_lrc.lrc = [];</span><br><span class="line">    kk_lrc.lrcobj = null;</span><br><span class="line">    kk_lrc.target = 0;</span><br><span class="line">    kk_lrc._target = 0;</span><br><span class="line">    kk_lrc.player_obj = document.getElementById(&apos;player_player&apos;);</span><br><span class="line">    kk_lrc.lrc_obj = document.getElementById(&apos;player_lrc&apos;);</span><br><span class="line"></span><br><span class="line">    kk_lrc.scroll_lrc = function () &#123;</span><br><span class="line">        if(typeof kk_lrc.lrc[kk_lrc.current+2] != &quot;undefined&quot;)&#123;</span><br><span class="line">            for(id in kk_lrc.lrcobj) kk_lrc.lrcobj[id].className = &apos;&apos;;</span><br><span class="line">            kk_lrc.lrcobj[kk_lrc.current+3].className = &apos;current&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">        kk_lrc.current_start = kk_lrc.lrc[kk_lrc.current];</span><br><span class="line">        kk_lrc.current++;</span><br><span class="line">        kk_lrc.current_obj = kk_lrc.lrcobj[kk_lrc.current+2];</span><br><span class="line">        kk_lrc.next_update_time = kk_lrc.lrc[kk_lrc.current];</span><br><span class="line">        kk_lrc.showtime = kk_lrc.next_update_time - kk_lrc.current_start;</span><br><span class="line">        kk_lrc.lrc_offset = kk_lrc.current_obj.offsetTop;</span><br><span class="line">        kk_lrc.lrc_height = kk_lrc.current_obj.offsetHeight;</span><br><span class="line">    &#125;;</span><br><span class="line">    kk_lrc.check_lrc_update = function () &#123;</span><br><span class="line">        var curTime = kk_lrc.player_obj.currentTime;</span><br><span class="line">        if(curTime &gt;= kk_lrc.next_update_time - 0.2)&#123;</span><br><span class="line">            kk_lrc.scroll_lrc();</span><br><span class="line">            kk_lrc.check_lrc_update();</span><br><span class="line">        &#125;</span><br><span class="line">        if(typeof kk_lrc.lrc[kk_lrc.current-1] != &quot;undefined&quot;)&#123;</span><br><span class="line">            kk_lrc.extra_top = (kk_lrc.next_update_time - curTime) / kk_lrc.showtime;</span><br><span class="line">        &#125;</span><br><span class="line">        kk_lrc.target = Math.round(kk_lrc.lrc_offset - (125 - kk_lrc.lrc_height) / 2);</span><br><span class="line">        if(kk_lrc.target &lt; 0) kk_lrc.target = 0;</span><br><span class="line">    &#125;;</span><br><span class="line">    kk_lrc.init = function () &#123;</span><br><span class="line">        kk_lrc.add_lrc(&apos;999999&apos;, &apos;&apos;);</span><br><span class="line">        kk_lrc.add_lrc(&apos;999999&apos;, &apos;&apos;);</span><br><span class="line">        kk_lrc.add_lrc(&apos;999999&apos;, &apos;&apos;);</span><br><span class="line">        kk_lrc.current = -1;</span><br><span class="line">        kk_lrc.lrcobj = kk_lrc.lrc_obj.getElementsByTagName(&apos;li&apos;);</span><br><span class="line">        kk_lrc.current_obj = kk_lrc.lrcobj[0];</span><br><span class="line">        kk_lrc.scroll_lrc();</span><br><span class="line">        kk_lrc.check_lrc_update();</span><br><span class="line">                if (ael==false) &#123;</span><br><span class="line">        kk_lrc.player_obj.addEventListener(&quot;seeked&quot; ,function()&#123;</span><br><span class="line">            kk_lrc.current = -1;</span><br><span class="line">            kk_lrc.scroll_lrc();</span><br><span class="line">            kk_lrc.check_lrc_update();</span><br><span class="line">        &#125;);</span><br><span class="line">        kk_lrc.player_obj.addEventListener(&quot;durationchange&quot; ,function()&#123;</span><br><span class="line">            kk_lrc.current = -1;</span><br><span class="line">            kk_lrc.scroll_lrc();</span><br><span class="line">            kk_lrc.check_lrc_update();</span><br><span class="line">        &#125;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    clearInterval(tmp_interval[0]);</span><br><span class="line">                    clearInterval(tmp_interval[1]);</span><br><span class="line">                &#125;</span><br><span class="line">        tmp_interval[0]=setInterval(function()&#123;</span><br><span class="line">                if(kk_lrc.player_obj.paused) return;</span><br><span class="line">                if(kk_lrc.current_start &gt; kk_lrc.player_obj.currentTime)&#123;</span><br><span class="line">                    kk_lrc.current = -1;</span><br><span class="line">                    kk_lrc.scroll_lrc();</span><br><span class="line">                    kk_lrc.check_lrc_update();</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    kk_lrc.check_lrc_update();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, 100);</span><br><span class="line">            tmp_interval[1]=setInterval(function()&#123;</span><br><span class="line">                if(kk_lrc._target == kk_lrc.target) return;</span><br><span class="line">                if(Math.abs(kk_lrc.lrc_obj.scrollTop - kk_lrc._target) &gt; kk_lrc.lrc_height)&#123;</span><br><span class="line">                    kk_lrc._target = kk_lrc.lrc_obj.scrollTop;</span><br><span class="line">                &#125;</span><br><span class="line">                if(kk_lrc.player_obj.paused)&#123;</span><br><span class="line">                    kk_lrc._target = kk_lrc.fixFloat(kk_lrc._target * 0.8 + kk_lrc.target * 0.2);</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    kk_lrc._target = kk_lrc.fixFloat(kk_lrc._target * 0.98 + kk_lrc.target * 0.02);</span><br><span class="line">                &#125;</span><br><span class="line">                kk_lrc.lrc_obj.scrollTop = kk_lrc._target;</span><br><span class="line">            &#125;, 5);</span><br><span class="line">    &#125;;</span><br><span class="line">    kk_lrc.add_lrc = function (time, lrc) &#123;</span><br><span class="line">        kk_lrc.lrc.push(parseFloat(time) + kk_lrc.offset);</span><br><span class="line">        var lrc_line = document.createElement(&quot;li&quot;);</span><br><span class="line">        lrc_line.innerHTML = lrc;</span><br><span class="line">        kk_lrc.lrc_obj.appendChild(lrc_line);</span><br><span class="line">    &#125;;</span><br><span class="line">    kk_lrc.get_lrc = function (num) &#123;</span><br><span class="line">        if(typeof kk_lrc.lrc[num] != &quot;undefined&quot;)&#123;</span><br><span class="line">            return kk_lrc.lrc[num][1];</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return &apos;&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    kk_lrc.setoffset = function (num) &#123;</span><br><span class="line">        kk_lrc.offset = num / 1000;</span><br><span class="line">    &#125;</span><br><span class="line">    kk_lrc.fixFloat = function (num) &#123;</span><br><span class="line">        return Math.ceil(num * 10) / 10;</span><br><span class="line">    &#125;</span><br><span class="line">    return kk_lrc;</span><br><span class="line">&#125;</span><br><span class="line">    function get_music() &#123;</span><br><span class="line">        $(&quot;#audio_player&quot;).html(&apos;&lt;p&gt;正在加载播放器，请稍候&lt;/p&gt;&apos;);</span><br><span class="line">        if (&quot;undefined&quot;==typeof $.cookie(&quot;music_list&quot;) || $.cookie(&quot;music_list&quot;)==null) &#123;</span><br><span class="line">            var music_id=0;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            var cookie_music=JSON.parse($.cookie(&quot;music_list&quot;));</span><br><span class="line">            if ((cookie_music[&apos;id&apos;]+1)==cookie_music[&apos;length&apos;]) &#123;</span><br><span class="line">                var music_id=0;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                var music_id=cookie_music[&apos;id&apos;]+1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        var music_id=(&quot;undefined&quot;!==typeof arguments[0])?arguments[0]:music_id;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: &apos;get&apos;,</span><br><span class="line">            url: &apos;/music_list.php&apos;,</span><br><span class="line">            dataType: &apos;json&apos;,</span><br><span class="line">            timeout: 3000,</span><br><span class="line">            data: &#123;&quot;action&quot;:&quot;get_music&quot;,&quot;id&quot;:music_id&#125;,</span><br><span class="line">            success: function(music) &#123;</span><br><span class="line">                $(&quot;#audio_player&quot;).html(&apos;&lt;p&gt;当前&lt;span id=&quot;audio_player_status&quot;&gt;正在缓冲准备播放&lt;/span&gt;的是:&lt;br /&gt;&lt;span id=&quot;music_name&quot;&gt;&apos; +  music[&apos;name&apos;] + &apos; - &apos; + music[&apos;singer&apos;] + &apos;&lt;/span&gt;&amp;nbsp;&lt;a href=&quot;####&quot; id=&quot;reload_audio_player&quot;&gt;换一首&lt;/a&gt;&lt;/p&gt;&apos;);</span><br><span class="line">                if (typeof $(&quot;#audio_list&quot;).html()!==&apos;undefined&apos;) $(&quot;#audio_list&quot;).html($(&quot;#audio_list&quot;).html().replace(/&lt;\/?span.*?&gt;/g,&apos;&apos;).replace($(&quot;#music_name&quot;).html(),&apos;&lt;span style=&quot;font-weight: bold; color: red&quot;&gt;&apos;+$(&quot;#music_name&quot;).html()+&apos;&lt;/span&gt;&apos;));</span><br><span class="line">                if ($(document).width()&gt;=768 &amp;&amp; (new Date().getHours()&gt;=8 &amp;&amp; new Date().getHours()&lt;23)) &#123;</span><br><span class="line">                    $(&quot;#player_player&quot;).attr(&quot;autoplay&quot;,&quot;autoplay&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">                $(&quot;#player_player&quot;).attr(&quot;src&quot;,music[&apos;url&apos;]);</span><br><span class="line">                if (music[&apos;lrc&apos;]==&quot;0&quot;) &#123;</span><br><span class="line">                    $(&quot;#kk_lrc_box&quot;).css(&quot;display&quot;,&quot;none&quot;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    $(&quot;#kk_lrc_box&quot;).css(&quot;display&quot;,&quot;block&quot;);</span><br><span class="line">                    if (music[&apos;lrc_data&apos;]!==&quot;&quot;) &#123;</span><br><span class="line">                        add_lrc(music[&apos;lrc_data&apos;]);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        get_lrc(music[&apos;name&apos;],music[&apos;singer&apos;]);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                $(&quot;#audio_player2&quot;).html(&apos;&lt;!-- id=&apos; + music_id + &apos; mysql_id=&apos; + music[&apos;id&apos;] + &apos; --&gt;&apos; + (($(document).width()&lt;768 || new Date().getHours()&lt;8 || new Date().getHours()&gt;=23)?&quot;&lt;p&gt;&lt;small&gt;已为您关闭了自动播放&lt;/small&gt;&lt;/p&gt;&quot;:&quot;&quot;));</span><br><span class="line">                $.cookie(&quot;music_list&quot;,&apos;&#123;&quot;id&quot;:&apos;+ music_id + &apos;,&quot;length&quot;:&apos; + music[&apos;length&apos;] + &apos;&#125;&apos;,&#123;expires: 7, path: &apos;/&apos;&#125;);</span><br><span class="line">            &#125;,</span><br><span class="line">            error: function(XMLHttpRequest,status) &#123;</span><br><span class="line">                if (status == &apos;timeout&apos;) &#123;</span><br><span class="line">                    $(&quot;#audio_player&quot;).html(&apos;&lt;p&gt;请求超时，&lt;a href=&quot;####&quot; id=&quot;reload_audio_player&quot;&gt;重新加载&lt;/a&gt;&lt;/p&gt;&apos;);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    $(&quot;#audio_player&quot;).html(&apos;&lt;p&gt;无法请求播放数据&lt;/p&gt;&apos;);</span><br><span class="line">                    return true;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    function change_audio_player_status() &#123;</span><br><span class="line">        $(&quot;#audio_player_status&quot;).html(&quot;正在播放&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    $(function() &#123;</span><br><span class="line">        get_music();</span><br><span class="line">        $(&quot;#audio_player&quot;).on(&apos;click&apos;, &quot;#reload_audio_player&quot;, function() &#123;</span><br><span class="line">            get_music();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;span id=&quot;audio_player&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;audio src=&quot;&quot; controls=&quot;controls&quot; onended=&quot;get_music()&quot; onplaying=&quot;change_audio_player_status()&quot; style=&quot;width: 100%&quot; id=&quot;player_player&quot;&gt;您的浏览器不支持 HTML5&lt;/audio&gt;</span><br><span class="line">&lt;span id=&quot;audio_player2&quot;&gt;&lt;/span&gt;</span><br><span class="line">&lt;div class=&quot;kk_lrc_box&quot; id=&quot;kk_lrc_box&quot;&gt;&lt;ul id=&quot;player_lrc&quot; class=&quot;kk_lrc&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;/ul&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>四、将下面这个文件解压上传至根目录，里面分别是 jQuery 的 JSON 插件和 Cookies 插件<br><a href="/uploads/2014/01/jq.zip">jq.zip</a></p>
<p>效果如本页所示。有段时间没写 php 了，如果有什么 bug 或者建议请评论，谢谢</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/程序发布/">程序发布</a>
    </span>
    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>