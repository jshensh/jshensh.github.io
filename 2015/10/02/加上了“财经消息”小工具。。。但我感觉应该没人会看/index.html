<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>加上了“财经消息”小工具。。。但我感觉应该没人会看 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="纯用来提升逼格。。。数据来源 http://www.jin10.com/">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="加上了“财经消息”小工具。。。但我感觉应该没人会看"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>加上了“财经消息”小工具。。。但我感觉应该没人会看</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/10/02/加上了“财经消息”小工具。。。但我感觉应该没人会看/" rel="bookmark">
        <time class="entry-date published" datetime="2015-10-01T19:02:32.000Z">
          2015-10-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>纯用来提升逼格。。。数据来源 <a href="http://www.jin10.com/" target="_blank" rel="noopener">http://www.jin10.com/</a><br><a id="more"></a><br>附源码：<br>`<audio id="ring" src="http://www.jin10.com/images/notice.wav"></audio></p>
<p><form></form></p>
<p></p><p style="font-size: 12px !important; margin: 0;"><label style="vertical-align:middle;"><input type="checkbox" id="economicsPlaySound" style="vertical-align:middle;">播放提示音</label>&nbsp;<label style="vertical-align:middle;"><input type="checkbox" id="economicsPlaySoundImportant" style="vertical-align:middle;">仅在有重要消息时提醒我</label></p><br><p></p>
<p><script type="text/javascript"><br>    $(function() {<br>        if ($.cookie(“economics”)&gt;0) {<br>            $(“#economicsPlaySound”).attr(“checked”,”checked”);<br>            if ($.cookie(“economics”)==2) {<br>                $(“#economicsPlaySoundImportant”).attr(“checked”,”checked”);<br>            }<br>        }<br>        $(“#economicsPlaySound”).click(function() {<br>            if (!this.checked) {<br>                $.cookie(“economics”,0,{ expires: 30 });<br>                document.getElementById(“economicsPlaySoundImportant”).checked=false;<br>            } else {<br>                $.cookie(“economics”,1,{ expires: 30 });<br>            }<br>        });<br>        $(“#economicsPlaySoundImportant”).click(function() {<br>            if (this.checked) {<br>                $.cookie(“economics”,2,{ expires: 30 });<br>                document.getElementById(“economicsPlaySound”).checked=true;<br>            } else {<br>                $.cookie(“economics”,1,{ expires: 30 });<br>            }<br>        });<br>    });<br></script></p>
<p><ul id="listarea"><br></ul></p>
<p><style></p>
<p>#listarea {<br>    max-height: 350px;<br>    overflow: auto;<br>}</p>
<p>#listarea li {<br>    display: block;<br>    line-height: 20px;<br>    margin: 2px 0 10px 0 !important;<br>    min-height: 20px;<br>}</p>
<p>#listarea li p {<br>    margin: 0;<br>    font-size: 12px !important;<br>}</p>
<p>#listarea li img {<br>    padding-bottom: 0 !important;<br>}<br></style></p>
<p><script src="http://cdn.jin10.com/socket.io/node_modules/socket.io-client/socket.io.js"></script></p>
<p><script type="text/javascript"><br>    $(“#listarea li”).css(“border-top”,”black 1px”);<br>    $(“#listarea”).parent().css({“background-color”:”#ffffff”,”padding-bottom”:”5px”});<br>    var jin10 = io.connect(“<a href="http://112.74.94.246:8080&quot;)">http://112.74.94.246:8080&quot;)</a>;<br>    jin10.on(‘user message’,function(msg){<br>        msgbox(msg,true);<br>    });<br>    jin10.on(‘connect’, function() {<br>        jin10.emit(‘reg’, “ok”);<br>    });<br>    jin10.on(‘disconnect’, function() {<br>        $(“#listarea”).prepend(“<li><p style=\"font-weight: bold; color: red;\">Connection Lost. Pleace refresh this page.</p></li>“);<br>    });<br>    var template1 = “<!-- {pic} {have} -->&lt;li{color}&gt;<small>{time}</small><p>{more}</p><p>{content}</p></li>“;</p>
<pre><code>var template2 = &quot;&lt;!-- {pic} --&gt;&lt;li{color}&gt;&lt;small&gt;{time}&lt;/small&gt;&lt;p&gt;{mingcheng}&lt;/p&gt;前值：{qianzhi} 预期：{yuqi}，公布：{gongbu}&lt;/p&gt;&lt;p&gt;{xingji} 星数据，影响金银：{yingxiang}&lt;/p&gt;&lt;/li&gt;&quot;;

function msgbox(str){
    console.log(str);
    if (str.match(&quot;金十贵金属多空投票&quot;) || str.match(&quot;1442406496.jpg&quot;)) {
        return;
    };
    var arrmp = str.split(&quot;#&quot;);
    var type = arrmp[0];
    var im = arrmp[1];
    var sj = arrmp[2];
    var nr = arrmp[3];
    var a4 = arrmp[4];
    var a5 = arrmp[5];
    var a6 = arrmp[6];
    var a7 = arrmp[7];
    var a8 = arrmp[8];
    var a9 = arrmp[9];
    var addtext = &quot;&quot;;

    if (arguments[1]) {
        var playSound=getCookie(&quot;economics&quot;);
        if (playSound==1 || (playSound==2 &amp;&amp; im==0)) {
            document.getElementById(&quot;ring&quot;).play();
        }
    }

    if(type == &quot;0&quot;) {
        sj = sj.substr(11,8);
        if(im == &quot;0&quot;){
            addtext = template1.replace(&quot;{color}&quot;,&quot; style=\&quot;color:red; font-weight: bold;\&quot;&quot;).replace(&quot;{pic}&quot;,&quot;importantnews.png&quot;).replace(&quot;{time}&quot;,sj).replace(&quot;{content}&quot;,nr);  
        } else {
            addtext = template1.replace(&quot;{color}&quot;,&quot;&quot;).replace(&quot;{pic}&quot;,&quot;nomarlnews.png&quot;).replace(&quot;{time}&quot;,sj).replace(&quot;{content}&quot;,nr);
        }
        if(a4.length &gt; 5 || a5.length &gt;5 || a6.length &gt;5) {
            //have url pic video
            if(a4.length &gt; 5 &amp;&amp; a5.length &gt; 5 &amp;&amp; a6.length &gt; 5) {
                addtext = addtext.replace(&quot;{have}&quot;,&quot;have_url_pic_video&quot;);
            } else if((a4.length &gt; 5 &amp;&amp; a5.length &gt; 5) || (a5.length &gt; 5 &amp;&amp; a6.length &gt; 5)) {
                addtext = addtext.replace(&quot;{have}&quot;,&quot;have_url_pic&quot;);
            } else if(a4.length &gt; 5 &amp;&amp; a5.length &gt; 5) {
                addtext = addtext.replace(&quot;{have}&quot;,&quot;have_no_pic&quot;);
            } else if(a6.length &gt; 5 &amp;&amp; a4.length &lt; 5 &amp;&amp; a5.length &lt; 5) {
                addtext = addtext.replace(&quot;{have}&quot;,&quot;have_pic&quot;);
            }

            addtext = addtext.replace(&quot;{more}&quot;,&quot;{more2}&quot;);

            if(a4.length &gt; 5) {
                addtext = addtext.replace(&quot;{more2}&quot;,&quot;&lt;a href=\&quot;&quot;+a4+&quot;\&quot; target=\&quot;_blank\&quot;&gt;链接戳这里&lt;\/a&gt;{more3}&quot;);
            } else {
                addtext = addtext.replace(&quot;{more2}&quot;,&quot;{more3}&quot;);
            }

            if(a5.length &gt; 5) {
                addtext = addtext.replace(&quot;{more3}&quot;,&quot;&lt;a class=\&quot;youtube\&quot; href=\&quot;&quot;+a5+&quot;\&quot; target=\&quot;_blank\&quot;&gt;&lt;img src=\&quot;http://www.jin10.com/oem\/images\/video2.png\&quot; style=\&quot;padding-bottom:5px;\&quot; border=\&quot;0\&quot; /&gt;&lt;\/a&gt;{more4}&quot;);
            } else {
                addtext = addtext.replace(&quot;{more3}&quot;,&quot;{more4}&quot;);
            }

            if(a6.length &gt; 5) {
                addtext = addtext.replace(&quot;{more4}&quot;,&quot;&lt;a href=\&quot;http:\/\/image.jin10.com\/&quot;+a6.replace(&quot;_lite&quot;,&quot;&quot;)+&quot;\&quot; target=\&quot;_blank\&quot;&gt;&lt;img src=\&quot;http:\/\/image.jin10.com\/&quot;+a6+&quot;\&quot; width=\&quot;50\&quot; style=\&quot;padding-bottom:5px; max-height:85px;\&quot; border=\&quot;0\&quot; \/&gt;&lt;\/a&gt;&quot;);
            } else {
                addtext = addtext.replace(&quot;{more4}&quot;,&quot;&quot;);
            }


        } else {
            addtext = addtext.replace(&quot;{more}&quot;,&quot;&quot;);
        }

        $(&quot;#listarea&quot;).prepend(addtext);
    } else if(type == &quot;1&quot;) {
        im = im.substr(0,5);
        if(a6 &gt;= 3) {           
            a7.replace(&quot;2&quot;,&quot;&quot;);
            addtext = template2.replace(&quot;{color}&quot;,&quot; style=\&quot;color:red; font-weight: bold;\&quot;&quot;).replace(&quot;{pic}&quot;,&quot;importantdata.png&quot;).replace(&quot;{time}&quot;,a8.substr(11,8)).replace(&quot;{shijian}&quot;,im).replace(&quot;{mingcheng}&quot;,sj).replace(&quot;{qianzhi}&quot;,nr).replace(&quot;{yuqi}&quot;,a4).replace(&quot;{gongbu}&quot;,a5).replace(&quot;{xingji}&quot;,a6).replace(&quot;{yingxiang}&quot;,a7);
        } else {
            addtext = template2.replace(&quot;{color}&quot;,&quot;&quot;).replace(&quot;{pic}&quot;,&quot;nomarldata.png&quot;).replace(&quot;{time}&quot;,a8.substr(11,8)).replace(&quot;{shijian}&quot;,im).replace(&quot;{mingcheng}&quot;,sj).replace(&quot;{qianzhi}&quot;,nr).replace(&quot;{yuqi}&quot;,a4).replace(&quot;{gongbu}&quot;,a5).replace(&quot;{xingji}&quot;,a6).replace(&quot;{yingxiang}&quot;,a7);
        }

        $(&quot;#listarea&quot;).prepend(addtext);
    }//else if(type == &quot;1&quot;)
}//function msgbox(str){
</code></pre><p>var newsData=&lt;?php<br>    function curl_get_contents($url,$timeout=5,$method=’get’,$post_fields=array()) { //封装 curl<br>        $ch = curl_init();<br>        curl_setopt($ch, CURLOPT_URL, $url);<br>        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);<br>        curl_setopt($ch, CURLOPT_HEADER, 0);<br>        curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);<br>        if ($method==’post’) {<br>            curl_setopt($ch, CURLOPT_POST, true);<br>            curl_setopt($ch, CURLOPT_POSTFIELDS,$post_fields);<br>        }<br>        $output = curl_exec($ch);<br>        curl_close($ch);<br>        return $output;<br>    }</p>
<pre><code>$content=preg_replace(&quot;/\n|\s{3,}/&quot;, &quot;&quot;,curl_get_contents(&quot;http://www.jin10.com/jin10.com.html&quot;));
preg_match_all(&quot;/&lt;div class=\&quot;listline.*?\&quot;&gt;(.*?)&lt;!-- listline end --&gt;/is&quot;,$content,$news);
$newArray=array();
for ($i=0;$i&lt;50;$i++) {
    $new=$news[0][$i];
    if (strpos($new,&quot;class=\&quot;data\&quot;&quot;)) {
        $type=1;
    } else {
        $type=0;
    }
    $im=&quot;&quot;;
    $sj=&quot;&quot;;
    $nr=&quot;&quot;;
    $a4=&quot;&quot;;
    $a5=&quot;&quot;;
    $a6=&quot;&quot;;
    $a7=&quot;&quot;;
    $a8=&quot;&quot;;
    $a9=&quot;&quot;;
    if ($type==0) {
        preg_match_all(&quot;/&lt;div class=\&quot;doany\&quot;&gt;(.*?)&lt;\/div&gt;/is&quot;, $new, $tmpMore);
        if ($tmpMore[1][0]!==&quot;&quot;) {
            if (preg_match_all(&quot;/&lt;a href=\&quot;(.*?)\&quot; target=\&quot;_blank\&quot;&gt;&lt;img src=\&quot;http:\/\/www.jin10.com\/images\/website2.png\&quot; style=\&quot;padding-bottom:5px;\&quot; border=\&quot;0\&quot; \/&gt;&lt;\/a&gt;/&quot;, $tmpMore[1][0],$a4Tmp)) {
                $a4=$a4Tmp[1][0];
            }
            if (preg_match_all(&quot;/&lt;a class=\&quot;youtube\&quot; href=\&quot;(.*?)\&quot; target=\&quot;_blank\&quot;&gt;&lt;img src=\&quot;http:\/\/www.jin10.com\/images\/video2.png\&quot; style=\&quot;padding-bottom:5px;\&quot; border=\&quot;0\&quot; \/&gt;&lt;\/a&gt;/&quot;, $tmpMore[1][0],$a5Tmp)) {
                $a5=$a5Tmp[1][0];
            }
            if (preg_match_all(&quot;/&lt;img src=\&quot;http:\/\/image.jin10.com\/(.*?)\&quot; width=\&quot;50\&quot; style=\&quot;padding-bottom:5px; max-height:85px;\&quot; border=\&quot;0\&quot; \/&gt;/&quot;, $tmpMore[1][0],$a6Tmp)) {
                $a6=$a6Tmp[1][0];
            }
        }
        if (strpos($new, &quot;listline important&quot;)) {
            $im=0;
        } else {
            $im=1;
        }
        preg_match_all(&quot;/&lt;div class=\&quot;time\&quot;&gt;(.*?)&lt;\/div&gt;/&quot;, $new, $sjArr);
        $sj=&quot;0000-00-00 &quot;.$sjArr[1][0];
        preg_match_all(&quot;/&lt;p class=\&quot;text\&quot;&gt;(.*?)&lt;\/p&gt;/&quot;, $new, $nrArr);
        $nr=$nrArr[1][0];
    } else {
        preg_match_all(&quot;/&lt;div class=\&quot;dname\&quot;&gt;(.*?)&lt;\/div&gt;/&quot;, $new, $sjArr);
        $sj=$sjArr[1][0];
        preg_match_all(&quot;/&lt;div class=\&quot;preview\&quot;&gt;前值：(.*?) 预期：(.*?)&lt;\/div&gt;/&quot;, $new, $nra4Arr);
        $nr=$nra4Arr[1][0];
        $a4=$nra4Arr[2][0];
        preg_match_all(&quot;/&lt;div class=\&quot;actual\&quot;&gt;实际：(.*?)&lt;\/div&gt;/&quot;, $new, $a5Arr);
        $a5=$a5Arr[1][0];
        preg_match_all(&quot;/&lt;img src=\&quot;oem\/images\/star\/(.*?).png\&quot; width=\&quot;20\&quot; height=\&quot;34\&quot; border=\&quot;0\&quot; \/&gt;/&quot;, $new, $a6Arr);
        $a6=$a6Arr[1][0];
        preg_match_all(&quot;/&lt;div class=\&quot;updown\&quot;&gt;&lt;img src=\&quot;oem\/images\/updown\/(.*?).png\&quot; width=\&quot;82\&quot; height=\&quot;24\&quot; border=\&quot;0\&quot; \/&gt;&lt;\/div&gt;/&quot;, $new, $a7Arr);
        $a7=str_replace(&quot;2&quot;, &quot;&quot;, $a7Arr[1][0]);
        preg_match_all(&quot;/&lt;div class=\&quot;time isdata\&quot;&gt;(.*?)&lt;\/div&gt;/&quot;, $new, $a8Arr);
        $a8=&quot;0000-00-00 &quot;.$a8Arr[1][0];
        preg_match_all(&quot;/&lt;img src=\&quot;oem\/images\/flag\/(.*?).png\&quot; width=\&quot;40\&quot; height=\&quot;40\&quot; border=\&quot;0\&quot; \/&gt;/&quot;, $new, $a9Arr);
        $a9=$a9Arr[1][0];
    }
    $newArray[]=implode(&quot;#&quot;,array($type,$im,$sj,$nr,$a4,$a5,$a6,$a7,$a8,$a9));
}
echo json_encode(array_reverse($newArray));
</code></pre><p>?&gt;;<br>    for (var i=0;i&lt;newsData.length;i++) {<br>        msgbox(newsData[i]);<br>    }<br></script><br><code>`</code></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>