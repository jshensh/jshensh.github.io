<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>识别真假搜索引擎（搜索蜘蛛）方法（baidu,google,Msn,sogou,soso等) | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="最近工作中遇到个问题，就是有一些资源，不希望别人很派发的抓取，这样会占用我们带宽还有资源。因此，我们对页面访问做了频率限制。这样一来，又怕搜索蜘蛛给限制了。 因此，我们有个需求，就是除了常见搜索蜘蛛，其它都要做频率限制。 工作就变成了，首先我们怎么样正确表示搜索蜘蛛。
怎么样识别搜索蜘蛛搜索引擎基本">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="识别真假搜索引擎（搜索蜘蛛）方法（baidu,google,Msn,sogou,soso等)"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>识别真假搜索引擎（搜索蜘蛛）方法（baidu,google,Msn,sogou,soso等)</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2015/12/29/识别真假搜索引擎（搜索蜘蛛）方法（baidu,google,Msn,sogou,soso等)/" rel="bookmark">
        <time class="entry-date published" datetime="2015-12-28T17:12:50.000Z">
          2015-12-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>最近工作中遇到个问题，就是有一些资源，不希望别人很派发的抓取，这样会占用我们带宽还有资源。因此，我们对页面访问做了频率限制。这样一来，又怕搜索蜘蛛给限制了。 因此，我们有个需求，就是除了常见搜索蜘蛛，其它都要做频率限制。 工作就变成了，首先我们怎么样正确表示搜索蜘蛛。</p>
<p><strong>怎么样识别搜索蜘蛛</strong><br>搜索引擎基本上由最先google,和国内的baidu统一了。刚开始比较混乱，后期有很多规则协议，可以遵循。基本上一些新兴的搜索引擎在访问站点时候，都会延用google制定的一些规则。它们一般都会有特定的user-agent，但是，如果我们只通过user-agent去识别搜索蜘蛛的话，那样第三方抓取程序，都会去伪造个user-agent。变成搜索蜘蛛的，如：Googlebot/2.1 (+<a href="http://www.googlebot.com/bot.html" target="_blank" rel="noopener">http://www.googlebot.com/bot.html) </a>%C2%A0)是，google蜘蛛的值。</p>
<p>现在一般搜索引擎都提供一个DNS 反向IP查询功能，只需要把访问来的IP 通过反向查询域名，看是不是搜索引擎域名。这样伪造的爬虫工具，就会被很容易识别了。 具体识别真假蜘蛛只需要：<em>1，判断user-agent是否满足蜘蛛格式 2，然后进一步确定IP 反解析域名是否属于该搜索引擎域名.</em></p>
<table border="0" align="center" width="732" cellpadding="4" cellspacing="1" class="table">

<tr><br><br><td width="102"><strong>搜索引擎</strong><br></td><br><br><td width="104"><strong>user-agent(包含)</strong><br></td><br><br><td width="77"><strong>是否PTR</strong><br></td><br><br><td width="442"><strong>备注</strong><br></td><br></tr>

<p><tbody></tbody></p>
<tr>

<td width="102">google<br></td>

<td width="104">Googlebot<br></td>

<td width="77">√<br></td>

<td width="442">host ip  得到域名：googlebot.com主域名<br></td><br></tr><br><tr><br><br><td width="102">baidu<br></td>

<td width="104">Baiduspider<br></td>

<td width="77">√<br></td>

<td width="442">host ip  得到域名：<em>.baidu.com 或 </em>.baidu.jp<br></td><br></tr><br><tr><br><br><td width="102">yahoo<br></td>

<td width="104">Yahoo!<br></td>

<td width="77">√<br></td>

<td width="442">host ip  得到域名：inktomisearch.com主域名<br></td><br></tr><br><tr><br><br><td width="102">Sogou<br></td>

<td width="104">Sogou<br></td>

<td width="77">×<br></td>

<td width="442"><em>Sogou web spider/3.0(+<a href="http://www.sogou.com/docs/help/webmasters.htm#07″" target="_blank" rel="noopener">http://www.sogou.com/docs/help/webmasters.htm#07″) </a> )
</em>Sogou Push Spider/3.0(+<a href="http://www.sogou.com/docs/help/webmasters.htm#07″" target="_blank" rel="noopener">http://www.sogou.com/docs/help/webmasters.htm#07″) </a> )<br></td><br></tr><br><tr><br><br><td width="102">网易<br></td>

<td width="104">YodaoBot<br></td>

<td width="77">×<br></td>

<td width="442">*Mozilla/5.0 (compatible; YodaoBot/1.0; <a href="http://www.yodao.com/help/webmaster/spider/%E2%80%9D;" target="_blank" rel="noopener">http://www.yodao.com/help/webmaster/spider/”;</a> )<br></td><br></tr><br><tr><br><br><td width="102">MSN<br></td>

<td width="104">MSNBot<br></td>

<td width="77">√<br></td>

<td width="442">host ip  得到域名：live.com主域名<br></td><br></tr><br><tr><br><br><td width="102">360<br></td>

<td width="104">360Spider<br></td>

<td width="77">×<br></td>

<td width="442">Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.8.0.11)  Firefox/1.5.0.11; 360Spider<br></td><br></tr><br><tr><br><br><td width="102">soso<br></td>

<td width="104">Sosospider<br></td>

<td width="77">×<br></td>

<td width="442">Sosospider+(+<a href="http://help.soso.com/webspider.htm" target="_blank" rel="noopener">http://help.soso.com/webspider.htm</a>)<br></td><br></tr><br><tr><br><br><td width="102">bing<br></td>

<td width="104">bingbot<br></td>

<td width="77">√<br></td>

<p><td width="442">host ip  得到域名：msn.com主域名<br></td><br></p></tr><br><br></table><br>以上是我整理一些常用搜索引擎的user-agent特征码，以及IP反向解析情况。保证准确识别搜索引擎，我们通过IP反解析是最为准确方法。好在google,baidu,bing都有做反向解析。基本上占用了80%搜索市场了。下面，我是我检测方法。<p></p>
<p><strong>PHP反解析IP方法</strong><br>`    function check_spider($ip,$ua) {<br>        static $spider_list=array(<br>            ‘google’=&gt;array(‘Googlebot’,’googlebot.com’),<br>            ‘baidu’=&gt;array(‘Baiduspider’,’.baidu.’),<br>            ‘yahoo’=&gt;array(‘Yahoo!’,’inktomisearch.com’),<br>            ‘msn’=&gt;array(‘MSNBot’,’live.com’),<br>            ‘bing’=&gt;array(‘bingbot’,’msn.com’)<br>        );</p>
<pre><code>    if(!preg_match(&apos;/^(\d{1,3}\.){3}\d{1,3}$/&apos;,$ip)) return false;
    if(empty($ua)) return false;

    foreach ($spider_list as $k=&gt;$v) {
        if(stripos($ua,$v[0])!==false) {
            $domain = gethostbyaddr($ip);

            if($domain &amp;&amp; stripos($domain,$v[1])!==false) {
                return $k;
            }
        }
    }
    return false;
}
</code></pre><p><code>`</code></p>
<p>目前只加入几个搜索引擎检测，这些是可以做反解析查询的。不能做反解析查询的，最好做速度限制，用户会使用它们来伪造搜索引擎来抓取你的资源。欢迎大家交流，先写到这里了。</p>
<p>转载自 <a href="http://blog.chacuo.net/147.html" target="_blank" rel="noopener">http://blog.chacuo.net/147.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/建站相关/">建站相关</a>
    </span>
    

    

    </div>

    
  </div>
</article>


    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2018 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>