<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>记录一下家里网络的一些配置 | 博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  
  <meta name="description" content="家里使用的三线接入主路由进行拨号，mwan3 优先级分别为 电信 &amp;gt; 即插即用 5G RNDIS &amp;gt; 长城宽带，网内还有一个 Debian 系统的透明网关，记录下重要配置供以后参考。
参考链接：

openwrt负载均衡最详细设置-小白进阶篇 - OPENWRT专版 - 恩山无线论坛 -">
  

  
  
  <meta name="keywords" content="">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="记录一下家里网络的一些配置"/>

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/about.html">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>记录一下家里网络的一些配置</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2022/02/03/记录一下家里网络的一些配置/" rel="bookmark">
        <time class="entry-date published" datetime="2022-02-02T17:23:43.000Z">
          2022-02-03
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>家里使用的三线接入主路由进行拨号，mwan3 优先级分别为 电信 &gt; 即插即用 5G RNDIS &gt; 长城宽带，网内还有一个 Debian 系统的透明网关，记录下重要配置供以后参考。</p>
<p>参考链接：</p>
<ul>
<li><a href="https://www.right.com.cn/forum/thread-2670532-1-1.html" target="_blank" rel="noopener">openwrt负载均衡最详细设置-小白进阶篇 - OPENWRT专版 - 恩山无线论坛 -  Powered by Discuz!</a></li>
<li><a href="https://www.youtube.com/watch?v=vHWYH_5ooEY" target="_blank" rel="noopener">OpenWRT - Configure Multiwan Failover with mwan3 - YouTube</a></li>
<li><a href="https://github.com/Dreamacro/clash/issues/555" target="_blank" rel="noopener">Dreamacro/clash #555 clash本机做透明代理iptables规则请教</a></li>
</ul>
<h2 id="Openwrt-上的"><a href="#Openwrt-上的" class="headerlink" title="Openwrt 上的"></a>Openwrt 上的</h2><p><code>/etc/config/network</code> 包含一些 switch、interface 相关的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line">config interface &apos;loopback&apos;</span><br><span class="line">        option ifname &apos;lo&apos;</span><br><span class="line">        option proto &apos;static&apos;</span><br><span class="line">        option ipaddr &apos;127.0.0.1&apos;</span><br><span class="line">        option netmask &apos;255.0.0.0&apos;</span><br><span class="line"></span><br><span class="line">config globals &apos;globals&apos;</span><br><span class="line">        option ula_prefix &apos;fd53:0f22:53b4::/48&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;lan&apos;</span><br><span class="line">        option type &apos;bridge&apos;</span><br><span class="line">        option ifname &apos;eth0.1&apos;</span><br><span class="line">        option proto &apos;static&apos;</span><br><span class="line">        option netmask &apos;255.255.255.0&apos;</span><br><span class="line">        option ip6assign &apos;60&apos;</span><br><span class="line">        option ipaddr &apos;192.168.1.1&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;wan&apos;</span><br><span class="line">        option ifname &apos;eth0.2&apos;</span><br><span class="line">        option _orig_ifname &apos;eth0.2&apos;</span><br><span class="line">        option _orig_bridge &apos;false&apos;</span><br><span class="line">        option proto &apos;pppoe&apos;</span><br><span class="line">        option keepalive &apos;0&apos;</span><br><span class="line">        option username &apos;ad******69&apos;</span><br><span class="line">        option password &apos;42****08&apos;</span><br><span class="line">        option metric &apos;40&apos;</span><br><span class="line">        option ipv6 &apos;auto&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;wan6&apos;</span><br><span class="line">        option ifname &apos;eth0.2&apos;</span><br><span class="line">        option _orig_ifname &apos;eth0.2&apos;</span><br><span class="line">        option _orig_bridge &apos;false&apos;</span><br><span class="line">        option proto &apos;dhcpv6&apos;</span><br><span class="line"></span><br><span class="line">config switch</span><br><span class="line">        option name &apos;switch0&apos;</span><br><span class="line">        option reset &apos;1&apos;</span><br><span class="line">        option enable_vlan &apos;1&apos;</span><br><span class="line"></span><br><span class="line">config switch_vlan</span><br><span class="line">        option device &apos;switch0&apos;</span><br><span class="line">        option vlan &apos;1&apos;</span><br><span class="line">        option ports &apos;2 5t&apos;</span><br><span class="line"></span><br><span class="line">config switch_vlan</span><br><span class="line">        option device &apos;switch0&apos;</span><br><span class="line">        option vlan &apos;2&apos;</span><br><span class="line">        option ports &apos;3 5t&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;wan_gwbn&apos;</span><br><span class="line">        option proto &apos;pppoe&apos;</span><br><span class="line">        option ifname &apos;eth0.3&apos;</span><br><span class="line">        option username &apos;090******982&apos;</span><br><span class="line">        option password &apos;im******&apos;</span><br><span class="line">        option ipv6 &apos;auto&apos;</span><br><span class="line">        option keepalive &apos;0&apos;</span><br><span class="line">        option peerdns &apos;0&apos;</span><br><span class="line">        option dns &apos;223.5.5.5 223.6.6.6&apos;</span><br><span class="line">        option metric &apos;42&apos;</span><br><span class="line"></span><br><span class="line">config switch_vlan</span><br><span class="line">        option device &apos;switch0&apos;</span><br><span class="line">        option vlan &apos;3&apos;</span><br><span class="line">        option ports &apos;1 5t&apos;</span><br><span class="line"></span><br><span class="line">config switch_vlan</span><br><span class="line">        option device &apos;switch0&apos;</span><br><span class="line">        option ports &apos;0t 5t&apos;</span><br><span class="line">        option vlan &apos;85&apos;</span><br><span class="line"></span><br><span class="line">config switch_vlan</span><br><span class="line">        option device &apos;switch0&apos;</span><br><span class="line">        option ports &apos;0t 5t&apos;</span><br><span class="line">        option vlan &apos;51&apos;</span><br><span class="line"></span><br><span class="line">config switch_vlan</span><br><span class="line">        option device &apos;switch0&apos;</span><br><span class="line">        option ports &apos;0t 5t&apos;</span><br><span class="line">        option vlan &apos;46&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;iptv&apos;</span><br><span class="line">        option proto &apos;dhcp&apos;</span><br><span class="line">        option ifname &apos;eth0.85&apos;</span><br><span class="line">        option hostname &apos;HuaWei&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;tr069&apos;</span><br><span class="line">        option proto &apos;dhcp&apos;</span><br><span class="line">        option ifname &apos;eth0.46&apos;</span><br><span class="line">        option hostname &apos;HuaWei&apos;</span><br><span class="line"></span><br><span class="line">config route</span><br><span class="line">        option interface &apos;tr069&apos;</span><br><span class="line">        option target &apos;28.0.0.0&apos;</span><br><span class="line">        option netmask &apos;255.0.0.0&apos;</span><br><span class="line">        option gateway &apos;28.39.127.254&apos;</span><br><span class="line"></span><br><span class="line">config route</span><br><span class="line">        option target &apos;124.75.34.37&apos;</span><br><span class="line">        option netmask &apos;255.255.255.255&apos;</span><br><span class="line">        option gateway &apos;23.39.127.254&apos;</span><br><span class="line">        option interface &apos;iptv&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;rndis&apos;</span><br><span class="line">        option proto &apos;dhcp&apos;</span><br><span class="line">        option macaddr &apos;2C:B2:1A:5D:8A:00&apos;</span><br><span class="line">        option metric &apos;41&apos;</span><br><span class="line">        option _orig_ifname &apos;usb0&apos;</span><br><span class="line">        option _orig_bridge &apos;false&apos;</span><br><span class="line">        option ifname &apos;usb0&apos;</span><br></pre></td></tr></table></figure>
<p><code>/etc/config/dhcp</code> 包含 DHCP 相关的配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">config dnsmasq</span><br><span class="line">        option localise_queries &apos;1&apos;</span><br><span class="line">        option rebind_protection &apos;1&apos;</span><br><span class="line">        option rebind_localhost &apos;1&apos;</span><br><span class="line">        option local &apos;/lan/&apos;</span><br><span class="line">        option domain &apos;lan&apos;</span><br><span class="line">        option expandhosts &apos;1&apos;</span><br><span class="line">        option authoritative &apos;1&apos;</span><br><span class="line">        option readethers &apos;1&apos;</span><br><span class="line">        option leasefile &apos;/tmp/dhcp.leases&apos;</span><br><span class="line">        option resolvfile &apos;/tmp/resolv.conf.d/resolv.conf.auto&apos;</span><br><span class="line">        option nonwildcard &apos;1&apos;</span><br><span class="line">        option localservice &apos;1&apos;</span><br><span class="line">        option filter_aaaa &apos;1&apos;</span><br><span class="line">        option cachesize &apos;0&apos;</span><br><span class="line">        option doh_backup_noresolv &apos;-1&apos;</span><br><span class="line">        list doh_backup_server &apos;&apos;</span><br><span class="line">        list server &apos;127.0.0.1#5054&apos;</span><br><span class="line">        list server &apos;127.0.0.1#5053&apos;</span><br><span class="line">        option noresolv &apos;0&apos;</span><br><span class="line"></span><br><span class="line">config dhcp &apos;lan&apos;</span><br><span class="line">        option interface &apos;lan&apos;</span><br><span class="line">        option start &apos;100&apos;</span><br><span class="line">        option limit &apos;150&apos;</span><br><span class="line">        option leasetime &apos;12h&apos;</span><br><span class="line">        option ra_slaac &apos;1&apos;</span><br><span class="line">        list ra_flags &apos;managed-config&apos;</span><br><span class="line">        list ra_flags &apos;other-config&apos;</span><br><span class="line">        option dhcpv6 &apos;hybrid&apos;</span><br><span class="line">        option ndp &apos;hybrid&apos;</span><br><span class="line">        option ra_management &apos;1&apos;</span><br><span class="line">        list dhcp_option &apos;6,192.168.1.234&apos;</span><br><span class="line">        list dhcp_option &apos;3,192.168.1.234&apos;</span><br><span class="line">        option ra &apos;server&apos;</span><br><span class="line">        list dns &apos;2001:4860:4860::8888&apos;</span><br><span class="line">        list dns &apos;2001:4860:4860::8844&apos;</span><br><span class="line">        list dns &apos;2400:3200:baba::1&apos;</span><br><span class="line"></span><br><span class="line">config dhcp &apos;wan&apos;</span><br><span class="line">        option interface &apos;wan&apos;</span><br><span class="line">        option ignore &apos;1&apos;</span><br><span class="line"></span><br><span class="line">config odhcpd &apos;odhcpd&apos;</span><br><span class="line">        option maindhcp &apos;0&apos;</span><br><span class="line">        option leasefile &apos;/tmp/hosts/odhcpd&apos;</span><br><span class="line">        option leasetrigger &apos;/usr/sbin/odhcpd-update&apos;</span><br><span class="line">        option loglevel &apos;4&apos;</span><br><span class="line"></span><br><span class="line">config srvhost</span><br><span class="line">        option srv &apos;_vlmcs._tcp&apos;</span><br><span class="line">        option target &apos;OpenWrt&apos;</span><br><span class="line">        option port &apos;1688&apos;</span><br><span class="line">        option class &apos;0&apos;</span><br><span class="line">        option weight &apos;100&apos;</span><br></pre></td></tr></table></figure>
<p><code>/etc/config/mwan3</code> 三线故障自动切换相关配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">config globals &apos;globals&apos;</span><br><span class="line">        option mmx_mask &apos;0x3F00&apos;</span><br><span class="line">        option local_source &apos;lan&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;wan&apos;</span><br><span class="line">        option enabled &apos;1&apos;</span><br><span class="line">        option initial_state &apos;online&apos;</span><br><span class="line">        option family &apos;ipv4&apos;</span><br><span class="line">        option reliability &apos;1&apos;</span><br><span class="line">        option count &apos;1&apos;</span><br><span class="line">        option size &apos;56&apos;</span><br><span class="line">        option timeout &apos;2&apos;</span><br><span class="line">        option interval &apos;5&apos;</span><br><span class="line">        option failure_interval &apos;5&apos;</span><br><span class="line">        option recovery_interval &apos;5&apos;</span><br><span class="line">        option down &apos;3&apos;</span><br><span class="line">        option up &apos;3&apos;</span><br><span class="line">        option flush_conntrack &apos;never&apos;</span><br><span class="line">        option check_quality &apos;0&apos;</span><br><span class="line">        option track_method &apos;httping&apos;</span><br><span class="line">        list track_ip &apos;101.95.49.100&apos;</span><br><span class="line">        list track_ip &apos;182.61.200.7&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;wan_gwbn&apos;</span><br><span class="line">        option enabled &apos;1&apos;</span><br><span class="line">        option initial_state &apos;online&apos;</span><br><span class="line">        option family &apos;ipv4&apos;</span><br><span class="line">        option reliability &apos;1&apos;</span><br><span class="line">        option count &apos;1&apos;</span><br><span class="line">        option size &apos;56&apos;</span><br><span class="line">        option timeout &apos;2&apos;</span><br><span class="line">        option interval &apos;5&apos;</span><br><span class="line">        option failure_interval &apos;5&apos;</span><br><span class="line">        option recovery_interval &apos;5&apos;</span><br><span class="line">        option down &apos;3&apos;</span><br><span class="line">        option up &apos;3&apos;</span><br><span class="line">        option check_quality &apos;1&apos;</span><br><span class="line">        option failure_latency &apos;1000&apos;</span><br><span class="line">        option failure_loss &apos;20&apos;</span><br><span class="line">        option recovery_latency &apos;500&apos;</span><br><span class="line">        option recovery_loss &apos;5&apos;</span><br><span class="line">        option flush_conntrack &apos;never&apos;</span><br><span class="line">        list track_ip &apos;101.95.49.100&apos;</span><br><span class="line">        list track_ip &apos;182.61.200.7&apos;</span><br><span class="line">        option track_method &apos;httping&apos;</span><br><span class="line"></span><br><span class="line">config interface &apos;rndis&apos;</span><br><span class="line">        option enabled &apos;1&apos;</span><br><span class="line">        option initial_state &apos;online&apos;</span><br><span class="line">        option family &apos;ipv4&apos;</span><br><span class="line">        option track_method &apos;ping&apos;</span><br><span class="line">        option reliability &apos;1&apos;</span><br><span class="line">        option count &apos;1&apos;</span><br><span class="line">        option size &apos;56&apos;</span><br><span class="line">        option check_quality &apos;0&apos;</span><br><span class="line">        option timeout &apos;2&apos;</span><br><span class="line">        option interval &apos;5&apos;</span><br><span class="line">        option failure_interval &apos;5&apos;</span><br><span class="line">        option recovery_interval &apos;5&apos;</span><br><span class="line">        option down &apos;3&apos;</span><br><span class="line">        option up &apos;3&apos;</span><br><span class="line">        list track_ip &apos;101.95.48.168&apos;</span><br><span class="line"></span><br><span class="line">config member &apos;wan_m1_w1&apos;</span><br><span class="line">        option interface &apos;wan&apos;</span><br><span class="line">        option weight &apos;1&apos;</span><br><span class="line">        option metric &apos;1&apos;</span><br><span class="line"></span><br><span class="line">config member &apos;gwbn_m3_w1&apos;</span><br><span class="line">        option interface &apos;wan_gwbn&apos;</span><br><span class="line">        option metric &apos;3&apos;</span><br><span class="line">        option weight &apos;1&apos;</span><br><span class="line"></span><br><span class="line">config member &apos;rndis_m2_w1&apos;</span><br><span class="line">        option interface &apos;rndis&apos;</span><br><span class="line">        option metric &apos;2&apos;</span><br><span class="line">        option weight &apos;1&apos;</span><br><span class="line"></span><br><span class="line">config policy &apos;wan_rndis_gwbn&apos;</span><br><span class="line">        list use_member &apos;wan_m1_w1&apos;</span><br><span class="line">        list use_member &apos;rndis_m2_w1&apos;</span><br><span class="line">        list use_member &apos;gwbn_m3_w1&apos;</span><br><span class="line">        option last_resort &apos;unreachable&apos;</span><br><span class="line"></span><br><span class="line">config rule &apos;default&apos;</span><br><span class="line">        option proto &apos;all&apos;</span><br><span class="line">        option sticky &apos;0&apos;</span><br><span class="line">        option use_policy &apos;wan_rndis_gwbn&apos;</span><br></pre></td></tr></table></figure>
<h2 id="Debian-上的"><a href="#Debian-上的" class="headerlink" title="Debian 上的"></a>Debian 上的</h2><p>先记录下相关命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd clash</span><br><span class="line">systemctl daemon-reload</span><br><span class="line">dpkg-reconfigure iptables-persistent</span><br></pre></td></tr></table></figure>
<p><code>iptables</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp -j CLASH</span><br><span class="line">iptables -t nat -A OUTPUT -p tcp -m owner ! --uid-owner clash -j REDIRECT --to-ports 7892</span><br><span class="line">iptables -t nat -A CLASH -p tcp -j REDIRECT --to-ports 7892</span><br><span class="line">iptables -t nat -A CLASH -d 0.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 10.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 127.0.0.0/8 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 169.254.0.0/16 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 172.16.0.0/12 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 192.168.0.0/16 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 224.0.0.0/4 -j RETURN</span><br><span class="line">iptables -t nat -A CLASH -d 240.0.0.0/4 -j RETURN</span><br></pre></td></tr></table></figure>
<p><code>/etc/systemd/system/clash.service</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=clash service</span><br><span class="line">Requires=systemd-networkd-wait-online.service</span><br><span class="line">After=systemd-networkd-wait-online.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=clash</span><br><span class="line">Group=clash</span><br><span class="line">Type=simple</span><br><span class="line">CapabilityBoundingSet=CAP_NET_BIND_SERVICE</span><br><span class="line">AmbientCapabilities=CAP_NET_BIND_SERVICE</span><br><span class="line">ExecStart=/usr/local/bin/clash -d /etc/clash/</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p><code>/etc/clash/config.yaml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">port: 7890</span><br><span class="line">socks-port: 7891</span><br><span class="line">redir-port: 7892</span><br><span class="line">allow-lan: true</span><br><span class="line">external-controller: 192.168.1.234:9090</span><br><span class="line">secret: &quot;******&quot;</span><br><span class="line">mode: Rule</span><br><span class="line">log-level: warning</span><br><span class="line"># log-level: info</span><br><span class="line"></span><br><span class="line">experimental:</span><br><span class="line">  ignore-resolve-fail: false</span><br><span class="line"></span><br><span class="line">proxies:</span><br><span class="line">  - name: Proxy</span><br><span class="line">    type: **</span><br><span class="line">    server: **</span><br><span class="line">    port: **</span><br><span class="line">    uuid: **</span><br><span class="line">    alterId: 0</span><br><span class="line">    cipher: auto</span><br><span class="line">    tls: true</span><br><span class="line">    network: ws</span><br><span class="line">    ws-path: **</span><br><span class="line">    ws-headers:</span><br><span class="line">      Host: **</span><br><span class="line"></span><br><span class="line">dns:</span><br><span class="line">  enable: true</span><br><span class="line">  listen: 0.0.0.0:53</span><br><span class="line">  enhanced-mode: redir-host</span><br><span class="line">  nameserver:</span><br><span class="line">    - 127.0.0.1:5335</span><br><span class="line"></span><br><span class="line">rules:</span><br><span class="line">  - DOMAIN-SUFFIX,mlsub.net,DIRECT</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/openwrt/">openwrt</a>, <a href="/categories/openwrt/debian/">debian</a>
    </span>
    

    

    </div>

    
  </div>
</article>

  



	<section id="comment" class="comment">
	  <div id="disqus_thread">
	  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	  </div>
	</section>

	<script type="text/javascript">
	var disqus_shortname = 'futa-ooo';
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	(function(){
	  var dsq = document.createElement('script');
	  dsq.type = 'text/javascript';
	  dsq.async = true;
	  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
	  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	}());
	</script>




    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2022 403 Forbidden
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>