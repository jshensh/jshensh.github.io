<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>博客</title>

  
  <meta name="author" content="403 Forbidden">
  

  

  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="博客"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
</head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">博客</a>
    </h1>
    <p class="site-description"></p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/about.html">关于</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2019/04/24/N1 盒子使用 Armbian 内核运行 Lede (Openwrt)/"><span>N1 盒子使用 Armbian 内核运行 Lede (Openwrt)</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2019/04/24/N1 盒子使用 Armbian 内核运行 Lede (Openwrt)/" rel="bookmark">
        <time class="entry-date published" datetime="2019-04-24T07:44:43.000Z">
          2019-04-24
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><hr>
<ol>
<li>如果用作旁路由，则 N1 接主路由的的LAN口</li>
<li>如果用作主路由，则 N1 接入交换机或AP模式的路由器或不插 WAN 口的路由器</li>
<li>以上的交换机或路由器设置为 192.168.1.X，但不能为 192.168.1.1，关闭除了 N1 外所有设备的 dhcp 服务</li>
<li>开 udp 转发，请：<code>opkg install iptables-mod-tproxy</code></li>
</ol>
<h2 id="制作镜像"><a href="#制作镜像" class="headerlink" title="制作镜像"></a>制作镜像</h2><hr>
<ol>
<li>首先创建目录 openwrt</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir openwrt</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>下载 openwrt rootfs 并解压</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.openwrt.org/releases/18.06.2/targets/armvirt/64/openwrt-18.06.2-armvirt-64-default-rootfs.tar.gz</span><br><span class="line">tar xvf openwrt-18.06.2-armvirt-64-default-rootfs.tar.gz -C openwrt</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>挂载 armbian 镜像</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">losetup -P -f --show Armbian_5.60_Aml-s9xxx_Debian_stretch_default_4.18.7_20180922.img</span><br></pre></td></tr></table></figure>
<p>会输出类似 <code>/dev/loop0</code> 的内容</p>
<p>其他任意 arm 的镜像都行，但是很多是 img 的，请自行挂载。</p>
<ol start="4">
<li>把第二分区挂载到 media 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/loop0p2 /media</span><br></pre></td></tr></table></figure>
<p>注意，<span color="red">这里的 loop0 要和上一步中的 loop0 保持一致，有可能是 loop1 等</span></p>
<ol start="5">
<li>删除 openwrt/lib/firmware 并将 media 里的内核模块和驱动等剪切到 openwrt 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rm -rf openwrt/lib/firmware</span><br><span class="line">rm -rf openwrt/lib/modules</span><br><span class="line"></span><br><span class="line">mv /media/lib/modules openwrt/lib/</span><br><span class="line">mv /media/lib/firmware openwrt/lib/</span><br><span class="line">mv /media/etc/modprobe.d openwrt/etc/</span><br><span class="line">mv /media/etc/fstab openwrt/etc/</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>切换到 openwrt/lib/modules/4.18.7-aml-s9xxx</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd openwrt/lib/modules/4.18.7-aml-s9xxx</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>创建 link-ko.sh 写入以下内容</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for x in `find -name *.ko`</span><br><span class="line">do</span><br><span class="line">    ln -s $x .</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>给予 link-ko.sh 运行权限并运行</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x link-ko.sh</span><br><span class="line">./link-ko.sh</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>回到 root 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>编辑 openwrt/etc/init.d/boot，在第 38 行也就是 <code>/sbin/kmodloader</code> 之前，增加以下内容：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -n 51200</span><br></pre></td></tr></table></figure>
<p>至此，openwrt 配置完毕，把它们全部剪切到 media 目录</p>
<ol start="11">
<li>先清空 media，把 openwrt 目录下所有剪切到 media 并新建 boot 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /media/*</span><br><span class="line">mv openwrt/* /media/</span><br><span class="line">mkdir /media/boot</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>同步一下</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sync</span><br></pre></td></tr></table></figure>
<ol start="13">
<li>卸载 media 和 openwrt 目录</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">umount /media</span><br><span class="line">losetup -d /dev/loop0</span><br></pre></td></tr></table></figure>
<p>现在 Armbian_5.60_Aml-s9xxx_Debian_stretch_default_4.18.7_20180922.img 已被修改为 openwrt 系统。</p>
<h2 id="路由相关设置"><a href="#路由相关设置" class="headerlink" title="路由相关设置"></a>路由相关设置</h2><hr>
<h3 id="主路由设置"><a href="#主路由设置" class="headerlink" title="主路由设置"></a>主路由设置</h3><ol>
<li>进入 Network –&gt; Interfaces</li>
<li>编辑 lan 口</li>
<li>取消桥接的对勾，保存</li>
<li>Network –&gt; Interfaces，新建 wan 接口</li>
<li>接口名称填 wan，协议选 pppoe，网卡选 eth0，选好后，点 submit</li>
<li>会自动跳转宽带帐号设置页面，填入宽带帐号密码，保存。然后就可以上网了。</li>
</ol>
<h3 id="旁路网关设置"><a href="#旁路网关设置" class="headerlink" title="旁路网关设置"></a>旁路网关设置</h3><p>进入 Network –&gt; Interfaces –&gt; lan 口，gateway 填主路由 ip，并设置 dns，就可以上网了。</p>
<p>转载自 <a href="https://www.right.com.cn/forum/thread-468983-1-1.html" target="_blank" rel="noopener">https://www.right.com.cn/forum/thread-468983-1-1.html</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/斐讯/">斐讯</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2019/04/24/N1 盒子使用 Armbian 内核运行 Lede (Openwrt)/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/10/10/解决dnsmasq安装好之后主机不能解析其他域名的问题/"><span>解决dnsmasq安装好之后主机不能解析其他域名的问题</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/10/10/解决dnsmasq安装好之后主机不能解析其他域名的问题/" rel="bookmark">
        <time class="entry-date published" datetime="2018-10-10T06:49:43.000Z">
          2018-10-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>事情是这样的，我想在阿里云上搭建一个dns服务器，没错就是吃空了，在阿里云上搭建一个本地的dns服务器，安装好之后发现不能ping域名了，难道是dns服务器的问题，换成114的dns也没有用，后来终于找到解决的方法了</p>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>首先看下我的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resolv-file=/etc/resolv.conf</span><br><span class="line">strict-order</span><br><span class="line">listen-address=47.100.210.53</span><br><span class="line">address=/hello.bboysoul.com/198.13.55.44</span><br></pre></td></tr></table></figure></p>
<p>没错我加了这个 <code>resolv-file=/etc/resolv.conf</code><br>也就是说的我的上游dns服务器地址应该是存在这个文件里面的，之后查看这个文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)</span><br><span class="line">#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN</span><br><span class="line">nameserver 127.0.0.1</span><br><span class="line">options timeout:2 attempts:3 rotate single-request-reopen</span><br></pre></td></tr></table></figure></p>
<p>这就是问题所在了，之后我们修改我们本机的dns服务器地址<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolvconf/resolv.conf.d/head</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver 47.100.210.53</span><br><span class="line">nameserver 114.114.114.114</span><br></pre></td></tr></table></figure>
<p>有人说ubuntu16.04是修改下面这个文件才可以修改dns服务器地址的，反正我是没有成功过，你们看着办<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolvconf/resolv.conf.d/base</span><br></pre></td></tr></table></figure></p>
<p>但是绝对不能编辑下面这个文件，因为一旦重启网络，这个文件会被重写<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>之后我们重启网络<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart networking</span><br></pre></td></tr></table></figure></p>
<p>重启dnsmasq<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart dnsmasq</span><br></pre></td></tr></table></figure></p>
<p>其实貌似直接重启dnsmasq就可以，因为重启这个貌似会直接重启网络的<br>如果你碰到同样ping不通主机的问题，但是我的方法没有帮助到你，那么也许下面是你的问题所在</p>
<h2 id="第二种情况"><a href="#第二种情况" class="headerlink" title="第二种情况"></a>第二种情况</h2><p>首先看下这个进程是怎么启动的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">╭─root@bboysoul-aliyun ~  </span><br><span class="line">╰─➤  ps -ef |grep dnsmasq</span><br><span class="line">dnsmasq  19842     1  0 17:02 ?        00:00:00 /usr/sbin/dnsmasq -x /var/run/dnsmasq/dnsmasq.pid -u dnsmasq -r /var/run/dnsmasq/resolv.conf -7 /etc/dnsmasq.d,.dpkg-dist,.dpkg-old,.dpkg-new --local-service --trust-anchor=.,19036,8,2,49aac11d7b6f6446702e54a1607371607a1a41855200fd2ce1cdde32f24e8fb5 --trust-anchor=.,20326,8,2,e06d44b80b8f1d39a95c0b0d7c65d08458e880409bbc683457104237c7f8ec8d</span><br><span class="line">root     20371 20335  0 21:03 pts/1    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn dnsmasq</span><br></pre></td></tr></table></figure></p>
<p>你可以看到上面这么一段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r /var/run/dnsmasq/resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>看下上面这个文件的路径和内容，如果不行那么修改下面这个文件，忽略掉上面这个文件之后重启dnsmasq<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/dnsmasq</span><br></pre></td></tr></table></figure></p>
<p>取消下面这行注释<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IGNORE_RESOLVCONF=yes</span><br></pre></td></tr></table></figure></p>
<p>之后手动指定上游dns服务器也就是dnsmasq的配置文件vim /etc/dnsmasq.conf加上下面这行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resolv-file=/etc/resolv.conf</span><br></pre></td></tr></table></figure></p>
<p>之后就是重复我上面第一种情况的操作了</p>
<p>转载自 <a href="https://www.jianshu.com/p/81c0221de34c" target="_blank" rel="noopener">https://www.jianshu.com/p/81c0221de34c</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/10/10/解决dnsmasq安装好之后主机不能解析其他域名的问题/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/10/10/N1 盒子 Ubuntu 3.14 内核开启无线热点/"><span>N1 盒子 Ubuntu 3.14 内核开启无线热点</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/10/10/N1 盒子 Ubuntu 3.14 内核开启无线热点/" rel="bookmark">
        <time class="entry-date published" datetime="2018-10-10T06:49:43.000Z">
          2018-10-10
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <ol>
<li>先开启 3.14 内核无线模块</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe dhd &amp;&amp; echo dhd &gt;&gt; /etc/modules</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>由于和后续的 dnsmasq 冲突，需要关掉系统自带的 systemd-resolved 服务</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop systemd-resolved</span><br><span class="line">systemctl disable systemd-resolved</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>安装要用的 dnsmasq 和 net-tools 组件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install dnsmasq net-tools</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>下载并安装 create_ap 工具</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/oblique/create_ap</span><br><span class="line">cd create_ap/</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>将以下内容保存至 /usr/bin/startap 。注意<strong>别忘了修改 YourSSIDHere YourPasswordHere</strong> 两个参数。<strong>如果有需要使用 2.4GHz 网络的，请去掉 –freq-band 5 –ieee80211ac 参数</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=ap</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/bin/startap</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>并执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /usr/lib/systemd/system/ap.service</span><br><span class="line">systemctl enable ap</span><br><span class="line">systemctl start ap</span><br></pre></td></tr></table></figure>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/斐讯/">斐讯</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/10/10/N1 盒子 Ubuntu 3.14 内核开启无线热点/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/08/13/斐讯 N1 折腾记：运行 Linux 及优化/"><span>斐讯 N1 折腾记：运行 Linux 及优化</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/08/13/斐讯 N1 折腾记：运行 Linux 及优化/" rel="bookmark">
        <time class="entry-date published" datetime="2018-08-13T06:16:02.000Z">
          2018-08-13
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　咳咳咳，上篇教程教大家给斐讯 N1 降级并且刷了官改系统，可以当作一个电视盒子和下载机来使用。<br>　　有些小伙伴可能不想把它当作电视盒子，就想把它当作 NAS 或者是服务器，但是总不能拿 Android 玩吧，Android 也不是针对服务器设计的。<br>　　那么我们说过，N1 不仅能刷官改，还能运行 Linux，而且是完整的 Linux 发行版，用 Linux 当服务器、NAS、下载机，包括电视盒子，体验总是要比 Android 好的。<br>　　这篇教程就教大家如何在斐讯 N1 运行 Linux 以及后续的优化，在此之前，需要将你的 N1 降级并刷入 webpad 的官改固件，或者只刷入降级关键分区（感谢群里的小伙伴反馈）。传送门：<a href="/2018/08/12/%E6%96%90%E8%AE%AF%20N1%20%E6%8A%98%E8%85%BE%E8%AE%B0%EF%BC%9A%E9%99%8D%E7%BA%A7%E5%8F%8A%E5%88%B7%E5%85%A5%E5%AE%98%E6%94%B9/">《斐讯N1折腾记：降级及刷入官改》</a></p>
<h2 id="制作-Linux-启动盘"><a href="#制作-Linux-启动盘" class="headerlink" title="制作 Linux 启动盘"></a>制作 Linux 启动盘</h2><p>　　N1 运行 Linux 的原理是通电的时候引导 U 盘里的系统<br>　　所以我们需要准备一个 U 盘来制作启动盘，U 盘大小推荐不低于 8G，连续读写速度推荐达到 30M/s，随机读写速度推荐达到 10M/s。最好是买个全新的，如果是旧的，提前备份好 U 盘内数据。<br>　　N1 运行的 Linux 发行版叫做 Armbian，玩过树莓派的小伙伴应该对这个系统不陌生，是适用于 ARM 架构的 Debian 和 Ubuntu。</p>
<blockquote>
<p><strong>下载地址</strong></p>
<p>Armbian：<br><a href="https://pan.baidu.com/s/1ux7zAF2QYoLWwTTB0Ah5ug" target="_blank" rel="noopener">https://pan.baidu.com/s/1ux7zAF2QYoLWwTTB0Ah5ug</a> 密码：axov<br><a href="https://yadi.sk/d/pHxaRAs-tZiei" target="_blank" rel="noopener">https://yadi.sk/d/pHxaRAs-tZiei</a><br><a href="https://mega.nz/#F!j9QSDQSQ!6WpasOlbZYIInfw6yo4phQ" target="_blank" rel="noopener">https://mega.nz/#F!j9QSDQSQ!6WpasOlbZYIInfw6yo4phQ</a><br><a href="https://share.weiyun.com/5eCvcvS" target="_blank" rel="noopener">https://share.weiyun.com/5eCvcvS</a> （部分搬运）密码：mivmcn<br>启动盘制作工具：<a href="https://www.alexpage.de/usb-image-tool/download/" target="_blank" rel="noopener">https://www.alexpage.de/usb-image-tool/download/</a></p>
</blockquote>
<p>　　里面有好几个版本，下载最新的 5.44 版本，然后选择 kernel_3.14，3.14 内核在 N1 上面使用最好，WiFi、蓝牙都可以正常工作，如果你不需要蓝牙和 WiFi，也可以使用 4.16 版本。</p>
<blockquote>
<p><strong>IMG 文件名含义</strong></p>
<p>例如：<code>Armbian_5.44_S9xxx_Debian_stretch_3.14.29_server_20180601.img</code><br>Armbian：这个就不多说了<br>5.44：Armbian 的版本号<br>S9xxx：适用的 CPU<br>Debian：基于 Debian 编译的，另外还有 Ubuntu。<br>stretch：Debian 或 Ubuntu 的发行版代号，stretch 表示的是 Debian 9。<br>3.14.29：Linux 内核版本号<br>server：桌面环境，Server 代表的是服务器版，没桌面环境，其他的代表的是相应的桌面环境，比如：xfce、mate。<br>20180601：编译日期</p>
</blockquote>
<p>　　小白推荐使用 Ubuntu，桌面环境推荐使用 mate。我推荐使用 Debian Server，做一个真正的服务器。<br>　　下面我会以 Armbian_5.44_S9xxx_Debian_stretch_3.14.29_server_20180601 版为例<br>　　首先格式化你的 U 盘分区格式为 FAT32，推荐最好把 U 盘分区全部删除。<br>　　打开启动盘制作工具：左侧选择你的 U 盘 → 点击 [Restore] → 选择 Linux 镜像文件 → 提示框点击 [是] → 等待制作完成<br>　　制作完成后，会出现一个名为 BOOT 的分区，打开它。如果你把分区全部删除了，BOOT 分区默认是 FAT16 格式，Windows 是不会显示的，可以使用 Ubuntu 来访问。<br>　　把<code>dtb</code>文件夹里的<code>gxl_p230_2g.dtb</code>复制到 BOOT 分区的根目录并重命名为<code>dtb.img</code>。如果是 4.16 内核，dtb 文件是<code>meson-gxl-s905d-p230.dtb</code>。<br>　　将 N1 断电，插上 U 盘、网线，最好是插靠近 HDMI 接口那个 USB 接口，通电开机。<br>　　正常情况下顺利开机并进入 Linux 系统，如果没有进入 Linux 系统而是进入了 Android 系统，ADB 连接至 N1，输入<code>adb shell reboot update</code>。<br>　　接下来的操作我会以 SSH 远程连接为例，如果你使用 HDMI 连接显示器也可以，这种情况推荐你连接一个 USB HUB，方便连接鼠标和键盘，当然，如果你用的是 Server，那么就不需要鼠标了。<br>　　用户：root<br>　　密码：1234<br>　　如何获取 N1 运行 Linux 的 IP？打开 cmd，输入<code>nslookup amlogic</code>，如果<code>amlogic</code>无法解析IP，可以尝试解析<code>aml</code>。<br>　　首次登陆需要重置密码，先输入当前密码（1234），再输入新密码以及确认新密码。<br>　　设置完密码之后会让你新建一个普通用户，如果是使用 Server，直接按 Ctrl + C 跳过。如果是使用桌面版，推荐创建一个普通用户，按照提示操作即可。<br>　　跳过之后，再次使用 SSH 连接。<br>　　这时候，整个系统就可以用了，不过我们需要做一些小工作。</p>
<h2 id="小工作"><a href="#小工作" class="headerlink" title="小工作"></a>小工作</h2><p>　　加载 WiFi 驱动：<code>modprobe dhd &amp;&amp; echo dhd &gt;&gt; /etc/modules</code><br>　　设置时区：<code>echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone &amp;&amp; ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code><br>　　删除默认DNS：<code>rm /etc/resolvconf/resolv.conf.d/head &amp;&amp; touch /etc/resolvconf/resolv.conf.d/head &amp;&amp; systemctl restart network-manager.service</code><br>　　注：在重启系统后，输入<code>cat /etc/resolv.conf</code>，查看返回结果的第一行是否为<code>nameserver 8.8.8.8</code>，如果不是，则表示删除成功，如果是，则再执行一次删除命令。<br>　　停止红外支持：<code>systemctl stop lircd.service lircd-setup.service lircd.socket lircd-uinput.service lircmd.service</code><br>　　删除红外支持：<code>apt remove -y lirc &amp;&amp; apt autoremove -y</code><br>　　N1 没有红外，而且由于红外支持找不到红外，一直给系统日志写错误。<br>　　重启系统：<code>reboot</code><br>　　更新软件包：<code>apt update &amp;&amp; apt upgrade -y</code></p>
<h3 id="挂载外置存储设备"><a href="#挂载外置存储设备" class="headerlink" title="挂载外置存储设备"></a>挂载外置存储设备</h3><p>　　推荐把外置存储设备分区格式化为 ext4 格式，不推荐使用 NTFS 格式。<br>　　如果你的外置存储设备是 NTFS 格式，可以使用<code>mkfs.ext4</code>命令将你的外置存储设备格式化为 ext4 格式，格式化前提前备份数据。<br>　　可以用<code>fdisk -l</code>查看你的外置存储设备是那个设备，一般是<code>/dev/sdb</code>，分区是<code>/dev/sdb1</code>，如果有多个分区，依次类推。<br>　　输入<code>mkfs.ext4 /dev/sdb1</code>将分区格式化为 ext4，格式化完成后使用<code>fdisk -l</code>查看是否格式化成功，如果分区的 Type 属性为 Linux（如下图所示），表示分区为 ext4/3。</p>
<p><a href="/uploads/2018/08/fdisk.png"><img src="/uploads/2018/08/fdisk.png" alt="fdisk"></a></p>
<p>　　格式化成功后，为了方便挂载，可以给分区设置一个卷标。<br>　　命令：<code>e2label</code><br>　　设置卷标示例：<code>e2label /dev/sdb1 H1</code><br>　　查看卷标示例：<code>e2label /dev/sdb1</code><br>　　然后就可以挂载分区了<br>　　挂载分区示例：<code>echo &quot;LABEL=H1 /mnt ext4 defaults,noatime,nodiratime 0 2&quot; &gt;&gt; /etc/fstab</code><br>　　此命令会将卷标为 H1 的分区挂载到 /mnt 目录下<br>　　重启系统使挂载生效</p>
<h3 id="Samba-网络共享"><a href="#Samba-网络共享" class="headerlink" title="Samba 网络共享"></a>Samba 网络共享</h3><p>　　使用 Samba 将外置存储设备共享给其他设备<br>　　Samba 可以使用 Armbian 自带的一个可视化菜单来配置，非常方便。<br>　　启动 Armbian 配置菜单：<code>armbian-config</code><br>　　选择 [Software] → [Softy] → 选中 (空格) [Samba] → 回车 → 输入 samba 用户名和密码 → 工作组填写 WORKGROUP → 等待安装完成<br>　　安装后，它会自动弹出修改配置文件的界面。</p>
<p><a href="/uploads/2018/08/samba.png"><img src="/uploads/2018/08/samba.png" alt="samba"></a></p>
<p>　　将红框里的内容删除<br>　　将 ext 的 path 改为 /mnt，如果你的挂载路径不是 /mnt，则改为你的挂载路径。<br>　　按下 TAB 键 → 选择 [OK] → 保存退出<br>　　Samba 网络共享配置完成</p>
<h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>　　小山觉得，既然斐讯 N1 的定位是 NAS，那么运行 Android 系统是显然满足不了 NAS 这个属性的，只有运行稳定且高效的 Linux 才可以称为 NAS。<br>　　Linux 有着更多的扩展性，你可以在上面任意的折腾，比如搭建个开发环境，Web 服务器等等。<br>　　总而言之，几十块钱买个 N1 这样的玩具，小山觉得是非常值的。<br>　　还是那句话：文章有什么不懂的地方，欢迎在下方或者在QQ群告诉我。<br>　　以后如果我想到 N1 的更多玩法会继续分享给大家的，再次感谢所有为 N1 可玩性付出的人。<br>　　本篇文章参考了以下资料：</p>
<ul>
<li><a href="https://forum.armbian.com/topic/2419-armbian-for-amlogic-s905-and-s905x/" target="_blank" rel="noopener">https://forum.armbian.com/topic/2419-armbian-for-amlogic-s905-and-s905x/</a></li>
<li><a href="http://www.right.com.cn/forum/thread-323198-1-1.html" target="_blank" rel="noopener">http://www.right.com.cn/forum/thread-323198-1-1.html</a></li>
<li><a href="http://www.right.com.cn/forum/thread-326034-1-1.html" target="_blank" rel="noopener">http://www.right.com.cn/forum/thread-326034-1-1.html</a></li>
</ul>
<p>　　转载自 <a href="https://www.mivm.cn/phicomm-n1-linux/" target="_blank" rel="noopener">https://www.mivm.cn/phicomm-n1-linux/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/斐讯/">斐讯</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/08/13/斐讯 N1 折腾记：运行 Linux 及优化/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/08/12/斐讯 N1 折腾记：降级及刷入官改/"><span>斐讯 N1 折腾记：降级及刷入官改</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/08/12/斐讯 N1 折腾记：降级及刷入官改/" rel="bookmark">
        <time class="entry-date published" datetime="2018-08-12T06:16:54.000Z">
          2018-08-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>　　上个月，斐讯 K2T 首发那天，小山一不小心抢了两台 K2T，这就尴尬了。退了吧，好不容易抢到的，不退吧，我只能激活一台。所以，两台 K2T 我自己用了一台，另一台我准备卖出去。然而一个月过去了，眼看K码就要到期了，还是没有人要。咋办呢，只能再注册个账号来激活这台 K2T，但是首次激活的机会不能浪费啊，所以我又买了 N1 + H1 。<br>　　本来我根本不打算买 N1，因为我觉得这货没啥用，也没怎么关注过它。但是买来之后才发现，这货居然还能刷固件，刷完固件之后就是个电视盒子了，而且还能运行完整的 Linux。<br>　　这就非常耐斯了，我的折腾之心按耐不住了，所以就开始一步步的折腾。<br>　　这篇教程就先教大家给 斐讯 N1 降级以及刷入官改固件（电视盒子），这也是以后折腾的基础。</p>
<h2 id="降级"><a href="#降级" class="headerlink" title="降级"></a>降级</h2><p>　　如果你的 N1 系统版本是 2.19，那么可以直接跳过降级过程，如果是其他版本，请按照下面的方法降级关键分区。<br>　　降级准备：你需要有一根双公头的 USB 数据线，淘宝几块钱包邮，附上小山购买的链接（绝对不是广告）：<a href="https://detail.tmall.com/item.htm?id=13036924933" target="_blank" rel="noopener">https://detail.tmall.com/item.htm?id=13036924933</a><br>　　有些机智的小伙伴可能会说，我主板有 Type-C 接口，我拿手机的 Type-C 数据线，Type-C 这头插主板，A 头插 N1 行不行。<br>　　这个方法是可以的，小山最开始也是这么做的。但是，只能用来降级，刷官改是不行的，这个问题在刷官改步骤会解释。</p>
<ol>
<li>开启 ADB 调试</li>
</ol>
<p>　　非常简单，只需要用鼠标点击斐讯 N1 官方固件的那个版本号 4 次，出现 【ADB调试开启】的字样即可。</p>
<ol start="2">
<li>重启至 fastboot 模式</li>
</ol>
<p>　　如果经常给手机刷机的小伙伴，对这个模式肯定不陌生，也就是我们平常所说的线刷模式。<br>　　这一步需要用到 ADB 调试工具，下载地址：<a href="https://dl.google.com/android/repository/platform-tools-latest-windows.zip" target="_blank" rel="noopener">https://dl.google.com/android/repository/platform-tools-latest-windows.zip</a><br>　　下载完成后解压，然后打开解压后的文件夹。按住 Shift，鼠标右键点击空白处，点击 [在此处打开 Powershell 窗口] 或 [在此处打开 命令提示符 窗口]。<br>　　输入<code>.\adb.exe connect %IP%</code><br>　　将 %IP% 替换为 N1 的 IP，也就是官方固件页面显示的那个 IP。<br>　　示例：<code>.\adb.exe connect 192.168.1.222</code><br>　　如果返回类似<code>connected to 192.168.1.222</code>这样的提示，表示连接成功。<br>　　连接成功后输入<code>.\adb.exe shell reboot fastboot</code>，重启至 fastboot 模式。</p>
<ol start="3">
<li>刷入降级关键分区</li>
</ol>
<p>　　将你的 N1 用双公头 USB 数据线与电脑连接，务必连接至靠近 HDMI 接口的那个 USB 接口，连接后查看设备管理器是否识别出新的硬件，如果新硬件驱动异常，右键新硬件点击 [更新驱动程序]。<br>　　驱动正常后，输入<code>.\fastboot.exe devices</code>查看 fastboot 工具是否已识别设备。<br>　　如果返回类似<code>XXXXXXXXXXXX fastboot</code>这样的提示，表示成功识别。<br>　　注：XXXXX 为序列号<br>　　然后就可以刷入降级分区了，分区文件下载地址：<a href="/uploads/2018/08/N1_V2.19_imgs.zip">N1_V2.19_imgs.zip</a><br>　　将压缩包内的分区文件解压至 ADB 工具包文件夹<br>　　依次输入命令刷入各个分区</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.\fastboot.exe flash boot boot.img</span><br><span class="line">.\fastboot.exe flash bootloader bootloader.img</span><br><span class="line">.\fastboot.exe flash recovery recovery.img</span><br></pre></td></tr></table></figure>
<p>　　如果没有返回任何错误信息，表示降级成功。<br>　　输入<code>.\fastboot.exe reboot</code>重启设备<br>　　至此，降级步骤就完成了，可以放心的刷官改固件了。<br>　　可能有些小伙伴会说，系统版本哪里显示的不是 2.19 啊。这个降级并不是降级系统，而是降级引导等关键分区，所以系统版本哪里不会变的。</p>
<h2 id="刷入官改"><a href="#刷入官改" class="headerlink" title="刷入官改"></a>刷入官改</h2><p>　　这一步比较危险和麻烦，也正是因为这一步困扰了小山好久。<br>　　上面我说了，小山试过用 Type-C 数据线刷官改，但是没成功，为什么呢？<br>　　问题不是出在 Type-C 上面，而是出在那个垃圾烧录工具的驱动上面（<del>国产芯片的烧录工具，你们懂的</del>）。<br>　　那个烧录工具的驱动程序虽然可以兼容 Windows 10，但是缺兼容不了最新 CPU 平台。<br>　　小山用的是 Ryzen 平台，B350 主板，但是小山各种方法都试过了，插上去它就是识别不了。后来小山把以前的旧电脑拿出来，同一个系统环境，旧电脑插上去就识别了。所以我认为是那个驱动不支持最新的CPU平台，当然，我这里只测试了 Ryzen，酷睿系列没测试，但是我估计，酷睿 7 8 系也都不支持，如果有用酷睿新平台的小伙伴成功了记得在下面留言告诉我。<br>　　所以说，这一步，如果你用的是 Ryzen 平台，那么还是去找一台比较旧的电脑吧。<br>　　注：小山并没有看不起国产芯片，以上言论只针对晶晨USB烧录工具。<br>　　首先下载USB烧录工具，下载地址：<a href="/uploads/2018/08/USB_Burning_Tool_v2.1.6.zip">USB_Burning_Tool_v2.1.6.zip</a><br>　　安装的时候记得创建桌面快捷方式，安装最后的驱动安装一定不要跳过。<br>　　另外小山找到了一个 Linux 版本的烧录工具，但没来得及测试，有兴趣的小伙伴可以试一试：<a href="http://forum.khadas.com/t/burning-tools-for-linux-pc/1832" target="_blank" rel="noopener">http://forum.khadas.com/t/burning-tools-for-linux-pc/1832</a><br>　　安装完成后还有个小工作要做</p>
<blockquote>
<p><strong>小工作</strong></p>
<p>打开设备管理器<br>随便点击一个硬件<br>点击 [操作] 菜单 → [添加过时硬件] → 下一步 → 选择 [安装我手动从列表选择的硬件] → 下一步 → 选择 [libusb-win32 Usb Devices] → 下一步 →  选择 [WorldCup Device] → 下一步 →  下一步 → 完成<br><a href="/uploads/2018/08/Burning_Tool_Driver.png"><img src="/uploads/2018/08/Burning_Tool_Driver.png" alt="Burning Tool 驱动"></a><br>小工作做完之后，那个USB烧录工具才可以正常工作。</p>
</blockquote>
<p>　　官改固件我推荐刷 webpad 的官改固件，集成度高，也很好用，自带 Google 服务、Root、Xposed 框架、离线下载等常用软件。下载地址：<a href="http://www.right.com.cn/forum/thread-322736-1-1.html" target="_blank" rel="noopener">http://www.right.com.cn/forum/thread-322736-1-1.html</a><br>　　如果只是想当一个电视盒子用的，也可以刷 YYFROM 的语音版固件，下载地址：<a href="http://www.yyfrom.com/cms/yyfrom/product/2018-4-9/156.html" target="_blank" rel="noopener">http://www.yyfrom.com/cms/yyfrom/product/2018-4-9/156.html</a><br>　　下载你喜欢的官改固件，解压压缩包，得到 img 文件。<br>　　打开 USB_Burning_Tool → 点击 [文件] 菜单 → 导入烧录包 → 选择官改固件的 img 文件 → 等待校验完成<br>　　<strong>校验完成后，一定要去除勾选右边烧录配置的 [擦除flash] 和 [擦除bootloader]，否则会报错。</strong></p>
<p><a href="/uploads/2018/08/Burning_Tool_01.png"><img src="/uploads/2018/08/Burning_Tool_01.png" alt="Burning Tool"></a></p>
<p>　　然后点击烧录工具的 【开始】，这时候，工具就进入了待命状态。<br>　　首先将 N1 彻底断电，然后用双公头 USB 数据线连接电脑，然后接通电源。<br>　　如果不出意外，工具应该会识别出 N1 并且开始烧录。<br>　　如果没有识别出 N1，而 N1 直接进入了系统。使用 ADB 连接 N1（方法见上），输入<code>.\adb.exe shell reboot update</code>重启至刷机模式，应该就可以正常识别了。<br>　　小山懒得再搬出旧电脑了，这里的截图借用别人的。</p>
<p><a href="/uploads/2018/08/Burning_Tool_02.png"><img src="/uploads/2018/08/Burning_Tool_02.png" alt="Burning Tool"></a></p>
<p>　　等待上方那个紫色的进度条变绿，提示烧录成功，这时候不要着急拔掉 N1，先点击烧录工具的 【停止】，再关闭烧录工具，然后拔掉 N1，断电，通电开机。<br>　　首次启动大约需要 3-4 分钟，请耐心等待。<br>　　系统启动后，会提示遥控器配对，因为用了 T1 的一些东西，直接跳过即可。<br>　　然后联网，安装一些直播、点播视频应用，就可以完完整整的当一个电视盒子来用了。<br>　　操控方面，可以使用天天链里的遥控器，也可以自己买个蓝牙遥控器，这个看个人喜好。<br>　　如果你刷了 webpad 的固件，在浏览器输入 IP:8081，既可管理离线下载、samba等软件。具体用法我就不多说了。</p>
<h2 id="后话"><a href="#后话" class="headerlink" title="后话"></a>后话</h2><p>　　斐讯 N1 现在二手平台仅卖 70 元，但 N1 的配置是跟那些两三百的电视盒子不相上下的，可谓是非常的有性价比。<br>　　如果你想入手一个电视盒子，或者是想买一个类似树莓派的玩具（不搞硬件开发）。那么可以考虑下 N1，做电视盒子绰绰有余，运行 Linux 后，就是一个没有硬件扩展性的树莓派，当然，我相信大多数人买树莓派是搞软件开发的。<br>　　这是我目前觉得斐讯最有性价比的产品之一<br>　　再次感谢 <a href="http://www.right.com.cn/forum/?4478" target="_blank" rel="noopener">webpad</a> 为 N1 可玩性做出的贡献<br>　　下篇教程教大家如何在 N1 上运行完整的 Linux 发行版</p>
<p>　　转载自 <a href="https://www.mivm.cn/phicomm-n1-unofficial/" target="_blank" rel="noopener">https://www.mivm.cn/phicomm-n1-unofficial/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/斐讯/">斐讯</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/08/12/斐讯 N1 折腾记：降级及刷入官改/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2018/07/12/流水账记录下 Centos 7 配置 frp 服务端与客户端的全过程/"><span>流水账记录下 Centos 7 配置 frp 服务端与客户端的全过程</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2018/07/12/流水账记录下 Centos 7 配置 frp 服务端与客户端的全过程/" rel="bookmark">
        <time class="entry-date published" datetime="2018-07-12T00:51:43.000Z">
          2018-07-12
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>下载 frp：<a href="https://github.com/fatedier/frp/releases" target="_blank" rel="noopener">https://github.com/fatedier/frp/releases</a>，解压到 <code>/usr/local/frp</code> 目录下</p>
<p><strong>服务端：</strong><br>编辑四个文件：<br>/usr/local/frp/frps_full.ini（配置文件，视情况编辑）</p>
<p>/usr/lib/systemd/system/frps.service<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=frps</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/cron.hourly/frps</span><br><span class="line">ExecReload=/usr/bin/frpsreload</span><br><span class="line">ExecStop=/usr/bin/killall frps</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p>
<p>/etc/cron.hourly/frps<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">echo $(date +"%Y-%m-%d %H:%M:%S") &gt; /tmp/frpTimestamp</span><br><span class="line">ps aux | grep "frps -c" | grep -v grep</span><br><span class="line">if [ $? -ne 0 ];then</span><br><span class="line">    nohup /usr/local/frp/frps -c /usr/local/frp/frps_full.ini &gt;&gt; /root/frp.log 2&gt;&amp;1 &amp; echo $! &gt; /var/run/frp-server.pid</span><br><span class="line">fi;</span><br></pre></td></tr></table></figure></p>
<p>/usr/bin/frpsreload<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">kill -9 $(cat /var/run/frp-server.pid)</span><br><span class="line">nohup /usr/local/frp/frps -c /usr/local/frp/frps_full.ini &gt;&gt; /root/frp.log 2&gt;&amp;1 &amp; echo $! &gt; /var/run/frp-server.pid</span><br></pre></td></tr></table></figure></p>
<p>然后执行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable frps</span><br><span class="line">systemctl start frps</span><br></pre></td></tr></table></figure></p>
<p>最后是 nginx 反代设置：<br>/usr/local/nginx/conf/vhost/pi.imjs.0cdn.cn.conf<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  pi.imjs.0cdn.cn *.pi.imjs.0cdn.cn;</span><br><span class="line"> </span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass        http://127.0.0.1:8080;</span><br><span class="line">        proxy_set_header  X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header  Host $host:8080;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>客户端：</strong><br>编辑四个文件：<br>/usr/local/frp/frpc_full.ini（配置文件，视情况编辑）</p>
<p>/usr/lib/systemd/system/frp.service<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=frp</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/etc/cron.hourly/frp</span><br><span class="line">ExecReload=/usr/bin/frpreload</span><br><span class="line">ExecStop=killall frp</span><br><span class="line">PrivateTmp=true</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure></p>
<p>/etc/cron.hourly/frp<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">echo $(date +"%Y-%m-%d %H:%M:%S") &gt; /tmp/frpTimestamp</span><br><span class="line">ps aux | grep "frpc -c" | grep -v grep</span><br><span class="line">if [ $? -ne 0 ];then</span><br><span class="line">    ntpdate ntp1.aliyun.com &amp;&amp; (nohup /usr/local/frp/frpc -c /usr/local/frp/frpc_full.ini &gt;&gt; /root/frp.log 2&gt;&amp;1 &amp; echo $! &gt; /var/run/frp-client.pid)</span><br><span class="line">fi;</span><br></pre></td></tr></table></figure></p>
<p>/usr/bin/frpreload<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/sh</span><br><span class="line">kill -9 $(cat /var/run/frp-client.pid)</span><br><span class="line">nohup /usr/local/frp/frpc -c /usr/local/frp/frpc_full.ini &gt;/dev/null 2&gt;&amp;1 &amp; echo $! &gt; /var/run/frp-client.pid</span><br></pre></td></tr></table></figure></p>
<p>最后执行：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable frp</span><br><span class="line">systemctl start frp</span><br></pre></td></tr></table></figure></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2018/07/12/流水账记录下 Centos 7 配置 frp 服务端与客户端的全过程/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/11/19/清除windows访问Samba的访问记录/"><span>清除windows访问Samba的访问记录</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/11/19/清除windows访问Samba的访问记录/" rel="bookmark">
        <time class="entry-date published" datetime="2017-11-19T00:45:01.000Z">
          2017-11-19
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>在 windows 中访问 Samba 服务器后，windows 会存储访问记录，比如密码。当我们想清除密码，重新输入时，步骤如下：<br><strong>1. 获取访问记录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#在windows的命令行(cmd)中运行net use，可见访问Samba服务器的记录：</span><br><span class="line">C:\Users\User&gt;net use</span><br><span class="line">会记录新的网络连接。 </span><br><span class="line">状态       本地        远程                      网络</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">OK                     \\192.168.2.1\IPC$         Microsoft Windows Network</span><br><span class="line">命令成功完成。</span><br></pre></td></tr></table></figure></p>
<p><strong>2. 删除访问记录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\User&gt;net use \\192.168.2.1\IPC$ /del /y</span><br><span class="line"> \\192.168.2.1\IPC$ 已经删除。</span><br></pre></td></tr></table></figure></p>
<p><strong>3. 尝试重新登陆Samba</strong></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/openwrt/">openwrt</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2017/11/19/清除windows访问Samba的访问记录/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/11/04/斐讯 K3 流光金开箱与 TTL 刷 LEDE 教程（适用于 v21.5.39.260 系统）/"><span>斐讯 K3 流光金开箱与 TTL 刷 LEDE 教程（适用于 v21.5.39.260 系统）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/11/04/斐讯 K3 流光金开箱与 TTL 刷 LEDE 教程（适用于 v21.5.39.260 系统）/" rel="bookmark">
        <time class="entry-date published" datetime="2017-11-04T10:40:13.000Z">
          2017-11-04
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>注意：V21.5.39.260 集成的 CFE 编译日期为 8月2日，斐讯封堵了 CFE 网页执行命令，而且固件采用公私钥验证，除了 TTL 手动执行命令基本无法刷入其他固件（<a href="http://www.right.com.cn/forum/thread-212725-1-1.html" target="_blank" rel="noopener">斐讯K3 官方固件root版本 安装插件 entware </a>）</strong></p>
<p><strong>本文分四段：开箱，拆机加 TTL，CFE 刷官改固件，网页刷 LEDE 固件</strong></p>
<p><strong>在刷入 LEDE 固件之前，不要给 k3 连网！避免自动升级！<br>在刷入 LEDE 固件之前，不要给 k3 连网！避免自动升级！<br>在刷入 LEDE 固件之前，不要给 k3 连网！避免自动升级！</strong></p>
<p>11 月 1 号 K3 流光金首发送贼快的闪迪 U 盘，趁活动入了两台：<br><a href="/uploads/2017/11/QQ截图20171105012114.png"><img src="/uploads/2017/11/QQ截图20171105012114.png" alt=""></a></p>
<p>先上购买链接：</p>
<ul>
<li>斐讯K3流光金 AC3150：<a href="http://t.cn/RWIdtzy" target="_blank" rel="noopener">https://item.jd.com/5428209.html</a></li>
</ul>
<ul>
<li>斐讯K3星空银 AC3150：<a href="http://t.cn/RO955lB" target="_blank" rel="noopener">https://item.jd.com/3959251.html</a></li>
</ul>
<p>到手开箱全家福：<br><a href="/uploads/2017/11/20171102_120516.jpg"><img src="/uploads/2017/11/20171102_120516-1024x768.jpg" alt=""></a></p>
<p>四网口 + USB 3.0：<br><a href="/uploads/2017/11/20171102_120552.jpg"><img src="/uploads/2017/11/20171102_120552-768x1024.jpg" alt=""></a></p>
<p>整机照：<br><a href="/uploads/2017/11/20171102_121232.jpg"><img src="/uploads/2017/11/20171102_121232-768x1024.jpg" alt=""></a></p>
<p>mmp 的系统版本 v21.5.39.260：<br><a href="/uploads/2017/11/QQ截图20171102121540.png"><img src="/uploads/2017/11/QQ截图20171102121540.png" alt=""></a></p>
<p>嗯废话说完，先给各位拆个机</p>
<p>第一步先扯下底部脚垫，卸下四个螺丝。注意这里有保修易碎贴，如果还要保修的话，拿电吹风吹下挑开：<br><a href="/uploads/2017/11/20171104_154507.jpg"><img src="/uploads/2017/11/20171104_154507-768x1024.jpg" alt=""></a></p>
<p>第二步从如图位置插入塑料卡片撬开两侧侧面面板。最好不要用美工刀、钢尺等锐利的物品操作，会留下撬痕：<br><a href="/uploads/2017/11/20171104_155201.jpg"><img src="/uploads/2017/11/20171104_155201-768x1024.jpg" alt=""></a></p>
<p>第三步拆开侧面面板，轻轻取下上方天线（注意侧面有卡扣，把塑料外壳往外掰一下就可以取出来了），取下后搁在上面就行，目的是为了卸螺丝。<br><a href="/uploads/2017/11/20171104_155356.jpg"><img src="/uploads/2017/11/20171104_155356-1024x768.jpg" alt=""></a></p>
<p>第四步卸下固定两块主板用的八颗螺丝（在螺丝边上上胶的家伙我谢谢你全家）：</p>
<p><a href="/uploads/2017/11/20171104_160635.jpg"><img src="/uploads/2017/11/20171104_160635-1024x768.jpg" alt=""></a></p>
<p><a href="/uploads/2017/11/20171104_164950.jpg"><img src="/uploads/2017/11/20171104_164950-768x1024.jpg" alt=""></a></p>
<p>第五步在下方主板的右侧 TX RX GND 塞 TTL 线并固定（如果要保修的话，不要固定，我是为了方便以后刷机）我用的热熔胶，如果希望牢固一点的话可以用焊锡。线可以从边上散热孔引出：<br><a href="/uploads/2017/11/20171104_165104.jpg"><img src="/uploads/2017/11/20171104_165104-768x1024.jpg" alt=""></a></p>
<p><a href="/uploads/2017/11/20171104_185431.jpg"><img src="/uploads/2017/11/20171104_185431-768x1024.jpg" alt=""></a></p>
<p>第六步接 TTL 小板调试（TX 接 RXD，RX 接 TXD，GND 接 GND），115200，如果有输出，就是正常的：<br><a href="/uploads/2017/11/20171104_171541.jpg"><img src="/uploads/2017/11/20171104_171541-768x1024.jpg" alt=""></a></p>
<p>最后合上侧面面板：<br><a href="/uploads/2017/11/20171104_191757.jpg"><img src="/uploads/2017/11/20171104_191757-1024x768.jpg" alt=""></a></p>
<p>PS 最后找公司的硬件工程师帮忙把引出的线改成了座儿，用热熔胶固定在了散热口：<br><a href="/uploads/2017/11/20171105_222222.jpg"><img src="/uploads/2017/11/20171105_222222-768x1024.jpg" alt=""></a></p>
<p><a href="/uploads/2017/11/20171105_231846.jpg"><img src="/uploads/2017/11/20171105_231846-768x1024.jpg" alt=""></a></p>
<p>有了 TTL，我们需要先刷入破解了 root 的官改固件并降级，为刷入 LEDE 固件做准备：</p>
<p>以下是需要的软件：</p>
<ul>
<li>Tftpd：<a href="http://tftpd32.jounin.net/" target="_blank" rel="noopener">http://tftpd32.jounin.net/</a></li>
</ul>
<ul>
<li>官改固件下载：<a href="/uploads/2017/11/k3_root.zip">k3_root</a></li>
</ul>
<ul>
<li>低版本 mtd6 镜像下载：<a href="/uploads/2017/11/K3-linux-partition-mtd6.zip">K3-linux-partition-mtd6</a></li>
</ul>
<p>第一步下载固件，安装运行 Tftpd 工具。使用网线连接至 k3 上，设置静态 IP 192.168.2.100，网关 192.168.2.1，将 Tftpd 中的目录切换到你存放解压出来的固件目录，并切换网卡（应该是 192.168.2.100，我因为刷机后截的图地址不一样）：<br><a href="/uploads/2017/11/QQ图片20171105020419.png"><img src="/uploads/2017/11/QQ图片20171105020419.png" alt=""></a></p>
<p>第二步给路由器断电，连接 TTL，捅 Reset 通电开机，如果成功进入 CFE 会出现下一步图中以 CFE&gt; 开头的界面</p>
<p>第三步输入命令，CFE 会拉取你本机上的固件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flash -noheader 192.168.2.100:/k3_root.bin nflash0.trx</span><br></pre></td></tr></table></figure></p>
<p><a href="/uploads/2017/11/QQ图片20171105020442.jpg"><img src="/uploads/2017/11/QQ图片20171105020442.jpg" alt=""></a></p>
<p>第四步等写入完成后输入 reboot 重启</p>
<p>第五步在 TTL 输入以下命令，将 mtd6 镜像拉至路由器上并写入（<strong>镜像大小 44M，刷写时间比较长，大约需要 20 ~ 30 分钟（尽量多等一段时间），刷写过程中不要断开路由器的电源或拔网线，以免变砖！！！</strong>）：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp</span><br><span class="line">tftp -g -l K3-linux-partition-mtd6.img -r K3-linux-partition-mtd6.img 192.168.2.100</span><br><span class="line">cat /tmp/K3-linux-partition-mtd6.img &gt; /dev/mtd6</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure></p>
<p>最后进入功能设置 –&gt; 手动升级看到如图系统版本就说明成功了<br><a href="/uploads/2017/11/QQ图片20171105021238.png"><img src="/uploads/2017/11/QQ图片20171105021238.png" alt=""></a></p>
<p>随后开始刷 LEDE</p>
<p>固件下载：</p>
<ul>
<li>基础包（无密码）：<a href="/uploads/2017/11/lede-bcm53xx-phicomm-k3-squashfs-factory.zip">lede-bcm53xx-phicomm-k3-squashfs-factory</a></li>
</ul>
<ul>
<li>升级包（默认登录密码是 password）：<a href="/uploads/2017/11/LEDE-17.01.2-R7.3.2-bcm53xx-phicomm-k3-squashfs.rar">LEDE-17.01.2-R7.3.2-bcm53xx-phicomm-k3-squashfs</a></li>
</ul>
<p>第一步刷入基础包，进入功能设置 –&gt; 手动升级，上传：<br><a href="/uploads/2017/11/QQ图片20171105021247.png"><img src="/uploads/2017/11/QQ图片20171105021247.png" alt=""></a></p>
<p><a href="/uploads/2017/11/QQ图片20171105022757.png"><img src="/uploads/2017/11/QQ图片20171105022757.png" alt=""></a></p>
<p>第二步打开 192.168.1.1，进入 System –&gt; Backup / Flash Firmware，上传升级包固件<br><a href="/uploads/2017/11/QQ图片20171105023217.png"><img src="/uploads/2017/11/QQ图片20171105023217.png" alt=""></a></p>
<p>最后重启完成，重新打开 192.168.1.1，使用 root / password 登录即可：<br><a href="/uploads/2017/11/QQ截图20171105022906.png"><img src="/uploads/2017/11/QQ截图20171105022906.png" alt=""></a></p>
<p>该固件带屏幕驱动，感谢 Lean 大的无私奉献！<br><a href="/uploads/2017/11/20171105_011645.jpg"><img src="/uploads/2017/11/20171105_011645-711x1024.jpg" alt=""></a></p>
<p>参考以下文章：</p>
<ol>
<li>拆机部分：<a href="http://www.xinxunwei.com/wxjs/qtcjjc/2017/0327/7300.html" target="_blank" rel="noopener">斐讯路由器怎么样？斐讯K3拆机图解</a></li>
</ol>
<ol start="2">
<li>官改固件：<a href="http://www.right.com.cn/forum/thread-212725-1-1.html" target="_blank" rel="noopener">斐讯K3 官方固件root版本 安装插件 entware</a></li>
</ol>
<ol start="3">
<li>固件降级：<a href="http://koolshare.cn/thread-95398-1-2.html" target="_blank" rel="noopener">K3原厂固件从217版降级212版方法</a></li>
</ol>
<ol start="4">
<li>Lean 大 LEDE：<a href="http://www.right.com.cn/forum/thread-214087-1-1.html" target="_blank" rel="noopener">斐讯 K3 OPENWRT LEDE R7.3  固件，Adbyby Plus，潘多拉多拨，S…</a></li>
</ol>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/openwrt/">openwrt</a>, <a href="/categories/openwrt/斐讯/">斐讯</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2017/11/04/斐讯 K3 流光金开箱与 TTL 刷 LEDE 教程（适用于 v21.5.39.260 系统）/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/10/28/PHP无限级分类实现（递归+非递归）/"><span>PHP无限级分类实现（递归+非递归）</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/10/28/PHP无限级分类实现（递归+非递归）/" rel="bookmark">
        <time class="entry-date published" datetime="2017-10-28T04:21:16.000Z">
          2017-10-28
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by PhpStorm.</span></span><br><span class="line"><span class="comment"> * User: qishou</span></span><br><span class="line"><span class="comment"> * Date: 15-8-2</span></span><br><span class="line"><span class="comment"> * Time: 上午12:00</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//准备数组，代替从数据库中检索出的数据(共有三个必须字段id,name,pid)</span></span><br><span class="line">header(<span class="string">"content-type:text/html;charset=utf-8"</span>);</span><br><span class="line">$categories = <span class="keyword">array</span>(</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">1</span>,<span class="string">'name'</span>=&gt;<span class="string">'电脑'</span>,<span class="string">'pid'</span>=&gt;<span class="number">0</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">2</span>,<span class="string">'name'</span>=&gt;<span class="string">'手机'</span>,<span class="string">'pid'</span>=&gt;<span class="number">0</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">3</span>,<span class="string">'name'</span>=&gt;<span class="string">'笔记本'</span>,<span class="string">'pid'</span>=&gt;<span class="number">1</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">4</span>,<span class="string">'name'</span>=&gt;<span class="string">'台式机'</span>,<span class="string">'pid'</span>=&gt;<span class="number">1</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">5</span>,<span class="string">'name'</span>=&gt;<span class="string">'智能机'</span>,<span class="string">'pid'</span>=&gt;<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">6</span>,<span class="string">'name'</span>=&gt;<span class="string">'功能机'</span>,<span class="string">'pid'</span>=&gt;<span class="number">2</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">7</span>,<span class="string">'name'</span>=&gt;<span class="string">'超级本'</span>,<span class="string">'pid'</span>=&gt;<span class="number">3</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="number">8</span>,<span class="string">'name'</span>=&gt;<span class="string">'游戏本'</span>,<span class="string">'pid'</span>=&gt;<span class="number">3</span>),</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*======================非递归实现========================*/</span></span><br><span class="line">$tree = <span class="keyword">array</span>();</span><br><span class="line"><span class="comment">//第一步，将分类id作为数组key,并创建children单元</span></span><br><span class="line"><span class="keyword">foreach</span>($categories <span class="keyword">as</span> $category)&#123;</span><br><span class="line">    $tree[$category[<span class="string">'id'</span>]] = $category;</span><br><span class="line">    $tree[$category[<span class="string">'id'</span>]][<span class="string">'children'</span>] = <span class="keyword">array</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第二步，利用引用，将每个分类添加到父类children数组中，这样一次遍历即可形成树形结构。</span></span><br><span class="line"><span class="keyword">foreach</span>($tree <span class="keyword">as</span> $key=&gt;$item)&#123;</span><br><span class="line">    <span class="keyword">if</span>($item[<span class="string">'pid'</span>] != <span class="number">0</span>)&#123;</span><br><span class="line">        $tree[$item[<span class="string">'pid'</span>]][<span class="string">'children'</span>][] = &amp;$tree[$key];<span class="comment">//注意：此处必须传引用否则结果不对</span></span><br><span class="line">        <span class="keyword">if</span>($tree[$key][<span class="string">'children'</span>] == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">unset</span>($tree[$key][<span class="string">'children'</span>]); <span class="comment">//如果children为空，则删除该children元素（可选）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">////第三步，删除无用的非根节点数据</span></span><br><span class="line"><span class="keyword">foreach</span>($tree <span class="keyword">as</span> $key=&gt;$category)&#123;</span><br><span class="line">    <span class="keyword">if</span>($category[<span class="string">'pid'</span>] != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">unset</span>($tree[$key]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">print_r($tree);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*======================递归实现========================*/</span></span><br><span class="line">$tree = $categories;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_attr</span><span class="params">($a,$pid)</span></span>&#123;</span><br><span class="line">    $tree = <span class="keyword">array</span>();                                <span class="comment">//每次都声明一个新数组用来放子元素</span></span><br><span class="line">    <span class="keyword">foreach</span>($a <span class="keyword">as</span> $v)&#123;</span><br><span class="line">        <span class="keyword">if</span>($v[<span class="string">'pid'</span>] == $pid)&#123;                      <span class="comment">//匹配子记录</span></span><br><span class="line">            $v[<span class="string">'children'</span>] = get_attr($a,$v[<span class="string">'id'</span>]); <span class="comment">//递归获取子记录</span></span><br><span class="line">            <span class="keyword">if</span>($v[<span class="string">'children'</span>] == <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">unset</span>($v[<span class="string">'children'</span>]);             <span class="comment">//如果子元素为空则unset()进行删除，说明已经到该分支的最后一个元素了（可选）</span></span><br><span class="line">            &#125;</span><br><span class="line">            $tree[] = $v;                           <span class="comment">//将记录存入新数组</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $tree;                                  <span class="comment">//返回新数组</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;"</span>;</span><br><span class="line"></span><br><span class="line">print_r(get_attr($tree,<span class="number">0</span>));</span><br></pre></td></tr></table></figure>
<p>转载自 <a href="http://blog.csdn.net/qishouzhang/article/details/47204359" target="_blank" rel="noopener">http://blog.csdn.net/qishouzhang/article/details/47204359</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Web-开发/">Web 开发</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2017/10/28/PHP无限级分类实现（递归+非递归）/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2017/03/20/aria2配置示例/"><span>aria2配置示例</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2017/03/20/aria2配置示例/" rel="bookmark">
        <time class="entry-date published" datetime="2017-03-20T07:16:30.000Z">
          2017-03-20
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p>其实面对man的存在，写什么总结完全没有必要，一切宝藏都在<a href="http://aria2.sourceforge.net/manual/en/html/aria2c.html" target="_blank" rel="noopener">manual</a>。不过反正不会有人会读就是了。那我就写一下吧</p>
<p>##基础<br>首先，aria2或者叫做aria2c，它是一个下载器，嗯。<br>常用的两种模式是直接下载，比如 aria2c “<a href="http://host/file.zip&quot;" target="_blank" rel="noopener">http://host/file.zip&quot;</a> 这样，当它完成后就退出了，就像wget（估计你们也不知道吧）那样。<br>另一种就是rpc server模式，特点就是，它启动之后什么都不干，然后等着从rpc接口添加任务，下载完也不退出，而是一直等着。对，就像迅雷干的那样，当然，它不会上传你硬盘上的数据。<br>因为第一种方式要每次都敲命令，除非像我是原生nix，没有命令行就没法用电脑，估计也没什么用，于是常用的就是第二种。一般启动命令是 aria2c –enable-rpc –rpc-listen-all=true –rpc-allow-origin-all -c -D 。但是，其实*这个命令是不好的！不要使用这种启动方式。<br>首先，用命令方式导致配置不方便修改保存，-D导致无法看到出错信息。<br><strong>推荐启动方式是使用配置文件</strong> $HOME/.aria2/aria2.conf 。嗯，我知道路由上这个地址是无法修改或者重启后会丢失的，那么你可以放到别的地方，然后 aria2c –conf-path= 注意  填完整路径，因为鬼知道这个程序是从那个路径启动的。-D (用于后台执行, 这样ssh断开连接后程序不会退出） 只有在确认OK之后在启动脚本中使用。</p>
<p><strong>以下方案都基于配置文件方式</strong></p>
<p>##图形界面<br>aria2是没有图形界面的，已知相对好用的图形界面有：</p>
<ul>
<li><a href="https://github.com/binux/yaaw" target="_blank" rel="noopener">binux/yaaw</a></li>
</ul>
<ul>
<li><a href="https://github.com/ziahamza/webui-aria2" target="_blank" rel="noopener">ziahamza/webui-aria2</a></li>
</ul>
<p><strong>请使用chrome，firefox等现代浏览器访问</strong>。这两个东西都可以直接使用，除了看英文不爽以外，有什么必要下载回来使用？（吐槽：难道你们就不觉得webui-aria2的title总是被压成好几行，诡异的配色（对，说的就是那个蓝色背景，深蓝颜色的 Use custom IP and port settings 按钮）不难看吗？）<br>图形界面基本都基于RPC模式，所以一定<strong>确定开启了RPC，IP端口可访问，并且在管理器中填写了正确的地址</strong>。</p>
<p>##配置<br><strong>请将所有配置置于配置文件中<br>只有在确认配置无误后再加上 -D 选项<br>请阅读出错信息!</strong></p>
<p>###RPC<br>需要1.14及以上版本<br><a href="http://aria2.sourceforge.net/manual/en/html/aria2c.html#rpc-options" target="_blank" rel="noopener">http://aria2.sourceforge.net/manual/en/html/aria2c.html#rpc-options</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#允许rpc</span><br><span class="line">enable-rpc=true</span><br><span class="line">#允许所有来源, web界面跨域权限需要</span><br><span class="line">rpc-allow-origin-all=true</span><br><span class="line">#允许非外部访问</span><br><span class="line">rpc-listen-all=true</span><br><span class="line">#RPC端口, 仅当默认端口被占用时修改</span><br><span class="line">#rpc-listen-port=6800</span><br></pre></td></tr></table></figure></p>
<p>如果启动时出现 Initializing EpollEventPoll failed. 或相似错误, 在配置中加上 event-poll=select</p>
<p><strong>使用token验证（建议使用，需要1.18.4以上版本，帐号密码方式将在后续版本中停用！）</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># token验证</span><br><span class="line">rpc-secret=secret</span><br></pre></td></tr></table></figure></p>
<p>在YAAW中使用 <a href="http://token:secret@hostname:port/jsonrpc" target="_blank" rel="noopener">http://token:secret@hostname:port/jsonrpc</a> 的地址格式设置secret.<br>如果需要使用密码验证（需要1.15.2以上，1.18.6以下版本）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#用户名</span><br><span class="line">rpc-user=username</span><br><span class="line">#密码</span><br><span class="line">rpc-passwd=passwd</span><br></pre></td></tr></table></figure></p>
<p>在YAAW中使用 <a href="http://username:passwd@hostname:port/jsonrpc" target="_blank" rel="noopener">http://username:passwd@hostname:port/jsonrpc</a> 的地址格式设置密码.<br>对于RPC模式来说, 界面和后端是分离的, 只要给后端设置密码即可. 前端认证什么的是毫无意义的.<br>如果你比较新潮, 在YAAW中也可以用 ws:// 为前缀,只用websocket连接aria2c, 如果你不知道websocket是什么. 那就算了.</p>
<p>###速度相关<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#最大同时下载数(任务数), 路由建议值: 3</span><br><span class="line">max-concurrent-downloads=5</span><br><span class="line">#断点续传</span><br><span class="line">continue=true</span><br><span class="line">#同服务器连接数</span><br><span class="line">max-connection-per-server=5</span><br><span class="line">#最小文件分片大小, 下载线程数上限取决于能分出多少片, 对于小文件重要</span><br><span class="line">min-split-size=10M</span><br><span class="line">#单文件最大线程数, 路由建议值: 5</span><br><span class="line">split=10</span><br><span class="line">#下载速度限制</span><br><span class="line">max-overall-download-limit=0</span><br><span class="line">#单文件速度限制</span><br><span class="line">max-download-limit=0</span><br><span class="line">#上传速度限制</span><br><span class="line">max-overall-upload-limit=0</span><br><span class="line">#单文件速度限制</span><br><span class="line">max-upload-limit=0</span><br><span class="line">#断开速度过慢的连接</span><br><span class="line">#lowest-speed-limit=0</span><br><span class="line">#验证用，需要1.16.1之后的release版本</span><br><span class="line">#referer=*</span><br></pre></td></tr></table></figure></p>
<p>###进度保存相关<br>aria2c只有在正常退出时(ctrl-c), 突然断电是无法保存进度的. 在第一次使用的时候会出现会话文件不存在的错误, 手动创建一个空文件即可. 如果您编写的是自动启动脚本，在启动aria2前加上 touch aria2.session 这句命令。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input-file=/some/where/aria2.session</span><br><span class="line">save-session=/some/where/aria2.session</span><br><span class="line">#定时保存会话，需要1.16.1之后的release版</span><br><span class="line">#save-session-interval=60</span><br></pre></td></tr></table></figure></p>
<p>###磁盘相关<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#文件保存路径, 默认为当前启动位置</span><br><span class="line">dir=/some/where</span><br><span class="line">#文件缓存, 使用内置的文件缓存, 如果你不相信Linux内核文件缓存和磁盘内置缓存时使用, 需要1.16及以上版本</span><br><span class="line">#disk-cache=0</span><br><span class="line">#另一种Linux文件缓存方式, 使用前确保您使用的内核支持此选项, 需要1.15及以上版本(?)</span><br><span class="line">#enable-mmap=true</span><br><span class="line">#文件预分配, 能有效降低文件碎片, 提高磁盘性能. 缺点是预分配时间较长</span><br><span class="line">#所需时间 none &lt; falloc ? trunc &lt;&lt; prealloc, falloc和trunc需要文件系统和内核支持</span><br><span class="line">file-allocation=prealloc</span><br></pre></td></tr></table></figure></p>
<p>###BT相关<br><a href="http://aria2.sourceforge.net/manual/en/html/aria2c.html#bittorrent-specific-options" target="_blank" rel="noopener">http://aria2.sourceforge.net/manual/en/html/aria2c.html#bittorrent-specific-options</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#启用本地节点查找</span><br><span class="line">bt-enable-lpd=true</span><br><span class="line">#添加额外的tracker</span><br><span class="line">#bt-tracker=&lt;URI&gt;,…</span><br><span class="line">#单种子最大连接数</span><br><span class="line">#bt-max-peers=55</span><br><span class="line">#强制加密, 防迅雷必备</span><br><span class="line">#bt-require-crypto=true</span><br><span class="line">#当下载的文件是一个种子(以.torrent结尾)时, 自动下载BT</span><br><span class="line">follow-torrent=true</span><br><span class="line">#BT监听端口, 当端口屏蔽时使用</span><br><span class="line">#listen-port=6881-6999</span><br><span class="line">aria2亦可以用于PT下载, 下载的关键在于伪装</span><br><span class="line">#不确定是否需要，为保险起见，need more test</span><br><span class="line">enable-dht=false</span><br><span class="line">bt-enable-lpd=false</span><br><span class="line">enable-peer-exchange=false</span><br><span class="line">#修改特征</span><br><span class="line">user-agent=uTorrent/2210(25130)</span><br><span class="line">peer-id-prefix=-UT2210-</span><br><span class="line">#修改做种设置, 允许做种</span><br><span class="line">seed-ratio=0</span><br><span class="line">#保存会话</span><br><span class="line">force-save=true</span><br><span class="line">bt-hash-check-seed=true</span><br><span class="line">bt-seed-unverified=true</span><br><span class="line">bt-save-metadata=true</span><br><span class="line">#定时保存会话，需要1.16.1之后的某个release版本（比如1.16.2）</span><br><span class="line">#save-session-interval=60</span><br></pre></td></tr></table></figure></p>
<p>##常见问题</p>
<p>###Internal server error<br>手动访问你的JSON-RPC地址 <a href="http://hostname:port/jsonrpc?jsoncallback=1" target="_blank" rel="noopener">http://hostname:port/jsonrpc?jsoncallback=1</a> 如果没有返回, 请确认aria2是否启动以及连通性. 如果aria2在路由器后或没有公网IP, 请做好端口映射.</p>
<p>###如何使用迅雷离线<br><a href="http://binux.github.com/ThunderLixianExporter/" target="_blank" rel="noopener">http://binux.github.com/ThunderLixianExporter/</a><br>安装后, 在迅雷离线的右上角的设置中设置RPC地址.<br>提供chrome插件: <a href="https://chrome.google.com/webstore/detail/thunderlixianassistant/eehlmkfpnagoieibahhcghphdbjcdmen" target="_blank" rel="noopener">https://chrome.google.com/webstore/detail/thunderlixianassistant/eehlmkfpnagoieibahhcghphdbjcdmen</a></p>
<p>###如何使用旋风离线(QQ离线)<br><a href="http://userscripts.org/scripts/show/142624" target="_blank" rel="noopener">http://userscripts.org/scripts/show/142624</a><br>安装脚本后, 在旋风离线页面使用.</p>
<p>转载自 <a href="https://binux.blog/2012/12/aria2-examples/" target="_blank" rel="noopener">https://binux.blog/2012/12/aria2-examples/</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/VPS-技术/">VPS 技术</a>
    </span>
    

    

    </div>

    
    <div class="article-meta pull-right">
      <span>
        <i class="icon-comments"></i>
        <span>
          <a href="/2017/03/20/aria2配置示例/#comment">评论</a>
        </span>
      </span>
    </div>
    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2019 403 Forbidden
    
  </p>
</footer>
    
  </div>
</div>
</body>
</html>